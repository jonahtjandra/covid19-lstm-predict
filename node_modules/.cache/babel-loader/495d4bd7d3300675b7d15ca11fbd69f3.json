{"ast":null,"code":"(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['d3'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('d3'));\n  } else {\n    root.MG = factory(root.d3);\n  }\n})(this, function (d3) {\n  (typeof window === 'undefined' ? global : window).MG = {\n    version: '2.11'\n  }; //a set of helper functions, some that we've written, others that we've borrowed\n\n  MG.convert = {};\n\n  MG.convert.date = function (data, accessor, time_format) {\n    time_format = typeof time_format === \"undefined\" ? '%Y-%m-%d' : time_format;\n    var parse_time = d3.timeParse(time_format);\n    data = data.map(function (d) {\n      d[accessor] = parse_time(d[accessor].trim());\n      return d;\n    });\n    return data;\n  };\n\n  MG.convert.number = function (data, accessor) {\n    data = data.map(function (d) {\n      d[accessor] = Number(d[accessor]);\n      return d;\n    });\n    return data;\n  };\n\n  MG.time_format = function (utc, specifier) {\n    return utc ? d3.utcFormat(specifier) : d3.timeFormat(specifier);\n  };\n\n  function mg_jquery_exists() {\n    if (typeof jQuery !== 'undefined' || typeof $ !== 'undefined') {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  function mg_get_rollover_time_format(args) {\n    var fmt;\n\n    switch (args.processed.x_time_frame) {\n      case 'millis':\n        fmt = MG.time_format(args.utc_time, '%b %e, %Y  %H:%M:%S.%L');\n        break;\n\n      case 'seconds':\n        fmt = MG.time_format(args.utc_time, '%b %e, %Y  %H:%M:%S');\n        break;\n\n      case 'less-than-a-day':\n        fmt = MG.time_format(args.utc_time, '%b %e, %Y  %I:%M%p');\n        break;\n\n      case 'four-days':\n        fmt = MG.time_format(args.utc_time, '%b %e, %Y  %I:%M%p');\n        break;\n\n      default:\n        fmt = MG.time_format(args.utc_time, '%b %e, %Y');\n    }\n\n    return fmt;\n  }\n\n  function mg_data_in_plot_bounds(datum, args) {\n    return datum[args.x_accessor] >= args.processed.min_x && datum[args.x_accessor] <= args.processed.max_x && datum[args.y_accessor] >= args.processed.min_y && datum[args.y_accessor] <= args.processed.max_y;\n  }\n\n  function is_array(thing) {\n    return Object.prototype.toString.call(thing) === '[object Array]';\n  }\n\n  function is_function(thing) {\n    return Object.prototype.toString.call(thing) === '[object Function]';\n  }\n\n  function is_empty_array(thing) {\n    return is_array(thing) && thing.length === 0;\n  }\n\n  function is_object(thing) {\n    return Object.prototype.toString.call(thing) === '[object Object]';\n  }\n\n  function is_array_of_arrays(data) {\n    var all_elements = data.map(function (d) {\n      return is_array(d) === true && d.length > 0;\n    });\n    return d3.sum(all_elements) === data.length;\n  }\n\n  function is_array_of_objects(data) {\n    // is every element of data an object?\n    var all_elements = data.map(function (d) {\n      return is_object(d) === true;\n    });\n    return d3.sum(all_elements) === data.length;\n  }\n\n  function is_array_of_objects_or_empty(data) {\n    return is_empty_array(data) || is_array_of_objects(data);\n  }\n\n  function pluck(arr, accessor) {\n    return arr.map(function (d) {\n      return d[accessor];\n    });\n  }\n\n  function count_array_elements(arr) {\n    return arr.reduce(function (a, b) {\n      a[b] = a[b] + 1 || 1;\n      return a;\n    }, {});\n  }\n\n  function mg_get_bottom(args) {\n    return args.height - args.bottom;\n  }\n\n  function mg_get_plot_bottom(args) {\n    // returns the pixel location of the bottom side of the plot area.\n    return mg_get_bottom(args) - args.buffer;\n  }\n\n  function mg_get_top(args) {\n    return args.top;\n  }\n\n  function mg_get_plot_top(args) {\n    // returns the pixel location of the top side of the plot area.\n    return mg_get_top(args) + args.buffer;\n  }\n\n  function mg_get_left(args) {\n    return args.left;\n  }\n\n  function mg_get_plot_left(args) {\n    // returns the pixel location of the left side of the plot area.\n    return mg_get_left(args) + args.buffer;\n  }\n\n  function mg_get_right(args) {\n    return args.width - args.right;\n  }\n\n  function mg_get_plot_right(args) {\n    // returns the pixel location of the right side of the plot area.\n    return mg_get_right(args) - args.buffer;\n  } //////// adding elements, removing elements /////////////\n\n\n  function mg_exit_and_remove(elem) {\n    elem.exit().remove();\n  }\n\n  function mg_selectAll_and_remove(svg, cl) {\n    svg.selectAll(cl).remove();\n  }\n\n  function mg_add_g(svg, cl) {\n    return svg.append('g').classed(cl, true);\n  }\n\n  function mg_remove_element(svg, elem) {\n    svg.select(elem).remove();\n  } //////// axis helper functions ////////////\n\n\n  function mg_make_rug(args, rug_class) {\n    var svg = mg_get_svg_child_of(args.target);\n    var all_data = mg_flatten_array(args.data);\n    var rug = svg.selectAll('line.' + rug_class).data(all_data);\n    rug.enter().append('line').attr('class', rug_class).attr('opacity', 0.3); //remove rug elements that are no longer in use\n\n    mg_exit_and_remove(rug); //set coordinates of new rug elements\n\n    mg_exit_and_remove(rug);\n    return rug;\n  }\n\n  function mg_add_color_accessor_to_rug(rug, args, rug_mono_class) {\n    if (args.color_accessor) {\n      rug.attr('stroke', args.scalefns.colorf);\n      rug.classed(rug_mono_class, false);\n    } else {\n      rug.attr('stroke', null);\n      rug.classed(rug_mono_class, true);\n    }\n  }\n\n  function mg_rotate_labels(labels, rotation_degree) {\n    if (rotation_degree) {\n      labels.attr({\n        dy: 0,\n        transform: function () {\n          var elem = d3.select(this);\n          return 'rotate(' + rotation_degree + ' ' + elem.attr('x') + ',' + elem.attr('y') + ')';\n        }\n      });\n    }\n  } //////////////////////////////////////////////////\n\n\n  function mg_elements_are_overlapping(labels) {\n    labels = labels.node();\n\n    if (!labels) {\n      return false;\n    }\n\n    for (var i = 0; i < labels.length; i++) {\n      if (mg_is_horizontally_overlapping(labels[i], labels)) return true;\n    }\n\n    return false;\n  }\n\n  function mg_prevent_horizontal_overlap(labels, args) {\n    if (!labels || labels.length == 1) {\n      return;\n    } //see if each of our labels overlaps any of the other labels\n\n\n    for (var i = 0; i < labels.length; i++) {\n      //if so, nudge it up a bit, if the label it intersects hasn't already been nudged\n      if (mg_is_horizontally_overlapping(labels[i], labels)) {\n        var node = d3.select(labels[i]);\n        var newY = +node.attr('y');\n\n        if (newY + 8 >= args.top) {\n          newY = args.top - 16;\n        }\n\n        node.attr('y', newY);\n      }\n    }\n  }\n\n  function mg_prevent_vertical_overlap(labels, args) {\n    if (!labels || labels.length == 1) {\n      return;\n    }\n\n    labels.sort(function (b, a) {\n      return d3.select(a).attr('y') - d3.select(b).attr('y');\n    });\n    labels.reverse();\n    var overlap_amount, label_i, label_j; //see if each of our labels overlaps any of the other labels\n\n    for (var i = 0; i < labels.length; i++) {\n      //if so, nudge it up a bit, if the label it intersects hasn't already been nudged\n      label_i = d3.select(labels[i]).text();\n\n      for (var j = 0; j < labels.length; j++) {\n        label_j = d3.select(labels[j]).text();\n        overlap_amount = mg_is_vertically_overlapping(labels[i], labels[j]);\n\n        if (overlap_amount !== false && label_i !== label_j) {\n          var node = d3.select(labels[i]);\n          var newY = +node.attr('y');\n          newY = newY + overlap_amount;\n          node.attr('y', newY);\n        }\n      }\n    }\n  }\n\n  function mg_is_vertically_overlapping(element, sibling) {\n    var element_bbox = element.getBoundingClientRect();\n    var sibling_bbox = sibling.getBoundingClientRect();\n\n    if (element_bbox.top <= sibling_bbox.bottom && element_bbox.top >= sibling_bbox.top) {\n      return sibling_bbox.bottom - element_bbox.top;\n    }\n\n    return false;\n  }\n\n  function mg_is_horiz_overlap(element, sibling) {\n    var element_bbox = element.getBoundingClientRect();\n    var sibling_bbox = sibling.getBoundingClientRect();\n\n    if (element_bbox.right >= sibling_bbox.left || element_bbox.top >= sibling_bbox.top) {\n      return sibling_bbox.bottom - element_bbox.top;\n    }\n\n    return false;\n  }\n\n  function mg_is_horizontally_overlapping(element, labels) {\n    var element_bbox = element.getBoundingClientRect();\n\n    for (var i = 0; i < labels.length; i++) {\n      if (labels[i] == element) {\n        continue;\n      } //check to see if this label overlaps with any of the other labels\n\n\n      var sibling_bbox = labels[i].getBoundingClientRect();\n\n      if (element_bbox.top === sibling_bbox.top && !(sibling_bbox.left > element_bbox.right || sibling_bbox.right < element_bbox.left)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  function mg_infer_type(args, ns) {\n    // must return categorical or numerical.\n    var testPoint = mg_flatten_array(args.data);\n    testPoint = testPoint[0][args[ns + '_accessor']];\n    return typeof testPoint === 'string' ? 'categorical' : 'numerical';\n  }\n\n  function mg_get_svg_child_of(selector_or_node) {\n    return d3.select(selector_or_node).select('svg');\n  }\n\n  function mg_flatten_array(arr) {\n    var flat_data = [];\n    return flat_data.concat.apply(flat_data, arr);\n  }\n\n  function mg_next_id() {\n    if (typeof MG._next_elem_id === 'undefined') {\n      MG._next_elem_id = 0;\n    }\n\n    return 'mg-' + MG._next_elem_id++;\n  }\n\n  function mg_target_ref(target) {\n    if (typeof target === 'string') {\n      return mg_normalize(target);\n    } else if (target instanceof window.HTMLElement) {\n      var target_ref = target.getAttribute('data-mg-uid');\n\n      if (!target_ref) {\n        target_ref = mg_next_id();\n        target.setAttribute('data-mg-uid', target_ref);\n      }\n\n      return target_ref;\n    } else {\n      console.warn('The specified target should be a string or an HTMLElement.', target);\n      return mg_normalize(target);\n    }\n  }\n\n  function mg_normalize(string) {\n    return string.replace(/[^a-zA-Z0-9 _-]+/g, '').replace(/ +?/g, '');\n  }\n\n  function get_pixel_dimension(target, dimension) {\n    return Number(d3.select(target).style(dimension).replace(/px/g, ''));\n  }\n\n  function get_width(target) {\n    return get_pixel_dimension(target, 'width');\n  }\n\n  function get_height(target) {\n    return get_pixel_dimension(target, 'height');\n  }\n\n  function isNumeric(n) {\n    return !isNaN(parseFloat(n)) && isFinite(n);\n  }\n\n  var each = function (obj, iterator, context) {\n    // yanked out of underscore\n    var breaker = {};\n    if (obj === null) return obj;\n\n    if (Array.prototype.forEach && obj.forEach === Array.prototype.forEach) {\n      obj.forEach(iterator, context);\n    } else if (obj.length === +obj.length) {\n      for (var i = 0, length = obj.length; i < length; i++) {\n        if (iterator.call(context, obj[i], i, obj) === breaker) return;\n      }\n    } else {\n      for (var k in obj) {\n        if (iterator.call(context, obj[k], k, obj) === breaker) return;\n      }\n    }\n\n    return obj;\n  };\n\n  function merge_with_defaults(obj) {\n    // taken from underscore\n    each(Array.prototype.slice.call(arguments, 1), function (source) {\n      if (source) {\n        for (var prop in source) {\n          if (obj[prop] === void 0) obj[prop] = source[prop];\n        }\n      }\n    });\n    return obj;\n  }\n\n  MG.merge_with_defaults = merge_with_defaults;\n\n  function number_of_values(data, accessor, value) {\n    var values = data.filter(function (d) {\n      return d[accessor] === value;\n    });\n    return values.length;\n  }\n\n  function has_values_below(data, accessor, value) {\n    var values = data.filter(function (d) {\n      return d[accessor] <= value;\n    });\n    return values.length > 0;\n  }\n\n  function has_too_many_zeros(data, accessor, zero_count) {\n    return number_of_values(data, accessor, 0) >= zero_count;\n  }\n\n  function mg_is_date(obj) {\n    return Object.prototype.toString.call(obj) === '[object Date]';\n  }\n\n  function mg_is_object(obj) {\n    return Object.prototype.toString.call(obj) === '[object Object]';\n  }\n\n  function mg_is_array(obj) {\n    if (Array.isArray) {\n      return Array.isArray(obj);\n    }\n\n    return Object.prototype.toString.call(obj) === '[object Array]';\n  } // deep copy\n  // http://stackoverflow.com/questions/728360/most-elegant-way-to-clone-a-javascript-object\n\n\n  MG.clone = function (obj) {\n    var copy; // Handle the 3 simple types, and null or undefined\n\n    if (null === obj || \"object\" !== typeof obj) return obj; // Handle Date\n\n    if (mg_is_date(obj)) {\n      copy = new Date();\n      copy.setTime(obj.getTime());\n      return copy;\n    } // Handle Array\n\n\n    if (mg_is_array(obj)) {\n      copy = [];\n\n      for (var i = 0, len = obj.length; i < len; i++) {\n        copy[i] = MG.clone(obj[i]);\n      }\n\n      return copy;\n    } // Handle Object\n\n\n    if (mg_is_object(obj)) {\n      copy = {};\n\n      for (var attr in obj) {\n        if (obj.hasOwnProperty(attr)) copy[attr] = MG.clone(obj[attr]);\n      }\n\n      return copy;\n    }\n\n    throw new Error(\"Unable to copy obj! Its type isn't supported.\");\n  }; // give us the difference of two int arrays\n  // http://radu.cotescu.com/javascript-diff-function/\n\n\n  function arr_diff(a, b) {\n    var seen = [],\n        diff = [],\n        i;\n\n    for (i = 0; i < b.length; i++) seen[b[i]] = true;\n\n    for (i = 0; i < a.length; i++) if (!seen[a[i]]) diff.push(a[i]);\n\n    return diff;\n  }\n\n  MG.arr_diff = arr_diff;\n  /**\n    Print warning message to the console when a feature has been scheduled for removal\n  \n    @author Dan de Havilland (github.com/dandehavilland)\n    @date 2014-12\n  */\n\n  function warn_deprecation(message, untilVersion) {\n    console.warn('Deprecation: ' + message + (untilVersion ? '. This feature will be removed in ' + untilVersion + '.' : ' the near future.'));\n    console.trace();\n  }\n\n  MG.warn_deprecation = warn_deprecation;\n  /**\n    Truncate a string to fit within an SVG text node\n    CSS text-overlow doesn't apply to SVG <= 1.2\n  \n    @author Dan de Havilland (github.com/dandehavilland)\n    @date 2014-12-02\n  */\n\n  function truncate_text(textObj, textString, width) {\n    var bbox,\n        position = 0;\n    textObj.textContent = textString;\n    bbox = textObj.getBBox();\n\n    while (bbox.width > width) {\n      textObj.textContent = textString.slice(0, --position) + '...';\n      bbox = textObj.getBBox();\n\n      if (textObj.textContent === '...') {\n        break;\n      }\n    }\n  }\n\n  MG.truncate_text = truncate_text;\n  /**\n    Wrap the contents of a text node to a specific width\n  \n    Adapted from bl.ocks.org/mbostock/7555321\n  \n    @author Mike Bostock\n    @author Dan de Havilland\n    @date 2015-01-14\n  */\n\n  function wrap_text(text, width, token, tspanAttrs) {\n    text.each(function () {\n      var text = d3.select(this),\n          words = text.text().split(token || /\\s+/).reverse(),\n          word,\n          line = [],\n          lineNumber = 0,\n          lineHeight = 1.1,\n          // ems\n      y = text.attr(\"y\"),\n          dy = 0,\n          tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", dy + \"em\").attr(tspanAttrs || {});\n\n      while (!!(word = words.pop())) {\n        line.push(word);\n        tspan.text(line.join(\" \"));\n\n        if (width === null || tspan.node().getComputedTextLength() > width) {\n          line.pop();\n          tspan.text(line.join(\" \"));\n          line = [word];\n          tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", ++lineNumber * lineHeight + dy + \"em\").attr(tspanAttrs || {}).text(word);\n        }\n      }\n    });\n  }\n\n  MG.wrap_text = wrap_text;\n\n  function register(chartType, descriptor, defaults) {\n    MG.charts[chartType] = {\n      descriptor: descriptor,\n      defaults: defaults || {}\n    };\n  }\n\n  MG.register = register;\n  /**\n    Record of all registered hooks.\n    For internal use only.\n  */\n\n  MG._hooks = {};\n  /**\n    Add a hook callthrough to the stack.\n  \n    Hooks are executed in the order that they were registered.\n  */\n\n  MG.add_hook = function (name, func, context) {\n    var hooks;\n\n    if (!MG._hooks[name]) {\n      MG._hooks[name] = [];\n    }\n\n    hooks = MG._hooks[name];\n    var already_registered = hooks.filter(function (hook) {\n      return hook.func === func;\n    }).length > 0;\n\n    if (already_registered) {\n      throw 'That function is already registered.';\n    }\n\n    hooks.push({\n      func: func,\n      context: context\n    });\n  };\n  /**\n    Execute registered hooks.\n  \n    Optional arguments\n  */\n\n\n  MG.call_hook = function (name) {\n    var hooks = MG._hooks[name],\n        result = [].slice.apply(arguments, [1]),\n        processed;\n\n    if (hooks) {\n      hooks.forEach(function (hook) {\n        if (hook.func) {\n          var params = processed || result;\n\n          if (params && params.constructor !== Array) {\n            params = [params];\n          }\n\n          params = [].concat.apply([], params);\n          processed = hook.func.apply(hook.context, params);\n        }\n      });\n    }\n\n    return processed || result;\n  };\n\n  MG.globals = {};\n  MG.deprecations = {\n    rollover_callback: {\n      replacement: 'mouseover',\n      version: '2.0'\n    },\n    rollout_callback: {\n      replacement: 'mouseout',\n      version: '2.0'\n    },\n    x_rollover_format: {\n      replacement: 'x_mouseover',\n      version: '2.10'\n    },\n    y_rollover_format: {\n      replacement: 'y_mouseover',\n      version: '2.10'\n    },\n    show_years: {\n      replacement: 'show_secondary_x_label',\n      version: '2.1'\n    },\n    xax_start_at_min: {\n      replacement: 'axes_not_compact',\n      version: '2.7'\n    },\n    interpolate_tension: {\n      replacement: 'interpolate',\n      version: '2.10'\n    }\n  };\n  MG.globals.link = false;\n  MG.globals.version = \"1.1\";\n  MG.charts = {};\n\n  MG.data_graphic = function (args) {\n    'use strict';\n\n    var defaults = {\n      missing_is_zero: false,\n      // if true, missing values will be treated as zeros\n      missing_is_hidden: false,\n      // if true, missing values will appear as broken segments\n      missing_is_hidden_accessor: null,\n      // the accessor that determines the boolean value for missing data points\n      legend: '',\n      // an array identifying the labels for a chart's lines\n      legend_target: '',\n      // if set, the specified element is populated with a legend\n      error: '',\n      // if set, a graph will show an error icon and log the error to the console\n      animate_on_load: false,\n      // animate lines on load\n      top: 65,\n      // the size of the top margin\n      title_y_position: 10,\n      // how many pixels from the top edge (0) should we show the title at\n      center_title_full_width: false,\n      // center the title over the full graph (i.e. ignore left and right margins)\n      bottom: 45,\n      // the size of the bottom margin\n      right: 10,\n      // size of the right margin\n      left: 50,\n      // size of the left margin\n      buffer: 8,\n      // the buffer between the actual chart area and the margins\n      width: 350,\n      // the width of the entire graphic\n      height: 220,\n      // the height of the entire graphic\n      full_width: false,\n      // sets the graphic width to be the width of the parent element and resizes dynamically\n      full_height: false,\n      // sets the graphic width to be the width of the parent element and resizes dynamically\n      small_height_threshold: 120,\n      // the height threshold for when smaller text appears\n      small_width_threshold: 160,\n      // the width  threshold for when smaller text appears\n      xax_count: 6,\n      // number of x axis ticks\n      xax_tick_length: 5,\n      // x axis tick length\n      axes_not_compact: true,\n      yax_count: 3,\n      // number of y axis ticks\n      yax_tick_length: 5,\n      // y axis tick length\n      x_extended_ticks: false,\n      // extends x axis ticks across chart - useful for tall charts\n      y_extended_ticks: false,\n      // extends y axis ticks across chart - useful for long charts\n      y_scale_type: 'linear',\n      max_x: null,\n      max_y: null,\n      min_x: null,\n      min_y: null,\n      // if set, y axis starts at an arbitrary value\n      min_y_from_data: false,\n      // if set, y axis will start at minimum value rather than at 0\n      point_size: 2.5,\n      // the size of the dot that appears on a line on mouse-over\n      x_accessor: 'date',\n      xax_units: '',\n      x_label: '',\n      x_sort: true,\n      x_axis: true,\n      y_axis: true,\n      x_axis_position: 'bottom',\n      y_axis_position: 'left',\n      x_axis_type: null,\n      // TO BE INTRODUCED IN 2.10\n      y_axis_type: null,\n      // TO BE INTRODUCED IN 2.10\n      ygroup_accessor: null,\n      xgroup_accessor: null,\n      y_padding_percentage: 0.05,\n      // for categorical scales\n      y_outer_padding_percentage: .1,\n      // for categorical scales\n      ygroup_padding_percentage: .25,\n      // for categorical scales\n      ygroup_outer_padding_percentage: 0,\n      // for categorical scales\n      x_padding_percentage: 0.05,\n      // for categorical scales\n      x_outer_padding_percentage: .1,\n      // for categorical scales\n      xgroup_padding_percentage: .25,\n      // for categorical scales\n      xgroup_outer_padding_percentage: 0,\n      // for categorical scales\n      y_categorical_show_guides: false,\n      x_categorical_show_guide: false,\n      rotate_x_labels: 0,\n      rotate_y_labels: 0,\n      y_accessor: 'value',\n      y_label: '',\n      yax_units: '',\n      yax_units_append: false,\n      x_rug: false,\n      y_rug: false,\n      mouseover_align: 'right',\n      // implemented in point.js\n      x_mouseover: null,\n      y_mouseover: null,\n      transition_on_update: true,\n      mouseover: null,\n      click: null,\n      show_rollover_text: true,\n      show_confidence_band: null,\n      // given [l, u] shows a confidence at each point from l to u\n      xax_format: null,\n      // xax_format is a function that formats the labels for the x axis.\n      area: true,\n      chart_type: 'line',\n      data: [],\n      decimals: 2,\n      // the number of decimals in any rollover\n      format: 'count',\n      // format = {count, percentage}\n      inflator: 10 / 9,\n      // for setting y axis max\n      linked: false,\n      // links together all other graphs with linked:true, so rollovers in one trigger rollovers in the others\n      linked_format: '%Y-%m-%d',\n      // What granularity to link on for graphs. Default is at day\n      list: false,\n      baselines: null,\n      // sets the baseline lines\n      markers: null,\n      // sets the marker lines\n      scalefns: {},\n      scales: {},\n      utc_time: false,\n      european_clock: false,\n      show_year_markers: false,\n      show_secondary_x_label: true,\n      target: '#viz',\n      interpolate: d3.curveCatmullRom.alpha(0),\n      // interpolation method to use when rendering lines; increase tension if your data is irregular and you notice artifacts\n      custom_line_color_map: [],\n      // allows arbitrary mapping of lines to colors, e.g. [2,3] will map line 1 to color 2 and line 2 to color 3\n      colors: null,\n      // UNIMPLEMENTED - allows direct color mapping to line colors. Will eventually require\n      max_data_size: null,\n      // explicitly specify the the max number of line series, for use with custom_line_color_map\n      aggregate_rollover: false,\n      // links the lines in a multi-line chart\n      show_tooltips: true // if enabled, a chart's description will appear in a tooltip (requires jquery)\n\n    };\n    MG.call_hook('global.defaults', defaults);\n\n    if (!args) {\n      args = {};\n    }\n\n    var selected_chart = MG.charts[args.chart_type || defaults.chart_type];\n    merge_with_defaults(args, selected_chart.defaults, defaults);\n\n    if (args.list) {\n      args.x_accessor = 0;\n      args.y_accessor = 1;\n    } // check for deprecated parameters\n\n\n    for (var key in MG.deprecations) {\n      if (args.hasOwnProperty(key)) {\n        var deprecation = MG.deprecations[key],\n            message = 'Use of `args.' + key + '` has been deprecated',\n            replacement = deprecation.replacement,\n            version; // transparently alias the deprecated\n\n        if (replacement) {\n          if (args[replacement]) {\n            message += '. The replacement - `args.' + replacement + '` - has already been defined. This definition will be discarded.';\n          } else {\n            args[replacement] = args[key];\n          }\n        }\n\n        if (deprecation.warned) {\n          continue;\n        }\n\n        deprecation.warned = true;\n\n        if (replacement) {\n          message += ' in favor of `args.' + replacement + '`';\n        }\n\n        warn_deprecation(message, deprecation.version);\n      }\n    }\n\n    MG.call_hook('global.before_init', args);\n    new selected_chart.descriptor(args);\n    return args.data;\n  };\n\n  if (mg_jquery_exists()) {\n    /* ========================================================================\n     * Bootstrap: tooltip.js v3.3.5\n     * http://getbootstrap.com/javascript/#tooltip\n     * Inspired by the original jQuery.tipsy by Jason Frame\n     * ========================================================================\n     * Copyright 2011-2015 Twitter, Inc.\n     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n     * ======================================================================== */\n    +function ($) {\n      'use strict'; // TOOLTIP PUBLIC CLASS DEFINITION\n      // ===============================\n\n      var Tooltip = function (element, options) {\n        this.type = null;\n        this.options = null;\n        this.enabled = null;\n        this.timeout = null;\n        this.hoverState = null;\n        this.$element = null;\n        this.inState = null;\n        this.init('tooltip', element, options);\n      };\n\n      Tooltip.VERSION = '3.3.5';\n      Tooltip.TRANSITION_DURATION = 150;\n      Tooltip.DEFAULTS = {\n        animation: true,\n        placement: 'top',\n        selector: false,\n        template: '<div class=\"tooltip\" role=\"tooltip\"><div class=\"tooltip-arrow\"></div><div class=\"tooltip-inner\"></div></div>',\n        trigger: 'hover focus',\n        title: '',\n        delay: 0,\n        html: false,\n        container: false,\n        viewport: {\n          selector: 'body',\n          padding: 0\n        }\n      };\n\n      Tooltip.prototype.init = function (type, element, options) {\n        this.enabled = true;\n        this.type = type;\n        this.$element = $(element);\n        this.options = this.getOptions(options);\n        this.$viewport = this.options.viewport && $($.isFunction(this.options.viewport) ? this.options.viewport.call(this, this.$element) : this.options.viewport.selector || this.options.viewport);\n        this.inState = {\n          click: false,\n          hover: false,\n          focus: false\n        };\n\n        if (this.$element[0] instanceof document.constructor && !this.options.selector) {\n          throw new Error('`selector` option must be specified when initializing ' + this.type + ' on the window.document object!');\n        }\n\n        var triggers = this.options.trigger.split(' ');\n\n        for (var i = triggers.length; i--;) {\n          var trigger = triggers[i];\n\n          if (trigger == 'click') {\n            this.$element.on('click.' + this.type, this.options.selector, $.proxy(this.toggle, this));\n          } else if (trigger != 'manual') {\n            var eventIn = trigger == 'hover' ? 'mouseenter' : 'focusin';\n            var eventOut = trigger == 'hover' ? 'mouseleave' : 'focusout';\n            this.$element.on(eventIn + '.' + this.type, this.options.selector, $.proxy(this.enter, this));\n            this.$element.on(eventOut + '.' + this.type, this.options.selector, $.proxy(this.leave, this));\n          }\n        }\n\n        this.options.selector ? this._options = $.extend({}, this.options, {\n          trigger: 'manual',\n          selector: ''\n        }) : this.fixTitle();\n      };\n\n      Tooltip.prototype.getDefaults = function () {\n        return Tooltip.DEFAULTS;\n      };\n\n      Tooltip.prototype.getOptions = function (options) {\n        options = $.extend({}, this.getDefaults(), this.$element.data(), options);\n\n        if (options.delay && typeof options.delay == 'number') {\n          options.delay = {\n            show: options.delay,\n            hide: options.delay\n          };\n        }\n\n        return options;\n      };\n\n      Tooltip.prototype.getDelegateOptions = function () {\n        var options = {};\n        var defaults = this.getDefaults();\n        this._options && $.each(this._options, function (key, value) {\n          if (defaults[key] != value) options[key] = value;\n        });\n        return options;\n      };\n\n      Tooltip.prototype.enter = function (obj) {\n        var self = obj instanceof this.constructor ? obj : $(obj.currentTarget).data('bs.' + this.type);\n\n        if (!self) {\n          self = new this.constructor(obj.currentTarget, this.getDelegateOptions());\n          $(obj.currentTarget).data('bs.' + this.type, self);\n        }\n\n        if (obj instanceof $.Event) {\n          self.inState[obj.type == 'focusin' ? 'focus' : 'hover'] = true;\n        }\n\n        if (self.tip().hasClass('in') || self.hoverState == 'in') {\n          self.hoverState = 'in';\n          return;\n        }\n\n        clearTimeout(self.timeout);\n        self.hoverState = 'in';\n        if (!self.options.delay || !self.options.delay.show) return self.show();\n        self.timeout = setTimeout(function () {\n          if (self.hoverState == 'in') self.show();\n        }, self.options.delay.show);\n      };\n\n      Tooltip.prototype.isInStateTrue = function () {\n        for (var key in this.inState) {\n          if (this.inState[key]) return true;\n        }\n\n        return false;\n      };\n\n      Tooltip.prototype.leave = function (obj) {\n        var self = obj instanceof this.constructor ? obj : $(obj.currentTarget).data('bs.' + this.type);\n\n        if (!self) {\n          self = new this.constructor(obj.currentTarget, this.getDelegateOptions());\n          $(obj.currentTarget).data('bs.' + this.type, self);\n        }\n\n        if (obj instanceof $.Event) {\n          self.inState[obj.type == 'focusout' ? 'focus' : 'hover'] = false;\n        }\n\n        if (self.isInStateTrue()) return;\n        clearTimeout(self.timeout);\n        self.hoverState = 'out';\n        if (!self.options.delay || !self.options.delay.hide) return self.hide();\n        self.timeout = setTimeout(function () {\n          if (self.hoverState == 'out') self.hide();\n        }, self.options.delay.hide);\n      };\n\n      Tooltip.prototype.show = function () {\n        var e = $.Event('show.bs.' + this.type);\n\n        if (this.hasContent() && this.enabled) {\n          this.$element.trigger(e);\n          var inDom = $.contains(this.$element[0].ownerDocument.documentElement, this.$element[0]);\n          if (e.isDefaultPrevented() || !inDom) return;\n          var that = this;\n          var $tip = this.tip();\n          var tipId = this.getUID(this.type);\n          this.setContent();\n          $tip.attr('id', tipId);\n          this.$element.attr('aria-describedby', tipId);\n          if (this.options.animation) $tip.addClass('fade');\n          var placement = typeof this.options.placement == 'function' ? this.options.placement.call(this, $tip[0], this.$element[0]) : this.options.placement;\n          var autoToken = /\\s?auto?\\s?/i;\n          var autoPlace = autoToken.test(placement);\n          if (autoPlace) placement = placement.replace(autoToken, '') || 'top';\n          $tip.detach().css({\n            top: 0,\n            left: 0,\n            display: 'block'\n          }).addClass(placement).data('bs.' + this.type, this);\n          this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element);\n          this.$element.trigger('inserted.bs.' + this.type);\n          var pos = this.getPosition();\n          var actualWidth = $tip[0].offsetWidth;\n          var actualHeight = $tip[0].offsetHeight;\n\n          if (autoPlace) {\n            var orgPlacement = placement;\n            var viewportDim = this.getPosition(this.$viewport);\n            placement = placement == 'bottom' && pos.bottom + actualHeight > viewportDim.bottom ? 'top' : placement == 'top' && pos.top - actualHeight < viewportDim.top ? 'bottom' : placement == 'right' && pos.right + actualWidth > viewportDim.width ? 'left' : placement == 'left' && pos.left - actualWidth < viewportDim.left ? 'right' : placement;\n            $tip.removeClass(orgPlacement).addClass(placement);\n          }\n\n          var calculatedOffset = this.getCalculatedOffset(placement, pos, actualWidth, actualHeight);\n          this.applyPlacement(calculatedOffset, placement);\n\n          var complete = function () {\n            var prevHoverState = that.hoverState;\n            that.$element.trigger('shown.bs.' + that.type);\n            that.hoverState = null;\n            if (prevHoverState == 'out') that.leave(that);\n          };\n\n          $.support.transition && this.$tip.hasClass('fade') ? $tip.one('bsTransitionEnd', complete).emulateTransitionEnd(Tooltip.TRANSITION_DURATION) : complete();\n        }\n      };\n\n      Tooltip.prototype.applyPlacement = function (offset, placement) {\n        var $tip = this.tip();\n        var width = $tip[0].offsetWidth;\n        var height = $tip[0].offsetHeight; // manually read margins because getBoundingClientRect includes difference\n\n        var marginTop = parseInt($tip.css('margin-top'), 10);\n        var marginLeft = parseInt($tip.css('margin-left'), 10); // we must check for NaN for ie 8/9\n\n        if (isNaN(marginTop)) marginTop = 0;\n        if (isNaN(marginLeft)) marginLeft = 0;\n        offset.top += marginTop;\n        offset.left += marginLeft; // $.fn.offset doesn't round pixel values\n        // so we use setOffset directly with our own function B-0\n\n        $.offset.setOffset($tip[0], $.extend({\n          using: function (props) {\n            $tip.css({\n              top: Math.round(props.top),\n              left: Math.round(props.left)\n            });\n          }\n        }, offset), 0);\n        $tip.addClass('in'); // check to see if placing tip in new offset caused the tip to resize itself\n\n        var actualWidth = $tip[0].offsetWidth;\n        var actualHeight = $tip[0].offsetHeight;\n\n        if (placement == 'top' && actualHeight != height) {\n          offset.top = offset.top + height - actualHeight;\n        }\n\n        var delta = this.getViewportAdjustedDelta(placement, offset, actualWidth, actualHeight);\n        if (delta.left) offset.left += delta.left;else offset.top += delta.top;\n        var isVertical = /top|bottom/.test(placement);\n        var arrowDelta = isVertical ? delta.left * 2 - width + actualWidth : delta.top * 2 - height + actualHeight;\n        var arrowOffsetPosition = isVertical ? 'offsetWidth' : 'offsetHeight';\n        $tip.offset(offset);\n        this.replaceArrow(arrowDelta, $tip[0][arrowOffsetPosition], isVertical);\n      };\n\n      Tooltip.prototype.replaceArrow = function (delta, dimension, isVertical) {\n        this.arrow().css(isVertical ? 'left' : 'top', 50 * (1 - delta / dimension) + '%').css(isVertical ? 'top' : 'left', '');\n      };\n\n      Tooltip.prototype.setContent = function () {\n        var $tip = this.tip();\n        var title = this.getTitle();\n        $tip.find('.tooltip-inner')[this.options.html ? 'html' : 'text'](title);\n        $tip.removeClass('fade in top bottom left right');\n      };\n\n      Tooltip.prototype.hide = function (callback) {\n        var that = this;\n        var $tip = $(this.$tip);\n        var e = $.Event('hide.bs.' + this.type);\n\n        function complete() {\n          if (that.hoverState != 'in') $tip.detach();\n          that.$element.removeAttr('aria-describedby').trigger('hidden.bs.' + that.type);\n          callback && callback();\n        }\n\n        this.$element.trigger(e);\n        if (e.isDefaultPrevented()) return;\n        $tip.removeClass('in');\n        $.support.transition && $tip.hasClass('fade') ? $tip.one('bsTransitionEnd', complete).emulateTransitionEnd(Tooltip.TRANSITION_DURATION) : complete();\n        this.hoverState = null;\n        return this;\n      };\n\n      Tooltip.prototype.fixTitle = function () {\n        var $e = this.$element;\n\n        if ($e.attr('title') || typeof $e.attr('data-original-title') != 'string') {\n          $e.attr('data-original-title', $e.attr('title') || '').attr('title', '');\n        }\n      };\n\n      Tooltip.prototype.hasContent = function () {\n        return this.getTitle();\n      };\n\n      Tooltip.prototype.getPosition = function ($element) {\n        $element = $element || this.$element;\n        var el = $element[0];\n        var isBody = el.tagName == 'BODY';\n        var elRect = el.getBoundingClientRect();\n\n        if (elRect.width == null) {\n          // width and height are missing in IE8, so compute them manually; see https://github.com/twbs/bootstrap/issues/14093\n          elRect = $.extend({}, elRect, {\n            width: elRect.right - elRect.left,\n            height: elRect.bottom - elRect.top\n          });\n        }\n\n        var elOffset = isBody ? {\n          top: 0,\n          left: 0\n        } : $element.offset();\n        var scroll = {\n          scroll: isBody ? document.documentElement.scrollTop || document.body.scrollTop : $element.scrollTop()\n        };\n        var outerDims = isBody ? {\n          width: $(window).width(),\n          height: $(window).height()\n        } : null;\n        return $.extend({}, elRect, scroll, outerDims, elOffset);\n      };\n\n      Tooltip.prototype.getCalculatedOffset = function (placement, pos, actualWidth, actualHeight) {\n        return placement == 'bottom' ? {\n          top: pos.top + pos.height,\n          left: pos.left + pos.width / 2 - actualWidth / 2\n        } : placement == 'top' ? {\n          top: pos.top - actualHeight,\n          left: pos.left + pos.width / 2 - actualWidth / 2\n        } : placement == 'left' ? {\n          top: pos.top + pos.height / 2 - actualHeight / 2,\n          left: pos.left - actualWidth\n        } :\n        /* placement == 'right' */\n        {\n          top: pos.top + pos.height / 2 - actualHeight / 2,\n          left: pos.left + pos.width\n        };\n      };\n\n      Tooltip.prototype.getViewportAdjustedDelta = function (placement, pos, actualWidth, actualHeight) {\n        var delta = {\n          top: 0,\n          left: 0\n        };\n        if (!this.$viewport) return delta;\n        var viewportPadding = this.options.viewport && this.options.viewport.padding || 0;\n        var viewportDimensions = this.getPosition(this.$viewport);\n\n        if (/right|left/.test(placement)) {\n          var topEdgeOffset = pos.top - viewportPadding - viewportDimensions.scroll;\n          var bottomEdgeOffset = pos.top + viewportPadding - viewportDimensions.scroll + actualHeight;\n\n          if (topEdgeOffset < viewportDimensions.top) {\n            // top overflow\n            delta.top = viewportDimensions.top - topEdgeOffset;\n          } else if (bottomEdgeOffset > viewportDimensions.top + viewportDimensions.height) {\n            // bottom overflow\n            delta.top = viewportDimensions.top + viewportDimensions.height - bottomEdgeOffset;\n          }\n        } else {\n          var leftEdgeOffset = pos.left - viewportPadding;\n          var rightEdgeOffset = pos.left + viewportPadding + actualWidth;\n\n          if (leftEdgeOffset < viewportDimensions.left) {\n            // left overflow\n            delta.left = viewportDimensions.left - leftEdgeOffset;\n          } else if (rightEdgeOffset > viewportDimensions.right) {\n            // right overflow\n            delta.left = viewportDimensions.left + viewportDimensions.width - rightEdgeOffset;\n          }\n        }\n\n        return delta;\n      };\n\n      Tooltip.prototype.getTitle = function () {\n        var title;\n        var $e = this.$element;\n        var o = this.options;\n        title = $e.attr('data-original-title') || (typeof o.title == 'function' ? o.title.call($e[0]) : o.title);\n        return title;\n      };\n\n      Tooltip.prototype.getUID = function (prefix) {\n        do prefix += ~~(Math.random() * 1000000); while (document.getElementById(prefix));\n\n        return prefix;\n      };\n\n      Tooltip.prototype.tip = function () {\n        if (!this.$tip) {\n          this.$tip = $(this.options.template);\n\n          if (this.$tip.length != 1) {\n            throw new Error(this.type + ' `template` option must consist of exactly 1 top-level element!');\n          }\n        }\n\n        return this.$tip;\n      };\n\n      Tooltip.prototype.arrow = function () {\n        return this.$arrow = this.$arrow || this.tip().find('.tooltip-arrow');\n      };\n\n      Tooltip.prototype.enable = function () {\n        this.enabled = true;\n      };\n\n      Tooltip.prototype.disable = function () {\n        this.enabled = false;\n      };\n\n      Tooltip.prototype.toggleEnabled = function () {\n        this.enabled = !this.enabled;\n      };\n\n      Tooltip.prototype.toggle = function (e) {\n        var self = this;\n\n        if (e) {\n          self = $(e.currentTarget).data('bs.' + this.type);\n\n          if (!self) {\n            self = new this.constructor(e.currentTarget, this.getDelegateOptions());\n            $(e.currentTarget).data('bs.' + this.type, self);\n          }\n        }\n\n        if (e) {\n          self.inState.click = !self.inState.click;\n          if (self.isInStateTrue()) self.enter(self);else self.leave(self);\n        } else {\n          self.tip().hasClass('in') ? self.leave(self) : self.enter(self);\n        }\n      };\n\n      Tooltip.prototype.destroy = function () {\n        var that = this;\n        clearTimeout(this.timeout);\n        this.hide(function () {\n          that.$element.off('.' + that.type).removeData('bs.' + that.type);\n\n          if (that.$tip) {\n            that.$tip.detach();\n          }\n\n          that.$tip = null;\n          that.$arrow = null;\n          that.$viewport = null;\n        });\n      }; // TOOLTIP PLUGIN DEFINITION\n      // =========================\n\n\n      function Plugin(option) {\n        return this.each(function () {\n          var $this = $(this);\n          var data = $this.data('bs.tooltip');\n          var options = typeof option == 'object' && option;\n          if (!data && /destroy|hide/.test(option)) return;\n          if (!data) $this.data('bs.tooltip', data = new Tooltip(this, options));\n          if (typeof option == 'string') data[option]();\n        });\n      }\n\n      var old = $.fn.tooltip;\n      $.fn.tooltip = Plugin;\n      $.fn.tooltip.Constructor = Tooltip; // TOOLTIP NO CONFLICT\n      // ===================\n\n      $.fn.tooltip.noConflict = function () {\n        $.fn.tooltip = old;\n        return this;\n      };\n    }(jQuery);\n    /* ========================================================================\n     * Bootstrap: popover.js v3.3.5\n     * http://getbootstrap.com/javascript/#popovers\n     * ========================================================================\n     * Copyright 2011-2015 Twitter, Inc.\n     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n     * ======================================================================== */\n\n    +function ($) {\n      'use strict'; // POPOVER PUBLIC CLASS DEFINITION\n      // ===============================\n\n      var Popover = function (element, options) {\n        this.init('popover', element, options);\n      };\n\n      if (!$.fn.tooltip) throw new Error('Popover requires tooltip.js');\n      Popover.VERSION = '3.3.5';\n      Popover.DEFAULTS = $.extend({}, $.fn.tooltip.Constructor.DEFAULTS, {\n        placement: 'right',\n        trigger: 'click',\n        content: '',\n        template: '<div class=\"popover\" role=\"tooltip\"><div class=\"arrow\"></div><h3 class=\"popover-title\"></h3><div class=\"popover-content\"></div></div>'\n      }); // NOTE: POPOVER EXTENDS tooltip.js\n      // ================================\n\n      Popover.prototype = $.extend({}, $.fn.tooltip.Constructor.prototype);\n      Popover.prototype.constructor = Popover;\n\n      Popover.prototype.getDefaults = function () {\n        return Popover.DEFAULTS;\n      };\n\n      Popover.prototype.setContent = function () {\n        var $tip = this.tip();\n        var title = this.getTitle();\n        var content = this.getContent();\n        $tip.find('.popover-title')[this.options.html ? 'html' : 'text'](title);\n        $tip.find('.popover-content').children().detach().end()[// we use append for html objects to maintain js events\n        this.options.html ? typeof content == 'string' ? 'html' : 'append' : 'text'](content);\n        $tip.removeClass('fade top bottom left right in'); // IE8 doesn't accept hiding via the `:empty` pseudo selector, we have to do\n        // this manually by checking the contents.\n\n        if (!$tip.find('.popover-title').html()) $tip.find('.popover-title').hide();\n      };\n\n      Popover.prototype.hasContent = function () {\n        return this.getTitle() || this.getContent();\n      };\n\n      Popover.prototype.getContent = function () {\n        var $e = this.$element;\n        var o = this.options;\n        return $e.attr('data-content') || (typeof o.content == 'function' ? o.content.call($e[0]) : o.content);\n      };\n\n      Popover.prototype.arrow = function () {\n        return this.$arrow = this.$arrow || this.tip().find('.arrow');\n      }; // POPOVER PLUGIN DEFINITION\n      // =========================\n\n\n      function Plugin(option) {\n        return this.each(function () {\n          var $this = $(this);\n          var data = $this.data('bs.popover');\n          var options = typeof option == 'object' && option;\n          if (!data && /destroy|hide/.test(option)) return;\n          if (!data) $this.data('bs.popover', data = new Popover(this, options));\n          if (typeof option == 'string') data[option]();\n        });\n      }\n\n      var old = $.fn.popover;\n      $.fn.popover = Plugin;\n      $.fn.popover.Constructor = Popover; // POPOVER NO CONFLICT\n      // ===================\n\n      $.fn.popover.noConflict = function () {\n        $.fn.popover = old;\n        return this;\n      };\n    }(jQuery);\n  }\n\n  function chart_title(args) {\n    'use strict';\n\n    var svg = mg_get_svg_child_of(args.target); //remove the current title if it exists\n\n    svg.select('.mg-header').remove();\n\n    if (args.target && args.title) {\n      var chartTitle = svg.insert('text').attr('class', 'mg-header').attr('x', args.center_title_full_width ? args.width / 2 : (args.width + args.left - args.right) / 2).attr('y', args.title_y_position).attr('text-anchor', 'middle').attr('dy', '0.55em'); //show the title\n\n      chartTitle.append('tspan').attr('class', 'mg-chart-title').text(args.title); //show and activate the description icon if we have a description\n\n      if (args.show_tooltips && args.description && mg_jquery_exists()) {\n        chartTitle.append('tspan').attr('class', 'mg-chart-description').attr('dx', '0.3em').text('\\uf059'); //now that the title is an svg text element, we'll have to trigger\n        //mouseenter, mouseleave events manually for the popover to work properly\n\n        var $chartTitle = $(chartTitle.node());\n        $chartTitle.popover({\n          html: true,\n          animation: false,\n          placement: 'top',\n          content: args.description,\n          container: args.target,\n          trigger: 'manual',\n          template: '<div class=\"popover mg-popover\"><div class=\"arrow\"></div><div class=\"popover-inner\"><h3 class=\"popover-title\"></h3><div class=\"popover-content\"><p></p></div></div></div>'\n        }).on('mouseenter', function () {\n          d3.selectAll(args.target).selectAll('.mg-popover').remove();\n          $(this).popover('show');\n          $(d3.select(args.target).select('.popover').node()).on('mouseleave', function () {\n            $chartTitle.popover('hide');\n          });\n        }).on('mouseleave', function () {\n          setTimeout(function () {\n            if (!$('.popover:hover').length) {\n              $chartTitle.popover('hide');\n            }\n          }, 120);\n        });\n      } else if (args.show_tooltips && args.description && typeof $ === 'undefined') {\n        args.error = 'In order to enable tooltips, please make sure you include jQuery.';\n      }\n    }\n\n    if (args.error) {\n      error(args);\n    }\n  }\n\n  MG.chart_title = chart_title;\n\n  function mg_add_scale_function(args, scalefcn_name, scale, accessor, inflation) {\n    args.scalefns[scalefcn_name] = function (di) {\n      if (inflation === undefined) return args.scales[scale](di[accessor]);else return args.scales[scale](di[accessor]) + inflation;\n    };\n  }\n\n  function mg_position(str, args) {\n    if (str === 'bottom' || str === 'top') {\n      return [mg_get_plot_left(args), mg_get_plot_right(args)];\n    }\n\n    if (str === 'left' || str === 'right') {\n      return [mg_get_plot_bottom(args), args.top];\n    }\n  }\n\n  function mg_cat_position(str, args) {\n    if (str === 'bottom' || str === 'top') {\n      return [mg_get_plot_left(args), mg_get_plot_right(args)];\n    }\n\n    if (str === 'left' || str === 'right') {\n      return [mg_get_plot_bottom(args), mg_get_plot_top(args)];\n    }\n  }\n\n  function MGScale(args) {\n    // big wrapper around d3 scale that automatically formats & calculates scale bounds\n    // according to the data, and handles other niceties.\n    var scaleArgs = {};\n    scaleArgs.use_inflator = false;\n    scaleArgs.zero_bottom = false;\n    scaleArgs.scaleType = 'numerical';\n\n    this.namespace = function (_namespace) {\n      scaleArgs.namespace = _namespace;\n      scaleArgs.namespace_accessor_name = scaleArgs.namespace + '_accessor';\n      scaleArgs.scale_name = scaleArgs.namespace.toUpperCase();\n      scaleArgs.scalefn_name = scaleArgs.namespace + 'f';\n      return this;\n    };\n\n    this.scaleName = function (scaleName) {\n      scaleArgs.scale_name = scaleName.toUpperCase();\n      scaleArgs.scalefn_name = scaleName + 'f';\n      return this;\n    };\n\n    this.inflateDomain = function (tf) {\n      scaleArgs.use_inflator = tf;\n      return this;\n    };\n\n    this.zeroBottom = function (tf) {\n      scaleArgs.zero_bottom = tf;\n      return this;\n    }; /////////////////////////////////////////////////////////////////////////////////////////////////////////\n    /// all scale domains are either numerical (number, date, etc.) or categorical (factor, label, etc) /////\n    /////////////////////////////////////////////////////////////////////////////////////////////////////////\n    // these functions automatically create the d3 scale function and place the domain.\n\n\n    this.numericalDomainFromData = function () {\n      var other_flat_data_arrays = [];\n\n      if (arguments.length > 0) {\n        other_flat_data_arrays = arguments;\n      } // pull out a non-empty array in args.data.\n\n\n      var illustrative_data;\n\n      for (var i = 0; i < args.data.length; i++) {\n        if (args.data[i].length > 0) {\n          illustrative_data = args.data[i];\n        }\n      }\n\n      scaleArgs.is_time_series = mg_is_date(illustrative_data[0][args[scaleArgs.namespace_accessor_name]]) ? true : false;\n      mg_add_scale_function(args, scaleArgs.scalefn_name, scaleArgs.scale_name, args[scaleArgs.namespace_accessor_name]);\n      mg_min_max_numerical(args, scaleArgs, other_flat_data_arrays, scaleArgs.use_inflator);\n      var time_scale = args.utc_time ? d3.scaleUtc() : d3.scaleTime();\n      args.scales[scaleArgs.scale_name] = scaleArgs.is_time_series ? time_scale : args[scaleArgs.namespace + '_scale_type'] === 'log' ? d3.scaleLog() : d3.scaleLinear();\n      args.scales[scaleArgs.scale_name].domain([args.processed['min_' + scaleArgs.namespace], args.processed['max_' + scaleArgs.namespace]]);\n      scaleArgs.scaleType = 'numerical';\n      return this;\n    };\n\n    this.categoricalDomain = function (domain) {\n      args.scales[scaleArgs.scale_name] = d3.scaleOrdinal().domain(domain);\n      mg_add_scale_function(args, scaleArgs.scalefn_name, scaleArgs.scale_name, args[scaleArgs.namespace_accessor_name]);\n      return this;\n    };\n\n    this.categoricalDomainFromData = function () {\n      // make args.categorical_variables.\n      // lets make the categorical variables.\n      var all_data = mg_flatten_array(args.data); //d3.set(data.map(function(d){return d[args.group_accessor]})).values()\n\n      scaleArgs.categoricalVariables = d3.set(all_data.map(function (d) {\n        return d[args[scaleArgs.namespace_accessor_name]];\n      })).values();\n      args.scales[scaleArgs.scale_name] = d3.scaleBand().domain(scaleArgs.categoricalVariables);\n      scaleArgs.scaleType = 'categorical';\n      return this;\n    }; /////////////////////////////////////////////////////////////////////////////////////////////////////////////\n    ////////// all scale ranges are either positional (for axes, etc) or arbitrary (colors, size, etc) //////////\n    /////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n\n    this.numericalRange = function (range) {\n      if (typeof range === 'string') {\n        args.scales[scaleArgs.scale_name].range(mg_position(range, args));\n      } else {\n        args.scales[scaleArgs.scale_name].range(range);\n      }\n\n      return this;\n    };\n\n    this.categoricalRangeBands = function (range, halfway) {\n      if (halfway === undefined) halfway = false;\n      var namespace = scaleArgs.namespace;\n      var paddingPercentage = args[namespace + '_padding_percentage'];\n      var outerPaddingPercentage = args[namespace + '_outer_padding_percentage'];\n\n      if (typeof range === 'string') {\n        // if string, it's a location. Place it accordingly.\n        args.scales[scaleArgs.scale_name].range(mg_position(range, args)).paddingInner(paddingPercentage).paddingOuter(outerPaddingPercentage);\n      } else {\n        args.scales[scaleArgs.scale_name].range(range).paddingInner(paddingPercentage).paddingOuter(outerPaddingPercentage);\n      }\n\n      mg_add_scale_function(args, scaleArgs.scalefn_name, scaleArgs.scale_name, args[scaleArgs.namespace_accessor_name], halfway ? args.scales[scaleArgs.scale_name].bandwidth() / 2 : 0);\n      return this;\n    };\n\n    this.categoricalRange = function (range) {\n      args.scales[scaleArgs.scale_name].range(range);\n      mg_add_scale_function(args, scaleArgs.scalefn_name, scaleArgs.scale_name, args[scaleArgs.namespace_accessor_name]);\n      return this;\n    };\n\n    this.categoricalColorRange = function () {\n      args.scales[scaleArgs.scale_name] = args.scales[scaleArgs.scale_name].domain().length > 10 ? d3.scaleOrdinal(d3.schemeCategory20) : d3.scaleOrdinal(d3.schemeCategory10);\n      args.scales[scaleArgs.scale_name].domain(scaleArgs.categoricalVariables);\n      mg_add_scale_function(args, scaleArgs.scalefn_name, scaleArgs.scale_name, args[scaleArgs.namespace_accessor_name]);\n      return this;\n    };\n\n    this.clamp = function (yn) {\n      args.scales[scaleArgs.scale_name].clamp(yn);\n      return this;\n    };\n\n    return this;\n  }\n\n  MG.scale_factory = MGScale; /////////////////////////////// x, x_accessor, markers, baselines, etc.\n\n  function mg_min_max_numerical(args, scaleArgs, additional_data_arrays) {\n    // A BIT OF EXPLANATION ABOUT THIS FUNCTION\n    // This function pulls out all the accessor values in all the arrays in args.data.\n    // We also have this additional argument, additional_data_arrays, which is an array of arrays of raw data values.\n    // These values also get concatenated to the data pulled from args.data, and the extents are calculate from that.\n    // They are optional.\n    //\n    // This may seem arbitrary, but it gives us a lot of flexibility. For instance, if we're calculating\n    // the min and max for the y axis of a line chart, we're going to want to also factor in baselines (horizontal lines\n    // that might potentially be outside of the y value bounds). The easiest way to do this is in the line.js code\n    // & scale creation to just flatten the args.baselines array, pull out hte values, and feed it in\n    // so it appears in additional_data_arrays.\n    var namespace = scaleArgs.namespace;\n    var namespace_accessor_name = scaleArgs.namespace_accessor_name;\n    var use_inflator = scaleArgs.use_inflator;\n    var zero_bottom = scaleArgs.zero_bottom;\n    var accessor = args[namespace_accessor_name]; // add together all relevant data arrays.\n\n    var all_data = mg_flatten_array(args.data).map(function (dp) {\n      return dp[accessor];\n    }).concat(mg_flatten_array(additional_data_arrays)); // do processing for log\n\n    if (args[namespace + '_scale_type'] === 'log') {\n      all_data = all_data.filter(function (d) {\n        return d > 0;\n      });\n    } // use inflator?\n\n\n    var extents = d3.extent(all_data);\n    var min_val = extents[0];\n    var max_val = extents[1]; // bolt scale domain to zero when the right conditions are met:\n    // not pulling the bottom of the range from data\n    // not zero-bottomed\n    // not a time series\n\n    if (zero_bottom && !args['min_' + namespace + '_from_data'] && min_val > 0 && !scaleArgs.is_time_series) {\n      min_val = args[namespace + '_scale_type'] === 'log' ? 1 : 0;\n    }\n\n    if (args[namespace + '_scale_type'] !== 'log' && min_val < 0 && !scaleArgs.is_time_series) {\n      min_val = min_val - (min_val - min_val * args.inflator) * use_inflator;\n    }\n\n    if (!scaleArgs.is_time_series) {\n      max_val = max_val < 0 ? max_val + (max_val - max_val * args.inflator) * use_inflator : max_val * (use_inflator ? args.inflator : 1);\n    }\n\n    min_val = args['min_' + namespace] || min_val;\n    max_val = args['max_' + namespace] || max_val; // if there's a single data point, we should custom-set the min and max values.\n\n    if (min_val === max_val && !(args['min_' + namespace] && args['max_' + namespace])) {\n      if (mg_is_date(min_val)) {\n        max_val = new Date(MG.clone(min_val).setDate(min_val.getDate() + 1));\n        min_val = new Date(MG.clone(min_val).setDate(min_val.getDate() - 1));\n      } else if (typeof min_val === 'number') {\n        min_val = min_val - 1;\n        max_val = min_val + 1;\n        mg_force_xax_count_to_be_two(args);\n      }\n    }\n\n    args.processed['min_' + namespace] = min_val;\n    args.processed['max_' + namespace] = max_val;\n    MG.call_hook('x_axis.process_min_max', args, args.processed.min_x, args.processed.max_x);\n    MG.call_hook('y_axis.process_min_max', args, args.processed.min_y, args.processed.max_y);\n  }\n\n  function mg_categorical_group_color_scale(args) {\n    if (args.color_accessor !== false) {\n      if (args.ygroup_accessor) {\n        // add a custom accessor element.\n        if (args.color_accessor === null) {\n          args.color_accessor = args.y_accessor;\n        } else {}\n      }\n\n      if (args.color_accessor !== null) {\n        new MG.scale_factory(args).namespace('color').categoricalDomainFromData().categoricalColorRange();\n      }\n    }\n  }\n\n  function mg_add_color_categorical_scale(args, domain, accessor) {\n    args.scales.color = d3.scaleOrdinal(d3.schemeCategory20).domain(domain);\n\n    args.scalefns.color = function (d) {\n      return args.scales.color(d[accessor]);\n    };\n  }\n\n  function mg_get_categorical_domain(data, accessor) {\n    return d3.set(data.map(function (d) {\n      return d[accessor];\n    })).values();\n  }\n\n  function mg_get_color_domain(args) {\n    var color_domain;\n\n    if (args.color_domain === null) {\n      if (args.color_type === 'number') {\n        color_domain = d3.extent(args.data[0], function (d) {\n          return d[args.color_accessor];\n        });\n      } else if (args.color_type === 'category') {\n        color_domain = mg_get_categorical_domain(args.data[0], args.color_accessor);\n      }\n    } else {\n      color_domain = args.color_domain;\n    }\n\n    return color_domain;\n  }\n\n  function mg_get_color_range(args) {\n    var color_range;\n\n    if (args.color_range === null) {\n      if (args.color_type === 'number') {\n        color_range = ['blue', 'red'];\n      } else {\n        color_range = null;\n      }\n    } else {\n      color_range = args.color_range;\n    }\n\n    return color_range;\n  }\n\n  function processScaleTicks(args, axis) {\n    var accessor = args[axis + '_accessor'];\n    var scale_ticks = args.scales[axis.toUpperCase()].ticks(args[axis + 'ax_count']);\n    var max = args.processed['max_' + axis];\n\n    function log10(val) {\n      if (val === 1000) {\n        return 3;\n      }\n\n      if (val === 1000000) {\n        return 7;\n      }\n\n      return Math.log(val) / Math.LN10;\n    }\n\n    if (args[axis + '_scale_type'] === 'log') {\n      // get out only whole logs\n      scale_ticks = scale_ticks.filter(function (d) {\n        return Math.abs(log10(d)) % 1 < 1e-6 || Math.abs(log10(d)) % 1 > 1 - 1e-6;\n      });\n    } // filter out fraction ticks if our data is ints and if xmax > number of generated ticks\n\n\n    var number_of_ticks = scale_ticks.length; // is our data object all ints?\n\n    var data_is_int = true;\n    args.data.forEach(function (d, i) {\n      d.forEach(function (d, i) {\n        if (d[accessor] % 1 !== 0) {\n          data_is_int = false;\n          return false;\n        }\n      });\n    });\n\n    if (data_is_int && number_of_ticks > max && args.format === 'count') {\n      // remove non-integer ticks\n      scale_ticks = scale_ticks.filter(function (d) {\n        return d % 1 === 0;\n      });\n    }\n\n    args.processed[axis + '_ticks'] = scale_ticks;\n  }\n\n  function rugPlacement(args, axisArgs) {\n    var position = axisArgs.position;\n    var ns = axisArgs.namespace;\n    var coordinates = {};\n\n    if (position === 'left') {\n      coordinates.x1 = mg_get_left(args) + 1;\n      coordinates.x2 = mg_get_left(args) + args.rug_buffer_size;\n      coordinates.y1 = args.scalefns[ns + 'f'];\n      coordinates.y2 = args.scalefns[ns + 'f'];\n    }\n\n    if (position === 'right') {\n      coordinates.x1 = mg_get_right(args) - 1, coordinates.x2 = mg_get_right(args) - args.rug_buffer_size, coordinates.y1 = args.scalefns[ns + 'f'];\n      coordinates.y2 = args.scalefns[ns + 'f'];\n    }\n\n    if (position === 'top') {\n      coordinates.x1 = args.scalefns[ns + 'f'];\n      coordinates.x2 = args.scalefns[ns + 'f'];\n      coordinates.y1 = mg_get_top(args) + 1;\n      coordinates.y2 = mg_get_top(args) + args.rug_buffer_size;\n    }\n\n    if (position === 'bottom') {\n      coordinates.x1 = args.scalefns[ns + 'f'];\n      coordinates.x2 = args.scalefns[ns + 'f'];\n      coordinates.y1 = mg_get_bottom(args) - 1;\n      coordinates.y2 = mg_get_bottom(args) - args.rug_buffer_size;\n    }\n\n    return coordinates;\n  }\n\n  function rimPlacement(args, axisArgs) {\n    var ns = axisArgs.namespace;\n    var position = axisArgs.position;\n    var tick_length = args.processed[ns + '_ticks'].length;\n    var ticks = args.processed[ns + '_ticks'];\n    var scale = args.scales[ns.toUpperCase()];\n    var coordinates = {};\n\n    if (position === 'left') {\n      coordinates.x1 = mg_get_left(args);\n      coordinates.x2 = mg_get_left(args);\n      coordinates.y1 = scale(ticks[0]).toFixed(2);\n      coordinates.y2 = scale(ticks[tick_length - 1]).toFixed(2);\n    }\n\n    if (position === 'right') {\n      coordinates.x1 = mg_get_right(args);\n      coordinates.x2 = mg_get_right(args);\n      coordinates.y1 = scale(ticks[0]).toFixed(2);\n      coordinates.y2 = scale(ticks[tick_length - 1]).toFixed(2);\n    }\n\n    if (position === 'top') {\n      coordinates.x1 = mg_get_left(args);\n      coordinates.x2 = mg_get_right(args);\n      coordinates.y1 = mg_get_top(args);\n      coordinates.y2 = mg_get_top(args);\n    }\n\n    if (position === 'bottom') {\n      coordinates.x1 = mg_get_left(args);\n      coordinates.x2 = mg_get_right(args);\n      coordinates.y1 = mg_get_bottom(args);\n      coordinates.y2 = mg_get_bottom(args);\n    }\n\n    if (position === 'left' || position === 'right') {\n      if (args.axes_not_compact) {\n        coordinates.y1 = mg_get_bottom(args);\n        coordinates.y2 = mg_get_top(args);\n      } else if (tick_length) {\n        coordinates.y1 = scale(ticks[0]).toFixed(2);\n        coordinates.y2 = scale(ticks[tick_length - 1]).toFixed(2);\n      }\n    }\n\n    return coordinates;\n  }\n\n  function labelPlacement(args, axisArgs) {\n    var position = axisArgs.position;\n    var ns = axisArgs.namespace;\n    var tickLength = args[ns + 'ax_tick_length'];\n    var scale = args.scales[ns.toUpperCase()];\n    var coordinates = {};\n\n    if (position === 'left') {\n      coordinates.x = mg_get_left(args) - tickLength * 3 / 2;\n\n      coordinates.y = function (d) {\n        return scale(d).toFixed(2);\n      };\n\n      coordinates.dx = -3;\n      coordinates.dy = '.35em';\n      coordinates.textAnchor = 'end';\n\n      coordinates.text = function (d) {\n        return mg_compute_yax_format(args)(d);\n      };\n    }\n\n    if (position === 'right') {\n      coordinates.x = mg_get_right(args) + tickLength * 3 / 2;\n\n      coordinates.y = function (d) {\n        return scale(d).toFixed(2);\n      };\n\n      coordinates.dx = 3;\n      coordinates.dy = '.35em';\n      coordinates.textAnchor = 'start';\n\n      coordinates.text = function (d) {\n        return mg_compute_yax_format(args)(d);\n      };\n    }\n\n    if (position === 'top') {\n      coordinates.x = function (d) {\n        return scale(d).toFixed(2);\n      };\n\n      coordinates.y = (mg_get_top(args) - tickLength * 7 / 3).toFixed(2);\n      coordinates.dx = 0;\n      coordinates.dy = '0em';\n      coordinates.textAnchor = 'middle';\n\n      coordinates.text = function (d) {\n        return mg_default_xax_format(args)(d);\n      };\n    }\n\n    if (position === 'bottom') {\n      coordinates.x = function (d) {\n        return scale(d).toFixed(2);\n      };\n\n      coordinates.y = (mg_get_bottom(args) + tickLength * 7 / 3).toFixed(2);\n      coordinates.dx = 0;\n      coordinates.dy = '.50em';\n      coordinates.textAnchor = 'middle';\n\n      coordinates.text = function (d) {\n        return mg_default_xax_format(args)(d);\n      };\n    }\n\n    return coordinates;\n  }\n\n  function selectXaxFormat(args) {\n    var c = args.chart_type;\n\n    if (!args.processed.xax_format) {\n      if (args.xax_format) {\n        args.processed.xax_format = args.xax_format;\n      } else {\n        if (c === 'line' || c === 'point' || c === 'histogram') {\n          args.processed.xax_format = mg_default_xax_format(args);\n        } else if (c === 'bar') {\n          args.processed.xax_format = mg_default_bar_xax_format(args);\n        }\n      }\n    }\n  }\n\n  function secondaryLabels(g, args, axisArgs) {\n    if (args.time_series && (args.show_years || args.show_secondary_x_label)) {\n      var tf = mg_get_yformat_and_secondary_time_function(args);\n      addSecondaryLabelElements(args, axisArgs, g, tf.timeframe, tf.yformat, tf.secondary);\n    }\n  }\n\n  function addSecondaryLabelElements(args, axisArgs, g, time_frame, yformat, secondary_function) {\n    var years = secondary_function(args.processed.min_x, args.processed.max_x);\n\n    if (years.length === 0) {\n      var first_tick = args.scales.X.ticks(args.xax_count)[0];\n      years = [first_tick];\n    }\n\n    var yg = mg_add_g(g, 'mg-year-marker');\n\n    if (time_frame === 'default' && args.show_year_markers) {\n      yearMarkerLine(args, axisArgs, yg, years, yformat);\n    }\n\n    if (time_frame != 'years') yearMarkerText(args, axisArgs, yg, years, yformat);\n  }\n\n  function yearMarkerLine(args, axisArgs, g, years, yformat) {\n    g.selectAll('.mg-year-marker').data(years).enter().append('line').attr('x1', function (d) {\n      return args.scales.X(d).toFixed(2);\n    }).attr('x2', function (d) {\n      return args.scales.X(d).toFixed(2);\n    }).attr('y1', mg_get_top(args)).attr('y2', mg_get_bottom(args));\n  }\n\n  function yearMarkerText(args, axisArgs, g, years, yformat) {\n    var position = axisArgs.position;\n    var ns = axisArgs.namespace;\n    var scale = args.scales[ns.toUpperCase()];\n    var x, y, dy, textAnchor, textFcn;\n    var xAxisTextElement = d3.select(args.target).select('.mg-x-axis text').node().getBoundingClientRect();\n\n    if (position === 'top') {\n      x = function (d, i) {\n        return scale(d).toFixed(2);\n      };\n\n      y = mg_get_top(args) - args.xax_tick_length * 7 / 3 - xAxisTextElement.height;\n      dy = '.50em';\n      textAnchor = 'middle';\n\n      textFcn = function (d) {\n        return yformat(new Date(d));\n      };\n    }\n\n    if (position === 'bottom') {\n      x = function (d, i) {\n        return scale(d).toFixed(2);\n      };\n\n      y = mg_get_bottom(args) + args.xax_tick_length * 7 / 3 + xAxisTextElement.height * 0.8;\n      dy = '.50em';\n      textAnchor = 'middle';\n\n      textFcn = function (d) {\n        return yformat(new Date(d));\n      };\n    }\n\n    g.selectAll('.mg-year-marker').data(years).enter().append('text').attr('x', x).attr('y', y).attr('dy', dy).attr('text-anchor', textAnchor).text(textFcn);\n  }\n\n  function addNumericalLabels(g, args, axisArgs) {\n    var ns = axisArgs.namespace;\n    var coords = labelPlacement(args, axisArgs);\n    var ticks = args.processed[ns + '_ticks'];\n    var labels = g.selectAll('.mg-yax-labels').data(ticks).enter().append('text').attr('x', coords.x).attr('dx', coords.dx).attr('y', coords.y).attr('dy', coords.dy).attr('text-anchor', coords.textAnchor).text(coords.text); // move the labels if they overlap\n\n    if (ns == 'x') {\n      selectXaxFormat(args);\n\n      if (args.time_series && args.european_clock) {\n        labels.append('tspan').classed('mg-european-hours', true).text(function (_d, i) {\n          var d = new Date(_d);\n          if (i === 0) return d3.timeFormat('%H')(d);else return '';\n        });\n        labels.append('tspan').classed('mg-european-minutes-seconds', true).text(function (_d, i) {\n          var d = new Date(_d);\n          return ':' + args.processed.xax_format(d);\n        });\n      } else {\n        labels.text(function (d) {\n          return args.xax_units + args.processed.xax_format(d);\n        });\n      }\n\n      secondaryLabels(g, args, axisArgs);\n    }\n\n    if (mg_elements_are_overlapping(labels)) {\n      labels.filter(function (d, i) {\n        return (i + 1) % 2 === 0;\n      }).remove();\n      var svg = mg_get_svg_child_of(args.target);\n      svg.selectAll('.mg-' + ns + 'ax-ticks').filter(function (d, i) {\n        return (i + 1) % 2 === 0;\n      }).remove();\n    }\n  }\n\n  function addTickLines(g, args, axisArgs) {\n    // name\n    var ns = axisArgs.namespace;\n    var position = axisArgs.position;\n    var scale = args.scales[ns.toUpperCase()];\n    var ticks = args.processed[ns + '_ticks'];\n    var ticksClass = 'mg-' + ns + 'ax-ticks';\n    var extendedTicksClass = 'mg-extended-' + ns + 'ax-ticks';\n    var extendedTicks = args[ns + '_extended_ticks'];\n    var tickLength = args[ns + 'ax_tick_length'];\n    var x1, x2, y1, y2;\n\n    if (position === 'left') {\n      x1 = mg_get_left(args);\n      x2 = extendedTicks ? mg_get_right(args) : mg_get_left(args) - tickLength;\n\n      y1 = function (d) {\n        return scale(d).toFixed(2);\n      };\n\n      y2 = function (d) {\n        return scale(d).toFixed(2);\n      };\n    }\n\n    if (position === 'right') {\n      x1 = mg_get_right(args);\n      x2 = extendedTicks ? mg_get_left(args) : mg_get_right(args) + tickLength;\n\n      y1 = function (d) {\n        return scale(d).toFixed(2);\n      };\n\n      y2 = function (d) {\n        return scale(d).toFixed(2);\n      };\n    }\n\n    if (position === 'top') {\n      x1 = function (d) {\n        return scale(d).toFixed(2);\n      };\n\n      x2 = function (d) {\n        return scale(d).toFixed(2);\n      };\n\n      y1 = mg_get_top(args);\n      y2 = extendedTicks ? mg_get_bottom(args) : mg_get_top(args) - tickLength;\n    }\n\n    if (position === 'bottom') {\n      x1 = function (d) {\n        return scale(d).toFixed(2);\n      };\n\n      x2 = function (d) {\n        return scale(d).toFixed(2);\n      };\n\n      y1 = mg_get_bottom(args);\n      y2 = extendedTicks ? mg_get_top(args) : mg_get_bottom(args) + tickLength;\n    }\n\n    g.selectAll('.' + ticksClass).data(ticks).enter().append('line').classed(extendedTicksClass, extendedTicks).attr('x1', x1).attr('x2', x2).attr('y1', y1).attr('y2', y2);\n  }\n\n  function initializeAxisRim(g, args, axisArgs) {\n    var namespace = axisArgs.namespace;\n    var tick_length = args.processed[namespace + '_ticks'].length;\n    var rim = rimPlacement(args, axisArgs);\n\n    if (!args[namespace + '_extended_ticks'] && !args[namespace + '_extended_ticks'] && tick_length) {\n      g.append('line').attr('x1', rim.x1).attr('x2', rim.x2).attr('y1', rim.y1).attr('y2', rim.y2);\n    }\n  }\n\n  function initializeRug(args, rug_class) {\n    var svg = mg_get_svg_child_of(args.target);\n    var all_data = mg_flatten_array(args.data);\n    var rug = svg.selectAll('line.' + rug_class).data(all_data); // set the attributes that do not change after initialization, per\n\n    rug.enter().append('svg:line').attr('class', rug_class).attr('opacity', 0.3); // remove rug elements that are no longer in use\n\n    mg_exit_and_remove(rug); // set coordinates of new rug elements\n\n    mg_exit_and_remove(rug);\n    return rug;\n  }\n\n  function rug(args, axisArgs) {\n    'use strict';\n\n    args.rug_buffer_size = args.chart_type === 'point' ? args.buffer / 2 : args.buffer * 2 / 3;\n    var rug = initializeRug(args, 'mg-' + axisArgs.namespace + '-rug');\n    var rug_positions = rugPlacement(args, axisArgs);\n    rug.attr('x1', rug_positions.x1).attr('x2', rug_positions.x2).attr('y1', rug_positions.y1).attr('y2', rug_positions.y2);\n    mg_add_color_accessor_to_rug(rug, args, 'mg-' + axisArgs.namespace + '-rug-mono');\n  }\n\n  function categoricalLabelPlacement(args, axisArgs, group) {\n    var ns = axisArgs.namespace;\n    var position = axisArgs.position;\n    var scale = args.scales[ns.toUpperCase()];\n    var groupScale = args.scales[(ns + 'group').toUpperCase()];\n    var coords = {};\n    coords.cat = {};\n    coords.group = {}; // x, y, dy, text-anchor\n\n    if (position === 'left') {\n      coords.cat.x = mg_get_plot_left(args) - args.buffer;\n\n      coords.cat.y = function (d) {\n        return groupScale(group) + scale(d) + scale.bandwidth() / 2;\n      };\n\n      coords.cat.dy = '.35em';\n      coords.cat.textAnchor = 'end';\n      coords.group.x = mg_get_plot_left(args) - args.buffer;\n      coords.group.y = groupScale(group) + (groupScale.bandwidth ? groupScale.bandwidth() / 2 : 0);\n      coords.group.dy = '.35em';\n      coords.group.textAnchor = args['rotate_' + ns + '_labels'] ? 'end' : 'end';\n    }\n\n    if (position === 'right') {\n      coords.cat.x = mg_get_plot_right(args) - args.buffer;\n\n      coords.cat.y = function (d) {\n        return groupScale(group) + scale(d) + scale.bandwidth() / 2;\n      };\n\n      coords.cat.dy = '.35em';\n      coords.cat.textAnchor = 'start';\n      coords.group.x = mg_get_plot_right(args) - args.buffer;\n      coords.group.y = groupScale(group) + (groupScale.bandwidth ? groupScale.bandwidth() / 2 : 0);\n      coords.group.dy = '.35em';\n      coords.group.textAnchor = 'start';\n    }\n\n    if (position === 'top') {\n      coords.cat.x = function (d) {\n        return groupScale(group) + scale(d) + scale.bandwidth() / 2;\n      };\n\n      coords.cat.y = mg_get_plot_top(args) + args.buffer;\n      coords.cat.dy = '.35em';\n      coords.cat.textAnchor = args['rotate_' + ns + '_labels'] ? 'start' : 'middle';\n      coords.group.x = groupScale(group) + (groupScale.bandwidth ? groupScale.bandwidth() / 2 : 0);\n      coords.group.y = mg_get_plot_top(args) + args.buffer;\n      coords.group.dy = '.35em';\n      coords.group.textAnchor = args['rotate_' + ns + '_labels'] ? 'start' : 'middle';\n    }\n\n    if (position === 'bottom') {\n      coords.cat.x = function (d) {\n        return groupScale(group) + scale(d) + scale.bandwidth() / 2;\n      };\n\n      coords.cat.y = mg_get_plot_bottom(args) + args.buffer;\n      coords.cat.dy = '.35em';\n      coords.cat.textAnchor = args['rotate_' + ns + '_labels'] ? 'start' : 'middle';\n      coords.group.x = groupScale(group) + (groupScale.bandwidth ? groupScale.bandwidth() / 2 - scale.bandwidth() / 2 : 0);\n      coords.group.y = mg_get_plot_bottom(args) + args.buffer;\n      coords.group.dy = '.35em';\n      coords.group.textAnchor = args['rotate_' + ns + '_labels'] ? 'start' : 'middle';\n    }\n\n    return coords;\n  }\n\n  function categoricalLabels(args, axisArgs) {\n    var ns = axisArgs.namespace;\n    var nsClass = 'mg-' + ns + '-axis';\n    var scale = args.scales[ns.toUpperCase()];\n    var groupScale = args.scales[(ns + 'group').toUpperCase()];\n    var groupAccessor = ns + 'group_accessor';\n    var svg = mg_get_svg_child_of(args.target);\n    mg_selectAll_and_remove(svg, '.' + nsClass);\n    var g = mg_add_g(svg, nsClass);\n    var group_g;\n    var groups = groupScale.domain && groupScale.domain() ? groupScale.domain() : ['1'];\n    groups.forEach(function (group) {\n      // grab group placement stuff.\n      var coords = categoricalLabelPlacement(args, axisArgs, group);\n      group_g = mg_add_g(g, 'mg-group-' + mg_normalize(group));\n\n      if (args[groupAccessor] !== null) {\n        var labels = group_g.append('text').classed('mg-barplot-group-label', true).attr('x', coords.group.x).attr('y', coords.group.y).attr('dy', coords.group.dy).attr('text-anchor', coords.group.textAnchor).text(group);\n      } else {\n        var labels = group_g.selectAll('text').data(scale.domain()).enter().append('text').attr('x', coords.cat.x).attr('y', coords.cat.y).attr('dy', coords.cat.dy).attr('text-anchor', coords.cat.textAnchor).text(String);\n      }\n\n      if (args['rotate_' + ns + '_labels']) {\n        rotateLabels(labels, args['rotate_' + ns + '_labels']);\n      }\n    });\n  }\n\n  function categoricalGuides(args, axisArgs) {\n    // for each group\n    // for each data point\n    var ns = axisArgs.namespace;\n    var scalef = args.scalefns[ns + 'f'];\n    var groupf = args.scalefns[ns + 'groupf'];\n    var groupScale = args.scales[(ns + 'group').toUpperCase()];\n    var scale = args.scales[ns.toUpperCase()];\n    var position = axisArgs.position;\n    var svg = mg_get_svg_child_of(args.target);\n    var alreadyPlotted = [];\n    var x1, x2, y1, y2;\n    var grs = groupScale.domain && groupScale.domain() ? groupScale.domain() : [null];\n    mg_selectAll_and_remove(svg, '.mg-category-guides');\n    var g = mg_add_g(svg, 'mg-category-guides');\n    grs.forEach(function (group) {\n      scale.domain().forEach(function (cat) {\n        if (position === 'left' || position === 'right') {\n          x1 = mg_get_plot_left(args);\n          x2 = mg_get_plot_right(args);\n          y1 = scale(cat) + groupScale(group) + scale.bandwidth() / 2;\n          y2 = scale(cat) + groupScale(group) + scale.bandwidth() / 2;\n        }\n\n        if (position === 'top' || position === 'bottom') {\n          x1 = scale(cat) + groupScale(group) + scale.bandwidth() / 2 * (group === null);\n          x2 = scale(cat) + groupScale(group) + scale.bandwidth() / 2 * (group === null);\n          y1 = mg_get_plot_bottom(args);\n          y2 = mg_get_plot_top(args);\n        }\n\n        g.append('line').attr('x1', x1).attr('x2', x2).attr('y1', y1).attr('y2', y2).attr('stroke-dasharray', '2,1');\n      });\n      var first = groupScale(group) + scale(scale.domain()[0]) + scale.bandwidth() / 2 * (group === null || position !== 'top' && position != 'bottom');\n      var last = groupScale(group) + scale(scale.domain()[scale.domain().length - 1]) + scale.bandwidth() / 2 * (group === null || position !== 'top' && position != 'bottom');\n\n      if (position === 'left' || position === 'right') {\n        x11 = mg_get_plot_left(args);\n        x21 = mg_get_plot_left(args);\n        y11 = first;\n        y21 = last;\n        x12 = mg_get_plot_right(args);\n        x22 = mg_get_plot_right(args);\n        y12 = first;\n        y22 = last;\n      }\n\n      if (position === 'bottom' || position === 'top') {\n        x11 = first;\n        x21 = last;\n        y11 = mg_get_plot_bottom(args);\n        y21 = mg_get_plot_bottom(args);\n        x12 = first;\n        x22 = last;\n        y12 = mg_get_plot_top(args);\n        y22 = mg_get_plot_top(args);\n      }\n\n      g.append('line').attr('x1', x11).attr('x2', x21).attr('y1', y11).attr('y2', y21).attr('stroke-dasharray', '2,1');\n      g.append('line').attr('x1', x12).attr('x2', x22).attr('y1', y12).attr('y2', y22).attr('stroke-dasharray', '2,1');\n    });\n  }\n\n  function rotateLabels(labels, rotation_degree) {\n    if (rotation_degree) {\n      labels.attr('transform', function () {\n        var elem = d3.select(this);\n        return 'rotate(' + rotation_degree + ' ' + elem.attr('x') + ',' + elem.attr('y') + ')';\n      });\n    }\n  }\n\n  function zeroLine(args, axisArgs) {\n    var svg = mg_get_svg_child_of(args.target);\n    var ns = axisArgs.namespace;\n    var position = axisArgs.position;\n    var scale = args.scales[ns.toUpperCase()];\n    var x1, x2, y1, y2;\n\n    if (position === 'left' || position === 'right') {\n      x1 = mg_get_plot_left(args);\n      x2 = mg_get_plot_right(args);\n      y1 = scale(0) + 1;\n      y2 = scale(0) + 1;\n    }\n\n    if (position === 'bottom' || position === 'top') {\n      y1 = mg_get_plot_top(args);\n      y2 = mg_get_plot_bottom(args);\n      x1 = scale(0) - 1;\n      x2 = scale(0) - 1;\n    }\n\n    svg.append('line').attr('x1', x1).attr('x2', x2).attr('y1', y1).attr('y2', y2).attr('stroke', 'black');\n  }\n\n  var mgDrawAxis = {};\n\n  mgDrawAxis.categorical = function (args, axisArgs) {\n    var ns = axisArgs.namespace;\n    categoricalLabels(args, axisArgs);\n    categoricalGuides(args, axisArgs);\n  };\n\n  mgDrawAxis.numerical = function (args, axisArgs) {\n    var namespace = axisArgs.namespace;\n    var axisName = namespace + '_axis';\n    var axisClass = 'mg-' + namespace + '-axis';\n    var svg = mg_get_svg_child_of(args.target);\n    mg_selectAll_and_remove(svg, '.' + axisClass);\n\n    if (!args[axisName]) {\n      return this;\n    }\n\n    var g = mg_add_g(svg, axisClass);\n    processScaleTicks(args, namespace);\n    initializeAxisRim(g, args, axisArgs);\n    addTickLines(g, args, axisArgs);\n    addNumericalLabels(g, args, axisArgs); // add label\n\n    if (args[namespace + '_label']) {\n      axisArgs.label(svg.select('.mg-' + namespace + '-axis'), args);\n    } // add rugs\n\n\n    if (args[namespace + '_rug']) {\n      rug(args, axisArgs);\n    }\n\n    if (args.show_bar_zero) {\n      mg_bar_add_zero_line(args);\n    }\n\n    return this;\n  };\n\n  function axisFactory(args) {\n    var axisArgs = {};\n    axisArgs.type = 'numerical';\n\n    this.namespace = function (ns) {\n      // take the ns in the scale, and use it to\n      axisArgs.namespace = ns;\n      return this;\n    };\n\n    this.rug = function (tf) {\n      axisArgs.rug = tf;\n      return this;\n    };\n\n    this.label = function (tf) {\n      axisArgs.label = tf;\n      return this;\n    };\n\n    this.type = function (t) {\n      axisArgs.type = t;\n      return this;\n    };\n\n    this.position = function (pos) {\n      axisArgs.position = pos;\n      return this;\n    };\n\n    this.zeroLine = function (tf) {\n      axisArgs.zeroLine = tf;\n      return this;\n    };\n\n    this.draw = function () {\n      mgDrawAxis[axisArgs.type](args, axisArgs);\n      return this;\n    };\n\n    return this;\n  }\n\n  MG.axis_factory = axisFactory;\n  /* ================================================================================ */\n\n  /* ================================================================================ */\n\n  /* ================================================================================ */\n\n  function y_rug(args) {\n    'use strict';\n\n    if (!args.y_rug) {\n      return;\n    }\n\n    args.rug_buffer_size = args.chart_type === 'point' ? args.buffer / 2 : args.buffer * 2 / 3;\n    var rug = mg_make_rug(args, 'mg-y-rug');\n    rug.attr('x1', args.left + 1).attr('x2', args.left + args.rug_buffer_size).attr('y1', args.scalefns.yf).attr('y2', args.scalefns.yf);\n    mg_add_color_accessor_to_rug(rug, args, 'mg-y-rug-mono');\n  }\n\n  MG.y_rug = y_rug;\n\n  function mg_change_y_extents_for_bars(args, my) {\n    if (args.chart_type === 'bar') {\n      my.min = 0;\n      my.max = d3.max(args.data[0], function (d) {\n        var trio = [];\n        trio.push(d[args.y_accessor]);\n\n        if (args.baseline_accessor !== null) {\n          trio.push(d[args.baseline_accessor]);\n        }\n\n        if (args.predictor_accessor !== null) {\n          trio.push(d[args.predictor_accessor]);\n        }\n\n        return Math.max.apply(null, trio);\n      });\n    }\n\n    return my;\n  }\n\n  function mg_compute_yax_format(args) {\n    var yax_format = args.yax_format;\n\n    if (!yax_format) {\n      if (args.format === 'count') {\n        // increase decimals if we have small values, useful for realtime data\n        if (args.processed.max_y < 0.0001) {\n          args.decimals = 6;\n        } else if (args.processed.max_y < 0.1) {\n          args.decimals = 4;\n        }\n\n        yax_format = function (d) {\n          var pf;\n\n          if (d < 1.0 && d > -1.0 && d !== 0) {\n            // don't scale tiny values\n            pf = d3.format(',.' + args.decimals + 'f');\n          } else if (d < 1000) {\n            pf = d3.format(',.0f');\n          } else {\n            pf = d3.format(',.2s');\n          } // are we adding units after the value or before?\n\n\n          if (args.yax_units_append) {\n            return pf(d) + args.yax_units;\n          } else {\n            return args.yax_units + pf(d);\n          }\n        };\n      } else {\n        // percentage\n        yax_format = function (d_) {\n          var n = d3.format('.0%');\n          return n(d_);\n        };\n      }\n    }\n\n    return yax_format;\n  }\n\n  function mg_bar_add_zero_line(args) {\n    var svg = mg_get_svg_child_of(args.target);\n    var extents = args.scales.X.domain();\n\n    if (0 >= extents[0] && extents[1] >= 0) {\n      var r = args.scales.Y.range();\n      var g = args.categorical_groups.length ? args.scales.YGROUP(args.categorical_groups[args.categorical_groups.length - 1]) : args.scales.YGROUP();\n      svg.append('svg:line').attr('x1', args.scales.X(0)).attr('x2', args.scales.X(0)).attr('y1', r[0] + mg_get_plot_top(args)).attr('y2', r[r.length - 1] + g).attr('stroke', 'black').attr('opacity', .2);\n    }\n  }\n\n  function set_min_max_y(args) {\n    // flatten data\n    // remove weird data, if log.\n    var data = mg_flatten_array(args.data);\n\n    if (args.y_scale_type === 'log') {\n      data = data.filter(function (d) {\n        return d[args.y_accessor] > 0;\n      });\n    }\n\n    if (args.baselines) {\n      data = data.concat(args.baselines);\n    }\n\n    var extents = d3.extent(data, function (d) {\n      return d[args.y_accessor];\n    });\n    var my = {};\n    my.min = extents[0];\n    my.max = extents[1]; // the default case is for the y-axis to start at 0, unless we explicitly want it\n    // to start at an arbitrary number or from the data's minimum value\n\n    if (my.min >= 0 && !args.min_y && !args.min_y_from_data) {\n      my.min = 0;\n    }\n\n    mg_change_y_extents_for_bars(args, my);\n    my.min = args.min_y !== null ? args.min_y : my.min;\n    my.max = args.max_y !== null ? args.max_y : my.max < 0 ? my.max + (my.max - my.max * args.inflator) : my.max * args.inflator;\n\n    if (args.y_scale_type !== 'log' && my.min < 0) {\n      my.min = my.min - (my.min - my.min * args.inflator);\n    }\n\n    if (!args.min_y && args.min_y_from_data) {\n      var buff = (my.max - my.min) * .01;\n      my.min = extents[0] - buff;\n      my.max = extents[1] + buff;\n    }\n\n    args.processed.min_y = my.min;\n    args.processed.max_y = my.max;\n  }\n\n  function mg_y_domain_range(args, scale) {\n    scale.domain([args.processed.min_y, args.processed.max_y]).range([mg_get_plot_bottom(args), args.top]);\n    return scale;\n  }\n\n  function mg_define_y_scales(args) {\n    var scale = args.y_scale_type === 'log' ? d3.scaleLog() : d3.scaleLinear();\n\n    if (args.y_scale_type === 'log') {\n      if (args.chart_type === 'histogram') {\n        // log histogram plots should start just below 1\n        // so that bins with single counts are visible\n        args.processed.min_y = 0.2;\n      } else {\n        if (args.processed.min_y <= 0) {\n          args.processed.min_y = 1;\n        }\n      }\n    }\n\n    args.scales.Y = mg_y_domain_range(args, scale);\n    args.scales.Y.clamp(args.y_scale_type === 'log'); // used for ticks and such, and designed to be paired with log or linear\n\n    args.scales.Y_axis = mg_y_domain_range(args, d3.scaleLinear());\n  }\n\n  function mg_add_y_label(g, args) {\n    if (args.y_label) {\n      g.append('text').attr('class', 'label').attr('x', function () {\n        return -1 * (mg_get_plot_top(args) + (mg_get_plot_bottom(args) - mg_get_plot_top(args)) / 2);\n      }).attr('y', function () {\n        return args.left / 2;\n      }).attr('dy', '0.4em').attr('text-anchor', 'middle').text(function (d) {\n        return args.y_label;\n      }).attr('transform', function (d) {\n        return 'rotate(-90)';\n      });\n    }\n  }\n\n  function mg_add_y_axis_rim(g, args) {\n    var tick_length = args.processed.y_ticks.length;\n\n    if (!args.x_extended_ticks && !args.y_extended_ticks && tick_length) {\n      var y1scale, y2scale;\n\n      if (args.axes_not_compact && args.chart_type !== 'bar') {\n        y1scale = args.height - args.bottom;\n        y2scale = args.top;\n      } else if (tick_length) {\n        y1scale = args.scales.Y(args.processed.y_ticks[0]).toFixed(2);\n        y2scale = args.scales.Y(args.processed.y_ticks[tick_length - 1]).toFixed(2);\n      } else {\n        y1scale = 0;\n        y2scale = 0;\n      }\n\n      g.append('line').attr('x1', args.left).attr('x2', args.left).attr('y1', y1scale).attr('y2', y2scale);\n    }\n  }\n\n  function mg_add_y_axis_tick_lines(g, args) {\n    g.selectAll('.mg-yax-ticks').data(args.processed.y_ticks).enter().append('line').classed('mg-extended-yax-ticks', args.y_extended_ticks).attr('x1', args.left).attr('x2', function () {\n      return args.y_extended_ticks ? args.width - args.right : args.left - args.yax_tick_length;\n    }).attr('y1', function (d) {\n      return args.scales.Y(d).toFixed(2);\n    }).attr('y2', function (d) {\n      return args.scales.Y(d).toFixed(2);\n    });\n  }\n\n  function mg_add_y_axis_tick_labels(g, args) {\n    var yax_format = mg_compute_yax_format(args);\n    g.selectAll('.mg-yax-labels').data(args.processed.y_ticks).enter().append('text').attr('x', args.left - args.yax_tick_length * 3 / 2).attr('dx', -3).attr('y', function (d) {\n      return args.scales.Y(d).toFixed(2);\n    }).attr('dy', '.35em').attr('text-anchor', 'end').text(function (d) {\n      var o = yax_format(d);\n      return o;\n    });\n  } // TODO ought to be deprecated, only used by histogram\n\n\n  function y_axis(args) {\n    if (!args.processed) {\n      args.processed = {};\n    }\n\n    var svg = mg_get_svg_child_of(args.target);\n    MG.call_hook('y_axis.process_min_max', args, args.processed.min_y, args.processed.max_y);\n    mg_selectAll_and_remove(svg, '.mg-y-axis');\n\n    if (!args.y_axis) {\n      return this;\n    }\n\n    var g = mg_add_g(svg, 'mg-y-axis');\n    mg_add_y_label(g, args);\n    mg_process_scale_ticks(args, 'y');\n    mg_add_y_axis_rim(g, args);\n    mg_add_y_axis_tick_lines(g, args);\n    mg_add_y_axis_tick_labels(g, args);\n\n    if (args.y_rug) {\n      y_rug(args);\n    }\n\n    return this;\n  }\n\n  MG.y_axis = y_axis;\n\n  function mg_add_categorical_labels(args) {\n    var svg = mg_get_svg_child_of(args.target);\n    mg_selectAll_and_remove(svg, '.mg-y-axis');\n    var g = mg_add_g(svg, 'mg-y-axis');\n    var group_g;\n    (args.categorical_groups.length ? args.categorical_groups : ['1']).forEach(function (group) {\n      group_g = mg_add_g(g, 'mg-group-' + mg_normalize(group));\n\n      if (args.ygroup_accessor !== null) {\n        mg_add_group_label(group_g, group, args);\n      } else {\n        var labels = mg_add_graphic_labels(group_g, group, args);\n        mg_rotate_labels(labels, args.rotate_y_labels);\n      }\n    });\n  }\n\n  function mg_add_graphic_labels(g, group, args) {\n    return g.selectAll('text').data(args.scales.Y.domain()).enter().append('svg:text').attr('x', args.left - args.buffer).attr('y', function (d) {\n      return args.scales.YGROUP(group) + args.scales.Y(d) + args.scales.Y.bandwidth() / 2;\n    }).attr('dy', '.35em').attr('text-anchor', 'end').text(String);\n  }\n\n  function mg_add_group_label(g, group, args) {\n    g.append('svg:text').classed('mg-barplot-group-label', true).attr('x', args.left - args.buffer).attr('y', args.scales.YGROUP(group) + args.scales.YGROUP.bandwidth() / 2).attr('dy', '.35em').attr('text-anchor', 'end').text(group);\n  }\n\n  function mg_draw_group_lines(args) {\n    var svg = mg_get_svg_child_of(args.target);\n    var groups = args.scales.YGROUP.domain();\n    var first = groups[0];\n    var last = groups[groups.length - 1];\n    svg.select('.mg-category-guides').selectAll('mg-group-lines').data(groups).enter().append('line').attr('x1', mg_get_plot_left(args)).attr('x2', mg_get_plot_left(args)).attr('y1', function (d) {\n      return args.scales.YGROUP(d);\n    }).attr('y2', function (d) {\n      return args.scales.YGROUP(d) + args.ygroup_height;\n    }).attr('stroke-width', 1);\n  }\n\n  function mg_y_categorical_show_guides(args) {\n    // for each group\n    // for each data point\n    var svg = mg_get_svg_child_of(args.target);\n    var alreadyPlotted = [];\n    args.data[0].forEach(function (d) {\n      if (alreadyPlotted.indexOf(d[args.y_accessor]) === -1) {\n        svg.select('.mg-category-guides').append('line').attr('x1', mg_get_plot_left(args)).attr('x2', mg_get_plot_right(args)).attr('y1', args.scalefns.yf(d) + args.scalefns.ygroupf(d)).attr('y2', args.scalefns.yf(d) + args.scalefns.ygroupf(d)).attr('stroke-dasharray', '2,1');\n      }\n    });\n  }\n\n  function y_axis_categorical(args) {\n    if (!args.y_axis) {\n      return this;\n    }\n\n    mg_add_categorical_labels(args); // mg_draw_group_scaffold(args);\n\n    if (args.show_bar_zero) mg_bar_add_zero_line(args);\n    if (args.ygroup_accessor) mg_draw_group_lines(args);\n    if (args.y_categorical_show_guides) mg_y_categorical_show_guides(args);\n    return this;\n  }\n\n  MG.y_axis_categorical = y_axis_categorical;\n\n  function x_rug(args) {\n    'use strict';\n\n    if (!args.x_rug) {\n      return;\n    }\n\n    args.rug_buffer_size = args.chart_type === 'point' ? args.buffer / 2 : args.buffer;\n    var rug = mg_make_rug(args, 'mg-x-rug');\n    rug.attr('x1', args.scalefns.xf).attr('x2', args.scalefns.xf).attr('y1', args.height - args.bottom - args.rug_buffer_size).attr('y2', args.height - args.bottom);\n    mg_add_color_accessor_to_rug(rug, args, 'mg-x-rug-mono');\n  }\n\n  MG.x_rug = x_rug;\n\n  function mg_add_processed_object(args) {\n    if (!args.processed) {\n      args.processed = {};\n    }\n  } // TODO ought to be deprecated, only used by histogram\n\n\n  function x_axis(args) {\n    'use strict';\n\n    var svg = mg_get_svg_child_of(args.target);\n    mg_add_processed_object(args);\n    mg_select_xax_format(args);\n    mg_selectAll_and_remove(svg, '.mg-x-axis');\n\n    if (!args.x_axis) {\n      return this;\n    }\n\n    var g = mg_add_g(svg, 'mg-x-axis');\n    mg_add_x_ticks(g, args);\n    mg_add_x_tick_labels(g, args);\n\n    if (args.x_label) {\n      mg_add_x_label(g, args);\n    }\n\n    if (args.x_rug) {\n      x_rug(args);\n    }\n\n    return this;\n  }\n\n  MG.x_axis = x_axis;\n\n  function x_axis_categorical(args) {\n    var svg = mg_get_svg_child_of(args.target);\n    var additional_buffer = 0;\n\n    if (args.chart_type === 'bar') {\n      additional_buffer = args.buffer + 5;\n    }\n\n    mg_add_categorical_scale(args, 'X', args.categorical_variables.reverse(), args.left, mg_get_plot_right(args) - additional_buffer);\n    mg_add_scale_function(args, 'xf', 'X', 'value');\n    mg_selectAll_and_remove(svg, '.mg-x-axis');\n    var g = mg_add_g(svg, 'mg-x-axis');\n\n    if (!args.x_axis) {\n      return this;\n    }\n\n    mg_add_x_axis_categorical_labels(g, args, additional_buffer);\n    return this;\n  }\n\n  function mg_add_x_axis_categorical_labels(g, args, additional_buffer) {\n    var labels = g.selectAll('text').data(args.categorical_variables).enter().append('text');\n    labels.attr('x', function (d) {\n      return args.scales.X(d) + args.scales.X.bandwidth() / 2 + args.buffer * args.bar_outer_padding_percentage + additional_buffer / 2;\n    }).attr('y', mg_get_plot_bottom(args)).attr('dy', '.35em').attr('text-anchor', 'middle').text(String);\n\n    if (args.truncate_x_labels) {\n      labels.each(function (d, idx) {\n        var elem = this,\n            width = args.scales.X.bandwidth();\n        truncate_text(elem, d, width);\n      });\n    }\n\n    mg_rotate_labels(labels, args.rotate_x_labels);\n  }\n\n  MG.x_axis_categorical = x_axis_categorical;\n\n  function mg_point_add_color_scale(args) {\n    var color_domain, color_range;\n\n    if (args.color_accessor !== null) {\n      color_domain = mg_get_color_domain(args);\n      color_range = mg_get_color_range(args);\n\n      if (args.color_type === 'number') {\n        args.scales.color = d3.scaleLinear().domain(color_domain).range(color_range).clamp(true);\n      } else {\n        args.scales.color = args.color_range !== null ? d3.scaleOrdinal().range(color_range) : color_domain.length > 10 ? d3.scaleOrdinal(d3.schemeCategory20) : d3.scaleOrdinal(d3.schemeCategory10);\n        args.scales.color.domain(color_domain);\n      }\n\n      mg_add_scale_function(args, 'color', 'color', args.color_accessor);\n    }\n  }\n\n  function mg_get_color_domain(args) {\n    var color_domain;\n\n    if (args.color_domain === null) {\n      if (args.color_type === 'number') {\n        color_domain = d3.extent(args.data[0], function (d) {\n          return d[args.color_accessor];\n        });\n      } else if (args.color_type === 'category') {\n        color_domain = d3.set(args.data[0].map(function (d) {\n          return d[args.color_accessor];\n        })).values();\n        color_domain.sort();\n      }\n    } else {\n      color_domain = args.color_domain;\n    }\n\n    return color_domain;\n  }\n\n  function mg_get_color_range(args) {\n    var color_range;\n\n    if (args.color_range === null) {\n      if (args.color_type === 'number') {\n        color_range = ['blue', 'red'];\n      } else {\n        color_range = null;\n      }\n    } else {\n      color_range = args.color_range;\n    }\n\n    return color_range;\n  }\n\n  function mg_point_add_size_scale(args) {\n    var min_size, max_size, size_domain, size_range;\n\n    if (args.size_accessor !== null) {\n      size_domain = mg_get_size_domain(args);\n      size_range = mg_get_size_range(args);\n      args.scales.size = d3.scaleLinear().domain(size_domain).range(size_range).clamp(true);\n      mg_add_scale_function(args, 'size', 'size', args.size_accessor);\n    }\n  }\n\n  function mg_get_size_domain(args) {\n    return args.size_domain === null ? d3.extent(args.data[0], function (d) {\n      return d[args.size_accessor];\n    }) : args.size_domain;\n  }\n\n  function mg_get_size_range(args) {\n    var size_range;\n\n    if (args.size_range === null) {\n      size_range = [1, 5];\n    } else {\n      size_range = args.size_range;\n    }\n\n    return size_range;\n  }\n\n  function mg_add_x_label(g, args) {\n    if (args.x_label) {\n      g.append('text').attr('class', 'label').attr('x', function () {\n        return mg_get_plot_left(args) + (mg_get_plot_right(args) - mg_get_plot_left(args)) / 2;\n      }).attr('dx', args.x_label_nudge_x != null ? args.x_label_nudge_x : 0).attr('y', function () {\n        var xAxisTextElement = d3.select(args.target).select('.mg-x-axis text').node().getBoundingClientRect();\n        return mg_get_bottom(args) + args.xax_tick_length * (7 / 3) + xAxisTextElement.height * 0.8 + 10;\n      }).attr('dy', '.5em').attr('text-anchor', 'middle').text(function (d) {\n        return args.x_label;\n      });\n    }\n  }\n\n  function mg_default_bar_xax_format(args) {\n    return function (d) {\n      if (d < 1.0 && d > -1.0 && d !== 0) {\n        // don't scale tiny values\n        return args.xax_units + d.toFixed(args.decimals);\n      } else {\n        var pf = d3.format(',.0f');\n        return args.xax_units + pf(d);\n      }\n    };\n  }\n\n  function mg_get_time_frame(diff) {\n    // diff should be (max_x - min_x) / 1000, in other words, the difference in seconds.\n    var time_frame;\n\n    if (mg_milisec_diff(diff)) {\n      time_frame = 'millis';\n    } else if (mg_sec_diff(diff)) {\n      time_frame = 'seconds';\n    } else if (mg_day_diff(diff)) {\n      time_frame = 'less-than-a-day';\n    } else if (mg_four_days(diff)) {\n      time_frame = 'four-days';\n    } else if (mg_many_days(diff)) {\n      // a handful of months?\n      time_frame = 'many-days';\n    } else if (mg_many_months(diff)) {\n      time_frame = 'many-months';\n    } else if (mg_years(diff)) {\n      time_frame = 'years';\n    } else {\n      time_frame = 'default';\n    }\n\n    return time_frame;\n  }\n\n  function mg_milisec_diff(diff) {\n    return diff < 10;\n  }\n\n  function mg_sec_diff(diff) {\n    return diff < 60;\n  }\n\n  function mg_day_diff(diff) {\n    return diff / (60 * 60) <= 24;\n  }\n\n  function mg_four_days(diff) {\n    return diff / (60 * 60) <= 24 * 4;\n  }\n\n  function mg_many_days(diff) {\n    return diff / (60 * 60 * 24) <= 93;\n  }\n\n  function mg_many_months(diff) {\n    return diff / (60 * 60 * 24) < 365 * 2;\n  }\n\n  function mg_years(diff) {\n    return diff / (60 * 60 * 24) >= 365 * 2;\n  }\n\n  function mg_get_time_format(utc, diff) {\n    var main_time_format;\n\n    if (mg_milisec_diff(diff)) {\n      main_time_format = MG.time_format(utc, '%M:%S.%L');\n    } else if (mg_sec_diff(diff)) {\n      main_time_format = MG.time_format(utc, '%M:%S');\n    } else if (mg_day_diff(diff)) {\n      main_time_format = MG.time_format(utc, '%H:%M');\n    } else if (mg_four_days(diff)) {\n      main_time_format = MG.time_format(utc, '%H:%M');\n    } else if (mg_many_days(diff)) {\n      main_time_format = MG.time_format(utc, '%b %d');\n    } else if (mg_many_months(diff)) {\n      main_time_format = MG.time_format(utc, '%b');\n    } else {\n      main_time_format = MG.time_format(utc, '%Y');\n    }\n\n    return main_time_format;\n  }\n\n  function mg_process_time_format(args) {\n    var diff;\n    var main_time_format;\n    var time_frame;\n\n    if (args.time_series) {\n      diff = (args.processed.max_x - args.processed.min_x) / 1000;\n      time_frame = mg_get_time_frame(diff);\n      main_time_format = mg_get_time_format(args.utc_time, diff);\n    }\n\n    args.processed.main_x_time_format = main_time_format;\n    args.processed.x_time_frame = time_frame;\n  }\n\n  function mg_default_xax_format(args) {\n    if (args.xax_format) {\n      return args.xax_format;\n    }\n\n    var data = args.processed.original_data || args.data;\n    var flattened = mg_flatten_array(data)[0];\n    var test_point_x = flattened[args.processed.original_x_accessor || args.x_accessor];\n\n    if (test_point_x === undefined) {\n      test_point_x = flattened;\n    }\n\n    return function (d) {\n      mg_process_time_format(args);\n\n      if (mg_is_date(test_point_x)) {\n        return args.processed.main_x_time_format(new Date(d));\n      } else if (typeof test_point_x === 'number') {\n        var is_float = d % 1 !== 0;\n        var pf;\n\n        if (is_float) {\n          pf = d3.format(',.' + args.decimals + 'f');\n        } else if (d < 1000) {\n          pf = d3.format(',.0f');\n        } else {\n          pf = d3.format(',.2s');\n        }\n\n        return args.xax_units + pf(d);\n      } else {\n        return args.xax_units + d;\n      }\n    };\n  }\n\n  function mg_add_x_ticks(g, args) {\n    mg_process_scale_ticks(args, 'x');\n    mg_add_x_axis_rim(args, g);\n    mg_add_x_axis_tick_lines(args, g);\n  }\n\n  function mg_add_x_axis_rim(args, g) {\n    var tick_length = args.processed.x_ticks.length;\n    var last_i = args.scales.X.ticks(args.xax_count).length - 1;\n\n    if (!args.x_extended_ticks) {\n      g.append('line').attr('x1', function () {\n        if (args.xax_count === 0) {\n          return mg_get_plot_left(args);\n        } else if (args.axes_not_compact && args.chart_type !== 'bar') {\n          return args.left;\n        } else {\n          return args.scales.X(args.scales.X.ticks(args.xax_count)[0]).toFixed(2);\n        }\n      }).attr('x2', function () {\n        if (args.xax_count === 0 || args.axes_not_compact && args.chart_type !== 'bar') {\n          return mg_get_right(args);\n        } else {\n          return args.scales.X(args.scales.X.ticks(args.xax_count)[last_i]).toFixed(2);\n        }\n      }).attr('y1', args.height - args.bottom).attr('y2', args.height - args.bottom);\n    }\n  }\n\n  function mg_add_x_axis_tick_lines(args, g) {\n    g.selectAll('.mg-xax-ticks').data(args.processed.x_ticks).enter().append('line').attr('x1', function (d) {\n      return args.scales.X(d).toFixed(2);\n    }).attr('x2', function (d) {\n      return args.scales.X(d).toFixed(2);\n    }).attr('y1', args.height - args.bottom).attr('y2', function () {\n      return args.x_extended_ticks ? args.top : args.height - args.bottom + args.xax_tick_length;\n    }).attr('class', function () {\n      if (args.x_extended_ticks) {\n        return 'mg-extended-xax-ticks';\n      }\n    }).classed('mg-xax-ticks', true);\n  }\n\n  function mg_add_x_tick_labels(g, args) {\n    mg_add_primary_x_axis_label(args, g);\n    mg_add_secondary_x_axis_label(args, g);\n  }\n\n  function mg_add_primary_x_axis_label(args, g) {\n    var labels = g.selectAll('.mg-xax-labels').data(args.processed.x_ticks).enter().append('text').attr('x', function (d) {\n      return args.scales.X(d).toFixed(2);\n    }).attr('y', (args.height - args.bottom + args.xax_tick_length * 7 / 3).toFixed(2)).attr('dy', '.50em').attr('text-anchor', 'middle');\n\n    if (args.time_series && args.european_clock) {\n      labels.append('tspan').classed('mg-european-hours', true).text(function (_d, i) {\n        var d = new Date(_d);\n        if (i === 0) return d3.timeFormat('%H')(d);else return '';\n      });\n      labels.append('tspan').classed('mg-european-minutes-seconds', true).text(function (_d, i) {\n        var d = new Date(_d);\n        return ':' + args.processed.xax_format(d);\n      });\n    } else {\n      labels.text(function (d) {\n        return args.xax_units + args.processed.xax_format(d);\n      });\n    } // CHECK TO SEE IF OVERLAP for labels. If so,\n    // remove half of them. This is a dirty hack.\n    // We will need to figure out a more principled way of doing this.\n\n\n    if (mg_elements_are_overlapping(labels)) {\n      labels.filter(function (d, i) {\n        return (i + 1) % 2 === 0;\n      }).remove();\n      var svg = mg_get_svg_child_of(args.target);\n      svg.selectAll('.mg-xax-ticks').filter(function (d, i) {\n        return (i + 1) % 2 === 0;\n      }).remove();\n    }\n  }\n\n  function mg_add_secondary_x_axis_label(args, g) {\n    if (args.time_series && (args.show_years || args.show_secondary_x_label)) {\n      var tf = mg_get_yformat_and_secondary_time_function(args);\n      mg_add_secondary_x_axis_elements(args, g, tf.timeframe, tf.yformat, tf.secondary);\n    }\n  }\n\n  function mg_get_yformat_and_secondary_time_function(args) {\n    var tf = {};\n    tf.timeframe = args.processed.x_time_frame;\n\n    switch (tf.timeframe) {\n      case 'millis':\n      case 'seconds':\n        tf.secondary = d3.timeDays;\n        if (args.european_clock) tf.yformat = MG.time_format(args.utc_time, '%b %d');else tf.yformat = MG.time_format(args.utc_time, '%I %p');\n        break;\n\n      case 'less-than-a-day':\n        tf.secondary = d3.timeDays;\n        tf.yformat = MG.time_format(args.utc_time, '%b %d');\n        break;\n\n      case 'four-days':\n        tf.secondary = d3.timeDays;\n        tf.yformat = MG.time_format(args.utc_time, '%b %d');\n        break;\n\n      case 'many-days':\n        tf.secondary = d3.timeYears;\n        tf.yformat = MG.time_format(args.utc_time, '%Y');\n        break;\n\n      case 'many-months':\n        tf.secondary = d3.timeYears;\n        tf.yformat = MG.time_format(args.utc_time, '%Y');\n        break;\n\n      default:\n        tf.secondary = d3.timeYears;\n        tf.yformat = MG.time_format(args.utc_time, '%Y');\n    }\n\n    return tf;\n  }\n\n  function mg_add_secondary_x_axis_elements(args, g, time_frame, yformat, secondary_function) {\n    var years = secondary_function(args.processed.min_x, args.processed.max_x);\n\n    if (years.length === 0) {\n      var first_tick = args.scales.X.ticks(args.xax_count)[0];\n      years = [first_tick];\n    }\n\n    var yg = mg_add_g(g, 'mg-year-marker');\n\n    if (time_frame === 'default' && args.show_year_markers) {\n      mg_add_year_marker_line(args, yg, years, yformat);\n    }\n\n    if (time_frame != 'years') mg_add_year_marker_text(args, yg, years, yformat);\n  }\n\n  function mg_add_year_marker_line(args, g, years, yformat) {\n    g.selectAll('.mg-year-marker').data(years).enter().append('line').attr('x1', function (d) {\n      return args.scales.X(d).toFixed(2);\n    }).attr('x2', function (d) {\n      return args.scales.X(d).toFixed(2);\n    }).attr('y1', mg_get_top(args)).attr('y2', mg_get_bottom(args));\n  }\n\n  function mg_add_year_marker_text(args, g, years, yformat) {\n    g.selectAll('.mg-year-marker').data(years).enter().append('text').attr('x', function (d, i) {\n      return args.scales.X(d).toFixed(2);\n    }).attr('y', function () {\n      var xAxisTextElement = d3.select(args.target).select('.mg-x-axis text').node().getBoundingClientRect();\n      return mg_get_bottom(args) + args.xax_tick_length * 7 / 3 + xAxisTextElement.height * 0.8;\n    }).attr('dy', '.50em').attr('text-anchor', 'middle').text(function (d) {\n      return yformat(new Date(d));\n    });\n  }\n\n  function mg_min_max_x_for_nonbars(mx, args, data) {\n    var extent_x = d3.extent(data, function (d) {\n      return d[args.x_accessor];\n    });\n    mx.min = extent_x[0];\n    mx.max = extent_x[1];\n  }\n\n  function mg_min_max_x_for_bars(mx, args, data) {\n    mx.min = d3.min(data, function (d) {\n      var trio = [d[args.x_accessor], d[args.baseline_accessor] ? d[args.baseline_accessor] : 0, d[args.predictor_accessor] ? d[args.predictor_accessor] : 0];\n      return Math.min.apply(null, trio);\n    });\n    if (mx.min > 0) mx.min = 0;\n    mx.max = d3.max(data, function (d) {\n      var trio = [d[args.x_accessor], d[args.baseline_accessor] ? d[args.baseline_accessor] : 0, d[args.predictor_accessor] ? d[args.predictor_accessor] : 0];\n      return Math.max.apply(null, trio);\n    });\n    return mx;\n  }\n\n  function mg_min_max_x_for_dates(mx) {\n    var yesterday = MG.clone(mx.min).setDate(mx.min.getDate() - 1);\n    var tomorrow = MG.clone(mx.min).setDate(mx.min.getDate() + 1);\n    mx.min = yesterday;\n    mx.max = tomorrow;\n  }\n\n  function mg_min_max_x_for_numbers(mx) {\n    // TODO do we want to rewrite this?\n    mx.min = mx.min - 1;\n    mx.max = mx.max + 1;\n  }\n\n  function mg_min_max_x_for_strings(mx) {\n    // TODO shouldn't be allowing strings here to be coerced into numbers\n    mx.min = Number(mx.min) - 1;\n    mx.max = Number(mx.max) + 1;\n  }\n\n  function mg_force_xax_count_to_be_two(args) {\n    args.xax_count = 2;\n  }\n\n  function mg_sort_through_data_type_and_set_x_min_max_accordingly(mx, args, data) {\n    if (args.chart_type === 'line' || args.chart_type === 'point' || args.chart_type === 'histogram') {\n      mg_min_max_x_for_nonbars(mx, args, data);\n    } else if (args.chart_type === 'bar') {\n      mg_min_max_x_for_bars(mx, args, data);\n    } // if data set is of length 1, expand the range so that we can build the x-axis\n\n\n    if (mx.min === mx.max && !(args.min_x && args.max_x)) {\n      if (mg_is_date(mx.min)) {\n        mg_min_max_x_for_dates(mx);\n      } else if (typeof min_x === 'number') {\n        mg_min_max_x_for_numbers(mx);\n      } else if (typeof min_x === 'string') {\n        mg_min_max_x_for_strings(mx);\n      } // force xax_count to be 2\n\n\n      mg_force_xax_count_to_be_two(args);\n    }\n  }\n\n  function mg_select_xax_format(args) {\n    var c = args.chart_type;\n\n    if (!args.processed.xax_format) {\n      if (args.xax_format) {\n        args.processed.xax_format = args.xax_format;\n      } else {\n        if (c === 'line' || c === 'point' || c === 'histogram') {\n          args.processed.xax_format = mg_default_xax_format(args);\n        } else if (c === 'bar') {\n          args.processed.xax_format = mg_default_bar_xax_format(args);\n        }\n      }\n    }\n  }\n\n  function mg_merge_args_with_defaults(args) {\n    var defaults = {\n      target: null,\n      title: null,\n      description: null\n    };\n\n    if (!args) {\n      args = {};\n    }\n\n    if (!args.processed) {\n      args.processed = {};\n    }\n\n    args = merge_with_defaults(args, defaults);\n    return args;\n  }\n\n  function mg_is_time_series(args) {\n    var first_elem = mg_flatten_array(args.processed.original_data || args.data)[0];\n    args.time_series = mg_is_date(first_elem[args.processed.original_x_accessor || args.x_accessor]);\n  }\n\n  function mg_init_compute_width(args) {\n    var svg_width = args.width;\n\n    if (args.full_width) {\n      svg_width = get_width(args.target);\n    }\n\n    if (args.x_axis_type === 'categorical' && svg_width === null) {\n      svg_width = mg_categorical_calculate_height(args, 'x');\n    }\n\n    args.width = svg_width;\n  }\n\n  function mg_init_compute_height(args) {\n    var svg_height = args.height;\n\n    if (args.full_height) {\n      svg_height = get_height(args.target);\n    }\n\n    if (args.y_axis_type === 'categorical' && svg_height === null) {\n      svg_height = mg_categorical_calculate_height(args, 'y');\n    }\n\n    args.height = svg_height;\n  }\n\n  function mg_remove_svg_if_chart_type_has_changed(svg, args) {\n    if (!svg.selectAll('.mg-main-line').empty() && args.chart_type !== 'line' || !svg.selectAll('.mg-points').empty() && args.chart_type !== 'point' || !svg.selectAll('.mg-histogram').empty() && args.chart_type !== 'histogram' || !svg.selectAll('.mg-barplot').empty() && args.chart_type !== 'bar') {\n      svg.remove();\n    }\n  }\n\n  function mg_add_svg_if_it_doesnt_exist(svg, args) {\n    if (mg_get_svg_child_of(args.target).empty()) {\n      svg = d3.select(args.target).append('svg').classed('linked', args.linked).attr('width', args.width).attr('height', args.height);\n    }\n\n    return svg;\n  }\n\n  function mg_add_clip_path_for_plot_area(svg, args) {\n    svg.selectAll('.mg-clip-path').remove();\n    svg.append('defs').attr('class', 'mg-clip-path').append('clipPath').attr('id', 'mg-plot-window-' + mg_target_ref(args.target)).append('svg:rect').attr('x', mg_get_left(args)).attr('y', mg_get_top(args)).attr('width', args.width - args.left - args.right - args.buffer).attr('height', args.height - args.top - args.bottom - args.buffer + 1);\n  }\n\n  function mg_adjust_width_and_height_if_changed(svg, args) {\n    if (args.width !== Number(svg.attr('width'))) {\n      svg.attr('width', args.width);\n    }\n\n    if (args.height !== Number(svg.attr('height'))) {\n      svg.attr('height', args.height);\n    }\n  }\n\n  function mg_set_viewbox_for_scaling(svg, args) {\n    // we need to reconsider how we handle automatic scaling\n    svg.attr('viewBox', '0 0 ' + args.width + ' ' + args.height);\n\n    if (args.full_width || args.full_height) {\n      svg.attr('preserveAspectRatio', 'xMinYMin meet');\n    }\n  }\n\n  function mg_remove_missing_classes_and_text(svg) {\n    // remove missing class\n    svg.classed('mg-missing', false); // remove missing text\n\n    svg.selectAll('.mg-missing-text').remove();\n    svg.selectAll('.mg-missing-pane').remove();\n  }\n\n  function mg_remove_outdated_lines(svg, args) {\n    // if we're updating an existing chart and we have fewer lines than\n    // before, remove the outdated lines, e.g. if we had 3 lines, and we're calling\n    // data_graphic() on the same target with 2 lines, remove the 3rd line\n    var i = 0;\n\n    if (svg.selectAll('.mg-main-line').nodes().length >= args.data.length) {\n      // now, the thing is we can't just remove, say, line3 if we have a custom\n      // line-color map, instead, see which are the lines to be removed, and delete those\n      if (args.custom_line_color_map.length > 0) {\n        var array_full_series = function (len) {\n          var arr = new Array(len);\n\n          for (var i = 0; i < arr.length; i++) {\n            arr[i] = i + 1;\n          }\n\n          return arr;\n        }; // get an array of lines ids to remove\n\n\n        var lines_to_remove = arr_diff(array_full_series(args.max_data_size), args.custom_line_color_map);\n\n        for (i = 0; i < lines_to_remove.length; i++) {\n          svg.selectAll('.mg-main-line.mg-line' + lines_to_remove[i] + '-color').remove();\n        }\n      } else {\n        // if we don't have a custom line-color map, just remove the lines from the end\n        var num_of_new = args.data.length;\n        var num_of_existing = svg.selectAll('.mg-main-line').nodes() ? svg.selectAll('.mg-main-line').nodes().length : 0;\n\n        for (i = num_of_existing; i > num_of_new; i--) {\n          svg.selectAll('.mg-main-line.mg-line' + i + '-color').remove();\n        }\n      }\n    }\n  }\n\n  function mg_raise_container_error(container, args) {\n    if (container.empty()) {\n      console.warn('The specified target element \"' + args.target + '\" could not be found in the page. The chart will not be rendered.');\n      return;\n    }\n  }\n\n  function categoricalInitialization(args, ns) {\n    var which = ns === 'x' ? args.width : args.height;\n    mg_categorical_count_number_of_groups(args, ns);\n    mg_categorical_count_number_of_lanes(args, ns);\n    mg_categorical_calculate_group_length(args, ns, which);\n    if (which) mg_categorical_calculate_bar_thickness(args, ns);\n  }\n\n  function mg_categorical_count_number_of_groups(args, ns) {\n    var accessor_string = ns + 'group_accessor';\n    var accessor = args[accessor_string];\n    args.categorical_groups = [];\n\n    if (accessor) {\n      var data = args.data[0];\n      args.categorical_groups = d3.set(data.map(function (d) {\n        return d[accessor];\n      })).values();\n    }\n  }\n\n  function mg_categorical_count_number_of_lanes(args, ns) {\n    var accessor_string = ns + 'group_accessor';\n    var groupAccessor = args[accessor_string];\n    args.total_bars = args.data[0].length;\n\n    if (groupAccessor) {\n      var group_bars = count_array_elements(pluck(args.data[0], groupAccessor));\n      group_bars = d3.max(Object.keys(group_bars).map(function (d) {\n        return group_bars[d];\n      }));\n      args.bars_per_group = group_bars;\n    } else {\n      args.bars_per_group = args.data[0].length;\n    }\n  }\n\n  function mg_categorical_calculate_group_length(args, ns, which) {\n    var groupHeight = ns + 'group_height';\n\n    if (which) {\n      var gh = ns === 'y' ? (args.height - args.top - args.bottom - args.buffer * 2) / (args.categorical_groups.length || 1) : (args.width - args.left - args.right - args.buffer * 2) / (args.categorical_groups.length || 1);\n      args[groupHeight] = gh;\n    } else {\n      var step = (1 + args[ns + '_padding_percentage']) * args.bar_thickness;\n      args[groupHeight] = args.bars_per_group * step + args[ns + '_outer_padding_percentage'] * 2 * step; //args.bar_thickness + (((args.bars_per_group-1) * args.bar_thickness) * (args.bar_padding_percentage + args.bar_outer_padding_percentage*2));\n    }\n  }\n\n  function mg_categorical_calculate_bar_thickness(args, ns) {\n    // take one group height.\n    var step = args[ns + 'group_height'] / (args.bars_per_group + args[ns + '_outer_padding_percentage']);\n    args.bar_thickness = step - step * args[ns + '_padding_percentage'];\n  }\n\n  function mg_categorical_calculate_height(args, ns) {\n    var groupContribution = args[ns + 'group_height'] * (args.categorical_groups.length || 1);\n    var marginContribution = ns === 'y' ? args.top + args.bottom + args.buffer * 2 : args.left + args.right + args.buffer * 2;\n    return groupContribution + marginContribution + args.categorical_groups.length * args[ns + 'group_height'] * (args[ns + 'group_padding_percentage'] + args[ns + 'group_outer_padding_percentage']);\n  }\n\n  function mg_barchart_extrapolate_group_and_thickness_from_height(args) {// we need to set args.bar_thickness, group_height\n  }\n\n  function init(args) {\n    'use strict';\n\n    args = arguments[0];\n    args = mg_merge_args_with_defaults(args); // If you pass in a dom element for args.target, the expectation\n    // of a string elsewhere will break.\n\n    var container = d3.select(args.target);\n    mg_raise_container_error(container, args);\n    var svg = container.selectAll('svg'); // some things that will need to be calculated if we have a categorical axis.\n\n    if (args.y_axis_type === 'categorical') {\n      categoricalInitialization(args, 'y');\n    }\n\n    if (args.x_axis_type === 'categorical') {\n      categoricalInitialization(args, 'x');\n    }\n\n    mg_is_time_series(args);\n    mg_init_compute_width(args);\n    mg_init_compute_height(args);\n    mg_remove_svg_if_chart_type_has_changed(svg, args);\n    svg = mg_add_svg_if_it_doesnt_exist(svg, args);\n    mg_add_clip_path_for_plot_area(svg, args);\n    mg_adjust_width_and_height_if_changed(svg, args);\n    mg_set_viewbox_for_scaling(svg, args);\n    mg_remove_missing_classes_and_text(svg);\n    chart_title(args);\n    mg_remove_outdated_lines(svg, args);\n    return this;\n  }\n\n  MG.init = init;\n\n  function mg_return_label(d) {\n    return d.label;\n  }\n\n  function mg_remove_existing_markers(svg) {\n    svg.selectAll('.mg-markers').remove();\n    svg.selectAll('.mg-baselines').remove();\n  }\n\n  function mg_in_range(args) {\n    return function (d) {\n      return args.scales.X(d[args.x_accessor]) >= mg_get_plot_left(args) && args.scales.X(d[args.x_accessor]) <= mg_get_plot_right(args);\n    };\n  }\n\n  function mg_x_position(args) {\n    return function (d) {\n      return args.scales.X(d[args.x_accessor]);\n    };\n  }\n\n  function mg_x_position_fixed(args) {\n    var _mg_x_pos = mg_x_position(args);\n\n    return function (d) {\n      return _mg_x_pos(d).toFixed(2);\n    };\n  }\n\n  function mg_y_position_fixed(args) {\n    var _mg_y_pos = args.scales.Y;\n    return function (d) {\n      return _mg_y_pos(d.value).toFixed(2);\n    };\n  }\n\n  function mg_place_annotations(checker, class_name, args, svg, line_fcn, text_fcn) {\n    var g;\n\n    if (checker) {\n      g = svg.append('g').attr('class', class_name);\n      line_fcn(g, args);\n      text_fcn(g, args);\n    }\n  }\n\n  function mg_place_markers(args, svg) {\n    mg_place_annotations(args.markers, 'mg-markers', args, svg, mg_place_marker_lines, mg_place_marker_text);\n  }\n\n  function mg_place_baselines(args, svg) {\n    mg_place_annotations(args.baselines, 'mg-baselines', args, svg, mg_place_baseline_lines, mg_place_baseline_text);\n  }\n\n  function mg_place_marker_lines(gm, args) {\n    var x_pos_fixed = mg_x_position_fixed(args);\n    gm.selectAll('.mg-markers').data(args.markers.filter(mg_in_range(args))).enter().append('line').attr('x1', x_pos_fixed).attr('x2', x_pos_fixed).attr('y1', args.top).attr('y2', mg_get_plot_bottom(args)).attr('class', function (d) {\n      return d.lineclass;\n    }).attr('stroke-dasharray', '3,1');\n  }\n\n  function mg_place_marker_text(gm, args) {\n    gm.selectAll('.mg-markers').data(args.markers.filter(mg_in_range(args))).enter().append('text').attr('class', function (d) {\n      return d.textclass || '';\n    }).classed('mg-marker-text', true).attr('x', mg_x_position(args)).attr('y', args.x_axis_position === 'bottom' ? mg_get_top(args) * 0.95 : mg_get_bottom(args) + args.buffer).attr('text-anchor', 'middle').text(mg_return_label).each(function (d) {\n      if (d.click) {\n        d3.select(this).style('cursor', 'pointer').on('click', d.click);\n      }\n    });\n    mg_prevent_horizontal_overlap(gm.selectAll('.mg-marker-text').nodes(), args);\n  }\n\n  function mg_place_baseline_lines(gb, args) {\n    var y_pos = mg_y_position_fixed(args);\n    gb.selectAll('.mg-baselines').data(args.baselines).enter().append('line').attr('x1', mg_get_plot_left(args)).attr('x2', mg_get_plot_right(args)).attr('y1', y_pos).attr('y2', y_pos);\n  }\n\n  function mg_place_baseline_text(gb, args) {\n    var y_pos = mg_y_position_fixed(args);\n    gb.selectAll('.mg-baselines').data(args.baselines).enter().append('text').attr('x', mg_get_plot_right(args)).attr('y', y_pos).attr('dy', -3).attr('text-anchor', 'end').text(mg_return_label);\n  }\n\n  function markers(args) {\n    'use strict';\n\n    var svg = mg_get_svg_child_of(args.target);\n    mg_remove_existing_markers(svg);\n    mg_place_markers(args, svg);\n    mg_place_baselines(args, svg);\n    return this;\n  }\n\n  MG.markers = markers;\n\n  function mg_clear_mouseover_container(svg) {\n    svg.selectAll('.mg-active-datapoint-container').selectAll('*').remove();\n  }\n\n  function mg_setup_mouseover_container(svg, args) {\n    svg.select('.mg-active-datapoint').remove();\n    var text_anchor = args.mouseover_align === 'right' ? 'end' : args.mouseover_align === 'left' ? 'start' : 'middle';\n    var mouseover_x = args.mouseover_align === 'right' ? mg_get_plot_right(args) : args.mouseover_align === 'left' ? mg_get_plot_left(args) : (args.width - args.left - args.right) / 2 + args.left;\n    var active_datapoint = svg.select('.mg-active-datapoint-container').append('text').attr('class', 'mg-active-datapoint').attr('xml:space', 'preserve').attr('text-anchor', text_anchor); // set the rollover text's position; if we have markers on two lines,\n    // nudge up the rollover text a bit\n\n    var active_datapoint_y_nudge = 0.75;\n    var y_position = args.x_axis_position === 'bottom' ? mg_get_top(args) * active_datapoint_y_nudge : mg_get_bottom(args) + args.buffer * 3;\n\n    if (args.markers) {\n      var yPos;\n      svg.selectAll('.mg-marker-text').each(function () {\n        if (!yPos) {\n          yPos = d3.select(this).attr('y');\n        } else if (yPos !== d3.select(this).attr('y')) {\n          active_datapoint_y_nudge = 0.56;\n        }\n      });\n    }\n\n    active_datapoint.attr('transform', 'translate(' + mouseover_x + ',' + y_position + ')');\n  }\n\n  function mg_mouseover_tspan(svg, text) {\n    var tspan = '';\n    var cl = null;\n    if (arguments.length === 3) cl = arguments[2];\n    tspan = svg.append('tspan').text(text);\n    if (cl !== null) tspan.classed(cl, true);\n    this.tspan = tspan;\n\n    this.bold = function () {\n      this.tspan.attr('font-weight', 'bold');\n      return this;\n    };\n\n    this.font_size = function (pts) {\n      this.tspan.attr('font-size', pts);\n      return this;\n    };\n\n    this.x = function (x) {\n      this.tspan.attr('x', x);\n      return this;\n    };\n\n    this.y = function (y) {\n      this.tspan.attr('y', y);\n      return this;\n    };\n\n    this.elem = function () {\n      return this.tspan;\n    };\n\n    return this;\n  }\n\n  function mg_reset_text_container(svg) {\n    var textContainer = svg.select('.mg-active-datapoint');\n    textContainer.selectAll('*').remove();\n    return textContainer;\n  }\n\n  function mg_mouseover_row(row_number, container, rargs) {\n    var lineHeight = 1.1;\n    this.rargs = rargs;\n    var rrr = container.append('tspan').attr('x', 0).attr('y', row_number * lineHeight + 'em');\n\n    this.text = function (text) {\n      return mg_mouseover_tspan(rrr, text);\n    };\n\n    return this;\n  }\n\n  function mg_mouseover_text(args, rargs) {\n    var lineHeight = 1.1;\n    this.row_number = 0;\n    this.rargs = rargs;\n    mg_setup_mouseover_container(rargs.svg, args);\n    this.text_container = mg_reset_text_container(rargs.svg);\n\n    this.mouseover_row = function (rargs) {\n      var that = this;\n      var rrr = mg_mouseover_row(that.row_number, that.text_container, rargs);\n      that.row_number += 1;\n      return rrr;\n    };\n\n    return this;\n  }\n\n  function MG_WindowResizeTracker() {\n    var targets = [];\n    var Observer;\n\n    if (typeof MutationObserver !== \"undefined\") {\n      Observer = MutationObserver;\n    } else if (typeof WebKitMutationObserver !== \"undefined\") {\n      Observer = WebKitMutationObserver;\n    }\n\n    function window_listener() {\n      targets.forEach(function (target) {\n        var svg = d3.select(target).select('svg'); // skip if svg is not visible\n\n        if (!svg.empty() && (svg.node().parentNode.offsetWidth > 0 || svg.node().parentNode.offsetHeight > 0)) {\n          var aspect = svg.attr('width') !== 0 ? svg.attr('height') / svg.attr('width') : 0;\n          var newWidth = get_width(target);\n          svg.attr('width', newWidth);\n          svg.attr('height', aspect * newWidth);\n        }\n      });\n    }\n\n    function remove_target(target) {\n      var index = targets.indexOf(target);\n\n      if (index !== -1) {\n        targets.splice(index, 1);\n      }\n\n      if (targets.length === 0) {\n        window.removeEventListener('resize', window_listener, true);\n      }\n    }\n\n    return {\n      add_target: function (target) {\n        if (targets.length === 0) {\n          window.addEventListener('resize', window_listener, true);\n        }\n\n        if (targets.indexOf(target) === -1) {\n          targets.push(target);\n\n          if (Observer) {\n            var observer = new Observer(function (mutations) {\n              var targetNode = d3.select(target).node();\n\n              if (!targetNode || mutations.some(function (mutation) {\n                for (var i = 0; i < mutation.removedNodes.length; i++) {\n                  if (mutation.removedNodes[i] === targetNode) {\n                    return true;\n                  }\n                }\n              })) {\n                observer.disconnect();\n                remove_target(target);\n              }\n            });\n            observer.observe(d3.select(target).node().parentNode, {\n              childList: true\n            });\n          }\n        }\n      }\n    };\n  }\n\n  var mg_window_resize_tracker = new MG_WindowResizeTracker();\n\n  function mg_window_listeners(args) {\n    mg_if_aspect_ratio_resize_svg(args);\n  }\n\n  function mg_if_aspect_ratio_resize_svg(args) {\n    // have we asked the svg to fill a div, if so resize with div\n    if (args.full_width || args.full_height) {\n      mg_window_resize_tracker.add_target(args.target);\n    }\n  }\n\n  if (mg_jquery_exists()) {\n    /*!\n     * Bootstrap v3.3.1 (http://getbootstrap.com)\n     * Copyright 2011-2014 Twitter, Inc.\n     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n     */\n\n    /*!\n     * Generated using the Bootstrap Customizer (http://getbootstrap.com/customize/?id=c3834cc5b59ef727da53)\n     * Config saved to config.json and https://gist.github.com/c3834cc5b59ef727da53\n     */\n\n    /* ========================================================================\n     * Bootstrap: dropdown.js v3.3.1\n     * http://getbootstrap.com/javascript/#dropdowns\n     * ========================================================================\n     * Copyright 2011-2014 Twitter, Inc.\n     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n     * ======================================================================== */\n    +function ($) {\n      'use strict';\n\n      if (typeof $().dropdown == 'function') return true; // DROPDOWN CLASS DEFINITION\n      // =========================\n\n      var backdrop = '.dropdown-backdrop';\n      var toggle = '[data-toggle=\"dropdown\"]';\n\n      var Dropdown = function (element) {\n        $(element).on('click.bs.dropdown', this.toggle);\n      };\n\n      Dropdown.VERSION = '3.3.1';\n\n      Dropdown.prototype.toggle = function (e) {\n        var $this = $(this);\n        if ($this.is('.disabled, :disabled')) return;\n        var $parent = getParent($this);\n        var isActive = $parent.hasClass('open');\n        clearMenus();\n\n        if (!isActive) {\n          if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {\n            // if mobile we use a backdrop because click events don't delegate\n            $('<div class=\"dropdown-backdrop\"/>').insertAfter($(this)).on('click', clearMenus);\n          }\n\n          var relatedTarget = {\n            relatedTarget: this\n          };\n          $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget));\n          if (e.isDefaultPrevented()) return;\n          $this.trigger('focus').attr('aria-expanded', 'true');\n          $parent.toggleClass('open').trigger('shown.bs.dropdown', relatedTarget);\n        }\n\n        return false;\n      };\n\n      Dropdown.prototype.keydown = function (e) {\n        if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return;\n        var $this = $(this);\n        e.preventDefault();\n        e.stopPropagation();\n        if ($this.is('.disabled, :disabled')) return;\n        var $parent = getParent($this);\n        var isActive = $parent.hasClass('open');\n\n        if (!isActive && e.which != 27 || isActive && e.which == 27) {\n          if (e.which == 27) $parent.find(toggle).trigger('focus');\n          return $this.trigger('click');\n        }\n\n        var desc = ' li:not(.divider):visible a';\n        var $items = $parent.find('[role=\"menu\"]' + desc + ', [role=\"listbox\"]' + desc);\n        if (!$items.length) return;\n        var index = $items.index(e.target);\n        if (e.which == 38 && index > 0) index--; // up\n\n        if (e.which == 40 && index < $items.length - 1) index++; // down\n\n        if (!~index) index = 0;\n        $items.eq(index).trigger('focus');\n      };\n\n      function clearMenus(e) {\n        if (e && e.which === 3) return;\n        $(backdrop).remove();\n        $(toggle).each(function () {\n          var $this = $(this);\n          var $parent = getParent($this);\n          var relatedTarget = {\n            relatedTarget: this\n          };\n          if (!$parent.hasClass('open')) return;\n          $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget));\n          if (e.isDefaultPrevented()) return;\n          $this.attr('aria-expanded', 'false');\n          $parent.removeClass('open').trigger('hidden.bs.dropdown', relatedTarget);\n        });\n      }\n\n      function getParent($this) {\n        var selector = $this.attr('data-target');\n\n        if (!selector) {\n          selector = $this.attr('href');\n          selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\\s]*$)/, ''); // strip for ie7\n        }\n\n        var $parent = selector && $(selector);\n        return $parent && $parent.length ? $parent : $this.parent();\n      } // DROPDOWN PLUGIN DEFINITION\n      // ==========================\n\n\n      function Plugin(option) {\n        return this.each(function () {\n          var $this = $(this);\n          var data = $this.data('bs.dropdown');\n          if (!data) $this.data('bs.dropdown', data = new Dropdown(this));\n          if (typeof option == 'string') data[option].call($this);\n        });\n      }\n\n      var old = $.fn.dropdown;\n      $.fn.dropdown = Plugin;\n      $.fn.dropdown.Constructor = Dropdown; // DROPDOWN NO CONFLICT\n      // ====================\n\n      $.fn.dropdown.noConflict = function () {\n        $.fn.dropdown = old;\n        return this;\n      }; // APPLY TO STANDARD DROPDOWN ELEMENTS\n      // ===================================\n\n\n      $(document).on('click.bs.dropdown.data-api', clearMenus).on('click.bs.dropdown.data-api', '.dropdown form', function (e) {\n        e.stopPropagation();\n      }).on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle).on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown).on('keydown.bs.dropdown.data-api', '[role=\"menu\"]', Dropdown.prototype.keydown).on('keydown.bs.dropdown.data-api', '[role=\"listbox\"]', Dropdown.prototype.keydown);\n    }(jQuery);\n  }\n\n  MG.button_layout = function (target) {\n    'use strict';\n\n    this.target = target;\n    this.feature_set = {};\n    this.public_name = {};\n    this.sorters = {};\n    this.manual = [];\n    this.manual_map = {};\n    this.manual_callback = {};\n\n    this._strip_punctuation = function (s) {\n      var punctuationless = s.replace(/[^a-zA-Z0-9 _]+/g, '');\n      var finalString = punctuationless.replace(/ +?/g, '');\n      return finalString;\n    };\n\n    this.data = function (data) {\n      this._data = data;\n      return this;\n    };\n\n    this.manual_button = function (feature, feature_set, callback) {\n      this.feature_set[feature] = feature_set;\n      this.manual_map[this._strip_punctuation(feature)] = feature;\n      this.manual_callback[feature] = callback; // the default is going to be the first feature.\n\n      return this;\n    };\n\n    this.button = function (feature) {\n      if (arguments.length > 1) {\n        this.public_name[feature] = arguments[1];\n      }\n\n      if (arguments.length > 2) {\n        this.sorters[feature] = arguments[2];\n      }\n\n      this.feature_set[feature] = [];\n      return this;\n    };\n\n    this.callback = function (callback) {\n      this._callback = callback;\n      return this;\n    };\n\n    this.display = function () {\n      var callback = this._callback;\n      var manual_callback = this.manual_callback;\n      var manual_map = this.manual_map;\n      var d, f, features, feat;\n      features = Object.keys(this.feature_set);\n\n      var mapDtoF = function (f) {\n        return d[f];\n      };\n\n      var i; // build out this.feature_set with this.data\n\n      for (i = 0; i < this._data.length; i++) {\n        d = this._data[i];\n        f = features.map(mapDtoF);\n\n        for (var j = 0; j < features.length; j++) {\n          feat = features[j];\n\n          if (this.feature_set[feat].indexOf(f[j]) === -1) {\n            this.feature_set[feat].push(f[j]);\n          }\n        }\n      }\n\n      for (feat in this.feature_set) {\n        if (this.sorters.hasOwnProperty(feat)) {\n          this.feature_set[feat].sort(this.sorters[feat]);\n        }\n      }\n\n      $(this.target).empty();\n      $(this.target).append(\"<div class='col-lg-12 segments text-center'></div>\");\n\n      var dropdownLiAClick = function () {\n        var k = $(this).data('key');\n        var feature = $(this).data('feature');\n        var manual_feature;\n        $('.' + feature + '-btns button.btn span.title').html(k);\n\n        if (!manual_map.hasOwnProperty(feature)) {\n          callback(feature, k);\n        } else {\n          manual_feature = manual_map[feature];\n          manual_callback[manual_feature](k);\n        }\n\n        return false;\n      };\n\n      for (var feature in this.feature_set) {\n        features = this.feature_set[feature];\n        $(this.target + ' div.segments').append('<div class=\"btn-group ' + this._strip_punctuation(feature) + '-btns text-left\">' + // This never changes.\n        '<button type=\"button\" class=\"btn btn-default btn-lg dropdown-toggle\" data-toggle=\"dropdown\">' + \"<span class='which-button'>\" + (this.public_name.hasOwnProperty(feature) ? this.public_name[feature] : feature) + \"</span>\" + \"<span class='title'>\" + (this.manual_callback.hasOwnProperty(feature) ? this.feature_set[feature][0] : 'all') + \"</span>\" + // if a manual button, don't default to all in label.\n        '<span class=\"caret\"></span>' + '</button>' + '<ul class=\"dropdown-menu\" role=\"menu\">' + (!this.manual_callback.hasOwnProperty(feature) ? '<li><a href=\"#\" data-feature=\"' + feature + '\" data-key=\"all\">All</a></li>' : \"\") + (!this.manual_callback.hasOwnProperty(feature) ? '<li class=\"divider\"></li>' : \"\") + '</ul>' + '</div>');\n\n        for (i = 0; i < features.length; i++) {\n          if (features[i] !== 'all' && features[i] !== undefined) {\n            // strange bug with undefined being added to manual buttons.\n            $(this.target + ' div.' + this._strip_punctuation(feature) + '-btns ul.dropdown-menu').append('<li><a href=\"#\" data-feature=\"' + this._strip_punctuation(feature) + '\" data-key=\"' + features[i] + '\">' + features[i] + '</a></li>');\n          }\n        }\n\n        $('.' + this._strip_punctuation(feature) + '-btns .dropdown-menu li a').on('click', dropdownLiAClick);\n      }\n\n      return this;\n    };\n\n    return this;\n  };\n\n  (function () {\n    'use strict';\n\n    function mg_line_color_text(elem, d, args) {\n      elem.classed('mg-hover-line' + d.line_id + '-color', args.colors === null).attr('fill', args.colors === null ? '' : args.colors[d.line_id - 1]);\n    }\n\n    function mg_line_graph_generators(args, plot, svg) {\n      mg_add_line_generator(args, plot);\n      mg_add_area_generator(args, plot);\n      mg_add_flat_line_generator(args, plot);\n      mg_add_confidence_band_generator(args, plot, svg);\n    }\n\n    function mg_add_confidence_band_generator(args, plot, svg) {\n      plot.existing_band = svg.selectAll('.mg-confidence-band').nodes();\n\n      if (args.show_confidence_band) {\n        plot.confidence_area = d3.area().defined(plot.line.defined()).x(args.scalefns.xf).y0(function (d) {\n          var l = args.show_confidence_band[0];\n\n          if (d[l] != undefined) {\n            return args.scales.Y(d[l]);\n          } else {\n            return args.scales.Y(d[args.y_accessor]);\n          }\n        }).y1(function (d) {\n          var u = args.show_confidence_band[1];\n\n          if (d[u] != undefined) {\n            return args.scales.Y(d[u]);\n          } else {\n            return args.scales.Y(d[args.y_accessor]);\n          }\n        }).curve(args.interpolate);\n      }\n    }\n\n    function mg_add_area_generator(args, plot) {\n      plot.area = d3.area().defined(plot.line.defined()).x(args.scalefns.xf).y0(args.scales.Y.range()[0]).y1(args.scalefns.yf).curve(args.interpolate);\n    }\n\n    function mg_add_flat_line_generator(args, plot) {\n      plot.flat_line = d3.line().defined(function (d) {\n        return (d['_missing'] === undefined || d['_missing'] !== true) && d[args.y_accessor] !== null;\n      }).x(args.scalefns.xf).y(function () {\n        return args.scales.Y(plot.data_median);\n      }).curve(args.interpolate);\n    }\n\n    function mg_add_line_generator(args, plot) {\n      plot.line = d3.line().x(args.scalefns.xf).y(args.scalefns.yf).curve(args.interpolate); // if missing_is_zero is not set, then hide data points that fall in missing\n      // data ranges or that have been explicitly identified as missing in the\n      // data source.\n\n      if (!args.missing_is_zero) {\n        // a line is defined if the _missing attrib is not set to true\n        // and the y-accessor is not null\n        plot.line = plot.line.defined(function (d) {\n          return (d['_missing'] === undefined || d['_missing'] !== true) && d[args.y_accessor] !== null;\n        });\n      }\n    }\n\n    function mg_add_confidence_band(args, plot, svg, which_line) {\n      if (args.show_confidence_band) {\n        var confidenceBand;\n\n        if (svg.select('.mg-confidence-band-' + which_line).empty()) {\n          svg.append('path').attr('class', 'mg-confidence-band mg-confidence-band-' + which_line);\n        } // transition this line's confidence band\n\n\n        confidenceBand = svg.select('.mg-confidence-band-' + which_line);\n        confidenceBand.transition().duration(function () {\n          return args.transition_on_update ? 1000 : 0;\n        }).attr('d', plot.confidence_area(args.data[which_line - 1])).attr('clip-path', 'url(#mg-plot-window-' + mg_target_ref(args.target) + ')');\n      }\n    }\n\n    function mg_add_area(args, plot, svg, which_line, line_id) {\n      var areas = svg.selectAll('.mg-main-area.mg-area' + line_id);\n\n      if (plot.display_area) {\n        // if area already exists, transition it\n        if (!areas.empty()) {\n          svg.node().appendChild(areas.node());\n          areas.transition().duration(plot.update_transition_duration).attr('d', plot.area(args.data[which_line])).attr('clip-path', 'url(#mg-plot-window-' + mg_target_ref(args.target) + ')');\n        } else {\n          // otherwise, add the area\n          svg.append('path').classed('mg-main-area', true).classed('mg-area' + line_id, true).classed('mg-area' + line_id + '-color', args.colors === null).attr('d', plot.area(args.data[which_line])).attr('fill', args.colors === null ? '' : args.colors[line_id - 1]).attr('clip-path', 'url(#mg-plot-window-' + mg_target_ref(args.target) + ')');\n        }\n      } else if (!areas.empty()) {\n        areas.remove();\n      }\n    }\n\n    function mg_default_color_for_path(this_path, line_id) {\n      this_path.classed('mg-line' + line_id + '-color', true);\n    }\n\n    function mg_color_line(args, this_path, which_line, line_id) {\n      if (args.colors) {\n        // for now, if args.colors is not an array, then keep moving as if nothing happened.\n        // if args.colors is not long enough, default to the usual line_id color.\n        if (args.colors.constructor === Array) {\n          this_path.attr('stroke', args.colors[which_line]);\n\n          if (args.colors.length < which_line + 1) {\n            // Go with default coloring.\n            // this_path.classed('mg-line' + (line_id) + '-color', true);\n            mg_default_color_for_path(this_path, line_id);\n          }\n        } else {\n          // this_path.classed('mg-line' + (line_id) + '-color', true);\n          mg_default_color_for_path(this_path, line_id);\n        }\n      } else {\n        // this is the typical workflow\n        // this_path.classed('mg-line' + (line_id) + '-color', true);\n        mg_default_color_for_path(this_path, line_id);\n      }\n    }\n\n    function mg_add_line_element(args, plot, this_path, which_line) {\n      if (args.animate_on_load) {\n        plot.data_median = d3.median(args.data[which_line], function (d) {\n          return d[args.y_accessor];\n        });\n        this_path.attr('d', plot.flat_line(args.data[which_line])).transition().duration(1000).attr('d', plot.line(args.data[which_line])).attr('clip-path', 'url(#mg-plot-window-' + mg_target_ref(args.target) + ')');\n      } else {\n        // or just add the line\n        this_path.attr('d', plot.line(args.data[which_line])).attr('clip-path', 'url(#mg-plot-window-' + mg_target_ref(args.target) + ')');\n      }\n    }\n\n    function mg_add_line(args, plot, svg, existing_line, which_line, line_id) {\n      if (!existing_line.empty()) {\n        svg.node().appendChild(existing_line.node());\n        var lineTransition = existing_line.transition().duration(plot.update_transition_duration);\n\n        if (!plot.display_area && args.transition_on_update && !args.missing_is_hidden) {\n          lineTransition.attrTween('d', path_tween(plot.line(args.data[which_line]), 4));\n        } else {\n          lineTransition.attr('d', plot.line(args.data[which_line]));\n        }\n      } else {\n        // otherwise...\n        // if we're animating on load, animate the line from its median value\n        var this_path = svg.append('path').attr('class', 'mg-main-line mg-line' + line_id);\n        mg_color_line(args, this_path, which_line, line_id);\n        mg_add_line_element(args, plot, this_path, which_line);\n      }\n    }\n\n    function mg_add_legend_element(args, plot, which_line, line_id) {\n      var this_legend;\n\n      if (args.legend) {\n        if (is_array(args.legend)) {\n          this_legend = args.legend[which_line];\n        } else if (is_function(args.legend)) {\n          this_legend = args.legend(args.data[which_line]);\n        }\n\n        if (args.legend_target) {\n          if (args.colors && args.colors.constructor === Array) {\n            plot.legend_text = \"<span style='color:\" + args.colors[which_line] + \"'>&mdash; \" + this_legend + '&nbsp; </span>' + plot.legend_text;\n          } else {\n            plot.legend_text = \"<span class='mg-line\" + line_id + \"-legend-color'>&mdash; \" + this_legend + '&nbsp; </span>' + plot.legend_text;\n          }\n        } else {\n          var anchor_point, anchor_orientation, dx;\n\n          if (args.y_axis_position === 'left') {\n            anchor_point = args.data[which_line][args.data[which_line].length - 1];\n            anchor_orientation = 'start';\n            dx = args.buffer;\n          } else {\n            anchor_point = args.data[which_line][0];\n            anchor_orientation = 'end';\n            dx = -args.buffer;\n          }\n\n          var legend_text = plot.legend_group.append('svg:text').attr('x', args.scalefns.xf(anchor_point)).attr('dx', dx).attr('y', args.scalefns.yf(anchor_point)).attr('dy', '.35em').attr('font-size', 10).attr('text-anchor', anchor_orientation).attr('font-weight', '300').text(this_legend);\n\n          if (args.colors && args.colors.constructor === Array) {\n            if (args.colors.length < which_line + 1) {\n              legend_text.classed('mg-line' + line_id + '-legend-color', true);\n            } else {\n              legend_text.attr('fill', args.colors[which_line]);\n            }\n          } else {\n            legend_text.classed('mg-line' + line_id + '-legend-color', true);\n          }\n\n          mg_prevent_vertical_overlap(plot.legend_group.selectAll('.mg-line-legend text').nodes(), args);\n        }\n      }\n    }\n\n    function mg_plot_legend_if_legend_target(target, legend) {\n      if (target) {\n        d3.select(target).html(legend);\n      }\n    }\n\n    function mg_add_legend_group(args, plot, svg) {\n      if (args.legend) plot.legend_group = mg_add_g(svg, 'mg-line-legend');\n    }\n\n    function mg_remove_existing_line_rollover_elements(svg) {\n      // remove the old rollovers if they already exist\n      mg_selectAll_and_remove(svg, '.mg-rollover-rect');\n      mg_selectAll_and_remove(svg, '.mg-voronoi'); // remove the old rollover text and circle if they already exist\n\n      mg_selectAll_and_remove(svg, '.mg-active-datapoint');\n      mg_selectAll_and_remove(svg, '.mg-line-rollover-circle'); //mg_selectAll_and_remove(svg, '.mg-active-datapoint-container');\n    }\n\n    function mg_add_rollover_circle(args, svg) {\n      // append circle\n      var circle = svg.selectAll('.mg-line-rollover-circle').data(args.data).enter().append('circle').attr('cx', 0).attr('cy', 0).attr('r', 0);\n\n      if (args.colors && args.colors.constructor === Array) {\n        circle.attr('class', function (d) {\n          return 'mg-line' + d.line_id;\n        }).attr('fill', function (d, i) {\n          return args.colors[i];\n        }).attr('stroke', function (d, i) {\n          return args.colors[i];\n        });\n      } else {\n        circle.attr('class', function (d, i) {\n          return ['mg-line' + d.line_id, 'mg-line' + d.line_id + '-color', 'mg-area' + d.line_id + '-color'].join(' ');\n        });\n      }\n\n      circle.classed('mg-line-rollover-circle', true);\n    }\n\n    function mg_set_unique_line_id_for_each_series(args) {\n      // update our data by setting a unique line id for each series\n      // increment from 1... unless we have a custom increment series\n      var line_id = 1;\n\n      for (var i = 0; i < args.data.length; i++) {\n        for (var j = 0; j < args.data[i].length; j++) {\n          // if custom line-color map is set, use that instead of line_id\n          if (args.custom_line_color_map.length > 0) {\n            args.data[i][j].line_id = args.custom_line_color_map[i];\n          } else {\n            args.data[i][j].line_id = line_id;\n          }\n        }\n\n        line_id++;\n      }\n    }\n\n    function mg_nest_data_for_voronoi(args) {\n      return d3.merge(args.data);\n    }\n\n    function mg_line_class_string(args) {\n      return function (d) {\n        var class_string;\n\n        if (args.linked) {\n          var v = d[args.x_accessor];\n          var formatter = MG.time_format(args.utc_time, args.linked_format); // only format when x-axis is date\n\n          var id = typeof v === 'number' ? d.line_id - 1 : formatter(v);\n          class_string = 'roll_' + id + ' mg-line' + d.line_id;\n\n          if (args.color === null) {\n            class_string += ' mg-line' + d.line_id + '-color';\n          }\n\n          return class_string;\n        } else {\n          class_string = 'mg-line' + d.line_id;\n          if (args.color === null) class_string += ' mg-line' + d.line_id + '-color';\n          return class_string;\n        }\n      };\n    }\n\n    function mg_add_voronoi_rollover(args, svg, rollover_on, rollover_off, rollover_move) {\n      var voronoi = d3.voronoi().x(function (d) {\n        return args.scales.X(d[args.x_accessor]).toFixed(2);\n      }).y(function (d) {\n        return args.scales.Y(d[args.y_accessor]).toFixed(2);\n      }).extent([[args.buffer, args.buffer + args.title_y_position], [args.width - args.buffer, args.height - args.buffer]]);\n      var g = mg_add_g(svg, 'mg-voronoi');\n      g.selectAll('path').data(voronoi.polygons(mg_nest_data_for_voronoi(args))).enter().append('path').filter(function (d) {\n        return d !== undefined && d.length > 0;\n      }).attr('d', function (d) {\n        return d == null ? null : 'M' + d.join('L') + 'Z';\n      }).datum(function (d) {\n        return d == null ? null : d.data;\n      }) // because of d3.voronoi, reassign d\n      .attr('class', mg_line_class_string(args)).on('mouseover', rollover_on).on('mouseout', rollover_off).on('mousemove', rollover_move);\n      mg_configure_voronoi_rollover(args, svg);\n    }\n\n    function nest_data_for_aggregate_rollover(args) {\n      var data_nested = d3.nest().key(function (d) {\n        return d[args.x_accessor];\n      }).entries(d3.merge(args.data));\n      data_nested.forEach(function (entry) {\n        var datum = entry.values[0];\n        entry.key = datum[args.x_accessor];\n      });\n\n      if (args.x_sort) {\n        return data_nested.sort(function (a, b) {\n          return new Date(a.key) - new Date(b.key);\n        });\n      } else {\n        return data_nested;\n      }\n    }\n\n    function mg_add_aggregate_rollover(args, svg, rollover_on, rollover_off, rollover_move) {\n      // Undo the keys getting coerced to strings, by setting the keys from the values\n      // This is necessary for when we have X axis keys that are things like\n      var data_nested = nest_data_for_aggregate_rollover(args);\n      var xf = data_nested.map(function (di) {\n        return args.scales.X(di.key);\n      });\n      var g = svg.append('g').attr('class', 'mg-rollover-rect');\n      g.selectAll('.mg-rollover-rects').data(data_nested).enter().append('rect').attr('x', function (d, i) {\n        if (xf.length === 1) return mg_get_plot_left(args);else if (i === 0) return xf[i].toFixed(2);else return ((xf[i - 1] + xf[i]) / 2).toFixed(2);\n      }).attr('y', args.top).attr('width', function (d, i) {\n        if (xf.length === 1) return mg_get_plot_right(args);else if (i === 0) return ((xf[i + 1] - xf[i]) / 2).toFixed(2);else if (i === xf.length - 1) return ((xf[i] - xf[i - 1]) / 2).toFixed(2);else return ((xf[i + 1] - xf[i - 1]) / 2).toFixed(2);\n      }).attr('class', function (d) {\n        var line_classes = d.values.map(function (datum) {\n          var lc = mg_line_class(datum.line_id);\n          if (args.colors === null) lc += ' ' + mg_line_color_class(datum.line_id);\n          return lc;\n        }).join(' ');\n\n        if (args.linked && d.values.length > 0) {\n          line_classes += ' ' + mg_rollover_id_class(mg_rollover_format_id(d.values[0], 0, args));\n        }\n\n        return line_classes;\n      }).attr('height', args.height - args.bottom - args.top - args.buffer).attr('opacity', 0).on('mouseover', rollover_on).on('mouseout', rollover_off).on('mousemove', rollover_move);\n      mg_configure_aggregate_rollover(args, svg);\n    }\n\n    function mg_configure_singleton_rollover(args, svg) {\n      svg.select('.mg-rollover-rect rect').on('mouseover')(args.data[0][0], 0);\n    }\n\n    function mg_configure_voronoi_rollover(args, svg) {\n      for (var i = 0; i < args.data.length; i++) {\n        var j = i + 1;\n\n        if (args.custom_line_color_map.length > 0 && args.custom_line_color_map[i] !== undefined) {\n          j = args.custom_line_color_map[i];\n        }\n\n        if (args.data[i].length === 1 && !svg.selectAll('.mg-voronoi .mg-line' + j).empty()) {\n          svg.selectAll('.mg-voronoi .mg-line' + j).on('mouseover')(args.data[i][0], 0);\n          svg.selectAll('.mg-voronoi .mg-line' + j).on('mouseout')(args.data[i][0], 0);\n        }\n      }\n    }\n\n    function mg_line_class(line_id) {\n      return 'mg-line' + line_id;\n    }\n\n    function mg_line_color_class(line_id) {\n      return 'mg-line' + line_id + '-color';\n    }\n\n    function mg_rollover_id_class(id) {\n      return 'roll_' + id;\n    }\n\n    function mg_rollover_format_id(d, i, args) {\n      var v = d[args.x_accessor];\n      var formatter = MG.time_format(args.utc_time, args.linked_format); // only format when x-axis is date\n\n      var id = typeof v === 'number' ? i : formatter(v);\n      return id;\n    }\n\n    function mg_add_single_line_rollover(args, svg, rollover_on, rollover_off, rollover_move) {\n      // set to 1 unless we have a custom increment series\n      var line_id = 1;\n\n      if (args.custom_line_color_map.length > 0) {\n        line_id = args.custom_line_color_map[0];\n      }\n\n      var g = svg.append('g').attr('class', 'mg-rollover-rect');\n      var xf = args.data[0].map(args.scalefns.xf);\n      g.selectAll('.mg-rollover-rects').data(args.data[0]).enter().append('rect').attr('class', function (d, i) {\n        var cl = mg_line_color_class(line_id) + ' ' + mg_line_class(d.line_id);\n        if (args.linked) cl += cl + ' ' + mg_rollover_id_class(mg_rollover_format_id(d, i, args));\n        return cl;\n      }).attr('x', function (d, i) {\n        // if data set is of length 1\n        if (xf.length === 1) return mg_get_plot_left(args);else if (i === 0) return xf[i].toFixed(2);else return ((xf[i - 1] + xf[i]) / 2).toFixed(2);\n      }).attr('y', function (d, i) {\n        return args.data.length > 1 ? args.scalefns.yf(d) - 6 // multi-line chart sensitivity\n        : args.top;\n      }).attr('width', function (d, i) {\n        // if data set is of length 1\n        if (xf.length === 1) return mg_get_plot_right(args);else if (i === 0) return ((xf[i + 1] - xf[i]) / 2).toFixed(2);else if (i === xf.length - 1) return ((xf[i] - xf[i - 1]) / 2).toFixed(2);else return ((xf[i + 1] - xf[i - 1]) / 2).toFixed(2);\n      }).attr('height', function (d, i) {\n        return args.data.length > 1 ? 12 // multi-line chart sensitivity\n        : args.height - args.bottom - args.top - args.buffer;\n      }).attr('opacity', 0).on('mouseover', rollover_on).on('mouseout', rollover_off).on('mousemove', rollover_move);\n\n      if (mg_is_singleton(args)) {\n        mg_configure_singleton_rollover(args, svg);\n      }\n    }\n\n    function mg_configure_aggregate_rollover(args, svg) {\n      var rect = svg.selectAll('.mg-rollover-rect rect');\n      var rect_first = rect.nodes()[0][0] || rect.nodes()[0];\n\n      if (args.data.filter(function (d) {\n        return d.length === 1;\n      }).length > 0) {\n        rect.on('mouseover')(rect_first.__data__, 0);\n      }\n    }\n\n    function mg_is_standard_multiline(args) {\n      return args.data.length > 1 && !args.aggregate_rollover;\n    }\n\n    function mg_is_aggregated_rollover(args) {\n      return args.data.length > 1 && args.aggregate_rollover;\n    }\n\n    function mg_is_singleton(args) {\n      return args.data.length === 1 && args.data[0].length === 1;\n    }\n\n    function mg_draw_all_line_elements(args, plot, svg) {\n      mg_remove_dangling_bands(plot, svg);\n\n      for (var i = args.data.length - 1; i >= 0; i--) {\n        var this_data = args.data[i]; // passing the data for the current line\n\n        MG.call_hook('line.before_each_series', [this_data, args]); // override increment if we have a custom increment series\n\n        var line_id = i + 1;\n\n        if (args.custom_line_color_map.length > 0) {\n          line_id = args.custom_line_color_map[i];\n        }\n\n        args.data[i].line_id = line_id;\n\n        if (this_data.length === 0) {\n          continue;\n        }\n\n        var existing_line = svg.select('path.mg-main-line.mg-line' + line_id);\n        mg_add_confidence_band(args, plot, svg, line_id);\n        mg_add_area(args, plot, svg, i, line_id);\n        mg_add_line(args, plot, svg, existing_line, i, line_id);\n        mg_add_legend_element(args, plot, i, line_id); // passing the data for the current line\n\n        MG.call_hook('line.after_each_series', [this_data, existing_line, args]);\n      }\n    }\n\n    function mg_remove_dangling_bands(plot, svg) {\n      if (plot.existing_band[0] && plot.existing_band[0].length > svg.selectAll('.mg-main-line').node().length) {\n        svg.selectAll('.mg-confidence-band').remove();\n      }\n    }\n\n    function mg_line_main_plot(args) {\n      var plot = {};\n      var svg = mg_get_svg_child_of(args.target); // remove any old legends if they exist\n\n      mg_selectAll_and_remove(svg, '.mg-line-legend');\n      mg_add_legend_group(args, plot, svg);\n      plot.data_median = 0;\n      plot.update_transition_duration = args.transition_on_update ? 1000 : 0;\n      plot.display_area = args.area && !args.use_data_y_min && args.data.length <= 1 && args.aggregate_rollover === false;\n      plot.legend_text = '';\n      mg_line_graph_generators(args, plot, svg);\n      plot.existing_band = svg.selectAll('.mg-confidence-band').nodes(); // should we continue with the default line render? A `line.all_series` hook should return false to prevent the default.\n\n      var continueWithDefault = MG.call_hook('line.before_all_series', [args]);\n\n      if (continueWithDefault !== false) {\n        mg_draw_all_line_elements(args, plot, svg);\n      }\n\n      mg_plot_legend_if_legend_target(args.legend_target, plot.legend_text);\n    }\n\n    function mg_line_rollover_setup(args, graph) {\n      var svg = mg_get_svg_child_of(args.target);\n\n      if (svg.selectAll('.mg-active-datapoint-container').nodes().length === 0) {\n        mg_add_g(svg, 'mg-active-datapoint-container');\n      }\n\n      mg_remove_existing_line_rollover_elements(svg);\n      mg_add_rollover_circle(args, svg);\n      mg_set_unique_line_id_for_each_series(args);\n\n      if (mg_is_standard_multiline(args)) {\n        mg_add_voronoi_rollover(args, svg, graph.rolloverOn(args), graph.rolloverOff(args), graph.rolloverMove(args));\n      } else if (mg_is_aggregated_rollover(args)) {\n        mg_add_aggregate_rollover(args, svg, graph.rolloverOn(args), graph.rolloverOff(args), graph.rolloverMove(args));\n      } else {\n        mg_add_single_line_rollover(args, svg, graph.rolloverOn(args), graph.rolloverOff(args), graph.rolloverMove(args));\n      }\n    }\n\n    function mg_update_rollover_circle(args, svg, d) {\n      if (args.aggregate_rollover && args.data.length > 1) {\n        // hide the circles in case a non-contiguous series is present\n        svg.selectAll('circle.mg-line-rollover-circle').style('opacity', 0);\n        d.values.forEach(function (datum) {\n          if (mg_data_in_plot_bounds(datum, args)) mg_update_aggregate_rollover_circle(args, svg, datum);\n        });\n      } else if (args.missing_is_hidden && d['_missing'] || d[args.y_accessor] === null) {\n        // disable rollovers for hidden parts of the line\n        // recall that hidden parts are missing data ranges and possibly also\n        // data points that have been explicitly identified as missing\n        return;\n      } else {\n        // show circle on mouse-overed rect\n        if (mg_data_in_plot_bounds(d, args)) {\n          mg_update_generic_rollover_circle(args, svg, d);\n        }\n      }\n    }\n\n    function mg_update_aggregate_rollover_circle(args, svg, datum) {\n      svg.select('circle.mg-line-rollover-circle.mg-line' + datum.line_id).attr('cx', args.scales.X(datum[args.x_accessor]).toFixed(2)).attr('cy', args.scales.Y(datum[args.y_accessor]).toFixed(2)).attr('r', args.point_size).style('opacity', 1);\n    }\n\n    function mg_update_generic_rollover_circle(args, svg, d) {\n      svg.selectAll('circle.mg-line-rollover-circle.mg-line' + d.line_id).classed('mg-line-rollover-circle', true).attr('cx', function () {\n        return args.scales.X(d[args.x_accessor]).toFixed(2);\n      }).attr('cy', function () {\n        return args.scales.Y(d[args.y_accessor]).toFixed(2);\n      }).attr('r', args.point_size).style('opacity', 1);\n    }\n\n    function mg_trigger_linked_mouseovers(args, d, i) {\n      if (args.linked && !MG.globals.link) {\n        MG.globals.link = true;\n\n        if (!args.aggregate_rollover || d.value !== undefined || d.values.length > 0) {\n          var datum = d.values ? d.values[0] : d;\n          var id = mg_rollover_format_id(datum, i, args); // trigger mouseover on matching line in .linked charts\n\n          d3.selectAll('.' + mg_line_class(datum.line_id) + '.' + mg_rollover_id_class(id)).each(function (d) {\n            d3.select(this).on('mouseover')(d, i);\n          });\n        }\n      }\n    }\n\n    function mg_trigger_linked_mouseouts(args, d, i) {\n      if (args.linked && MG.globals.link) {\n        MG.globals.link = false;\n        var formatter = MG.time_format(args.utc_time, args.linked_format);\n        var datums = d.values ? d.values : [d];\n        datums.forEach(function (datum) {\n          var v = datum[args.x_accessor];\n          var id = typeof v === 'number' ? i : formatter(v); // trigger mouseout on matching line in .linked charts\n\n          d3.selectAll('.roll_' + id).each(function (d) {\n            d3.select(this).on('mouseout')(d);\n          });\n        });\n      }\n    }\n\n    function mg_remove_active_data_points_for_aggregate_rollover(args, svg) {\n      svg.selectAll('circle.mg-line-rollover-circle').filter(function (circle) {\n        return circle.length > 1;\n      }).style('opacity', 0);\n    }\n\n    function mg_remove_active_data_points_for_generic_rollover(args, svg, d) {\n      svg.selectAll('circle.mg-line-rollover-circle.mg-line' + d.line_id).style('opacity', function () {\n        var id = d.line_id - 1;\n\n        if (args.custom_line_color_map.length > 0 && args.custom_line_color_map.indexOf(d.line_id) !== undefined) {\n          id = args.custom_line_color_map.indexOf(d.line_id);\n        }\n\n        if (args.data[id].length === 1) {\n          return 1;\n        } else {\n          return 0;\n        }\n      });\n    }\n\n    function mg_remove_active_text(svg) {\n      svg.select('.mg-active-datapoint').text('');\n    }\n\n    function lineChart(args) {\n      this.init = function (args) {\n        this.args = args;\n\n        if (!args.data || args.data.length === 0) {\n          args.internal_error = 'No data was supplied';\n          internal_error(args);\n          return this;\n        } else {\n          args.internal_error = undefined;\n        }\n\n        raw_data_transformation(args);\n        process_line(args);\n        MG.call_hook('line.before_destroy', this);\n        init(args); // TODO incorporate markers into calculation of x scales\n\n        new MG.scale_factory(args).namespace('x').numericalDomainFromData().numericalRange('bottom');\n        var baselines = (args.baselines || []).map(function (d) {\n          return d[args.y_accessor];\n        });\n        new MG.scale_factory(args).namespace('y').zeroBottom(true).inflateDomain(true).numericalDomainFromData(baselines).numericalRange('left');\n        var svg = mg_get_svg_child_of(args.target);\n\n        if (args.x_axis) {\n          new MG.axis_factory(args).namespace('x').type('numerical').position(args.x_axis_position).rug(x_rug(args)).label(mg_add_x_label).draw();\n        }\n\n        if (args.y_axis) {\n          new MG.axis_factory(args).namespace('y').type('numerical').position(args.y_axis_position).rug(y_rug(args)).label(mg_add_y_label).draw();\n        }\n\n        this.markers();\n        this.mainPlot();\n        this.rollover();\n        this.windowListeners();\n        MG.call_hook('line.after_init', this);\n        return this;\n      };\n\n      this.mainPlot = function () {\n        mg_line_main_plot(args);\n        return this;\n      };\n\n      this.markers = function () {\n        markers(args);\n        return this;\n      };\n\n      this.rollover = function () {\n        var that = this;\n        mg_line_rollover_setup(args, that);\n        MG.call_hook('line.after_rollover', args);\n        return this;\n      };\n\n      this.rolloverOn = function (args) {\n        var svg = mg_get_svg_child_of(args.target);\n        var fmt = mg_get_rollover_time_format(args);\n        return function (d, i) {\n          mg_update_rollover_circle(args, svg, d);\n          mg_trigger_linked_mouseovers(args, d, i);\n          svg.selectAll('text').filter(function (g, j) {\n            return d === g;\n          }).attr('opacity', 0.3); // update rollover text except for missing data points\n\n          if (args.show_rollover_text && !(args.missing_is_hidden && d['_missing'] || d[args.y_accessor] === null)) {\n            var mouseover = mg_mouseover_text(args, {\n              svg: svg\n            });\n            var row = mouseover.mouseover_row();\n\n            if (args.aggregate_rollover) {\n              row.text((args.aggregate_rollover && args.data.length > 1 ? mg_format_x_aggregate_mouseover : mg_format_x_mouseover)(args, d));\n            }\n\n            var pts = args.aggregate_rollover && args.data.length > 1 ? d.values : [d];\n            pts.forEach(function (di) {\n              if (args.aggregate_rollover) {\n                row = mouseover.mouseover_row();\n              }\n\n              if (args.legend) {\n                mg_line_color_text(row.text(args.legend[di.line_id - 1] + '  ').bold().elem(), di, args);\n              }\n\n              mg_line_color_text(row.text('\\u2014  ').elem(), di, args);\n\n              if (!args.aggregate_rollover) {\n                row.text(mg_format_x_mouseover(args, di));\n              }\n\n              row.text(mg_format_y_mouseover(args, di, args.time_series === false));\n            });\n          }\n\n          if (args.mouseover) {\n            args.mouseover(d, i);\n          }\n        };\n      };\n\n      this.rolloverOff = function (args) {\n        var svg = mg_get_svg_child_of(args.target);\n        return function (d, i) {\n          mg_trigger_linked_mouseouts(args, d, i);\n\n          if (args.aggregate_rollover) {\n            mg_remove_active_data_points_for_aggregate_rollover(args, svg);\n          } else {\n            mg_remove_active_data_points_for_generic_rollover(args, svg, d);\n          }\n\n          if (args.data[0].length > 1) {\n            mg_clear_mouseover_container(svg);\n          }\n\n          if (args.mouseout) {\n            args.mouseout(d, i);\n          }\n        };\n      };\n\n      this.rolloverMove = function (args) {\n        return function (d, i) {\n          if (args.mousemove) {\n            args.mousemove(d, i);\n          }\n        };\n      };\n\n      this.windowListeners = function () {\n        mg_window_listeners(this.args);\n        return this;\n      };\n\n      this.init(args);\n    }\n\n    MG.register('line', lineChart);\n  }).call(this);\n  (function () {\n    'use strict';\n\n    function histogram(args) {\n      this.init = function (args) {\n        this.args = args;\n        raw_data_transformation(args);\n        process_histogram(args);\n        init(args);\n        new MG.scale_factory(args).namespace('x').numericalDomainFromData().numericalRange('bottom');\n        var baselines = (args.baselines || []).map(function (d) {\n          return d[args.y_accessor];\n        });\n        new MG.scale_factory(args).namespace('y').zeroBottom(true).inflateDomain(true).numericalDomainFromData(baselines).numericalRange('left');\n        x_axis(args);\n        y_axis(args);\n        this.mainPlot();\n        this.markers();\n        this.rollover();\n        this.windowListeners();\n        return this;\n      };\n\n      this.mainPlot = function () {\n        var svg = mg_get_svg_child_of(args.target); //remove the old histogram, add new one\n\n        svg.selectAll('.mg-histogram').remove();\n        var g = svg.append('g').attr('class', 'mg-histogram');\n        var bar = g.selectAll('.mg-bar').data(args.data[0]).enter().append('g').attr('class', 'mg-bar').attr('transform', function (d) {\n          return \"translate(\" + args.scales.X(d[args.x_accessor]).toFixed(2) + \",\" + args.scales.Y(d[args.y_accessor]).toFixed(2) + \")\";\n        }); //draw bars\n\n        bar.append('rect').attr('x', 1).attr('width', function (d, i) {\n          if (args.data[0].length === 1) {\n            return (args.scalefns.xf(args.data[0][0]) - args.bar_margin).toFixed(0);\n          } else if (i !== args.data[0].length - 1) {\n            return (args.scalefns.xf(args.data[0][i + 1]) - args.scalefns.xf(d)).toFixed(0);\n          } else {\n            return (args.scalefns.xf(args.data[0][1]) - args.scalefns.xf(args.data[0][0])).toFixed(0);\n          }\n        }).attr('height', function (d) {\n          if (d[args.y_accessor] === 0) {\n            return 0;\n          }\n\n          return (args.height - args.bottom - args.buffer - args.scales.Y(d[args.y_accessor])).toFixed(2);\n        });\n        return this;\n      };\n\n      this.markers = function () {\n        markers(args);\n        return this;\n      };\n\n      this.rollover = function () {\n        var svg = mg_get_svg_child_of(args.target);\n\n        if (svg.selectAll('.mg-active-datapoint-container').nodes().length === 0) {\n          mg_add_g(svg, 'mg-active-datapoint-container');\n        } //remove the old rollovers if they already exist\n\n\n        svg.selectAll('.mg-rollover-rect').remove();\n        svg.selectAll('.mg-active-datapoint').remove();\n        var g = svg.append('g').attr('class', 'mg-rollover-rect'); //draw rollover bars\n\n        var bar = g.selectAll('.mg-bar').data(args.data[0]).enter().append('g').attr('class', function (d, i) {\n          if (args.linked) {\n            return 'mg-rollover-rects roll_' + i;\n          } else {\n            return 'mg-rollover-rects';\n          }\n        }).attr('transform', function (d) {\n          return \"translate(\" + args.scales.X(d[args.x_accessor]) + \",\" + 0 + \")\";\n        });\n        bar.append('rect').attr('x', 1).attr('y', args.buffer + args.title_y_position).attr('width', function (d, i) {\n          //if data set is of length 1\n          if (args.data[0].length === 1) {\n            return (args.scalefns.xf(args.data[0][0]) - args.bar_margin).toFixed(0);\n          } else if (i !== args.data[0].length - 1) {\n            return (args.scalefns.xf(args.data[0][i + 1]) - args.scalefns.xf(d)).toFixed(0);\n          } else {\n            return (args.scalefns.xf(args.data[0][1]) - args.scalefns.xf(args.data[0][0])).toFixed(0);\n          }\n        }).attr('height', function (d) {\n          return args.height;\n        }).attr('opacity', 0).on('mouseover', this.rolloverOn(args)).on('mouseout', this.rolloverOff(args)).on('mousemove', this.rolloverMove(args));\n        return this;\n      };\n\n      this.rolloverOn = function (args) {\n        var svg = mg_get_svg_child_of(args.target);\n        return function (d, i) {\n          svg.selectAll('text').filter(function (g, j) {\n            return d === g;\n          }).attr('opacity', 0.3);\n          var fmt = args.processed.xax_format || MG.time_format(args.utc_time, '%b %e, %Y');\n          var num = format_rollover_number(args);\n          svg.selectAll('.mg-bar rect').filter(function (d, j) {\n            return j === i;\n          }).classed('active', true); //trigger mouseover on all matching bars\n\n          if (args.linked && !MG.globals.link) {\n            MG.globals.link = true; //trigger mouseover on matching bars in .linked charts\n\n            d3.selectAll('.mg-rollover-rects.roll_' + i + ' rect').each(function (d) {\n              //use existing i\n              d3.select(this).on('mouseover')(d, i);\n            });\n          } //update rollover text\n\n\n          if (args.show_rollover_text) {\n            var mo = mg_mouseover_text(args, {\n              svg: svg\n            });\n            var row = mo.mouseover_row();\n            row.text('\\u259F  ').elem().classed('hist-symbol', true);\n            row.text(mg_format_x_mouseover(args, d)); // x\n\n            row.text(mg_format_y_mouseover(args, d, args.time_series === false));\n          }\n\n          if (args.mouseover) {\n            mg_setup_mouseover_container(svg, args);\n            args.mouseover(d, i);\n          }\n        };\n      };\n\n      this.rolloverOff = function (args) {\n        var svg = mg_get_svg_child_of(args.target);\n        return function (d, i) {\n          if (args.linked && MG.globals.link) {\n            MG.globals.link = false; //trigger mouseout on matching bars in .linked charts\n\n            d3.selectAll('.mg-rollover-rects.roll_' + i + ' rect').each(function (d) {\n              //use existing i\n              d3.select(this).on('mouseout')(d, i);\n            });\n          } //reset active bar\n\n\n          svg.selectAll('.mg-bar rect').classed('active', false); //reset active data point text\n\n          mg_clear_mouseover_container(svg);\n\n          if (args.mouseout) {\n            args.mouseout(d, i);\n          }\n        };\n      };\n\n      this.rolloverMove = function (args) {\n        return function (d, i) {\n          if (args.mousemove) {\n            args.mousemove(d, i);\n          }\n        };\n      };\n\n      this.windowListeners = function () {\n        mg_window_listeners(this.args);\n        return this;\n      };\n\n      this.init(args);\n    }\n\n    var defaults = {\n      binned: false,\n      bins: null,\n      processed_x_accessor: 'x',\n      processed_y_accessor: 'y',\n      processed_dx_accessor: 'dx',\n      bar_margin: 1\n    };\n    MG.register('histogram', histogram, defaults);\n  }).call(this);\n\n  function point_mouseover(args, svg, d) {\n    var mouseover = mg_mouseover_text(args, {\n      svg: svg\n    });\n    var row = mouseover.mouseover_row();\n\n    if (args.color_accessor !== null && args.color_type === 'category') {\n      var label = d[args.color_accessor];\n      row.text(label + '  ').bold().elem().attr('fill', args.scalefns.colorf(d));\n    }\n\n    mg_color_point_mouseover(args, row.text('\\u25CF   ').elem(), d); // point shape\n\n    row.text(mg_format_x_mouseover(args, d)); // x\n\n    row.text(mg_format_y_mouseover(args, d, args.time_series === false));\n  }\n\n  function mg_color_point_mouseover(args, elem, d) {\n    if (args.color_accessor !== null) {\n      elem.attr('fill', args.scalefns.colorf(d));\n      elem.attr('stroke', args.scalefns.colorf(d));\n    } else {\n      elem.classed('mg-points-mono', true);\n    }\n  }\n\n  (function () {\n    'use strict';\n\n    function mg_filter_out_plot_bounds(data, args) {\n      // max_x, min_x, max_y, min_y;\n      var x = args.x_accessor;\n      var y = args.y_accessor;\n      var new_data = data.filter(function (d) {\n        return (args.min_x === null || d[x] >= args.min_x) && (args.max_x === null || d[x] <= args.max_x) && (args.min_y === null || d[y] >= args.min_y) && (args.max_y === null || d[y] <= args.max_y);\n      });\n      return new_data;\n    }\n\n    function pointChart(args) {\n      this.init = function (args) {\n        this.args = args; // infer y_axis and x_axis type;\n\n        args.x_axis_type = mg_infer_type(args, 'x');\n        args.y_axis_type = mg_infer_type(args, 'y');\n        raw_data_transformation(args);\n        process_point(args);\n        init(args);\n        var xMaker, yMaker;\n\n        if (args.x_axis_type === 'categorical') {\n          xMaker = MG.scale_factory(args).namespace('x').categoricalDomainFromData().categoricalRangeBands([0, args.xgroup_height], args.xgroup_accessor === null);\n\n          if (args.xgroup_accessor) {\n            new MG.scale_factory(args).namespace('xgroup').categoricalDomainFromData().categoricalRangeBands('bottom');\n          } else {\n            args.scales.XGROUP = function (d) {\n              return mg_get_plot_left(args);\n            };\n\n            args.scalefns.xgroupf = function (d) {\n              return mg_get_plot_left(args);\n            };\n          }\n\n          args.scalefns.xoutf = function (d) {\n            return args.scalefns.xf(d) + args.scalefns.xgroupf(d);\n          };\n        } else {\n          xMaker = MG.scale_factory(args).namespace('x').inflateDomain(true).zeroBottom(args.y_axis_type === 'categorical').numericalDomainFromData((args.baselines || []).map(function (d) {\n            return d[args.x_accessor];\n          })).numericalRange('bottom');\n          args.scalefns.xoutf = args.scalefns.xf;\n        } // y-scale generation. This needs to get simplified.\n\n\n        if (args.y_axis_type === 'categorical') {\n          yMaker = MG.scale_factory(args).namespace('y').zeroBottom(true).categoricalDomainFromData().categoricalRangeBands([0, args.ygroup_height], true);\n\n          if (args.ygroup_accessor) {\n            new MG.scale_factory(args).namespace('ygroup').categoricalDomainFromData().categoricalRangeBands('left');\n          } else {\n            args.scales.YGROUP = function () {\n              return mg_get_plot_top(args);\n            };\n\n            args.scalefns.ygroupf = function (d) {\n              return mg_get_plot_top(args);\n            };\n          }\n\n          args.scalefns.youtf = function (d) {\n            return args.scalefns.yf(d) + args.scalefns.ygroupf(d);\n          };\n        } else {\n          var baselines = (args.baselines || []).map(function (d) {\n            return d[args.y_accessor];\n          });\n          yMaker = MG.scale_factory(args).namespace('y').inflateDomain(true).zeroBottom(args.x_axis_type === 'categorical').numericalDomainFromData(baselines).numericalRange('left');\n\n          args.scalefns.youtf = function (d) {\n            return args.scalefns.yf(d);\n          };\n        } /////// COLOR accessor\n\n\n        if (args.color_accessor !== null) {\n          var colorScale = MG.scale_factory(args).namespace('color');\n\n          if (args.color_type === 'number') {\n            // do the color scale.\n            // etiher get color range, or what.\n            colorScale.numericalDomainFromData(mg_get_color_domain(args)).numericalRange(mg_get_color_range(args)).clamp(true);\n          } else {\n            if (args.color_domain) {\n              colorScale.categoricalDomain(args.color_domain).categoricalRange(args.color_range);\n            } else {\n              colorScale.categoricalDomainFromData().categoricalColorRange();\n            }\n          }\n        }\n\n        if (args.size_accessor) {\n          new MG.scale_factory(args).namespace('size').numericalDomainFromData().numericalRange(mg_get_size_range(args)).clamp(true);\n        }\n\n        new MG.axis_factory(args).namespace('x').type(args.x_axis_type).zeroLine(args.y_axis_type === 'categorical').position(args.x_axis_position).rug(x_rug(args)).label(mg_add_x_label).draw();\n        new MG.axis_factory(args).namespace('y').type(args.y_axis_type).zeroLine(args.x_axis_type === 'categorical').position(args.y_axis_position).rug(y_rug(args)).label(mg_add_y_label).draw();\n        this.mainPlot();\n        this.markers();\n        this.rollover();\n        this.windowListeners();\n        return this;\n      };\n\n      this.markers = function () {\n        markers(args);\n\n        if (args.least_squares) {\n          add_ls(args);\n        }\n\n        return this;\n      };\n\n      this.mainPlot = function () {\n        var svg = mg_get_svg_child_of(args.target);\n        var g;\n        var data = mg_filter_out_plot_bounds(args.data[0], args); //remove the old points, add new one\n\n        svg.selectAll('.mg-points').remove();\n        g = svg.append('g').classed('mg-points', true);\n        var pts = g.selectAll('circle').data(data).enter().append('circle').attr('class', function (d, i) {\n          return 'path-' + i;\n        }).attr('cx', args.scalefns.xoutf).attr('cy', function (d) {\n          return args.scalefns.youtf(d);\n        }); //are we coloring our points, or just using the default color?\n\n        if (args.color_accessor !== null) {\n          pts.attr('fill', args.scalefns.colorf);\n          pts.attr('stroke', args.scalefns.colorf);\n        } else {\n          pts.classed('mg-points-mono', true);\n        }\n\n        if (args.size_accessor !== null) {\n          pts.attr('r', args.scalefns.sizef);\n        } else {\n          pts.attr('r', args.point_size);\n        }\n\n        return this;\n      };\n\n      this.rollover = function () {\n        var svg = mg_get_svg_child_of(args.target);\n\n        if (svg.selectAll('.mg-active-datapoint-container').nodes().length === 0) {\n          mg_add_g(svg, 'mg-active-datapoint-container');\n        } //remove the old rollovers if they already exist\n\n\n        svg.selectAll('.mg-voronoi').remove(); //add rollover paths\n\n        var voronoi = d3.voronoi().x(args.scalefns.xoutf).y(args.scalefns.youtf).extent([[args.buffer, args.buffer + args.title_y_position], [args.width - args.buffer, args.height - args.buffer]]);\n        var paths = svg.append('g').attr('class', 'mg-voronoi');\n        paths.selectAll('path').data(voronoi.polygons(mg_filter_out_plot_bounds(args.data[0], args))).enter().append('path').attr('d', function (d) {\n          return d == null ? null : 'M' + d.join(',') + 'Z';\n        }).attr('class', function (d, i) {\n          return 'path-' + i;\n        }).style('fill-opacity', 0).on('mouseover', this.rolloverOn(args)).on('mouseout', this.rolloverOff(args)).on('mousemove', this.rolloverMove(args));\n\n        if (args.data[0].length === 1) {\n          point_mouseover(args, svg, args.data[0][0]);\n        }\n\n        return this;\n      };\n\n      this.rolloverOn = function (args) {\n        var svg = mg_get_svg_child_of(args.target);\n        return function (d, i) {\n          svg.selectAll('.mg-points circle').classed('selected', false); //highlight active point\n\n          var pts = svg.selectAll('.mg-points circle.path-' + i).classed('selected', true);\n\n          if (args.size_accessor) {\n            pts.attr('r', function (di) {\n              return args.scalefns.sizef(di) + args.active_point_size_increase;\n            });\n          } else {\n            pts.attr('r', args.point_size + args.active_point_size_increase);\n          } //trigger mouseover on all points for this class name in .linked charts\n\n\n          if (args.linked && !MG.globals.link) {\n            MG.globals.link = true; //trigger mouseover on matching point in .linked charts\n\n            d3.selectAll('.mg-voronoi .path-' + i).each(function () {\n              d3.select(this).on('mouseover')(d, i);\n            });\n          }\n\n          if (args.show_rollover_text) {\n            point_mouseover(args, svg, d.data);\n          }\n\n          if (args.mouseover) {\n            args.mouseover(d, i);\n          }\n        };\n      };\n\n      this.rolloverOff = function (args) {\n        var svg = mg_get_svg_child_of(args.target);\n        return function (d, i) {\n          if (args.linked && MG.globals.link) {\n            MG.globals.link = false;\n            d3.selectAll('.mg-voronoi .path-' + i).each(function () {\n              d3.select(this).on('mouseout')(d, i);\n            });\n          } //reset active point\n\n\n          var pts = svg.selectAll('.mg-points circle').classed('unselected', false).classed('selected', false);\n\n          if (args.size_accessor) {\n            pts.attr('r', args.scalefns.sizef);\n          } else {\n            pts.attr('r', args.point_size);\n          } //reset active data point text\n\n\n          if (args.data[0].length > 1) mg_clear_mouseover_container(svg);\n\n          if (args.mouseout) {\n            args.mouseout(d, i);\n          }\n        };\n      };\n\n      this.rolloverMove = function (args) {\n        return function (d, i) {\n          if (args.mousemove) {\n            args.mousemove(d, i);\n          }\n        };\n      };\n\n      this.update = function (args) {\n        return this;\n      };\n\n      this.windowListeners = function () {\n        mg_window_listeners(this.args);\n        return this;\n      };\n\n      this.init(args);\n    }\n\n    var defaults = {\n      y_padding_percentage: 0.05,\n      // for categorical scales\n      y_outer_padding_percentage: .2,\n      // for categorical scales\n      ygroup_padding_percentage: 0,\n      // for categorical scales\n      ygroup_outer_padding_percentage: 0,\n      // for categorical scales\n      x_padding_percentage: 0.05,\n      // for categorical scales\n      x_outer_padding_percentage: .2,\n      // for categorical scales\n      xgroup_padding_percentage: 0,\n      // for categorical scales\n      xgroup_outer_padding_percentage: 0,\n      // for categorical scales\n      y_categorical_show_guides: true,\n      x_categorical_show_guides: true,\n      buffer: 16,\n      ls: false,\n      lowess: false,\n      point_size: 2.5,\n      label_accessor: null,\n      size_accessor: null,\n      color_accessor: null,\n      size_range: null,\n      // when we set a size_accessor option, this array determines the size range, e.g. [1,5]\n      color_range: null,\n      // e.g. ['blue', 'red'] to color different groups of points\n      size_domain: null,\n      color_domain: null,\n      active_point_size_increase: 1,\n      color_type: 'number' // can be either 'number' - the color scale is quantitative - or 'category' - the color scale is qualitative.\n\n    };\n    MG.register('point', pointChart, defaults);\n  }).call(this);\n  (function () {\n    'use strict'; // TODO add styles to stylesheet instead\n\n    function scaffold(args) {\n      var svg = mg_get_svg_child_of(args.target); // main margins\n\n      svg.append('line').attr('x1', 0).attr('x2', args.width).attr('y1', args.top).attr('y2', args.top).attr('stroke', 'black');\n      svg.append('line').attr('x1', 0).attr('x2', args.width).attr('y1', args.height - args.bottom).attr('y2', args.height - args.bottom).attr('stroke', 'black');\n      svg.append('line').attr('x1', args.left).attr('x2', args.left).attr('y1', 0).attr('y2', args.height).attr('stroke', 'black');\n      svg.append('line').attr('x1', args.width - args.right).attr('x2', args.width - args.right).attr('y1', 0).attr('y2', args.height).attr('stroke', 'black'); // plot area margins\n\n      svg.append('line').attr('x1', 0).attr('x2', args.width).attr('y1', args.height - args.bottom - args.buffer).attr('y2', args.height - args.bottom - args.buffer).attr('stroke', 'gray');\n      svg.append('line').attr('x1', 0).attr('x2', args.width).attr('y1', args.top + args.buffer).attr('y2', args.top + args.buffer).attr('stroke', 'gray');\n      svg.append('line').attr('x1', args.left + args.buffer).attr('x2', args.left + args.buffer).attr('y1', 0).attr('y2', args.height).attr('stroke', 'gray');\n      svg.append('line').attr('x1', args.width - args.right - args.buffer).attr('x2', args.width - args.right - args.buffer).attr('y1', 0).attr('y2', args.height).attr('stroke', 'gray');\n    } // barchart re-write.\n\n\n    function mg_targeted_legend(args) {\n      var labels;\n      var plot = '';\n\n      if (args.legend_target) {\n        var div = d3.select(args.legend_target).append('div').classed('mg-bar-target-legend', true);\n        if (args.orientation == 'horizontal') labels = args.scales.Y.domain();else labels = args.scales.X.domain();\n        labels.forEach(function (label) {\n          var outer_span = div.append('span').classed('mg-bar-target-element', true);\n          outer_span.append('span').classed('mg-bar-target-legend-shape', true).style('color', args.scales.COLOR(label)).text('\\u25FC ');\n          outer_span.append('span').classed('mg-bar-target-legend-text', true).text(label);\n        });\n      }\n    }\n\n    function legend_on_graph(svg, args) {\n      // draw each element at the top right\n      // get labels\n      var labels;\n      if (args.orientation == 'horizontal') labels = args.scales.Y.domain();else labels = args.scales.X.domain();\n      var lineCount = 0;\n      var lineHeight = 1.1;\n      var g = svg.append('g').classed(\"mg-bar-legend\", true);\n      var textContainer = g.append('text'); //\n\n      textContainer.selectAll('*').remove();\n      textContainer.attr('width', args.right).attr('height', 100).attr('text-anchor', 'start');\n      labels.forEach(function (label) {\n        var sub_container = textContainer.append('tspan').attr('x', mg_get_plot_right(args)).attr('y', args.height / 2).attr('dy', lineCount * lineHeight + 'em');\n        sub_container.append('tspan').text('\\u25a0 ').attr('fill', args.scales.COLOR(label)).attr('font-size', 20);\n        sub_container.append('tspan').text(label).attr('font-weight', 300).attr('font-size', 10);\n        lineCount++;\n      }); // d.values.forEach(function (datum) {\n      //   formatted_y = mg_format_y_rollover(args, num, datum);\n      //   if (args.y_rollover_format !== null) {\n      //     formatted_y = number_rollover_format(args.y_rollover_format, datum, args.y_accessor);\n      //   } else {\n      //     formatted_y = args.yax_units + num(datum[args.y_accessor]);\n      //   }\n      //   sub_container = textContainer.append('tspan').attr('x', 0).attr('y', (lineCount * lineHeight) + 'em');\n      //   formatted_y = mg_format_y_rollover(args, num, datum);\n      //   mouseover_tspan(sub_container, '\\u2014  ')\n      //     .color(args, datum);\n      //   mouseover_tspan(sub_container, formatted_x + ' ' + formatted_y);\n      //   lineCount++;\n      // });\n    }\n\n    function barChart(args) {\n      this.args = args;\n\n      this.init = function (args) {\n        this.args = args;\n        args.x_axis_type = mg_infer_type(args, 'x');\n        args.y_axis_type = mg_infer_type(args, 'y'); // this is specific to how rects work in svg, let's keep track of the bar orientation to\n        // plot appropriately.\n\n        if (args.x_axis_type == 'categorical') {\n          args.orientation = 'vertical';\n        } else if (args.y_axis_type == 'categorical') {\n          args.orientation = 'horizontal';\n        } else if (args.x_axis_type != 'categorical' && args.y_axis_type != 'categorical') {\n          // histogram.\n          args.orientation = 'vertical';\n        }\n\n        raw_data_transformation(args);\n        process_point(args);\n        init(args);\n        var xMaker, yMaker;\n\n        if (args.x_axis_type === 'categorical') {\n          xMaker = MG.scale_factory(args).namespace('x').categoricalDomainFromData().categoricalRangeBands([0, args.xgroup_height], args.xgroup_accessor === null);\n\n          if (args.xgroup_accessor) {\n            new MG.scale_factory(args).namespace('xgroup').categoricalDomainFromData().categoricalRangeBands('bottom');\n          } else {\n            args.scales.XGROUP = function (d) {\n              return mg_get_plot_left(args);\n            };\n\n            args.scalefns.xgroupf = function (d) {\n              return mg_get_plot_left(args);\n            };\n          }\n\n          args.scalefns.xoutf = function (d) {\n            return args.scalefns.xf(d) + args.scalefns.xgroupf(d);\n          };\n        } else {\n          xMaker = MG.scale_factory(args).namespace('x').inflateDomain(true).zeroBottom(args.y_axis_type === 'categorical').numericalDomainFromData((args.baselines || []).map(function (d) {\n            return d[args.x_accessor];\n          })).numericalRange('bottom');\n          args.scalefns.xoutf = args.scalefns.xf;\n        } // y-scale generation. This needs to get simplified.\n\n\n        if (args.y_axis_type === 'categorical') {\n          yMaker = MG.scale_factory(args).namespace('y').zeroBottom(true).categoricalDomainFromData().categoricalRangeBands([0, args.ygroup_height], true);\n\n          if (args.ygroup_accessor) {\n            new MG.scale_factory(args).namespace('ygroup').categoricalDomainFromData().categoricalRangeBands('left');\n          } else {\n            args.scales.YGROUP = function () {\n              return mg_get_plot_top(args);\n            };\n\n            args.scalefns.ygroupf = function (d) {\n              return mg_get_plot_top(args);\n            };\n          }\n\n          args.scalefns.youtf = function (d) {\n            return args.scalefns.yf(d) + args.scalefns.ygroupf(d);\n          };\n        } else {\n          var baselines = (args.baselines || []).map(function (d) {\n            return d[args.y_accessor];\n          });\n          yMaker = MG.scale_factory(args).namespace('y').inflateDomain(true).zeroBottom(args.x_axis_type === 'categorical').numericalDomainFromData(baselines).numericalRange('left');\n\n          args.scalefns.youtf = function (d) {\n            return args.scalefns.yf(d);\n          };\n        }\n\n        if (args.ygroup_accessor !== null) {\n          args.ycolor_accessor = args.y_accessor;\n          MG.scale_factory(args).namespace('ycolor').scaleName('color').categoricalDomainFromData().categoricalColorRange();\n        }\n\n        if (args.xgroup_accessor !== null) {\n          args.xcolor_accessor = args.x_accessor;\n          MG.scale_factory(args).namespace('xcolor').scaleName('color').categoricalDomainFromData().categoricalColorRange();\n        } // if (args.ygroup_accessor !== null) {\n        //   MG.scale_factory(args)\n        //     .namespace('ygroup')\n        //     .categoricalDomainFromData()\n        //     .categoricalColorRange();\n        // }\n\n\n        new MG.axis_factory(args).namespace('x').type(args.x_axis_type).zeroLine(args.y_axis_type === 'categorical').position(args.x_axis_position).draw();\n        new MG.axis_factory(args).namespace('y').type(args.y_axis_type).zeroLine(args.x_axis_type === 'categorical').position(args.y_axis_position).draw(); //mg_categorical_group_color_scale(args);\n\n        this.mainPlot();\n        this.markers();\n        this.rollover();\n        this.windowListeners(); //scaffold(args)\n\n        return this;\n      };\n\n      this.mainPlot = function () {\n        var svg = mg_get_svg_child_of(args.target);\n        var data = args.data[0];\n        var barplot = svg.select('g.mg-barplot');\n        var fresh_render = barplot.empty();\n        var bars;\n        var predictor_bars;\n        var pp, pp0;\n        var baseline_marks;\n        var perform_load_animation = fresh_render && args.animate_on_load;\n        var should_transition = perform_load_animation || args.transition_on_update;\n        var transition_duration = args.transition_duration || 1000; // draw the plot on first render\n\n        if (fresh_render) {\n          barplot = svg.append('g').classed('mg-barplot', true);\n        }\n\n        bars = barplot.selectAll('.mg-bar').data(data).enter().append('rect').classed('mg-bar', true).classed('default-bar', args.scales.hasOwnProperty('COLOR') ? false : true); // TODO - reimplement\n        // reference_accessor {}\n        // if (args.predictor_accessor) {\n        //   predictor_bars = barplot.selectAll('.mg-bar-prediction')\n        //     .data(data.filter(function(d) {\n        //       return d.hasOwnProperty(args.predictor_accessor) }));\n        //   predictor_bars.exit().remove();\n        //   predictor_bars.enter().append('rect')\n        //     .classed('mg-bar-prediction', true);\n        // }\n        // if (args.baseline_accessor) {\n        //   baseline_marks = barplot.selectAll('.mg-bar-baseline')\n        //     .data(data.filter(function(d) {\n        //       return d.hasOwnProperty(args.baseline_accessor) }));\n        //   baseline_marks.exit().remove();\n        //   baseline_marks.enter().append('line')\n        //     .classed('mg-bar-baseline', true);\n        // }\n\n        var appropriate_size; // setup transitions\n        // if (should_transition) {\n        //   bars = bars.transition()\n        //     .duration(transition_duration);\n        //   if (predictor_bars) {\n        //     predictor_bars = predictor_bars.transition()\n        //       .duration(transition_duration);\n        //   }\n        //   if (baseline_marks) {\n        //     baseline_marks = baseline_marks.transition()\n        //       .duration(transition_duration);\n        //   }\n        // }\n        //appropriate_size = args.scales.Y_ingroup.rangeBand()/1.5;\n\n        var length, width, length_type, width_type, length_coord, width_coord, length_scalefn, width_scalefn, length_scale, width_scale, length_accessor, width_accessor, length_coord_map, width_coord_map, length_map, width_map;\n        var reference_length_map, reference_length_coord_fn;\n\n        if (args.orientation == 'vertical') {\n          length = 'height';\n          width = 'width';\n          length_type = args.y_axis_type;\n          width_type = args.x_axis_type;\n          length_coord = 'y';\n          width_coord = 'x';\n          length_scalefn = length_type == 'categorical' ? args.scalefns.youtf : args.scalefns.yf;\n          width_scalefn = width_type == 'categorical' ? args.scalefns.xoutf : args.scalefns.xf;\n          length_scale = args.scales.Y;\n          width_scale = args.scales.X;\n          length_accessor = args.y_accessor;\n          width_accessor = args.x_accessor;\n\n          length_coord_map = function (d) {\n            var l;\n            l = length_scalefn(d);\n\n            if (d[length_accessor] < 0) {\n              l = length_scale(0);\n            }\n\n            return l;\n          };\n\n          length_map = function (d) {\n            return Math.abs(length_scalefn(d) - length_scale(0));\n          };\n\n          reference_length_map = function (d) {\n            return Math.abs(length_scale(d[args.reference_accessor]) - length_scale(0));\n          };\n\n          reference_length_coord_fn = function (d) {\n            return length_scale(d[args.reference_accessor]);\n          };\n        }\n\n        if (args.orientation == 'horizontal') {\n          length = 'width';\n          width = 'height';\n          length_type = args.x_axis_type;\n          width_type = args.y_axis_type;\n          length_coord = 'x';\n          width_coord = 'y';\n          length_scalefn = length_type == 'categorical' ? args.scalefns.xoutf : args.scalefns.xf;\n          width_scalefn = width_type == 'categorical' ? args.scalefns.youtf : args.scalefns.yf;\n          length_scale = args.scales.X;\n          width_scale = args.scales.Y;\n          length_accessor = args.x_accessor;\n          width_accessor = args.y_accessor;\n\n          length_coord_map = function (d) {\n            var l;\n            l = length_scale(0);\n            return l;\n          };\n\n          length_map = function (d) {\n            return Math.abs(length_scalefn(d) - length_scale(0));\n          };\n\n          reference_length_map = function (d) {\n            return Math.abs(length_scale(d[args.reference_accessor]) - length_scale(0));\n          };\n\n          reference_length_coord_fn = function (d) {\n            return length_scale(0);\n          };\n        } // if (perform_load_animation) {\n        //   bars.attr(length, 0);\n        //   if (predictor_bars) {\n        //     predictor_bars.attr(length, 0);\n        //   }\n        //   // if (baseline_marks) {\n        //   //   baseline_marks.attr({\n        //   //     x1: args.scales.X(0),\n        //   //     x2: args.scales.X(0)\n        //   //   });\n        //   // }\n        // }\n\n\n        bars.attr(length_coord, length_coord_map); // bars.attr(length_coord, 40)\n        //bars.attr(width_coord, 70)\n\n        bars.attr(width_coord, function (d) {\n          var w;\n\n          if (width_type == 'categorical') {\n            w = width_scalefn(d);\n          } else {\n            w = width_scale(0);\n\n            if (d[width_accessor] < 0) {\n              w = width_scalefn(d);\n            }\n          }\n\n          w = w - args.bar_thickness / 2;\n          return w;\n        });\n\n        if (args.scales.COLOR) {\n          bars.attr('fill', args.scalefns.colorf);\n        }\n\n        bars.attr(length, length_map).attr(width, function (d) {\n          return args.bar_thickness;\n        });\n\n        if (args.reference_accessor !== null) {\n          var reference_data = data.filter(function (d) {\n            return d.hasOwnProperty(args.reference_accessor);\n          });\n          var reference_bars = barplot.selectAll('.mg-categorical-reference').data(reference_data).enter().append('rect');\n          reference_bars.attr(length_coord, reference_length_coord_fn).attr(width_coord, function (d) {\n            return width_scalefn(d) - args.reference_thickness / 2;\n          }).attr(length, reference_length_map).attr(width, args.reference_thickness);\n        }\n\n        if (args.comparison_accessor !== null) {\n          var comparison_thickness = null;\n\n          if (args.comparison_thickness === null) {\n            comparison_thickness = args.bar_thickness / 2;\n          } else {\n            comparison_thickness = args.comparison_thickness;\n          }\n\n          var comparison_data = data.filter(function (d) {\n            return d.hasOwnProperty(args.comparison_accessor);\n          });\n          var comparison_marks = barplot.selectAll('.mg-categorical-comparison').data(comparison_data).enter().append('line');\n          comparison_marks.attr(length_coord + '1', function (d) {\n            return length_scale(d[args.comparison_accessor]);\n          }).attr(length_coord + '2', function (d) {\n            return length_scale(d[args.comparison_accessor]);\n          }).attr(width_coord + '1', function (d) {\n            return width_scalefn(d) - comparison_thickness / 2;\n          }).attr(width_coord + '2', function (d) {\n            return width_scalefn(d) + comparison_thickness / 2;\n          }).attr('stroke', 'black').attr('stroke-width', args.comparison_width);\n        } //bars.attr(width_coord, );\n        // bars.attr('width', 50);\n        // bars.attr('height', 50);\n        // bars.attr('y', function(d){\n        //   var y = args.scales.Y(0);\n        //   if (d[args.y_accessor] < 0) {\n        //     y = args.scalefns.yf(d);\n        //   }\n        //   return y;\n        // });\n        // bars.attr('x', function(d){\n        //   return 40;\n        // })\n        // bars.attr('width', function(d){\n        //   return 100;\n        // });\n        // bars.attr('height', 100);\n        // bars.attr('fill', 'black');\n        // bars.attr('x', function(d) {\n        //   var x = args.scales.X(0);\n        //   if (d[args.x_accessor] < 0) {\n        //     x = args.scalefns.xf(d);\n        //   }\n        //   return x;\n        // })\n        // TODO - reimplement.\n        // if (args.predictor_accessor) {\n        //   predictor_bars\n        //     .attr('x', args.scales.X(0))\n        //     .attr('y', function(d) {\n        //       return args.scalefns.ygroupf(d) + args.scalefns.yf(d) + args.scales.Y.rangeBand() * (7 / 16) // + pp0 * appropriate_size/(pp*2) + appropriate_size / 2;\n        //     })\n        //     .attr('height', args.scales.Y.rangeBand() / 8) //appropriate_size / pp)\n        //     .attr('width', function(d) {\n        //       return args.scales.X(d[args.predictor_accessor]) - args.scales.X(0);\n        //     });\n        // }\n        // TODO - reimplement.\n        //   if (args.baseline_accessor) {\n        //     baseline_marks\n        //       .attr('x1', function(d) {\n        //         return args.scales.X(d[args.baseline_accessor]); })\n        //       .attr('x2', function(d) {\n        //         return args.scales.X(d[args.baseline_accessor]); })\n        //       .attr('y1', function(d) {\n        //         return args.scalefns.ygroupf(d) + args.scalefns.yf(d) + args.scales.Y.rangeBand() / 4\n        //       })\n        //       .attr('y2', function(d) {\n        //         return args.scalefns.ygroupf(d) + args.scalefns.yf(d) + args.scales.Y.rangeBand() * 3 / 4\n        //       });\n        //   }\n\n\n        if (args.legend || args.color_accessor !== null && args.ygroup_accessor !== args.color_accessor) {\n          if (!args.legend_target) legend_on_graph(svg, args);else mg_targeted_legend(args);\n        }\n\n        return this;\n      };\n\n      this.markers = function () {\n        markers(args);\n        return this;\n      };\n\n      this.rollover = function () {\n        var svg = mg_get_svg_child_of(args.target);\n        var g;\n\n        if (svg.selectAll('.mg-active-datapoint-container').nodes().length === 0) {\n          mg_add_g(svg, 'mg-active-datapoint-container');\n        } //remove the old rollovers if they already exist\n\n\n        svg.selectAll('.mg-rollover-rect').remove();\n        svg.selectAll('.mg-active-datapoint').remove(); // get orientation\n\n        var length, width, length_type, width_type, length_coord, width_coord, length_scalefn, width_scalefn, length_scale, width_scale, length_accessor, width_accessor;\n        var length_coord_map, width_coord_map, length_map, width_map;\n\n        if (args.orientation == 'vertical') {\n          length = 'height';\n          width = 'width';\n          length_type = args.y_axis_type;\n          width_type = args.x_axis_type;\n          length_coord = 'y';\n          width_coord = 'x';\n          length_scalefn = length_type == 'categorical' ? args.scalefns.youtf : args.scalefns.yf;\n          width_scalefn = width_type == 'categorical' ? args.scalefns.xoutf : args.scalefns.xf;\n          length_scale = args.scales.Y;\n          width_scale = args.scales.X;\n          length_accessor = args.y_accessor;\n          width_accessor = args.x_accessor;\n\n          length_coord_map = function (d) {\n            return mg_get_plot_top(args);\n          };\n\n          length_map = function (d) {\n            return args.height - args.top - args.bottom - args.buffer * 2;\n          };\n        }\n\n        if (args.orientation == 'horizontal') {\n          length = 'width';\n          width = 'height';\n          length_type = args.x_axis_type;\n          width_type = args.y_axis_type;\n          length_coord = 'x';\n          width_coord = 'y';\n          length_scalefn = length_type == 'categorical' ? args.scalefns.xoutf : args.scalefns.xf;\n          width_scalefn = width_type == 'categorical' ? args.scalefns.youtf : args.scalefns.yf;\n          length_scale = args.scales.X;\n          width_scale = args.scales.Y;\n          length_accessor = args.x_accessor;\n          width_accessor = args.y_accessor;\n\n          length_coord_map = function (d) {\n            var l;\n            l = length_scale(0);\n            return l;\n          };\n\n          length_map = function (d) {\n            return args.width - args.left - args.right - args.buffer * 2;\n          };\n        } //rollover text\n\n\n        var rollover_x, rollover_anchor;\n\n        if (args.rollover_align === 'right') {\n          rollover_x = args.width - args.right;\n          rollover_anchor = 'end';\n        } else if (args.rollover_align === 'left') {\n          rollover_x = args.left;\n          rollover_anchor = 'start';\n        } else {\n          rollover_x = (args.width - args.left - args.right) / 2 + args.left;\n          rollover_anchor = 'middle';\n        }\n\n        svg.append('text').attr('class', 'mg-active-datapoint').attr('xml:space', 'preserve').attr('x', rollover_x).attr('y', args.top * 0.75).attr('dy', '.35em').attr('text-anchor', rollover_anchor);\n        g = svg.append('g').attr('class', 'mg-rollover-rect'); //draw rollover bars\n\n        var bars = g.selectAll(\".mg-bar-rollover\").data(args.data[0]).enter().append(\"rect\").attr('class', 'mg-bar-rollover');\n        bars.attr('opacity', 0).attr(length_coord, length_coord_map).attr(width_coord, function (d) {\n          var w;\n\n          if (width_type == 'categorical') {\n            w = width_scalefn(d);\n          } else {\n            w = width_scale(0);\n\n            if (d[width_accessor] < 0) {\n              w = width_scalefn(d);\n            }\n          }\n\n          w = w - args.bar_thickness / 2;\n          return w;\n        });\n        bars.attr(length, length_map);\n        bars.attr(width, function (d) {\n          return args.bar_thickness;\n        });\n        bars.on('mouseover', this.rolloverOn(args)).on('mouseout', this.rolloverOff(args)).on('mousemove', this.rolloverMove(args));\n        return this;\n      };\n\n      this.rolloverOn = function (args) {\n        var svg = mg_get_svg_child_of(args.target);\n        var label_accessor = this.is_vertical ? args.x_accessor : args.y_accessor;\n        var data_accessor = this.is_vertical ? args.y_accessor : args.x_accessor;\n        var label_units = this.is_vertical ? args.yax_units : args.xax_units;\n        return function (d, i) {\n          var fmt = MG.time_format(args.utc_time, '%b %e, %Y');\n          var num = format_rollover_number(args); //highlight active bar\n\n          var bar = svg.selectAll('g.mg-barplot .mg-bar').filter(function (d, j) {\n            return j === i;\n          }).classed('active', true);\n\n          if (args.scales.hasOwnProperty('COLOR')) {\n            bar.attr('fill', d3.rgb(args.scalefns.colorf(d)).darker());\n          } else {\n            bar.classed('default-active', true);\n          } //update rollover text\n\n\n          if (args.show_rollover_text) {\n            var mouseover = mg_mouseover_text(args, {\n              svg: svg\n            });\n            var row = mouseover.mouseover_row();\n            if (args.ygroup_accessor) row.text(d[args.ygroup_accessor] + '   ').bold();\n            row.text(mg_format_x_mouseover(args, d));\n            row.text(args.y_accessor + ': ' + d[args.y_accessor]);\n\n            if (args.predictor_accessor || args.baseline_accessor) {\n              row = mouseover.mouseover_row();\n              if (args.predictor_accessor) row.text(mg_format_data_for_mouseover(args, d, null, args.predictor_accessor, false));\n              if (args.baseline_accessor) row.text(mg_format_data_for_mouseover(args, d, null, args.baseline_accessor, false));\n            }\n          }\n\n          if (args.mouseover) {\n            args.mouseover(d, i);\n          }\n        };\n      };\n\n      this.rolloverOff = function (args) {\n        var svg = mg_get_svg_child_of(args.target);\n        return function (d, i) {\n          //reset active bar\n          var bar = svg.selectAll('g.mg-barplot .mg-bar.active').classed('active', false);\n\n          if (args.scales.hasOwnProperty('COLOR')) {\n            bar.attr('fill', args.scalefns.colorf(d));\n          } else {\n            bar.classed('default-active', false);\n          } //reset active data point text\n\n\n          svg.select('.mg-active-datapoint').text('');\n          mg_clear_mouseover_container(svg);\n\n          if (args.mouseout) {\n            args.mouseout(d, i);\n          }\n        };\n      };\n\n      this.rolloverMove = function (args) {\n        return function (d, i) {\n          if (args.mousemove) {\n            args.mousemove(d, i);\n          }\n        };\n      };\n\n      this.windowListeners = function () {\n        mg_window_listeners(this.args);\n        return this;\n      };\n\n      this.init(args);\n    }\n\n    var defaults = {\n      y_padding_percentage: 0.05,\n      // for categorical scales\n      y_outer_padding_percentage: .2,\n      // for categorical scales\n      ygroup_padding_percentage: 0,\n      // for categorical scales\n      ygroup_outer_padding_percentage: 0,\n      // for categorical scales\n      x_padding_percentage: 0.05,\n      // for categorical scales\n      x_outer_padding_percentage: .2,\n      // for categorical scales\n      xgroup_padding_percentage: 0,\n      // for categorical scales\n      xgroup_outer_padding_percentage: 0,\n      // for categorical scales\n      buffer: 16,\n      y_accessor: 'factor',\n      x_accessor: 'value',\n      reference_accessor: null,\n      comparison_accessor: null,\n      secondary_label_accessor: null,\n      color_accessor: null,\n      color_type: 'category',\n      color_domain: null,\n      reference_thickness: 1,\n      comparison_width: 3,\n      comparison_thickness: null,\n      legend: false,\n      legend_target: null,\n      mouseover_align: 'right',\n      baseline_accessor: null,\n      predictor_accessor: null,\n      predictor_proportion: 5,\n      show_bar_zero: true,\n      binned: true,\n      truncate_x_labels: true,\n      truncate_y_labels: true\n    };\n    MG.register('bar', barChart, defaults);\n  }).call(this);\n  /*\n  Data Tables\n  \n  Along with histograms, bars, lines, and scatters, a simple data table can take you far.\n  We often just want to look at numbers, organized as a table, where columns are variables,\n  and rows are data points. Sometimes we want a cell to have a small graphic as the main\n  column element, in which case we want small multiples. sometimes we want to\n  \n  var table = New data_table(data)\n          .target('div#data-table')\n          .title({accessor: 'point_name', align: 'left'})\n          .description({accessor: 'description'})\n          .number({accessor: ''})\n  \n  */\n\n  MG.data_table = function (args) {\n    'use strict';\n\n    this.args = args;\n    this.args.standard_col = {\n      width: 150,\n      font_size: 12,\n      font_weight: 'normal'\n    };\n    this.args.columns = [];\n    this.formatting_options = [['color', 'color'], ['font-weight', 'font_weight'], ['font-style', 'font_style'], ['font-size', 'font_size']];\n\n    this._strip_punctuation = function (s) {\n      var punctuationless = s.replace(/[^a-zA-Z0-9 _]+/g, '');\n      var finalString = punctuationless.replace(/ +?/g, '');\n      return finalString;\n    };\n\n    this._format_element = function (element, value, args) {\n      this.formatting_options.forEach(function (fo) {\n        var attr = fo[0];\n        var key = fo[1];\n        if (args[key]) element.style(attr, typeof args[key] === 'string' || typeof args[key] === 'number' ? args[key] : args[key](value));\n      });\n    };\n\n    this._add_column = function (_args, arg_type) {\n      var standard_column = this.args.standard_col;\n      var args = merge_with_defaults(MG.clone(_args), MG.clone(standard_column));\n      args.type = arg_type;\n      this.args.columns.push(args);\n    };\n\n    this.target = function () {\n      var target = arguments[0];\n      this.args.target = target;\n      return this;\n    };\n\n    this.title = function () {\n      this._add_column(arguments[0], 'title');\n\n      return this;\n    };\n\n    this.text = function () {\n      this._add_column(arguments[0], 'text');\n\n      return this;\n    };\n\n    this.bullet = function () {\n      /*\n      text label\n      main value\n      comparative measure\n      any number of ranges\n       additional args:\n      no title\n      xmin, xmax\n      format: percentage\n      xax_formatter\n      */\n      return this;\n    };\n\n    this.sparkline = function () {\n      return this;\n    };\n\n    this.number = function () {\n      this._add_column(arguments[0], 'number');\n\n      return this;\n    };\n\n    this.display = function () {\n      var args = this.args;\n      chart_title(args);\n      var target = args.target;\n      var table = d3.select(target).append('table').classed('mg-data-table', true);\n      var colgroup = table.append('colgroup');\n      var thead = table.append('thead');\n      var tbody = table.append('tbody');\n      var this_column;\n      var this_title;\n      var tr, th, td_accessor, td_type, td_value, th_text, td_text, td;\n      var col;\n      var h;\n      tr = thead.append('tr');\n\n      for (h = 0; h < args.columns.length; h++) {\n        var this_col = args.columns[h];\n        td_type = this_col.type;\n        th_text = this_col.label;\n        th_text = th_text === undefined ? '' : th_text;\n        th = tr.append('th').style('width', this_col.width).style('text-align', td_type === 'title' ? 'left' : 'right').text(th_text);\n\n        if (args.show_tooltips && this_col.description && mg_jquery_exists()) {\n          th.append('i').classed('fa', true).classed('fa-question-circle', true).classed('fa-inverse', true);\n          $(th.node()).popover({\n            html: true,\n            animation: false,\n            content: this_col.description,\n            trigger: 'hover',\n            placement: 'top',\n            container: $(th.node())\n          });\n        }\n      }\n\n      for (h = 0; h < args.columns.length; h++) {\n        col = colgroup.append('col');\n\n        if (args.columns[h].type === 'number') {\n          col.attr('align', 'char').attr('char', '.');\n        }\n      }\n\n      for (var i = 0; i < args.data.length; i++) {\n        tr = tbody.append('tr');\n\n        for (var j = 0; j < args.columns.length; j++) {\n          this_column = args.columns[j];\n          td_accessor = this_column.accessor;\n          td_value = td_text = args.data[i][td_accessor];\n          td_type = this_column.type;\n\n          if (td_type === 'number') {\n            //td_text may need to be rounded\n            if (this_column.hasOwnProperty('round') && !this_column.hasOwnProperty('format')) {\n              // round according to the number value in this_column.round\n              td_text = d3.format('0,.' + this_column.round + 'f')(td_text);\n            }\n\n            if (this_column.hasOwnProperty('value_formatter')) {\n              // provide a function that formats the text according to the function this_column.format.\n              td_text = this_column.value_formatter(td_text);\n            }\n\n            if (this_column.hasOwnProperty('format')) {\n              // this is a shorthand for percentage formatting, and others if need be.\n              // supported: 'percentage', 'count', 'temperature'\n              if (this_column.round) {\n                td_text = Math.round(td_text, this_column.round);\n              }\n\n              var this_format = this_column.format;\n              var formatter;\n              if (this_format === 'percentage') formatter = d3.format('.0%');\n              if (this_format === 'count') formatter = d3.format(',.0f');\n              if (this_format === 'temperature') formatter = function (t) {\n                return t + '°';\n              };\n              td_text = formatter(td_text);\n            }\n\n            if (this_column.hasOwnProperty('currency')) {\n              // this is another shorthand for formatting according to a currency amount, which gets appended to front of number\n              td_text = this_column.currency + td_text;\n            }\n          }\n\n          td = tr.append('td').classed('table-' + td_type, true).classed('table-' + td_type + '-' + this._strip_punctuation(td_accessor), true).attr('data-value', td_value).style('width', this_column.width).style('text-align', td_type === 'title' || td_type === 'text' ? 'left' : 'right');\n\n          this._format_element(td, td_value, this_column);\n\n          if (td_type === 'title') {\n            this_title = td.append('div').text(td_text);\n\n            this._format_element(this_title, td_text, this_column);\n\n            if (args.columns[j].hasOwnProperty('secondary_accessor')) {\n              td.append('div').text(args.data[i][args.columns[j].secondary_accessor]).classed(\"secondary-title\", true);\n            }\n          } else {\n            td.text(td_text);\n          }\n        }\n      }\n\n      return this;\n    };\n\n    return this;\n  };\n\n  (function () {\n    'use strict';\n\n    function mg_missing_add_text(svg, args) {\n      svg.selectAll('.mg-missing-text').data([args.missing_text]).enter().append('text').attr('class', 'mg-missing-text').attr('x', args.width / 2).attr('y', args.height / 2).attr('dy', '.50em').attr('text-anchor', 'middle').text(args.missing_text);\n    }\n\n    function mg_missing_x_scale(args) {\n      args.scales.X = d3.scaleLinear().domain([0, args.data.length]).range([mg_get_plot_left(args), mg_get_plot_right(args)]);\n\n      args.scalefns.yf = function (di) {\n        return args.scales.Y(di.y);\n      };\n    }\n\n    function mg_missing_y_scale(args) {\n      args.scales.Y = d3.scaleLinear().domain([-2, 2]).range([args.height - args.bottom - args.buffer * 2, args.top]);\n\n      args.scalefns.xf = function (di) {\n        return args.scales.X(di.x);\n      };\n    }\n\n    function mg_make_fake_data(args) {\n      var data = [];\n\n      for (var x = 1; x <= 50; x++) {\n        data.push({\n          'x': x,\n          'y': Math.random() - x * 0.03\n        });\n      }\n\n      args.data = data;\n    }\n\n    function mg_add_missing_background_rect(g, args) {\n      g.append('svg:rect').classed('mg-missing-background', true).attr('x', args.buffer).attr('y', args.buffer + args.title_y_position * 2).attr('width', args.width - args.buffer * 2).attr('height', args.height - args.buffer * 2 - args.title_y_position * 2).attr('rx', 15).attr('ry', 15);\n    }\n\n    function mg_missing_add_line(g, args) {\n      var line = d3.line().x(args.scalefns.xf).y(args.scalefns.yf).curve(args.interpolate);\n      g.append('path').attr('class', 'mg-main-line mg-line1-color').attr('d', line(args.data));\n    }\n\n    function mg_missing_add_area(g, args) {\n      var area = d3.area().x(args.scalefns.xf).y0(args.scales.Y.range()[0]).y1(args.scalefns.yf).curve(args.interpolate);\n      g.append('path').attr('class', 'mg-main-area mg-area1-color').attr('d', area(args.data));\n    }\n\n    function mg_remove_all_children(args) {\n      d3.select(args.target).selectAll('svg *').remove();\n    }\n\n    function mg_missing_remove_legend(args) {\n      if (args.legend_target) {\n        d3.select(args.legend_target).html('');\n      }\n    }\n\n    function missingData(args) {\n      this.init = function (args) {\n        this.args = args;\n        mg_init_compute_width(args);\n        mg_init_compute_height(args); // create svg if one doesn't exist\n\n        var container = d3.select(args.target);\n        mg_raise_container_error(container, args);\n        var svg = container.selectAll('svg');\n        mg_remove_svg_if_chart_type_has_changed(svg, args);\n        svg = mg_add_svg_if_it_doesnt_exist(svg, args);\n        mg_adjust_width_and_height_if_changed(svg, args);\n        mg_set_viewbox_for_scaling(svg, args);\n        mg_remove_all_children(args);\n        svg.classed('mg-missing', true);\n        mg_missing_remove_legend(args);\n        chart_title(args); // are we adding a background placeholder\n\n        if (args.show_missing_background) {\n          mg_make_fake_data(args);\n          mg_missing_x_scale(args);\n          mg_missing_y_scale(args);\n          var g = mg_add_g(svg, 'mg-missing-pane');\n          mg_add_missing_background_rect(g, args);\n          mg_missing_add_line(g, args);\n          mg_missing_add_area(g, args);\n        }\n\n        mg_missing_add_text(svg, args);\n        this.windowListeners();\n        return this;\n      };\n\n      this.windowListeners = function () {\n        mg_window_listeners(this.args);\n        return this;\n      };\n\n      this.init(args);\n    }\n\n    var defaults = {\n      top: 40,\n      // the size of the top margin\n      bottom: 30,\n      // the size of the bottom margin\n      right: 10,\n      // size of the right margin\n      left: 0,\n      // size of the left margin\n      buffer: 8,\n      // the buffer between the actual chart area and the margins\n      legend_target: '',\n      width: 350,\n      height: 220,\n      missing_text: 'Data currently missing or unavailable',\n      scalefns: {},\n      scales: {},\n      show_tooltips: true,\n      show_missing_background: true\n    };\n    MG.register('missing-data', missingData, defaults);\n  }).call(this);\n\n  function mg_process_scale_ticks(args, axis) {\n    var accessor;\n    var scale_ticks;\n    var max;\n\n    if (axis === 'x') {\n      accessor = args.x_accessor;\n      scale_ticks = args.scales.X.ticks(args.xax_count);\n      max = args.processed.max_x;\n    } else if (axis === 'y') {\n      accessor = args.y_accessor;\n      scale_ticks = args.scales.Y.ticks(args.yax_count);\n      max = args.processed.max_y;\n    }\n\n    function log10(val) {\n      if (val === 1000) {\n        return 3;\n      }\n\n      if (val === 1000000) {\n        return 7;\n      }\n\n      return Math.log(val) / Math.LN10;\n    }\n\n    if (axis === 'x' && args.x_scale_type === 'log' || axis === 'y' && args.y_scale_type === 'log') {\n      // get out only whole logs\n      scale_ticks = scale_ticks.filter(function (d) {\n        return Math.abs(log10(d)) % 1 < 1e-6 || Math.abs(log10(d)) % 1 > 1 - 1e-6;\n      });\n    } // filter out fraction ticks if our data is ints and if xmax > number of generated ticks\n\n\n    var number_of_ticks = scale_ticks.length; // is our data object all ints?\n\n    var data_is_int = true;\n    args.data.forEach(function (d, i) {\n      d.forEach(function (d, i) {\n        if (d[accessor] % 1 !== 0) {\n          data_is_int = false;\n          return false;\n        }\n      });\n    });\n\n    if (data_is_int && number_of_ticks > max && args.format === 'count') {\n      // remove non-integer ticks\n      scale_ticks = scale_ticks.filter(function (d) {\n        return d % 1 === 0;\n      });\n    }\n\n    if (axis === 'x') {\n      args.processed.x_ticks = scale_ticks;\n    } else if (axis === 'y') {\n      args.processed.y_ticks = scale_ticks;\n    }\n  }\n\n  function raw_data_transformation(args) {\n    'use strict'; // dupe our data so we can modify it without adverse effect\n\n    args.data = MG.clone(args.data); // we need to account for a few data format cases:\n    // #0 {bar1:___, bar2:___}                                    // single object (for, say, bar charts)\n    // #1 [{key:__, value:__}, ...]                               // unnested obj-arrays\n    // #2 [[{key:__, value:__}, ...], [{key:__, value:__}, ...]]  // nested obj-arrays\n    // #3 [[4323, 2343],..]                                       // unnested 2d array\n    // #4 [[[4323, 2343],..] , [[4323, 2343],..]]                 // nested 2d array\n\n    args.single_object = false; // for bar charts.\n\n    args.array_of_objects = false;\n    args.array_of_arrays = false;\n    args.nested_array_of_arrays = false;\n    args.nested_array_of_objects = false; // is the data object a nested array?\n\n    if (is_array_of_arrays(args.data)) {\n      args.nested_array_of_objects = args.data.map(function (d) {\n        return is_array_of_objects_or_empty(d);\n      }); // Case #2\n\n      args.nested_array_of_arrays = args.data.map(function (d) {\n        return is_array_of_arrays(d);\n      }); // Case #4\n    } else {\n      args.array_of_objects = is_array_of_objects(args.data); // Case #1\n\n      args.array_of_arrays = is_array_of_arrays(args.data); // Case #3\n    }\n\n    if (args.chart_type === 'line') {\n      if (args.array_of_objects || args.array_of_arrays) {\n        args.data = [args.data];\n      }\n    } else {\n      if (!mg_is_array(args.data[0])) {\n        args.data = [args.data];\n      }\n    } // if the y_accessor is an array, break it up and store the result in args.data\n\n\n    mg_process_multiple_x_accessors(args);\n    mg_process_multiple_y_accessors(args); // if user supplies keyword in args.color, change to arg.colors.\n    // this is so that the API remains fairly sensible and legible.\n\n    if (args.color !== undefined) {\n      args.colors = args.color;\n    } // if user has supplied args.colors, and that value is a string, turn it into an array.\n\n\n    if (args.colors !== null && typeof args.colors === 'string') {\n      args.colors = [args.colors];\n    } // sort x-axis data\n\n\n    if (args.chart_type === 'line' && args.x_sort === true) {\n      for (var i = 0; i < args.data.length; i++) {\n        args.data[i].sort(function (a, b) {\n          return a[args.x_accessor] - b[args.x_accessor];\n        });\n      }\n    }\n\n    return this;\n  }\n\n  function mg_process_multiple_accessors(args, which_accessor) {\n    // turns an array of accessors into ...\n    if (mg_is_array(args[which_accessor])) {\n      args.data = args.data.map(function (_d) {\n        return args[which_accessor].map(function (ya) {\n          return _d.map(function (di) {\n            di = MG.clone(di);\n\n            if (di[ya] === undefined) {\n              return undefined;\n            }\n\n            di['multiline_' + which_accessor] = di[ya];\n            return di;\n          }).filter(function (di) {\n            return di !== undefined;\n          });\n        });\n      })[0];\n      args[which_accessor] = 'multiline_' + which_accessor;\n    }\n  }\n\n  function mg_process_multiple_x_accessors(args) {\n    mg_process_multiple_accessors(args, 'x_accessor');\n  }\n\n  function mg_process_multiple_y_accessors(args) {\n    mg_process_multiple_accessors(args, 'y_accessor');\n  }\n\n  MG.raw_data_transformation = raw_data_transformation;\n\n  function process_line(args) {\n    'use strict';\n\n    var time_frame; // do we have a time-series?\n\n    var is_time_series = d3.sum(args.data.map(function (series) {\n      return series.length > 0 && mg_is_date(series[0][args.x_accessor]);\n    })) > 0; // are we replacing missing y values with zeros?\n\n    if ((args.missing_is_zero || args.missing_is_hidden) && args.chart_type === 'line' && is_time_series) {\n      for (var i = 0; i < args.data.length; i++) {\n        // we need to have a dataset of length > 2, so if it's less than that, skip\n        if (args.data[i].length <= 1) {\n          continue;\n        }\n\n        var first = args.data[i][0];\n        var last = args.data[i][args.data[i].length - 1]; // initialize our new array for storing the processed data\n\n        var processed_data = []; // we'll be starting from the day after our first date\n\n        var start_date = MG.clone(first[args.x_accessor]).setDate(first[args.x_accessor].getDate() + 1); // if we've set a max_x, add data points up to there\n\n        var from = args.min_x ? args.min_x : start_date;\n        var upto = args.max_x ? args.max_x : last[args.x_accessor];\n        time_frame = mg_get_time_frame((upto - from) / 1000);\n\n        if (['four-days', 'many-days', 'many-months', 'years', 'default'].indexOf(time_frame) !== -1 && args.missing_is_hidden_accessor === null) {\n          for (var d = new Date(from); d <= upto; d.setDate(d.getDate() + 1)) {\n            var o = {};\n            d.setHours(0, 0, 0, 0); // add the first date item, we'll be starting from the day after our first date\n\n            if (Date.parse(d) === Date.parse(new Date(start_date))) {\n              processed_data.push(MG.clone(args.data[i][0]));\n            } // check to see if we already have this date in our data object\n\n\n            var existing_o = null;\n            args.data[i].forEach(function (val, i) {\n              if (Date.parse(val[args.x_accessor]) === Date.parse(new Date(d))) {\n                existing_o = val;\n                return false;\n              }\n            }); // if we don't have this date in our data object, add it and set it to zero\n\n            if (!existing_o) {\n              o[args.x_accessor] = new Date(d);\n              o[args.y_accessor] = 0;\n              o['_missing'] = true; //we want to distinguish between zero-value and missing observations\n\n              processed_data.push(o);\n            } // if the data point has, say, a 'missing' attribute set or if its\n            // y-value is null identify it internally as missing\n            else if (existing_o[args.missing_is_hidden_accessor] || existing_o[args.y_accessor] === null) {\n                existing_o['_missing'] = true;\n                processed_data.push(existing_o);\n              } //otherwise, use the existing object for that date\n              else {\n                  processed_data.push(existing_o);\n                }\n          }\n        } else {\n          for (var j = 0; j < args.data[i].length; j += 1) {\n            var obj = MG.clone(args.data[i][j]);\n            obj['_missing'] = args.data[i][j][args.missing_is_hidden_accessor];\n            processed_data.push(obj);\n          }\n        } // update our date object\n\n\n        args.data[i] = processed_data;\n      }\n    }\n\n    return this;\n  }\n\n  MG.process_line = process_line;\n\n  function process_histogram(args) {\n    'use strict'; // if args.binned == false, then we need to bin the data appropriately.\n    // if args.binned == true, then we need to make sure to compute the relevant computed data.\n    // the outcome of either of these should be something in args.computed_data.\n    // the histogram plotting function will be looking there for the data to plot.\n    // we need to compute an array of objects.\n    // each object has an x, y, and dx.\n    // histogram data is always single dimension\n\n    var our_data = args.data[0];\n    var extracted_data;\n\n    if (args.binned === false) {\n      // use d3's built-in layout.histogram functionality to compute what you need.\n      if (typeof our_data[0] === 'object') {\n        // we are dealing with an array of objects. Extract the data value of interest.\n        extracted_data = our_data.map(function (d) {\n          return d[args.x_accessor];\n        });\n      } else if (typeof our_data[0] === 'number') {\n        // we are dealing with a simple array of numbers. No extraction needed.\n        extracted_data = our_data;\n      } else {\n        console.log('TypeError: expected an array of numbers, found ' + typeof our_data[0]);\n        return;\n      }\n\n      var hist = d3.histogram();\n\n      if (args.bins) {\n        hist.thresholds(args.bins);\n      }\n\n      var bins = hist(extracted_data);\n      args.processed_data = bins.map(function (d) {\n        return {\n          'x': d.x0,\n          'y': d.length\n        };\n      });\n    } else {\n      // here, we just need to reconstruct the array of objects\n      // take the x accessor and y accessor.\n      // pull the data as x and y. y is count.\n      args.processed_data = our_data.map(function (d) {\n        return {\n          'x': d[args.x_accessor],\n          'y': d[args.y_accessor]\n        };\n      });\n      var this_pt;\n      var next_pt; // we still need to compute the dx component for each data point\n\n      for (var i = 0; i < args.processed_data.length; i++) {\n        this_pt = args.processed_data[i];\n\n        if (i === args.processed_data.length - 1) {\n          this_pt.dx = args.processed_data[i - 1].dx;\n        } else {\n          next_pt = args.processed_data[i + 1];\n          this_pt.dx = next_pt.x - this_pt.x;\n        }\n      }\n    } // capture the original data and accessors before replacing args.data\n\n\n    if (!args.processed) {\n      args.processed = {};\n    }\n\n    args.processed.original_data = args.data;\n    args.processed.original_x_accessor = args.x_accessor;\n    args.processed.original_y_accessor = args.y_accessor;\n    args.data = [args.processed_data];\n    args.x_accessor = args.processed_x_accessor;\n    args.y_accessor = args.processed_y_accessor;\n    return this;\n  }\n\n  MG.process_histogram = process_histogram; // for use with bar charts, etc.\n\n  function process_categorical_variables(args) {\n    'use strict';\n\n    var extracted_data,\n        processed_data = {},\n        pd = []; //var our_data = args.data[0];\n\n    var label_accessor = args.bar_orientation === 'vertical' ? args.x_accessor : args.y_accessor;\n    var data_accessor = args.bar_orientation === 'vertical' ? args.y_accessor : args.x_accessor;\n    return this;\n  }\n\n  MG.process_categorical_variables = process_categorical_variables;\n\n  function process_point(args) {\n    'use strict';\n\n    var data = args.data[0];\n    var x = data.map(function (d) {\n      return d[args.x_accessor];\n    });\n    var y = data.map(function (d) {\n      return d[args.y_accessor];\n    });\n\n    if (args.least_squares) {\n      args.ls_line = least_squares(x, y);\n    }\n\n    return this;\n  }\n\n  MG.process_point = process_point;\n\n  function add_ls(args) {\n    var svg = mg_get_svg_child_of(args.target);\n    var data = args.data[0];\n    var min_x = d3.min(data, function (d) {\n      return d[args.x_accessor];\n    });\n    var max_x = d3.max(data, function (d) {\n      return d[args.x_accessor];\n    });\n    d3.select(args.target).selectAll('.mg-least-squares-line').remove();\n    svg.append('svg:line').attr('x1', args.scales.X(min_x)).attr('x2', args.scales.X(max_x)).attr('y1', args.scales.Y(args.ls_line.fit(min_x))).attr('y2', args.scales.Y(args.ls_line.fit(max_x))).attr('class', 'mg-least-squares-line');\n  }\n\n  MG.add_ls = add_ls;\n\n  function add_lowess(args) {\n    var svg = mg_get_svg_child_of(args.target);\n    var lowess = args.lowess_line;\n    var line = d3.svg.line().x(function (d) {\n      return args.scales.X(d.x);\n    }).y(function (d) {\n      return args.scales.Y(d.y);\n    }).interpolate(args.interpolate);\n    svg.append('path').attr('d', line(lowess)).attr('class', 'mg-lowess-line');\n  }\n\n  MG.add_lowess = add_lowess;\n\n  function lowess_robust(x, y, alpha, inc) {\n    // Used http://www.unc.edu/courses/2007spring/biol/145/001/docs/lectures/Oct27.html\n    // for the clear explanation of robust lowess.\n    // calculate the the first pass.\n    var _l;\n\n    var r = [];\n    var yhat = d3.mean(y);\n    var i;\n\n    for (i = 0; i < x.length; i += 1) {\n      r.push(1);\n    }\n\n    _l = _calculate_lowess_fit(x, y, alpha, inc, r);\n    var x_proto = _l.x;\n    var y_proto = _l.y; // Now, take the fit, recalculate the weights, and re-run LOWESS using r*w instead of w.\n\n    for (i = 0; i < 100; i += 1) {\n      r = d3.zip(y_proto, y).map(function (yi) {\n        return Math.abs(yi[1] - yi[0]);\n      });\n      var q = d3.quantile(r.sort(), 0.5);\n      r = r.map(function (ri) {\n        return _bisquare_weight(ri / (6 * q));\n      });\n      _l = _calculate_lowess_fit(x, y, alpha, inc, r);\n      x_proto = _l.x;\n      y_proto = _l.y;\n    }\n\n    return d3.zip(x_proto, y_proto).map(function (d) {\n      var p = {};\n      p.x = d[0];\n      p.y = d[1];\n      return p;\n    });\n  }\n\n  MG.lowess_robust = lowess_robust;\n\n  function lowess(x, y, alpha, inc) {\n    var r = [];\n\n    for (var i = 0; i < x.length; i += 1) {\n      r.push(1);\n    }\n\n    var _l = _calculate_lowess_fit(x, y, alpha, inc, r);\n  }\n\n  MG.lowess = lowess;\n\n  function least_squares(x_, y_) {\n    var x,\n        y,\n        xi,\n        yi,\n        _x = 0,\n        _y = 0,\n        _xy = 0,\n        _xx = 0;\n    var n = x_.length;\n\n    if (mg_is_date(x_[0])) {\n      x = x_.map(function (d) {\n        return d.getTime();\n      });\n    } else {\n      x = x_;\n    }\n\n    if (mg_is_date(y_[0])) {\n      y = y_.map(function (d) {\n        return d.getTime();\n      });\n    } else {\n      y = y_;\n    }\n\n    var xhat = d3.mean(x);\n    var yhat = d3.mean(y);\n    var numerator = 0,\n        denominator = 0;\n\n    for (var i = 0; i < x.length; i++) {\n      xi = x[i];\n      yi = y[i];\n      numerator += (xi - xhat) * (yi - yhat);\n      denominator += (xi - xhat) * (xi - xhat);\n    }\n\n    var beta = numerator / denominator;\n    var x0 = yhat - beta * xhat;\n    return {\n      x0: x0,\n      beta: beta,\n      fit: function (x) {\n        return x0 + x * beta;\n      }\n    };\n  }\n\n  MG.least_squares = least_squares;\n\n  function _pow_weight(u, w) {\n    if (u >= 0 && u <= 1) {\n      return Math.pow(1 - Math.pow(u, w), w);\n    } else {\n      return 0;\n    }\n  }\n\n  function _bisquare_weight(u) {\n    return _pow_weight(u, 2);\n  }\n\n  function _tricube_weight(u) {\n    return _pow_weight(u, 3);\n  }\n\n  function _neighborhood_width(x0, xis) {\n    return Array.max(xis.map(function (xi) {\n      return Math.abs(x0 - xi);\n    }));\n  }\n\n  function _manhattan(x1, x2) {\n    return Math.abs(x1 - x2);\n  }\n\n  function _weighted_means(wxy) {\n    var wsum = d3.sum(wxy.map(function (wxyi) {\n      return wxyi.w;\n    }));\n    return {\n      xbar: d3.sum(wxy.map(function (wxyi) {\n        return wxyi.w * wxyi.x;\n      })) / wsum,\n      ybar: d3.sum(wxy.map(function (wxyi) {\n        return wxyi.w * wxyi.y;\n      })) / wsum\n    };\n  }\n\n  function _weighted_beta(wxy, xbar, ybar) {\n    var num = d3.sum(wxy.map(function (wxyi) {\n      return Math.pow(wxyi.w, 2) * (wxyi.x - xbar) * (wxyi.y - ybar);\n    }));\n    var denom = d3.sum(wxy.map(function (wxyi) {\n      return Math.pow(wxyi.w, 2) * Math.pow(wxyi.x - xbar, 2);\n    }));\n    return num / denom;\n  }\n\n  function _weighted_least_squares(wxy) {\n    var ybar, xbar, beta_i, x0;\n\n    var _wm = _weighted_means(wxy);\n\n    xbar = _wm.xbar;\n    ybar = _wm.ybar;\n\n    var beta = _weighted_beta(wxy, xbar, ybar);\n\n    return {\n      beta: beta,\n      xbar: xbar,\n      ybar: ybar,\n      x0: ybar - beta * xbar\n    };\n  }\n\n  function _calculate_lowess_fit(x, y, alpha, inc, residuals) {\n    // alpha - smoothing factor. 0 < alpha < 1/\n    //\n    //\n    var k = Math.floor(x.length * alpha);\n    var sorted_x = x.slice();\n    sorted_x.sort(function (a, b) {\n      if (a < b) {\n        return -1;\n      } else if (a > b) {\n        return 1;\n      }\n\n      return 0;\n    });\n    var x_max = d3.quantile(sorted_x, 0.98);\n    var x_min = d3.quantile(sorted_x, 0.02);\n    var xy = d3.zip(x, y, residuals).sort();\n    var size = Math.abs(x_max - x_min) / inc;\n    var smallest = x_min;\n    var largest = x_max;\n    var x_proto = d3.range(smallest, largest, size);\n    var xi_neighbors;\n    var x_i, beta_i, x0_i, delta_i, xbar, ybar; // for each prototype, find its fit.\n\n    var y_proto = [];\n\n    for (var i = 0; i < x_proto.length; i += 1) {\n      x_i = x_proto[i]; // get k closest neighbors.\n\n      xi_neighbors = xy.map(function (xyi) {\n        return [Math.abs(xyi[0] - x_i), xyi[0], xyi[1], xyi[2]];\n      }).sort().slice(0, k); // Get the largest distance in the neighbor set.\n\n      delta_i = d3.max(xi_neighbors)[0]; // Prepare the weights for mean calculation and WLS.\n\n      xi_neighbors = xi_neighbors.map(function (wxy) {\n        return {\n          w: _tricube_weight(wxy[0] / delta_i) * wxy[3],\n          x: wxy[1],\n          y: wxy[2]\n        };\n      }); // Find the weighted least squares, obviously.\n\n      var _output = _weighted_least_squares(xi_neighbors);\n\n      x0_i = _output.x0;\n      beta_i = _output.beta; //\n\n      y_proto.push(x0_i + beta_i * x_i);\n    }\n\n    return {\n      x: x_proto,\n      y: y_proto\n    };\n  }\n\n  function format_rollover_number(args) {\n    var num;\n\n    if (args.format === 'count') {\n      num = function (d) {\n        var is_float = d % 1 !== 0;\n        var pf;\n\n        if (is_float) {\n          pf = d3.format(',.' + args.decimals + 'f');\n        } else {\n          pf = d3.format(',.0f');\n        } // are we adding units after the value or before?\n\n\n        if (args.yax_units_append) {\n          return pf(d) + args.yax_units;\n        } else {\n          return args.yax_units + pf(d);\n        }\n      };\n    } else {\n      num = function (d_) {\n        var fmt_string = (args.decimals ? '.' + args.decimals : '') + '%';\n        var pf = d3.format(fmt_string);\n        return pf(d_);\n      };\n    }\n\n    return num;\n  }\n\n  var time_rollover_format = function (f, d, accessor, utc) {\n    var fd;\n\n    if (typeof f === 'string') {\n      fd = MG.time_format(utc, f)(d[accessor]);\n    } else if (typeof f === 'function') {\n      fd = f(d);\n    } else {\n      fd = d[accessor];\n    }\n\n    return fd;\n  }; // define our rollover format for numbers\n\n\n  var number_rollover_format = function (f, d, accessor) {\n    var fd;\n\n    if (typeof f === 'string') {\n      fd = d3.format('s')(d[accessor]);\n    } else if (typeof f === 'function') {\n      fd = f(d);\n    } else {\n      fd = d[accessor];\n    }\n\n    return fd;\n  };\n\n  function mg_format_y_rollover(args, num, d) {\n    var formatted_y;\n\n    if (args.y_mouseover !== null) {\n      if (args.aggregate_rollover) {\n        formatted_y = number_rollover_format(args.y_mouseover, d, args.y_accessor);\n      } else {\n        formatted_y = number_rollover_format(args.y_mouseover, d, args.y_accessor);\n      }\n    } else {\n      if (args.time_series) {\n        if (args.aggregate_rollover) {\n          formatted_y = num(d[args.y_accessor]);\n        } else {\n          formatted_y = args.yax_units + num(d[args.y_accessor]);\n        }\n      } else {\n        formatted_y = args.y_accessor + ': ' + args.yax_units + num(d[args.y_accessor]);\n      }\n    }\n\n    return formatted_y;\n  }\n\n  function mg_format_x_rollover(args, fmt, d) {\n    var formatted_x;\n\n    if (args.x_mouseover !== null) {\n      if (args.time_series) {\n        if (args.aggregate_rollover) {\n          formatted_x = time_rollover_format(args.x_mouseover, d, 'key', args.utc);\n        } else {\n          formatted_x = time_rollover_format(args.x_mouseover, d, args.x_accessor, args.utc);\n        }\n      } else {\n        formatted_x = number_rollover_format(args.x_mouseover, d, args.x_accessor);\n      }\n    } else {\n      if (args.time_series) {\n        var date;\n\n        if (args.aggregate_rollover && args.data.length > 1) {\n          date = new Date(d.key);\n        } else {\n          date = new Date(+d[args.x_accessor]);\n          date.setDate(date.getDate());\n        }\n\n        formatted_x = fmt(date) + '  ';\n      } else {\n        formatted_x = args.x_accessor + ': ' + d[args.x_accessor] + '   ';\n      }\n    }\n\n    return formatted_x;\n  }\n\n  function mg_format_data_for_mouseover(args, d, mouseover_fcn, accessor, check_time) {\n    var formatted_data, formatter;\n    var time_fmt = mg_get_rollover_time_format(args);\n\n    if (typeof d[accessor] === 'string') {\n      formatter = function (d) {\n        return d;\n      };\n    } else {\n      formatter = format_rollover_number(args);\n    }\n\n    if (mouseover_fcn !== null) {\n      if (check_time) formatted_data = time_rollover_format(mouseover_fcn, d, accessor, args.utc);else formatted_data = number_rollover_format(mouseover_fcn, d, accessor);\n    } else {\n      if (check_time) formatted_data = time_fmt(new Date(+d[accessor])) + '  ';else formatted_data = (args.time_series ? '' : accessor + ': ') + formatter(d[accessor]) + '   ';\n    }\n\n    return formatted_data;\n  }\n\n  function mg_format_number_mouseover(args, d) {\n    return mg_format_data_for_mouseover(args, d, args.x_mouseover, args.x_accessor, false);\n  }\n\n  function mg_format_x_mouseover(args, d) {\n    return mg_format_data_for_mouseover(args, d, args.x_mouseover, args.x_accessor, args.time_series);\n  }\n\n  function mg_format_y_mouseover(args, d) {\n    return mg_format_data_for_mouseover(args, d, args.y_mouseover, args.y_accessor, false);\n  }\n\n  function mg_format_x_aggregate_mouseover(args, d) {\n    return mg_format_data_for_mouseover(args, d, args.x_mouseover, 'key', args.time_series);\n  }\n\n  MG.format_rollover_number = format_rollover_number; // http://bl.ocks.org/mbostock/3916621\n\n  function path_tween(d1, precision) {\n    return function () {\n      var path0 = this,\n          path1 = path0.cloneNode(),\n          n0 = path0.getTotalLength() || 0,\n          n1 = (path1.setAttribute(\"d\", d1), path1).getTotalLength() || 0; // Uniform sampling of distance based on specified precision.\n\n      var distances = [0],\n          i = 0,\n          dt = precision / Math.max(n0, n1);\n\n      while ((i += dt) < 1) distances.push(i);\n\n      distances.push(1); // Compute point-interpolators at each distance.\n\n      var points = distances.map(function (t) {\n        var p0 = path0.getPointAtLength(t * n0),\n            p1 = path1.getPointAtLength(t * n1);\n        return d3.interpolate([p0.x, p0.y], [p1.x, p1.y]);\n      });\n      return function (t) {\n        return t < 1 ? \"M\" + points.map(function (p) {\n          return p(t);\n        }).join(\"L\") : d1;\n      };\n    };\n  }\n\n  MG.path_tween = path_tween; // influenced by https://bl.ocks.org/tomgp/c99a699587b5c5465228\n\n  function render_markup_for_server(callback) {\n    var virtual_window = MG.virtual_window;\n    var virtual_d3 = d3.select(virtual_window.document);\n    var target = virtual_window.document.createElement('div');\n    var original_d3 = global.d3;\n    var original_window = global.window;\n    var original_document = global.document;\n    global.d3 = virtual_d3;\n    global.window = virtual_window;\n    global.document = virtual_window.document;\n    var error;\n\n    try {\n      callback(target);\n    } catch (e) {\n      error = e;\n    }\n\n    global.d3 = original_d3;\n    global.window = original_window;\n    global.document = original_document;\n\n    if (error) {\n      throw error;\n    }\n    /* for some reason d3.select parses jsdom elements incorrectly\n     * but it works if we wrap the element in a function.\n     */\n\n\n    return virtual_d3.select(function targetFn() {\n      return target;\n    }).html();\n  }\n\n  function render_markup_for_client(callback) {\n    var target = document.createElement('div');\n    callback(target);\n    return d3.select(target).html();\n  }\n\n  function render_markup(callback) {\n    switch (typeof window) {\n      case 'undefined':\n        return render_markup_for_server(callback);\n\n      default:\n        return render_markup_for_client(callback);\n    }\n  }\n\n  function init_virtual_window(jsdom, force) {\n    if (MG.virtual_window && !force) {\n      return;\n    }\n\n    var doc = jsdom.jsdom({\n      html: '',\n      features: {\n        QuerySelector: true\n      }\n    });\n    MG.virtual_window = doc.defaultView;\n  }\n\n  MG.render_markup = render_markup;\n  MG.init_virtual_window = init_virtual_window; // call this to add a warning icon to a graph and log an error to the console\n\n  function error(args) {\n    console.error('ERROR : ', args.target, ' : ', args.error);\n    d3.select(args.target).select('.mg-chart-title').append('tspan').attr('class', 'fa fa-x fa-exclamation-circle mg-warning').attr('dx', '0.3em').text('\\uf06a');\n  }\n\n  function internal_error(args) {\n    console.error('INTERNAL ERROR : ', args.target, ' : ', args.internal_error);\n  }\n\n  MG.error = error;\n  return MG;\n});","map":{"version":3,"sources":["/Users/jonah/Desktop/SP2021/Pandemic_Simulator/src/library/metrics-graphics/dist/metricsgraphics.js"],"names":["root","factory","define","amd","exports","module","require","MG","d3","window","global","version","convert","date","data","accessor","time_format","parse_time","timeParse","map","d","trim","number","Number","utc","specifier","utcFormat","timeFormat","mg_jquery_exists","jQuery","$","mg_get_rollover_time_format","args","fmt","processed","x_time_frame","utc_time","mg_data_in_plot_bounds","datum","x_accessor","min_x","max_x","y_accessor","min_y","max_y","is_array","thing","Object","prototype","toString","call","is_function","is_empty_array","length","is_object","is_array_of_arrays","all_elements","sum","is_array_of_objects","is_array_of_objects_or_empty","pluck","arr","count_array_elements","reduce","a","b","mg_get_bottom","height","bottom","mg_get_plot_bottom","buffer","mg_get_top","top","mg_get_plot_top","mg_get_left","left","mg_get_plot_left","mg_get_right","width","right","mg_get_plot_right","mg_exit_and_remove","elem","exit","remove","mg_selectAll_and_remove","svg","cl","selectAll","mg_add_g","append","classed","mg_remove_element","select","mg_make_rug","rug_class","mg_get_svg_child_of","target","all_data","mg_flatten_array","rug","enter","attr","mg_add_color_accessor_to_rug","rug_mono_class","color_accessor","scalefns","colorf","mg_rotate_labels","labels","rotation_degree","dy","transform","mg_elements_are_overlapping","node","i","mg_is_horizontally_overlapping","mg_prevent_horizontal_overlap","newY","mg_prevent_vertical_overlap","sort","reverse","overlap_amount","label_i","label_j","text","j","mg_is_vertically_overlapping","element","sibling","element_bbox","getBoundingClientRect","sibling_bbox","mg_is_horiz_overlap","mg_infer_type","ns","testPoint","selector_or_node","flat_data","concat","apply","mg_next_id","_next_elem_id","mg_target_ref","mg_normalize","HTMLElement","target_ref","getAttribute","setAttribute","console","warn","string","replace","get_pixel_dimension","dimension","style","get_width","get_height","isNumeric","n","isNaN","parseFloat","isFinite","each","obj","iterator","context","breaker","Array","forEach","k","merge_with_defaults","slice","arguments","source","prop","number_of_values","value","values","filter","has_values_below","has_too_many_zeros","zero_count","mg_is_date","mg_is_object","mg_is_array","isArray","clone","copy","Date","setTime","getTime","len","hasOwnProperty","Error","arr_diff","seen","diff","push","warn_deprecation","message","untilVersion","trace","truncate_text","textObj","textString","bbox","position","textContent","getBBox","wrap_text","token","tspanAttrs","words","split","word","line","lineNumber","lineHeight","y","tspan","pop","join","getComputedTextLength","register","chartType","descriptor","defaults","charts","_hooks","add_hook","name","func","hooks","already_registered","hook","call_hook","result","params","constructor","globals","deprecations","rollover_callback","replacement","rollout_callback","x_rollover_format","y_rollover_format","show_years","xax_start_at_min","interpolate_tension","link","data_graphic","missing_is_zero","missing_is_hidden","missing_is_hidden_accessor","legend","legend_target","error","animate_on_load","title_y_position","center_title_full_width","full_width","full_height","small_height_threshold","small_width_threshold","xax_count","xax_tick_length","axes_not_compact","yax_count","yax_tick_length","x_extended_ticks","y_extended_ticks","y_scale_type","min_y_from_data","point_size","xax_units","x_label","x_sort","x_axis","y_axis","x_axis_position","y_axis_position","x_axis_type","y_axis_type","ygroup_accessor","xgroup_accessor","y_padding_percentage","y_outer_padding_percentage","ygroup_padding_percentage","ygroup_outer_padding_percentage","x_padding_percentage","x_outer_padding_percentage","xgroup_padding_percentage","xgroup_outer_padding_percentage","y_categorical_show_guides","x_categorical_show_guide","rotate_x_labels","rotate_y_labels","y_label","yax_units","yax_units_append","x_rug","y_rug","mouseover_align","x_mouseover","y_mouseover","transition_on_update","mouseover","click","show_rollover_text","show_confidence_band","xax_format","area","chart_type","decimals","format","inflator","linked","linked_format","list","baselines","markers","scales","european_clock","show_year_markers","show_secondary_x_label","interpolate","curveCatmullRom","alpha","custom_line_color_map","colors","max_data_size","aggregate_rollover","show_tooltips","selected_chart","key","deprecation","warned","Tooltip","options","type","enabled","timeout","hoverState","$element","inState","init","VERSION","TRANSITION_DURATION","DEFAULTS","animation","placement","selector","template","trigger","title","delay","html","container","viewport","padding","getOptions","$viewport","isFunction","hover","focus","document","triggers","on","proxy","toggle","eventIn","eventOut","leave","_options","extend","fixTitle","getDefaults","show","hide","getDelegateOptions","self","currentTarget","Event","tip","hasClass","clearTimeout","setTimeout","isInStateTrue","e","hasContent","inDom","contains","ownerDocument","documentElement","isDefaultPrevented","that","$tip","tipId","getUID","setContent","addClass","autoToken","autoPlace","test","detach","css","display","appendTo","insertAfter","pos","getPosition","actualWidth","offsetWidth","actualHeight","offsetHeight","orgPlacement","viewportDim","removeClass","calculatedOffset","getCalculatedOffset","applyPlacement","complete","prevHoverState","support","transition","one","emulateTransitionEnd","offset","marginTop","parseInt","marginLeft","setOffset","using","props","Math","round","delta","getViewportAdjustedDelta","isVertical","arrowDelta","arrowOffsetPosition","replaceArrow","arrow","getTitle","find","callback","removeAttr","$e","el","isBody","tagName","elRect","elOffset","scroll","scrollTop","body","outerDims","viewportPadding","viewportDimensions","topEdgeOffset","bottomEdgeOffset","leftEdgeOffset","rightEdgeOffset","o","prefix","random","getElementById","$arrow","enable","disable","toggleEnabled","destroy","off","removeData","Plugin","option","$this","old","fn","tooltip","Constructor","noConflict","Popover","content","getContent","children","end","popover","chart_title","chartTitle","insert","description","$chartTitle","mg_add_scale_function","scalefcn_name","scale","inflation","di","undefined","mg_position","str","mg_cat_position","MGScale","scaleArgs","use_inflator","zero_bottom","scaleType","namespace","_namespace","namespace_accessor_name","scale_name","toUpperCase","scalefn_name","scaleName","inflateDomain","tf","zeroBottom","numericalDomainFromData","other_flat_data_arrays","illustrative_data","is_time_series","mg_min_max_numerical","time_scale","scaleUtc","scaleTime","scaleLog","scaleLinear","domain","categoricalDomain","scaleOrdinal","categoricalDomainFromData","categoricalVariables","set","scaleBand","numericalRange","range","categoricalRangeBands","halfway","paddingPercentage","outerPaddingPercentage","paddingInner","paddingOuter","bandwidth","categoricalRange","categoricalColorRange","schemeCategory20","schemeCategory10","clamp","yn","scale_factory","additional_data_arrays","dp","extents","extent","min_val","max_val","setDate","getDate","mg_force_xax_count_to_be_two","mg_categorical_group_color_scale","mg_add_color_categorical_scale","color","mg_get_categorical_domain","mg_get_color_domain","color_domain","color_type","mg_get_color_range","color_range","processScaleTicks","axis","scale_ticks","ticks","max","log10","val","log","LN10","abs","number_of_ticks","data_is_int","rugPlacement","axisArgs","coordinates","x1","x2","rug_buffer_size","y1","y2","rimPlacement","tick_length","toFixed","labelPlacement","tickLength","x","dx","textAnchor","mg_compute_yax_format","mg_default_xax_format","selectXaxFormat","c","mg_default_bar_xax_format","secondaryLabels","g","time_series","mg_get_yformat_and_secondary_time_function","addSecondaryLabelElements","timeframe","yformat","secondary","time_frame","secondary_function","years","first_tick","X","yg","yearMarkerLine","yearMarkerText","textFcn","xAxisTextElement","addNumericalLabels","coords","_d","addTickLines","ticksClass","extendedTicksClass","extendedTicks","initializeAxisRim","rim","initializeRug","rug_positions","categoricalLabelPlacement","group","groupScale","cat","categoricalLabels","nsClass","groupAccessor","group_g","groups","String","rotateLabels","categoricalGuides","scalef","groupf","alreadyPlotted","grs","first","last","x11","x21","y11","y21","x12","x22","y12","y22","zeroLine","mgDrawAxis","categorical","numerical","axisName","axisClass","label","show_bar_zero","mg_bar_add_zero_line","axisFactory","t","draw","axis_factory","yf","mg_change_y_extents_for_bars","my","min","trio","baseline_accessor","predictor_accessor","yax_format","pf","d_","r","Y","categorical_groups","YGROUP","set_min_max_y","buff","mg_y_domain_range","mg_define_y_scales","Y_axis","mg_add_y_label","mg_add_y_axis_rim","y_ticks","y1scale","y2scale","mg_add_y_axis_tick_lines","mg_add_y_axis_tick_labels","mg_process_scale_ticks","mg_add_categorical_labels","mg_add_group_label","mg_add_graphic_labels","mg_draw_group_lines","ygroup_height","mg_y_categorical_show_guides","indexOf","ygroupf","y_axis_categorical","xf","mg_add_processed_object","mg_select_xax_format","mg_add_x_ticks","mg_add_x_tick_labels","mg_add_x_label","x_axis_categorical","additional_buffer","mg_add_categorical_scale","categorical_variables","mg_add_x_axis_categorical_labels","bar_outer_padding_percentage","truncate_x_labels","idx","mg_point_add_color_scale","mg_point_add_size_scale","min_size","max_size","size_domain","size_range","size_accessor","mg_get_size_domain","mg_get_size_range","size","x_label_nudge_x","mg_get_time_frame","mg_milisec_diff","mg_sec_diff","mg_day_diff","mg_four_days","mg_many_days","mg_many_months","mg_years","mg_get_time_format","main_time_format","mg_process_time_format","main_x_time_format","original_data","flattened","test_point_x","original_x_accessor","is_float","mg_add_x_axis_rim","mg_add_x_axis_tick_lines","x_ticks","last_i","mg_add_primary_x_axis_label","mg_add_secondary_x_axis_label","mg_add_secondary_x_axis_elements","timeDays","timeYears","mg_add_year_marker_line","mg_add_year_marker_text","mg_min_max_x_for_nonbars","mx","extent_x","mg_min_max_x_for_bars","mg_min_max_x_for_dates","yesterday","tomorrow","mg_min_max_x_for_numbers","mg_min_max_x_for_strings","mg_sort_through_data_type_and_set_x_min_max_accordingly","mg_merge_args_with_defaults","mg_is_time_series","first_elem","mg_init_compute_width","svg_width","mg_categorical_calculate_height","mg_init_compute_height","svg_height","mg_remove_svg_if_chart_type_has_changed","empty","mg_add_svg_if_it_doesnt_exist","mg_add_clip_path_for_plot_area","mg_adjust_width_and_height_if_changed","mg_set_viewbox_for_scaling","mg_remove_missing_classes_and_text","mg_remove_outdated_lines","nodes","array_full_series","lines_to_remove","num_of_new","num_of_existing","mg_raise_container_error","categoricalInitialization","which","mg_categorical_count_number_of_groups","mg_categorical_count_number_of_lanes","mg_categorical_calculate_group_length","mg_categorical_calculate_bar_thickness","accessor_string","total_bars","group_bars","keys","bars_per_group","groupHeight","gh","step","bar_thickness","groupContribution","marginContribution","mg_barchart_extrapolate_group_and_thickness_from_height","mg_return_label","mg_remove_existing_markers","mg_in_range","mg_x_position","mg_x_position_fixed","_mg_x_pos","mg_y_position_fixed","_mg_y_pos","mg_place_annotations","checker","class_name","line_fcn","text_fcn","mg_place_markers","mg_place_marker_lines","mg_place_marker_text","mg_place_baselines","mg_place_baseline_lines","mg_place_baseline_text","gm","x_pos_fixed","lineclass","textclass","gb","y_pos","mg_clear_mouseover_container","mg_setup_mouseover_container","text_anchor","mouseover_x","active_datapoint","active_datapoint_y_nudge","y_position","yPos","mg_mouseover_tspan","bold","font_size","pts","mg_reset_text_container","textContainer","mg_mouseover_row","row_number","rargs","rrr","mg_mouseover_text","text_container","mouseover_row","MG_WindowResizeTracker","targets","Observer","MutationObserver","WebKitMutationObserver","window_listener","parentNode","aspect","newWidth","remove_target","index","splice","removeEventListener","add_target","addEventListener","observer","mutations","targetNode","some","mutation","removedNodes","disconnect","observe","childList","mg_window_resize_tracker","mg_window_listeners","mg_if_aspect_ratio_resize_svg","dropdown","backdrop","Dropdown","is","$parent","getParent","isActive","clearMenus","closest","relatedTarget","toggleClass","keydown","preventDefault","stopPropagation","desc","$items","eq","parent","button_layout","feature_set","public_name","sorters","manual","manual_map","manual_callback","_strip_punctuation","s","punctuationless","finalString","_data","manual_button","feature","button","_callback","f","features","feat","mapDtoF","dropdownLiAClick","manual_feature","mg_line_color_text","line_id","mg_line_graph_generators","plot","mg_add_line_generator","mg_add_area_generator","mg_add_flat_line_generator","mg_add_confidence_band_generator","existing_band","confidence_area","defined","y0","l","u","curve","flat_line","data_median","mg_add_confidence_band","which_line","confidenceBand","duration","mg_add_area","areas","display_area","appendChild","update_transition_duration","mg_default_color_for_path","this_path","mg_color_line","mg_add_line_element","median","mg_add_line","existing_line","lineTransition","attrTween","path_tween","mg_add_legend_element","this_legend","legend_text","anchor_point","anchor_orientation","legend_group","mg_plot_legend_if_legend_target","mg_add_legend_group","mg_remove_existing_line_rollover_elements","mg_add_rollover_circle","circle","mg_set_unique_line_id_for_each_series","mg_nest_data_for_voronoi","merge","mg_line_class_string","class_string","v","formatter","id","mg_add_voronoi_rollover","rollover_on","rollover_off","rollover_move","voronoi","polygons","mg_configure_voronoi_rollover","nest_data_for_aggregate_rollover","data_nested","nest","entries","entry","mg_add_aggregate_rollover","line_classes","lc","mg_line_class","mg_line_color_class","mg_rollover_id_class","mg_rollover_format_id","mg_configure_aggregate_rollover","mg_configure_singleton_rollover","mg_add_single_line_rollover","mg_is_singleton","rect","rect_first","__data__","mg_is_standard_multiline","mg_is_aggregated_rollover","mg_draw_all_line_elements","mg_remove_dangling_bands","this_data","mg_line_main_plot","use_data_y_min","continueWithDefault","mg_line_rollover_setup","graph","rolloverOn","rolloverOff","rolloverMove","mg_update_rollover_circle","mg_update_aggregate_rollover_circle","mg_update_generic_rollover_circle","mg_trigger_linked_mouseovers","mg_trigger_linked_mouseouts","datums","mg_remove_active_data_points_for_aggregate_rollover","mg_remove_active_data_points_for_generic_rollover","mg_remove_active_text","lineChart","internal_error","raw_data_transformation","process_line","mainPlot","rollover","windowListeners","row","mg_format_x_aggregate_mouseover","mg_format_x_mouseover","mg_format_y_mouseover","mouseout","mousemove","histogram","process_histogram","bar","bar_margin","num","format_rollover_number","mo","binned","bins","processed_x_accessor","processed_y_accessor","processed_dx_accessor","point_mouseover","mg_color_point_mouseover","mg_filter_out_plot_bounds","new_data","pointChart","process_point","xMaker","yMaker","xgroup_height","XGROUP","xgroupf","xoutf","youtf","colorScale","least_squares","add_ls","sizef","paths","active_point_size_increase","update","x_categorical_show_guides","ls","lowess","label_accessor","scaffold","mg_targeted_legend","div","orientation","outer_span","COLOR","legend_on_graph","lineCount","sub_container","barChart","ycolor_accessor","xcolor_accessor","barplot","fresh_render","bars","predictor_bars","pp","pp0","baseline_marks","perform_load_animation","should_transition","transition_duration","appropriate_size","length_type","width_type","length_coord","width_coord","length_scalefn","width_scalefn","length_scale","width_scale","length_accessor","width_accessor","length_coord_map","width_coord_map","length_map","width_map","reference_length_map","reference_length_coord_fn","reference_accessor","w","reference_data","reference_bars","reference_thickness","comparison_accessor","comparison_thickness","comparison_data","comparison_marks","comparison_width","rollover_x","rollover_anchor","rollover_align","is_vertical","data_accessor","label_units","rgb","darker","mg_format_data_for_mouseover","secondary_label_accessor","predictor_proportion","truncate_y_labels","data_table","standard_col","font_weight","columns","formatting_options","_format_element","fo","_add_column","_args","arg_type","standard_column","bullet","sparkline","table","colgroup","thead","tbody","this_column","this_title","tr","th","td_accessor","td_type","td_value","th_text","td_text","td","col","h","this_col","value_formatter","this_format","currency","secondary_accessor","mg_missing_add_text","missing_text","mg_missing_x_scale","mg_missing_y_scale","mg_make_fake_data","mg_add_missing_background_rect","mg_missing_add_line","mg_missing_add_area","mg_remove_all_children","mg_missing_remove_legend","missingData","show_missing_background","x_scale_type","single_object","array_of_objects","array_of_arrays","nested_array_of_arrays","nested_array_of_objects","mg_process_multiple_x_accessors","mg_process_multiple_y_accessors","mg_process_multiple_accessors","which_accessor","ya","series","processed_data","start_date","from","upto","setHours","parse","existing_o","our_data","extracted_data","hist","thresholds","x0","this_pt","next_pt","original_y_accessor","process_categorical_variables","pd","bar_orientation","ls_line","fit","add_lowess","lowess_line","lowess_robust","inc","_l","yhat","mean","_calculate_lowess_fit","x_proto","y_proto","zip","yi","q","quantile","ri","_bisquare_weight","p","x_","y_","xi","_x","_y","_xy","_xx","xhat","numerator","denominator","beta","_pow_weight","pow","_tricube_weight","_neighborhood_width","xis","_manhattan","_weighted_means","wxy","wsum","wxyi","xbar","ybar","_weighted_beta","denom","_weighted_least_squares","beta_i","_wm","residuals","floor","sorted_x","x_max","x_min","xy","smallest","largest","xi_neighbors","x_i","x0_i","delta_i","xyi","_output","fmt_string","time_rollover_format","fd","number_rollover_format","mg_format_y_rollover","formatted_y","mg_format_x_rollover","formatted_x","mouseover_fcn","check_time","formatted_data","time_fmt","mg_format_number_mouseover","d1","precision","path0","path1","cloneNode","n0","getTotalLength","n1","distances","dt","points","p0","getPointAtLength","p1","render_markup_for_server","virtual_window","virtual_d3","createElement","original_d3","original_window","original_document","targetFn","render_markup_for_client","render_markup","init_virtual_window","jsdom","force","doc","QuerySelector","defaultView"],"mappings":"AAAC,WAASA,IAAT,EAAeC,OAAf,EAAwB;AACvB,MAAI,OAAOC,MAAP,KAAkB,UAAlB,IAAgCA,MAAM,CAACC,GAA3C,EAAgD;AAC9CD,IAAAA,MAAM,CAAC,CAAC,IAAD,CAAD,EAASD,OAAT,CAAN;AACD,GAFD,MAEO,IAAI,OAAOG,OAAP,KAAmB,QAAvB,EAAiC;AACtCC,IAAAA,MAAM,CAACD,OAAP,GAAiBH,OAAO,CAACK,OAAO,CAAC,IAAD,CAAR,CAAxB;AACD,GAFM,MAEA;AACLN,IAAAA,IAAI,CAACO,EAAL,GAAUN,OAAO,CAACD,IAAI,CAACQ,EAAN,CAAjB;AACD;AACF,CARA,EAQC,IARD,EAQO,UAASA,EAAT,EAAa;AACrB,GAAC,OAAOC,MAAP,KAAkB,WAAlB,GAAgCC,MAAhC,GAAyCD,MAA1C,EAAkDF,EAAlD,GAAuD;AAACI,IAAAA,OAAO,EAAE;AAAV,GAAvD,CADqB,CAGrB;;AAEAJ,EAAAA,EAAE,CAACK,OAAH,GAAa,EAAb;;AAEAL,EAAAA,EAAE,CAACK,OAAH,CAAWC,IAAX,GAAkB,UAASC,IAAT,EAAeC,QAAf,EAAyBC,WAAzB,EAAsC;AACtDA,IAAAA,WAAW,GAAI,OAAOA,WAAP,KAAuB,WAAxB,GAAuC,UAAvC,GAAoDA,WAAlE;AACA,QAAIC,UAAU,GAAGT,EAAE,CAACU,SAAH,CAAaF,WAAb,CAAjB;AACAF,IAAAA,IAAI,GAAGA,IAAI,CAACK,GAAL,CAAS,UAASC,CAAT,EAAY;AAC1BA,MAAAA,CAAC,CAACL,QAAD,CAAD,GAAcE,UAAU,CAACG,CAAC,CAACL,QAAD,CAAD,CAAYM,IAAZ,EAAD,CAAxB;AACA,aAAOD,CAAP;AACD,KAHM,CAAP;AAKA,WAAON,IAAP;AACD,GATD;;AAWAP,EAAAA,EAAE,CAACK,OAAH,CAAWU,MAAX,GAAoB,UAASR,IAAT,EAAeC,QAAf,EAAyB;AAC3CD,IAAAA,IAAI,GAAGA,IAAI,CAACK,GAAL,CAAS,UAASC,CAAT,EAAY;AAC1BA,MAAAA,CAAC,CAACL,QAAD,CAAD,GAAcQ,MAAM,CAACH,CAAC,CAACL,QAAD,CAAF,CAApB;AACA,aAAOK,CAAP;AACD,KAHM,CAAP;AAKA,WAAON,IAAP;AACD,GAPD;;AASAP,EAAAA,EAAE,CAACS,WAAH,GAAiB,UAASQ,GAAT,EAAcC,SAAd,EAAyB;AACxC,WAAOD,GAAG,GAAGhB,EAAE,CAACkB,SAAH,CAAaD,SAAb,CAAH,GAA6BjB,EAAE,CAACmB,UAAH,CAAcF,SAAd,CAAvC;AACD,GAFD;;AAIA,WAASG,gBAAT,GAA4B;AAC1B,QAAI,OAAOC,MAAP,KAAkB,WAAlB,IAAiC,OAAOC,CAAP,KAAa,WAAlD,EAA+D;AAC7D,aAAO,IAAP;AACD,KAFD,MAEO;AACL,aAAO,KAAP;AACD;AACF;;AAED,WAASC,2BAAT,CAAqCC,IAArC,EAA2C;AACzC,QAAIC,GAAJ;;AACA,YAAQD,IAAI,CAACE,SAAL,CAAeC,YAAvB;AACE,WAAK,QAAL;AACEF,QAAAA,GAAG,GAAG1B,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,wBAA9B,CAAN;AACA;;AACF,WAAK,SAAL;AACEH,QAAAA,GAAG,GAAG1B,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,qBAA9B,CAAN;AACA;;AACF,WAAK,iBAAL;AACEH,QAAAA,GAAG,GAAG1B,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,oBAA9B,CAAN;AACA;;AACF,WAAK,WAAL;AACEH,QAAAA,GAAG,GAAG1B,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,oBAA9B,CAAN;AACA;;AACF;AACEH,QAAAA,GAAG,GAAG1B,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,WAA9B,CAAN;AAdJ;;AAgBA,WAAOH,GAAP;AACD;;AAED,WAASI,sBAAT,CAAgCC,KAAhC,EAAuCN,IAAvC,EAA6C;AAC3C,WAAOM,KAAK,CAACN,IAAI,CAACO,UAAN,CAAL,IAA0BP,IAAI,CAACE,SAAL,CAAeM,KAAzC,IACLF,KAAK,CAACN,IAAI,CAACO,UAAN,CAAL,IAA0BP,IAAI,CAACE,SAAL,CAAeO,KADpC,IAELH,KAAK,CAACN,IAAI,CAACU,UAAN,CAAL,IAA0BV,IAAI,CAACE,SAAL,CAAeS,KAFpC,IAGLL,KAAK,CAACN,IAAI,CAACU,UAAN,CAAL,IAA0BV,IAAI,CAACE,SAAL,CAAeU,KAH3C;AAID;;AAED,WAASC,QAAT,CAAkBC,KAAlB,EAAyB;AACvB,WAAOC,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,KAA/B,MAA0C,gBAAjD;AACD;;AAED,WAASK,WAAT,CAAqBL,KAArB,EAA4B;AAC1B,WAAOC,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,KAA/B,MAA0C,mBAAjD;AACD;;AAED,WAASM,cAAT,CAAwBN,KAAxB,EAA+B;AAC7B,WAAOD,QAAQ,CAACC,KAAD,CAAR,IAAmBA,KAAK,CAACO,MAAN,KAAiB,CAA3C;AACD;;AAED,WAASC,SAAT,CAAmBR,KAAnB,EAA0B;AACxB,WAAOC,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BJ,KAA/B,MAA0C,iBAAjD;AACD;;AAED,WAASS,kBAAT,CAA4BzC,IAA5B,EAAkC;AAChC,QAAI0C,YAAY,GAAG1C,IAAI,CAACK,GAAL,CAAS,UAASC,CAAT,EAAY;AACtC,aAAOyB,QAAQ,CAACzB,CAAD,CAAR,KAAgB,IAAhB,IAAwBA,CAAC,CAACiC,MAAF,GAAW,CAA1C;AACD,KAFkB,CAAnB;AAIA,WAAO7C,EAAE,CAACiD,GAAH,CAAOD,YAAP,MAAyB1C,IAAI,CAACuC,MAArC;AACD;;AAED,WAASK,mBAAT,CAA6B5C,IAA7B,EAAmC;AACjC;AACA,QAAI0C,YAAY,GAAG1C,IAAI,CAACK,GAAL,CAAS,UAASC,CAAT,EAAY;AACtC,aAAOkC,SAAS,CAAClC,CAAD,CAAT,KAAiB,IAAxB;AACD,KAFkB,CAAnB;AAIA,WAAOZ,EAAE,CAACiD,GAAH,CAAOD,YAAP,MAAyB1C,IAAI,CAACuC,MAArC;AACD;;AAED,WAASM,4BAAT,CAAsC7C,IAAtC,EAA4C;AAC1C,WAAOsC,cAAc,CAACtC,IAAD,CAAd,IAAwB4C,mBAAmB,CAAC5C,IAAD,CAAlD;AACD;;AAED,WAAS8C,KAAT,CAAeC,GAAf,EAAoB9C,QAApB,EAA8B;AAC5B,WAAO8C,GAAG,CAAC1C,GAAJ,CAAQ,UAASC,CAAT,EAAY;AACzB,aAAOA,CAAC,CAACL,QAAD,CAAR;AAAoB,KADf,CAAP;AAED;;AAED,WAAS+C,oBAAT,CAA8BD,GAA9B,EAAmC;AACjC,WAAOA,GAAG,CAACE,MAAJ,CAAW,UAASC,CAAT,EAAYC,CAAZ,EAAe;AAAED,MAAAA,CAAC,CAACC,CAAD,CAAD,GAAOD,CAAC,CAACC,CAAD,CAAD,GAAO,CAAP,IAAY,CAAnB;AACjC,aAAOD,CAAP;AAAW,KADN,EACQ,EADR,CAAP;AAED;;AAED,WAASE,aAAT,CAAuBlC,IAAvB,EAA6B;AAC3B,WAAOA,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACoC,MAA1B;AACD;;AAED,WAASC,kBAAT,CAA4BrC,IAA5B,EAAkC;AAChC;AACA,WAAOkC,aAAa,CAAClC,IAAD,CAAb,GAAsBA,IAAI,CAACsC,MAAlC;AACD;;AAED,WAASC,UAAT,CAAoBvC,IAApB,EAA0B;AACxB,WAAOA,IAAI,CAACwC,GAAZ;AACD;;AAED,WAASC,eAAT,CAAyBzC,IAAzB,EAA+B;AAC7B;AACA,WAAOuC,UAAU,CAACvC,IAAD,CAAV,GAAmBA,IAAI,CAACsC,MAA/B;AACD;;AAED,WAASI,WAAT,CAAqB1C,IAArB,EAA2B;AACzB,WAAOA,IAAI,CAAC2C,IAAZ;AACD;;AAED,WAASC,gBAAT,CAA0B5C,IAA1B,EAAgC;AAC9B;AACA,WAAO0C,WAAW,CAAC1C,IAAD,CAAX,GAAoBA,IAAI,CAACsC,MAAhC;AACD;;AAED,WAASO,YAAT,CAAsB7C,IAAtB,EAA4B;AAC1B,WAAOA,IAAI,CAAC8C,KAAL,GAAa9C,IAAI,CAAC+C,KAAzB;AACD;;AAED,WAASC,iBAAT,CAA2BhD,IAA3B,EAAiC;AAC/B;AACA,WAAO6C,YAAY,CAAC7C,IAAD,CAAZ,GAAqBA,IAAI,CAACsC,MAAjC;AACD,GApJoB,CAsJrB;;;AAEA,WAASW,kBAAT,CAA4BC,IAA5B,EAAkC;AAChCA,IAAAA,IAAI,CAACC,IAAL,GAAYC,MAAZ;AACD;;AAED,WAASC,uBAAT,CAAiCC,GAAjC,EAAsCC,EAAtC,EAA0C;AACxCD,IAAAA,GAAG,CAACE,SAAJ,CAAcD,EAAd,EAAkBH,MAAlB;AACD;;AAED,WAASK,QAAT,CAAkBH,GAAlB,EAAuBC,EAAvB,EAA2B;AACzB,WAAOD,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,OAAhB,CAAwBJ,EAAxB,EAA4B,IAA5B,CAAP;AACD;;AAED,WAASK,iBAAT,CAA2BN,GAA3B,EAAgCJ,IAAhC,EAAsC;AACpCI,IAAAA,GAAG,CAACO,MAAJ,CAAWX,IAAX,EAAiBE,MAAjB;AACD,GAtKoB,CAwKrB;;;AAEA,WAASU,WAAT,CAAqB9D,IAArB,EAA2B+D,SAA3B,EAAsC;AACpC,QAAIT,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,QAAIC,QAAQ,GAAGC,gBAAgB,CAACnE,IAAI,CAAClB,IAAN,CAA/B;AACA,QAAIsF,GAAG,GAAGd,GAAG,CAACE,SAAJ,CAAc,UAAUO,SAAxB,EAAmCjF,IAAnC,CAAwCoF,QAAxC,CAAV;AAEAE,IAAAA,GAAG,CAACC,KAAJ,GACGX,MADH,CACU,MADV,EAEKY,IAFL,CAEU,OAFV,EAEmBP,SAFnB,EAGKO,IAHL,CAGU,SAHV,EAGqB,GAHrB,EALoC,CAUpC;;AACArB,IAAAA,kBAAkB,CAACmB,GAAD,CAAlB,CAXoC,CAapC;;AACAnB,IAAAA,kBAAkB,CAACmB,GAAD,CAAlB;AACA,WAAOA,GAAP;AACD;;AAED,WAASG,4BAAT,CAAsCH,GAAtC,EAA2CpE,IAA3C,EAAiDwE,cAAjD,EAAiE;AAC/D,QAAIxE,IAAI,CAACyE,cAAT,EAAyB;AACvBL,MAAAA,GAAG,CAACE,IAAJ,CAAS,QAAT,EAAmBtE,IAAI,CAAC0E,QAAL,CAAcC,MAAjC;AACAP,MAAAA,GAAG,CAACT,OAAJ,CAAYa,cAAZ,EAA4B,KAA5B;AACD,KAHD,MAGO;AACLJ,MAAAA,GAAG,CAACE,IAAJ,CAAS,QAAT,EAAmB,IAAnB;AACAF,MAAAA,GAAG,CAACT,OAAJ,CAAYa,cAAZ,EAA4B,IAA5B;AACD;AACF;;AAED,WAASI,gBAAT,CAA0BC,MAA1B,EAAkCC,eAAlC,EAAmD;AACjD,QAAIA,eAAJ,EAAqB;AACnBD,MAAAA,MAAM,CAACP,IAAP,CAAY;AACVS,QAAAA,EAAE,EAAE,CADM;AAEVC,QAAAA,SAAS,EAAE,YAAW;AACpB,cAAI9B,IAAI,GAAG1E,EAAE,CAACqF,MAAH,CAAU,IAAV,CAAX;AACA,iBAAO,YAAYiB,eAAZ,GAA8B,GAA9B,GAAoC5B,IAAI,CAACoB,IAAL,CAAU,GAAV,CAApC,GAAqD,GAArD,GAA2DpB,IAAI,CAACoB,IAAL,CAAU,GAAV,CAA3D,GAA4E,GAAnF;AACD;AALS,OAAZ;AAOD;AACF,GAhNoB,CAkNrB;;;AAEA,WAASW,2BAAT,CAAqCJ,MAArC,EAA6C;AAC3CA,IAAAA,MAAM,GAAGA,MAAM,CAACK,IAAP,EAAT;;AACA,QAAI,CAACL,MAAL,EAAa;AACX,aAAO,KAAP;AACD;;AAED,SAAK,IAAIM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,MAAM,CAACxD,MAA3B,EAAmC8D,CAAC,EAApC,EAAwC;AACtC,UAAIC,8BAA8B,CAACP,MAAM,CAACM,CAAD,CAAP,EAAYN,MAAZ,CAAlC,EAAuD,OAAO,IAAP;AACxD;;AAED,WAAO,KAAP;AACD;;AAED,WAASQ,6BAAT,CAAuCR,MAAvC,EAA+C7E,IAA/C,EAAqD;AACnD,QAAI,CAAC6E,MAAD,IAAWA,MAAM,CAACxD,MAAP,IAAiB,CAAhC,EAAmC;AACjC;AACD,KAHkD,CAKnD;;;AACA,SAAK,IAAI8D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,MAAM,CAACxD,MAA3B,EAAmC8D,CAAC,EAApC,EAAwC;AACtC;AACA,UAAIC,8BAA8B,CAACP,MAAM,CAACM,CAAD,CAAP,EAAYN,MAAZ,CAAlC,EAAuD;AACrD,YAAIK,IAAI,GAAG1G,EAAE,CAACqF,MAAH,CAAUgB,MAAM,CAACM,CAAD,CAAhB,CAAX;AACA,YAAIG,IAAI,GAAG,CAACJ,IAAI,CAACZ,IAAL,CAAU,GAAV,CAAZ;;AACA,YAAIgB,IAAI,GAAG,CAAP,IAAYtF,IAAI,CAACwC,GAArB,EAA0B;AACxB8C,UAAAA,IAAI,GAAGtF,IAAI,CAACwC,GAAL,GAAW,EAAlB;AACD;;AACD0C,QAAAA,IAAI,CAACZ,IAAL,CAAU,GAAV,EAAegB,IAAf;AACD;AACF;AACF;;AAED,WAASC,2BAAT,CAAqCV,MAArC,EAA6C7E,IAA7C,EAAmD;AACjD,QAAI,CAAC6E,MAAD,IAAWA,MAAM,CAACxD,MAAP,IAAiB,CAAhC,EAAmC;AACjC;AACD;;AAEDwD,IAAAA,MAAM,CAACW,IAAP,CAAY,UAASvD,CAAT,EAAYD,CAAZ,EAAe;AACzB,aAAOxD,EAAE,CAACqF,MAAH,CAAU7B,CAAV,EAAasC,IAAb,CAAkB,GAAlB,IAAyB9F,EAAE,CAACqF,MAAH,CAAU5B,CAAV,EAAaqC,IAAb,CAAkB,GAAlB,CAAhC;AACD,KAFD;AAIAO,IAAAA,MAAM,CAACY,OAAP;AAEA,QAAIC,cAAJ,EAAoBC,OAApB,EAA6BC,OAA7B,CAXiD,CAajD;;AACA,SAAK,IAAIT,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,MAAM,CAACxD,MAA3B,EAAmC8D,CAAC,EAApC,EAAwC;AACtC;AACAQ,MAAAA,OAAO,GAAGnH,EAAE,CAACqF,MAAH,CAAUgB,MAAM,CAACM,CAAD,CAAhB,EAAqBU,IAArB,EAAV;;AAEA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGjB,MAAM,CAACxD,MAA3B,EAAmCyE,CAAC,EAApC,EAAwC;AACtCF,QAAAA,OAAO,GAAGpH,EAAE,CAACqF,MAAH,CAAUgB,MAAM,CAACiB,CAAD,CAAhB,EAAqBD,IAArB,EAAV;AACAH,QAAAA,cAAc,GAAGK,4BAA4B,CAAClB,MAAM,CAACM,CAAD,CAAP,EAAYN,MAAM,CAACiB,CAAD,CAAlB,CAA7C;;AAEA,YAAIJ,cAAc,KAAK,KAAnB,IAA4BC,OAAO,KAAKC,OAA5C,EAAqD;AACnD,cAAIV,IAAI,GAAG1G,EAAE,CAACqF,MAAH,CAAUgB,MAAM,CAACM,CAAD,CAAhB,CAAX;AACA,cAAIG,IAAI,GAAG,CAACJ,IAAI,CAACZ,IAAL,CAAU,GAAV,CAAZ;AACAgB,UAAAA,IAAI,GAAGA,IAAI,GAAGI,cAAd;AACAR,UAAAA,IAAI,CAACZ,IAAL,CAAU,GAAV,EAAegB,IAAf;AACD;AACF;AACF;AACF;;AAED,WAASS,4BAAT,CAAsCC,OAAtC,EAA+CC,OAA/C,EAAwD;AACtD,QAAIC,YAAY,GAAGF,OAAO,CAACG,qBAAR,EAAnB;AACA,QAAIC,YAAY,GAAGH,OAAO,CAACE,qBAAR,EAAnB;;AAEA,QAAID,YAAY,CAAC1D,GAAb,IAAoB4D,YAAY,CAAChE,MAAjC,IAA2C8D,YAAY,CAAC1D,GAAb,IAAoB4D,YAAY,CAAC5D,GAAhF,EAAqF;AACnF,aAAO4D,YAAY,CAAChE,MAAb,GAAsB8D,YAAY,CAAC1D,GAA1C;AACD;;AAED,WAAO,KAAP;AACD;;AAED,WAAS6D,mBAAT,CAA6BL,OAA7B,EAAsCC,OAAtC,EAA+C;AAC7C,QAAIC,YAAY,GAAGF,OAAO,CAACG,qBAAR,EAAnB;AACA,QAAIC,YAAY,GAAGH,OAAO,CAACE,qBAAR,EAAnB;;AAEA,QAAID,YAAY,CAACnD,KAAb,IAAsBqD,YAAY,CAACzD,IAAnC,IAA2CuD,YAAY,CAAC1D,GAAb,IAAoB4D,YAAY,CAAC5D,GAAhF,EAAqF;AACnF,aAAO4D,YAAY,CAAChE,MAAb,GAAsB8D,YAAY,CAAC1D,GAA1C;AACD;;AACD,WAAO,KAAP;AACD;;AAED,WAAS4C,8BAAT,CAAwCY,OAAxC,EAAiDnB,MAAjD,EAAyD;AACvD,QAAIqB,YAAY,GAAGF,OAAO,CAACG,qBAAR,EAAnB;;AAEA,SAAK,IAAIhB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,MAAM,CAACxD,MAA3B,EAAmC8D,CAAC,EAApC,EAAwC;AACtC,UAAIN,MAAM,CAACM,CAAD,CAAN,IAAaa,OAAjB,EAA0B;AACxB;AACD,OAHqC,CAKtC;;;AACA,UAAII,YAAY,GAAGvB,MAAM,CAACM,CAAD,CAAN,CAAUgB,qBAAV,EAAnB;;AACA,UAAID,YAAY,CAAC1D,GAAb,KAAqB4D,YAAY,CAAC5D,GAAlC,IACF,EAAE4D,YAAY,CAACzD,IAAb,GAAoBuD,YAAY,CAACnD,KAAjC,IAA0CqD,YAAY,CAACrD,KAAb,GAAqBmD,YAAY,CAACvD,IAA9E,CADF,EAEE;AACA,eAAO,IAAP;AACD;AACF;;AAED,WAAO,KAAP;AACD;;AAED,WAAS2D,aAAT,CAAuBtG,IAAvB,EAA6BuG,EAA7B,EAAiC;AAC7B;AACA,QAAIC,SAAS,GAAGrC,gBAAgB,CAACnE,IAAI,CAAClB,IAAN,CAAhC;AAEA0H,IAAAA,SAAS,GAAGA,SAAS,CAAC,CAAD,CAAT,CAAaxG,IAAI,CAACuG,EAAE,GAAG,WAAN,CAAjB,CAAZ;AACA,WAAO,OAAOC,SAAP,KAAqB,QAArB,GAAgC,aAAhC,GAAgD,WAAvD;AACD;;AAEH,WAASxC,mBAAT,CAA6ByC,gBAA7B,EAA+C;AAC7C,WAAOjI,EAAE,CAACqF,MAAH,CAAU4C,gBAAV,EAA4B5C,MAA5B,CAAmC,KAAnC,CAAP;AACD;;AAED,WAASM,gBAAT,CAA0BtC,GAA1B,EAA+B;AAC7B,QAAI6E,SAAS,GAAG,EAAhB;AACA,WAAOA,SAAS,CAACC,MAAV,CAAiBC,KAAjB,CAAuBF,SAAvB,EAAkC7E,GAAlC,CAAP;AACD;;AAED,WAASgF,UAAT,GAAsB;AACpB,QAAI,OAAOtI,EAAE,CAACuI,aAAV,KAA4B,WAAhC,EAA6C;AAC3CvI,MAAAA,EAAE,CAACuI,aAAH,GAAmB,CAAnB;AACD;;AAED,WAAO,QAASvI,EAAE,CAACuI,aAAH,EAAhB;AACD;;AAED,WAASC,aAAT,CAAuB9C,MAAvB,EAA+B;AAC7B,QAAI,OAAOA,MAAP,KAAkB,QAAtB,EAAgC;AAC9B,aAAO+C,YAAY,CAAC/C,MAAD,CAAnB;AAED,KAHD,MAGO,IAAIA,MAAM,YAAYxF,MAAM,CAACwI,WAA7B,EAA0C;AAC/C,UAAIC,UAAU,GAAGjD,MAAM,CAACkD,YAAP,CAAoB,aAApB,CAAjB;;AACA,UAAI,CAACD,UAAL,EAAiB;AACfA,QAAAA,UAAU,GAAGL,UAAU,EAAvB;AACA5C,QAAAA,MAAM,CAACmD,YAAP,CAAoB,aAApB,EAAmCF,UAAnC;AACD;;AAED,aAAOA,UAAP;AAED,KATM,MASA;AACLG,MAAAA,OAAO,CAACC,IAAR,CAAa,4DAAb,EAA2ErD,MAA3E;AACA,aAAO+C,YAAY,CAAC/C,MAAD,CAAnB;AACD;AACF;;AAED,WAAS+C,YAAT,CAAsBO,MAAtB,EAA8B;AAC5B,WAAOA,MAAM,CACVC,OADI,CACI,mBADJ,EACyB,EADzB,EAEJA,OAFI,CAEI,MAFJ,EAEY,EAFZ,CAAP;AAGD;;AAED,WAASC,mBAAT,CAA6BxD,MAA7B,EAAqCyD,SAArC,EAAgD;AAC9C,WAAOnI,MAAM,CAACf,EAAE,CAACqF,MAAH,CAAUI,MAAV,EAAkB0D,KAAlB,CAAwBD,SAAxB,EAAmCF,OAAnC,CAA2C,KAA3C,EAAkD,EAAlD,CAAD,CAAb;AACD;;AAED,WAASI,SAAT,CAAmB3D,MAAnB,EAA2B;AACzB,WAAOwD,mBAAmB,CAACxD,MAAD,EAAS,OAAT,CAA1B;AACD;;AAED,WAAS4D,UAAT,CAAoB5D,MAApB,EAA4B;AAC1B,WAAOwD,mBAAmB,CAACxD,MAAD,EAAS,QAAT,CAA1B;AACD;;AAED,WAAS6D,SAAT,CAAmBC,CAAnB,EAAsB;AACpB,WAAO,CAACC,KAAK,CAACC,UAAU,CAACF,CAAD,CAAX,CAAN,IAAyBG,QAAQ,CAACH,CAAD,CAAxC;AACD;;AAED,MAAII,IAAI,GAAG,UAASC,GAAT,EAAcC,QAAd,EAAwBC,OAAxB,EAAiC;AAC1C;AACA,QAAIC,OAAO,GAAG,EAAd;AACA,QAAIH,GAAG,KAAK,IAAZ,EAAkB,OAAOA,GAAP;;AAClB,QAAII,KAAK,CAACxH,SAAN,CAAgByH,OAAhB,IAA2BL,GAAG,CAACK,OAAJ,KAAgBD,KAAK,CAACxH,SAAN,CAAgByH,OAA/D,EAAwE;AACtEL,MAAAA,GAAG,CAACK,OAAJ,CAAYJ,QAAZ,EAAsBC,OAAtB;AACD,KAFD,MAEO,IAAIF,GAAG,CAAC/G,MAAJ,KAAe,CAAC+G,GAAG,CAAC/G,MAAxB,EAAgC;AACrC,WAAK,IAAI8D,CAAC,GAAG,CAAR,EAAW9D,MAAM,GAAG+G,GAAG,CAAC/G,MAA7B,EAAqC8D,CAAC,GAAG9D,MAAzC,EAAiD8D,CAAC,EAAlD,EAAsD;AACpD,YAAIkD,QAAQ,CAACnH,IAAT,CAAcoH,OAAd,EAAuBF,GAAG,CAACjD,CAAD,CAA1B,EAA+BA,CAA/B,EAAkCiD,GAAlC,MAA2CG,OAA/C,EAAwD;AACzD;AACF,KAJM,MAIA;AACL,WAAK,IAAIG,CAAT,IAAcN,GAAd,EAAmB;AACjB,YAAIC,QAAQ,CAACnH,IAAT,CAAcoH,OAAd,EAAuBF,GAAG,CAACM,CAAD,CAA1B,EAA+BA,CAA/B,EAAkCN,GAAlC,MAA2CG,OAA/C,EAAwD;AACzD;AACF;;AAED,WAAOH,GAAP;AACD,GAjBD;;AAmBA,WAASO,mBAAT,CAA6BP,GAA7B,EAAkC;AAChC;AACAD,IAAAA,IAAI,CAACK,KAAK,CAACxH,SAAN,CAAgB4H,KAAhB,CAAsB1H,IAAtB,CAA2B2H,SAA3B,EAAsC,CAAtC,CAAD,EAA2C,UAASC,MAAT,EAAiB;AAC9D,UAAIA,MAAJ,EAAY;AACV,aAAK,IAAIC,IAAT,IAAiBD,MAAjB,EAAyB;AACvB,cAAIV,GAAG,CAACW,IAAD,CAAH,KAAc,KAAK,CAAvB,EAA0BX,GAAG,CAACW,IAAD,CAAH,GAAYD,MAAM,CAACC,IAAD,CAAlB;AAC3B;AACF;AACF,KANG,CAAJ;AAQA,WAAOX,GAAP;AACD;;AAED7J,EAAAA,EAAE,CAACoK,mBAAH,GAAyBA,mBAAzB;;AAEA,WAASK,gBAAT,CAA0BlK,IAA1B,EAAgCC,QAAhC,EAA0CkK,KAA1C,EAAiD;AAC/C,QAAIC,MAAM,GAAGpK,IAAI,CAACqK,MAAL,CAAY,UAAS/J,CAAT,EAAY;AACnC,aAAOA,CAAC,CAACL,QAAD,CAAD,KAAgBkK,KAAvB;AACD,KAFY,CAAb;AAIA,WAAOC,MAAM,CAAC7H,MAAd;AACD;;AAED,WAAS+H,gBAAT,CAA0BtK,IAA1B,EAAgCC,QAAhC,EAA0CkK,KAA1C,EAAiD;AAC/C,QAAIC,MAAM,GAAGpK,IAAI,CAACqK,MAAL,CAAY,UAAS/J,CAAT,EAAY;AACnC,aAAOA,CAAC,CAACL,QAAD,CAAD,IAAekK,KAAtB;AACD,KAFY,CAAb;AAIA,WAAOC,MAAM,CAAC7H,MAAP,GAAgB,CAAvB;AACD;;AAED,WAASgI,kBAAT,CAA4BvK,IAA5B,EAAkCC,QAAlC,EAA4CuK,UAA5C,EAAwD;AACtD,WAAON,gBAAgB,CAAClK,IAAD,EAAOC,QAAP,EAAiB,CAAjB,CAAhB,IAAuCuK,UAA9C;AACD;;AAED,WAASC,UAAT,CAAoBnB,GAApB,EAAyB;AACvB,WAAOrH,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BkH,GAA/B,MAAwC,eAA/C;AACD;;AAED,WAASoB,YAAT,CAAsBpB,GAAtB,EAA2B;AACzB,WAAOrH,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BkH,GAA/B,MAAwC,iBAA/C;AACD;;AAED,WAASqB,WAAT,CAAqBrB,GAArB,EAA0B;AACxB,QAAII,KAAK,CAACkB,OAAV,EAAmB;AACjB,aAAOlB,KAAK,CAACkB,OAAN,CAActB,GAAd,CAAP;AACD;;AAED,WAAOrH,MAAM,CAACC,SAAP,CAAiBC,QAAjB,CAA0BC,IAA1B,CAA+BkH,GAA/B,MAAwC,gBAA/C;AACD,GAncoB,CAqcrB;AACA;;;AACA7J,EAAAA,EAAE,CAACoL,KAAH,GAAW,UAASvB,GAAT,EAAc;AACvB,QAAIwB,IAAJ,CADuB,CAGvB;;AACA,QAAI,SAASxB,GAAT,IAAgB,aAAa,OAAOA,GAAxC,EAA6C,OAAOA,GAAP,CAJtB,CAMvB;;AACA,QAAImB,UAAU,CAACnB,GAAD,CAAd,EAAqB;AACnBwB,MAAAA,IAAI,GAAG,IAAIC,IAAJ,EAAP;AACAD,MAAAA,IAAI,CAACE,OAAL,CAAa1B,GAAG,CAAC2B,OAAJ,EAAb;AACA,aAAOH,IAAP;AACD,KAXsB,CAavB;;;AACA,QAAIH,WAAW,CAACrB,GAAD,CAAf,EAAsB;AACpBwB,MAAAA,IAAI,GAAG,EAAP;;AACA,WAAK,IAAIzE,CAAC,GAAG,CAAR,EAAW6E,GAAG,GAAG5B,GAAG,CAAC/G,MAA1B,EAAkC8D,CAAC,GAAG6E,GAAtC,EAA2C7E,CAAC,EAA5C,EAAgD;AAC9CyE,QAAAA,IAAI,CAACzE,CAAD,CAAJ,GAAU5G,EAAE,CAACoL,KAAH,CAASvB,GAAG,CAACjD,CAAD,CAAZ,CAAV;AACD;;AACD,aAAOyE,IAAP;AACD,KApBsB,CAsBvB;;;AACA,QAAIJ,YAAY,CAACpB,GAAD,CAAhB,EAAuB;AACrBwB,MAAAA,IAAI,GAAG,EAAP;;AACA,WAAK,IAAItF,IAAT,IAAiB8D,GAAjB,EAAsB;AACpB,YAAIA,GAAG,CAAC6B,cAAJ,CAAmB3F,IAAnB,CAAJ,EAA8BsF,IAAI,CAACtF,IAAD,CAAJ,GAAa/F,EAAE,CAACoL,KAAH,CAASvB,GAAG,CAAC9D,IAAD,CAAZ,CAAb;AAC/B;;AACD,aAAOsF,IAAP;AACD;;AAED,UAAM,IAAIM,KAAJ,CAAU,+CAAV,CAAN;AACD,GAhCD,CAvcqB,CAyerB;AACA;;;AACA,WAASC,QAAT,CAAkBnI,CAAlB,EAAqBC,CAArB,EAAwB;AACtB,QAAImI,IAAI,GAAG,EAAX;AAAA,QACEC,IAAI,GAAG,EADT;AAAA,QAEElF,CAFF;;AAGA,SAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGlD,CAAC,CAACZ,MAAlB,EAA0B8D,CAAC,EAA3B,EACEiF,IAAI,CAACnI,CAAC,CAACkD,CAAD,CAAF,CAAJ,GAAa,IAAb;;AACF,SAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGnD,CAAC,CAACX,MAAlB,EAA0B8D,CAAC,EAA3B,EACE,IAAI,CAACiF,IAAI,CAACpI,CAAC,CAACmD,CAAD,CAAF,CAAT,EACEkF,IAAI,CAACC,IAAL,CAAUtI,CAAC,CAACmD,CAAD,CAAX;;AACJ,WAAOkF,IAAP;AACD;;AAED9L,EAAAA,EAAE,CAAC4L,QAAH,GAAcA,QAAd;AAEA;AACA;AACA;AACA;AACA;AACA;;AACA,WAASI,gBAAT,CAA0BC,OAA1B,EAAmCC,YAAnC,EAAiD;AAC/CpD,IAAAA,OAAO,CAACC,IAAR,CAAa,kBAAkBkD,OAAlB,IAA6BC,YAAY,GAAG,uCAAuCA,YAAvC,GAAsD,GAAzD,GAA+D,mBAAxG,CAAb;AACApD,IAAAA,OAAO,CAACqD,KAAR;AACD;;AAEDnM,EAAAA,EAAE,CAACgM,gBAAH,GAAsBA,gBAAtB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,WAASI,aAAT,CAAuBC,OAAvB,EAAgCC,UAAhC,EAA4C/H,KAA5C,EAAmD;AACjD,QAAIgI,IAAJ;AAAA,QACEC,QAAQ,GAAG,CADb;AAGAH,IAAAA,OAAO,CAACI,WAAR,GAAsBH,UAAtB;AACAC,IAAAA,IAAI,GAAGF,OAAO,CAACK,OAAR,EAAP;;AAEA,WAAOH,IAAI,CAAChI,KAAL,GAAaA,KAApB,EAA2B;AACzB8H,MAAAA,OAAO,CAACI,WAAR,GAAsBH,UAAU,CAACjC,KAAX,CAAiB,CAAjB,EAAoB,EAAEmC,QAAtB,IAAkC,KAAxD;AACAD,MAAAA,IAAI,GAAGF,OAAO,CAACK,OAAR,EAAP;;AAEA,UAAIL,OAAO,CAACI,WAAR,KAAwB,KAA5B,EAAmC;AACjC;AACD;AACF;AACF;;AAEDzM,EAAAA,EAAE,CAACoM,aAAH,GAAmBA,aAAnB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,WAASO,SAAT,CAAmBrF,IAAnB,EAAyB/C,KAAzB,EAAgCqI,KAAhC,EAAuCC,UAAvC,EAAmD;AACjDvF,IAAAA,IAAI,CAACsC,IAAL,CAAU,YAAW;AACnB,UAAItC,IAAI,GAAGrH,EAAE,CAACqF,MAAH,CAAU,IAAV,CAAX;AAAA,UACEwH,KAAK,GAAGxF,IAAI,CAACA,IAAL,GAAYyF,KAAZ,CAAkBH,KAAK,IAAI,KAA3B,EAAkC1F,OAAlC,EADV;AAAA,UAEE8F,IAFF;AAAA,UAGEC,IAAI,GAAG,EAHT;AAAA,UAIEC,UAAU,GAAG,CAJf;AAAA,UAKEC,UAAU,GAAG,GALf;AAAA,UAKoB;AAClBC,MAAAA,CAAC,GAAG9F,IAAI,CAACvB,IAAL,CAAU,GAAV,CANN;AAAA,UAOES,EAAE,GAAG,CAPP;AAAA,UAQE6G,KAAK,GAAG/F,IAAI,CAACA,IAAL,CAAU,IAAV,EACPnC,MADO,CACA,OADA,EAEPY,IAFO,CAEF,GAFE,EAEG,CAFH,EAGPA,IAHO,CAGF,GAHE,EAGGS,EAAE,GAAG,IAHR,EAIPT,IAJO,CAIF8G,UAAU,IAAI,EAJZ,CARV;;AAcA,aAAO,CAAC,EAAEG,IAAI,GAAGF,KAAK,CAACQ,GAAN,EAAT,CAAR,EAA+B;AAC7BL,QAAAA,IAAI,CAAClB,IAAL,CAAUiB,IAAV;AACAK,QAAAA,KAAK,CAAC/F,IAAN,CAAW2F,IAAI,CAACM,IAAL,CAAU,GAAV,CAAX;;AACA,YAAIhJ,KAAK,KAAK,IAAV,IAAkB8I,KAAK,CAAC1G,IAAN,GAAa6G,qBAAb,KAAuCjJ,KAA7D,EAAoE;AAClE0I,UAAAA,IAAI,CAACK,GAAL;AACAD,UAAAA,KAAK,CAAC/F,IAAN,CAAW2F,IAAI,CAACM,IAAL,CAAU,GAAV,CAAX;AACAN,UAAAA,IAAI,GAAG,CAACD,IAAD,CAAP;AACAK,UAAAA,KAAK,GAAG/F,IAAI,CACTnC,MADK,CACE,OADF,EAELY,IAFK,CAEA,GAFA,EAEK,CAFL,EAGLA,IAHK,CAGA,GAHA,EAGK,EAAEmH,UAAF,GAAeC,UAAf,GAA4B3G,EAA5B,GAAiC,IAHtC,EAILT,IAJK,CAIA8G,UAAU,IAAI,EAJd,EAKLvF,IALK,CAKA0F,IALA,CAAR;AAMD;AACF;AACF,KA9BD;AA+BD;;AAEDhN,EAAAA,EAAE,CAAC2M,SAAH,GAAeA,SAAf;;AAEA,WAASc,QAAT,CAAkBC,SAAlB,EAA6BC,UAA7B,EAAyCC,QAAzC,EAAmD;AACjD5N,IAAAA,EAAE,CAAC6N,MAAH,CAAUH,SAAV,IAAuB;AACrBC,MAAAA,UAAU,EAAEA,UADS;AAErBC,MAAAA,QAAQ,EAAEA,QAAQ,IAAI;AAFD,KAAvB;AAID;;AAED5N,EAAAA,EAAE,CAACyN,QAAH,GAAcA,QAAd;AAEA;AACA;AACA;AACA;;AACAzN,EAAAA,EAAE,CAAC8N,MAAH,GAAY,EAAZ;AAEA;AACA;AACA;AACA;AACA;;AACA9N,EAAAA,EAAE,CAAC+N,QAAH,GAAc,UAASC,IAAT,EAAeC,IAAf,EAAqBlE,OAArB,EAA8B;AAC1C,QAAImE,KAAJ;;AAEA,QAAI,CAAClO,EAAE,CAAC8N,MAAH,CAAUE,IAAV,CAAL,EAAsB;AACpBhO,MAAAA,EAAE,CAAC8N,MAAH,CAAUE,IAAV,IAAkB,EAAlB;AACD;;AAEDE,IAAAA,KAAK,GAAGlO,EAAE,CAAC8N,MAAH,CAAUE,IAAV,CAAR;AAEA,QAAIG,kBAAkB,GACpBD,KAAK,CAACtD,MAAN,CAAa,UAASwD,IAAT,EAAe;AAC1B,aAAOA,IAAI,CAACH,IAAL,KAAcA,IAArB;AACD,KAFD,EAGCnL,MAHD,GAGU,CAJZ;;AAMA,QAAIqL,kBAAJ,EAAwB;AACtB,YAAM,sCAAN;AACD;;AAEDD,IAAAA,KAAK,CAACnC,IAAN,CAAW;AACTkC,MAAAA,IAAI,EAAEA,IADG;AAETlE,MAAAA,OAAO,EAAEA;AAFA,KAAX;AAID,GAvBD;AAyBA;AACA;AACA;AACA;AACA;;;AACA/J,EAAAA,EAAE,CAACqO,SAAH,GAAe,UAASL,IAAT,EAAe;AAC5B,QAAIE,KAAK,GAAGlO,EAAE,CAAC8N,MAAH,CAAUE,IAAV,CAAZ;AAAA,QACEM,MAAM,GAAG,GAAGjE,KAAH,CAAShC,KAAT,CAAeiC,SAAf,EAA0B,CAAC,CAAD,CAA1B,CADX;AAAA,QAEE3I,SAFF;;AAIA,QAAIuM,KAAJ,EAAW;AACTA,MAAAA,KAAK,CAAChE,OAAN,CAAc,UAASkE,IAAT,EAAe;AAC3B,YAAIA,IAAI,CAACH,IAAT,EAAe;AACb,cAAIM,MAAM,GAAG5M,SAAS,IAAI2M,MAA1B;;AAEA,cAAIC,MAAM,IAAIA,MAAM,CAACC,WAAP,KAAuBvE,KAArC,EAA4C;AAC1CsE,YAAAA,MAAM,GAAG,CAACA,MAAD,CAAT;AACD;;AAEDA,UAAAA,MAAM,GAAG,GAAGnG,MAAH,CAAUC,KAAV,CAAgB,EAAhB,EAAoBkG,MAApB,CAAT;AACA5M,UAAAA,SAAS,GAAGyM,IAAI,CAACH,IAAL,CAAU5F,KAAV,CAAgB+F,IAAI,CAACrE,OAArB,EAA8BwE,MAA9B,CAAZ;AACD;AACF,OAXD;AAYD;;AAED,WAAO5M,SAAS,IAAI2M,MAApB;AACD,GArBD;;AAuBAtO,EAAAA,EAAE,CAACyO,OAAH,GAAa,EAAb;AACAzO,EAAAA,EAAE,CAAC0O,YAAH,GAAkB;AAChBC,IAAAA,iBAAiB,EAAE;AAAEC,MAAAA,WAAW,EAAE,WAAf;AAA4BxO,MAAAA,OAAO,EAAE;AAArC,KADH;AAEhByO,IAAAA,gBAAgB,EAAE;AAAED,MAAAA,WAAW,EAAE,UAAf;AAA2BxO,MAAAA,OAAO,EAAE;AAApC,KAFF;AAGhB0O,IAAAA,iBAAiB,EAAE;AAAEF,MAAAA,WAAW,EAAE,aAAf;AAA8BxO,MAAAA,OAAO,EAAE;AAAvC,KAHH;AAIhB2O,IAAAA,iBAAiB,EAAE;AAAEH,MAAAA,WAAW,EAAE,aAAf;AAA8BxO,MAAAA,OAAO,EAAE;AAAvC,KAJH;AAKhB4O,IAAAA,UAAU,EAAE;AAAEJ,MAAAA,WAAW,EAAE,wBAAf;AAAyCxO,MAAAA,OAAO,EAAE;AAAlD,KALI;AAMhB6O,IAAAA,gBAAgB,EAAE;AAAEL,MAAAA,WAAW,EAAE,kBAAf;AAAmCxO,MAAAA,OAAO,EAAE;AAA5C,KANF;AAOhB8O,IAAAA,mBAAmB,EAAE;AAAEN,MAAAA,WAAW,EAAE,aAAf;AAA8BxO,MAAAA,OAAO,EAAE;AAAvC;AAPL,GAAlB;AASAJ,EAAAA,EAAE,CAACyO,OAAH,CAAWU,IAAX,GAAkB,KAAlB;AACAnP,EAAAA,EAAE,CAACyO,OAAH,CAAWrO,OAAX,GAAqB,KAArB;AAEAJ,EAAAA,EAAE,CAAC6N,MAAH,GAAY,EAAZ;;AAEA7N,EAAAA,EAAE,CAACoP,YAAH,GAAkB,UAAS3N,IAAT,EAAe;AAC/B;;AACA,QAAImM,QAAQ,GAAG;AACbyB,MAAAA,eAAe,EAAE,KADJ;AAC+B;AAC5CC,MAAAA,iBAAiB,EAAE,KAFN;AAE+B;AAC5CC,MAAAA,0BAA0B,EAAE,IAHf;AAG+B;AAC5CC,MAAAA,MAAM,EAAE,EAJK;AAI+B;AAC5CC,MAAAA,aAAa,EAAE,EALF;AAK+B;AAC5CC,MAAAA,KAAK,EAAE,EANM;AAM+B;AAC5CC,MAAAA,eAAe,EAAE,KAPJ;AAO+B;AAC5C1L,MAAAA,GAAG,EAAE,EARQ;AAQ+B;AAC5C2L,MAAAA,gBAAgB,EAAE,EATL;AAS+B;AAC5CC,MAAAA,uBAAuB,EAAE,KAVZ;AAU+B;AAC5ChM,MAAAA,MAAM,EAAE,EAXK;AAW+B;AAC5CW,MAAAA,KAAK,EAAE,EAZM;AAY+B;AAC5CJ,MAAAA,IAAI,EAAE,EAbO;AAa+B;AAC5CL,MAAAA,MAAM,EAAE,CAdK;AAc+B;AAC5CQ,MAAAA,KAAK,EAAE,GAfM;AAe+B;AAC5CX,MAAAA,MAAM,EAAE,GAhBK;AAgB+B;AAC5CkM,MAAAA,UAAU,EAAE,KAjBC;AAiB+B;AAC5CC,MAAAA,WAAW,EAAE,KAlBA;AAkB+B;AAC5CC,MAAAA,sBAAsB,EAAE,GAnBX;AAmB+B;AAC5CC,MAAAA,qBAAqB,EAAE,GApBV;AAoB+B;AAC5CC,MAAAA,SAAS,EAAE,CArBE;AAqB+B;AAC5CC,MAAAA,eAAe,EAAE,CAtBJ;AAsB+B;AAC5CC,MAAAA,gBAAgB,EAAE,IAvBL;AAwBbC,MAAAA,SAAS,EAAE,CAxBE;AAwB+B;AAC5CC,MAAAA,eAAe,EAAE,CAzBJ;AAyB+B;AAC5CC,MAAAA,gBAAgB,EAAE,KA1BL;AA0B+B;AAC5CC,MAAAA,gBAAgB,EAAE,KA3BL;AA2B+B;AAC5CC,MAAAA,YAAY,EAAE,QA5BD;AA6BbvO,MAAAA,KAAK,EAAE,IA7BM;AA8BbG,MAAAA,KAAK,EAAE,IA9BM;AA+BbJ,MAAAA,KAAK,EAAE,IA/BM;AAgCbG,MAAAA,KAAK,EAAE,IAhCM;AAgC+B;AAC5CsO,MAAAA,eAAe,EAAE,KAjCJ;AAiC+B;AAC5CC,MAAAA,UAAU,EAAE,GAlCC;AAkC+B;AAC5C3O,MAAAA,UAAU,EAAE,MAnCC;AAoCb4O,MAAAA,SAAS,EAAE,EApCE;AAqCbC,MAAAA,OAAO,EAAE,EArCI;AAsCbC,MAAAA,MAAM,EAAE,IAtCK;AAuCbC,MAAAA,MAAM,EAAE,IAvCK;AAwCbC,MAAAA,MAAM,EAAE,IAxCK;AAyCbC,MAAAA,eAAe,EAAE,QAzCJ;AA0CbC,MAAAA,eAAe,EAAE,MA1CJ;AA2CbC,MAAAA,WAAW,EAAE,IA3CA;AA2C+B;AAC5CC,MAAAA,WAAW,EAAE,IA5CA;AA4C+B;AAC5CC,MAAAA,eAAe,EAAE,IA7CJ;AA8CbC,MAAAA,eAAe,EAAC,IA9CH;AA+CbC,MAAAA,oBAAoB,EAAE,IA/CT;AA+C+B;AAC5CC,MAAAA,0BAA0B,EAAE,EAhDf;AAgD+B;AAC5CC,MAAAA,yBAAyB,EAAC,GAjDb;AAiD+B;AAC5CC,MAAAA,+BAA+B,EAAE,CAlDpB;AAkD+B;AAC5CC,MAAAA,oBAAoB,EAAE,IAnDT;AAmD+B;AAC5CC,MAAAA,0BAA0B,EAAE,EApDf;AAoD+B;AAC5CC,MAAAA,yBAAyB,EAAC,GArDb;AAqD+B;AAC5CC,MAAAA,+BAA+B,EAAE,CAtDpB;AAsD+B;AAC5CC,MAAAA,yBAAyB,EAAE,KAvDd;AAwDbC,MAAAA,wBAAwB,EAAE,KAxDb;AAyDbC,MAAAA,eAAe,EAAE,CAzDJ;AA0DbC,MAAAA,eAAe,EAAE,CA1DJ;AA2Db/P,MAAAA,UAAU,EAAE,OA3DC;AA4DbgQ,MAAAA,OAAO,EAAE,EA5DI;AA6DbC,MAAAA,SAAS,EAAE,EA7DE;AA8DbC,MAAAA,gBAAgB,EAAE,KA9DL;AA+DbC,MAAAA,KAAK,EAAE,KA/DM;AAgEbC,MAAAA,KAAK,EAAE,KAhEM;AAiEbC,MAAAA,eAAe,EAAE,OAjEJ;AAiE+B;AAC5CC,MAAAA,WAAW,EAAE,IAlEA;AAmEbC,MAAAA,WAAW,EAAE,IAnEA;AAoEbC,MAAAA,oBAAoB,EAAE,IApET;AAqEbC,MAAAA,SAAS,EAAE,IArEE;AAsEbC,MAAAA,KAAK,EAAE,IAtEM;AAuEbC,MAAAA,kBAAkB,EAAE,IAvEP;AAwEbC,MAAAA,oBAAoB,EAAE,IAxET;AAwE+B;AAC5CC,MAAAA,UAAU,EAAE,IAzEC;AAyE+B;AAC5CC,MAAAA,IAAI,EAAE,IA1EO;AA2EbC,MAAAA,UAAU,EAAE,MA3EC;AA4Eb3S,MAAAA,IAAI,EAAE,EA5EO;AA6Eb4S,MAAAA,QAAQ,EAAE,CA7EG;AA6E+B;AAC5CC,MAAAA,MAAM,EAAE,OA9EK;AA8E+B;AAC5CC,MAAAA,QAAQ,EAAE,KAAG,CA/EA;AA+E+B;AAC5CC,MAAAA,MAAM,EAAE,KAhFK;AAgF+B;AAC5CC,MAAAA,aAAa,EAAE,UAjFF;AAiF+B;AAC5CC,MAAAA,IAAI,EAAE,KAlFO;AAmFbC,MAAAA,SAAS,EAAE,IAnFE;AAmF+B;AAC5CC,MAAAA,OAAO,EAAE,IApFI;AAoF+B;AAC5CvN,MAAAA,QAAQ,EAAE,EArFG;AAsFbwN,MAAAA,MAAM,EAAE,EAtFK;AAuFb9R,MAAAA,QAAQ,EAAE,KAvFG;AAwFb+R,MAAAA,cAAc,EAAE,KAxFH;AAyFbC,MAAAA,iBAAiB,EAAE,KAzFN;AA0FbC,MAAAA,sBAAsB,EAAE,IA1FX;AA2FbpO,MAAAA,MAAM,EAAE,MA3FK;AA4FbqO,MAAAA,WAAW,EAAE9T,EAAE,CAAC+T,eAAH,CAAmBC,KAAnB,CAAyB,CAAzB,CA5FA;AA4F+B;AAC5CC,MAAAA,qBAAqB,EAAE,EA7FV;AA6F+B;AAC5CC,MAAAA,MAAM,EAAE,IA9FK;AA8F+B;AAC5CC,MAAAA,aAAa,EAAE,IA/FF;AA+F+B;AAC5CC,MAAAA,kBAAkB,EAAE,KAhGP;AAgG+B;AAC5CC,MAAAA,aAAa,EAAE,IAjGF,CAiG+B;;AAjG/B,KAAf;AAoGAtU,IAAAA,EAAE,CAACqO,SAAH,CAAa,iBAAb,EAAgCT,QAAhC;;AAEA,QAAI,CAACnM,IAAL,EAAW;AAAEA,MAAAA,IAAI,GAAG,EAAP;AAAY;;AAEzB,QAAI8S,cAAc,GAAGvU,EAAE,CAAC6N,MAAH,CAAUpM,IAAI,CAACyR,UAAL,IAAmBtF,QAAQ,CAACsF,UAAtC,CAArB;AACA9I,IAAAA,mBAAmB,CAAC3I,IAAD,EAAO8S,cAAc,CAAC3G,QAAtB,EAAgCA,QAAhC,CAAnB;;AAEA,QAAInM,IAAI,CAAC+R,IAAT,EAAe;AACb/R,MAAAA,IAAI,CAACO,UAAL,GAAkB,CAAlB;AACAP,MAAAA,IAAI,CAACU,UAAL,GAAkB,CAAlB;AACD,KAhH8B,CAkH/B;;;AACA,SAAK,IAAIqS,GAAT,IAAgBxU,EAAE,CAAC0O,YAAnB,EAAiC;AAC/B,UAAIjN,IAAI,CAACiK,cAAL,CAAoB8I,GAApB,CAAJ,EAA8B;AAC5B,YAAIC,WAAW,GAAGzU,EAAE,CAAC0O,YAAH,CAAgB8F,GAAhB,CAAlB;AAAA,YACEvI,OAAO,GAAG,kBAAkBuI,GAAlB,GAAwB,uBADpC;AAAA,YAEE5F,WAAW,GAAG6F,WAAW,CAAC7F,WAF5B;AAAA,YAGExO,OAHF,CAD4B,CAM5B;;AACA,YAAIwO,WAAJ,EAAiB;AACf,cAAInN,IAAI,CAACmN,WAAD,CAAR,EAAuB;AACrB3C,YAAAA,OAAO,IAAI,+BAA+B2C,WAA/B,GAA6C,kEAAxD;AACD,WAFD,MAEO;AACLnN,YAAAA,IAAI,CAACmN,WAAD,CAAJ,GAAoBnN,IAAI,CAAC+S,GAAD,CAAxB;AACD;AACF;;AAED,YAAIC,WAAW,CAACC,MAAhB,EAAwB;AACtB;AACD;;AAEDD,QAAAA,WAAW,CAACC,MAAZ,GAAqB,IAArB;;AAEA,YAAI9F,WAAJ,EAAiB;AACf3C,UAAAA,OAAO,IAAI,wBAAwB2C,WAAxB,GAAsC,GAAjD;AACD;;AAED5C,QAAAA,gBAAgB,CAACC,OAAD,EAAUwI,WAAW,CAACrU,OAAtB,CAAhB;AACD;AACF;;AAEDJ,IAAAA,EAAE,CAACqO,SAAH,CAAa,oBAAb,EAAmC5M,IAAnC;AAEA,QAAI8S,cAAc,CAAC5G,UAAnB,CAA8BlM,IAA9B;AAEA,WAAOA,IAAI,CAAClB,IAAZ;AACD,GAtJD;;AAwJA,MAAIc,gBAAgB,EAApB,EAAwB;AACpB;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AAGI,KAAC,UAAUE,CAAV,EAAa;AACZ,mBADY,CAGZ;AACA;;AAEA,UAAIoT,OAAO,GAAG,UAAUlN,OAAV,EAAmBmN,OAAnB,EAA4B;AACxC,aAAKC,IAAL,GAAkB,IAAlB;AACA,aAAKD,OAAL,GAAkB,IAAlB;AACA,aAAKE,OAAL,GAAkB,IAAlB;AACA,aAAKC,OAAL,GAAkB,IAAlB;AACA,aAAKC,UAAL,GAAkB,IAAlB;AACA,aAAKC,QAAL,GAAkB,IAAlB;AACA,aAAKC,OAAL,GAAkB,IAAlB;AAEA,aAAKC,IAAL,CAAU,SAAV,EAAqB1N,OAArB,EAA8BmN,OAA9B;AACD,OAVD;;AAYAD,MAAAA,OAAO,CAACS,OAAR,GAAmB,OAAnB;AAEAT,MAAAA,OAAO,CAACU,mBAAR,GAA8B,GAA9B;AAEAV,MAAAA,OAAO,CAACW,QAAR,GAAmB;AACjBC,QAAAA,SAAS,EAAE,IADM;AAEjBC,QAAAA,SAAS,EAAE,KAFM;AAGjBC,QAAAA,QAAQ,EAAE,KAHO;AAIjBC,QAAAA,QAAQ,EAAE,8GAJO;AAKjBC,QAAAA,OAAO,EAAE,aALQ;AAMjBC,QAAAA,KAAK,EAAE,EANU;AAOjBC,QAAAA,KAAK,EAAE,CAPU;AAQjBC,QAAAA,IAAI,EAAE,KARW;AASjBC,QAAAA,SAAS,EAAE,KATM;AAUjBC,QAAAA,QAAQ,EAAE;AACRP,UAAAA,QAAQ,EAAE,MADF;AAERQ,UAAAA,OAAO,EAAE;AAFD;AAVO,OAAnB;;AAgBAtB,MAAAA,OAAO,CAAClS,SAAR,CAAkB0S,IAAlB,GAAyB,UAAUN,IAAV,EAAgBpN,OAAhB,EAAyBmN,OAAzB,EAAkC;AACzD,aAAKE,OAAL,GAAiB,IAAjB;AACA,aAAKD,IAAL,GAAiBA,IAAjB;AACA,aAAKI,QAAL,GAAiB1T,CAAC,CAACkG,OAAD,CAAlB;AACA,aAAKmN,OAAL,GAAiB,KAAKsB,UAAL,CAAgBtB,OAAhB,CAAjB;AACA,aAAKuB,SAAL,GAAiB,KAAKvB,OAAL,CAAaoB,QAAb,IAAyBzU,CAAC,CAACA,CAAC,CAAC6U,UAAF,CAAa,KAAKxB,OAAL,CAAaoB,QAA1B,IAAsC,KAAKpB,OAAL,CAAaoB,QAAb,CAAsBrT,IAAtB,CAA2B,IAA3B,EAAiC,KAAKsS,QAAtC,CAAtC,GAAyF,KAAKL,OAAL,CAAaoB,QAAb,CAAsBP,QAAtB,IAAkC,KAAKb,OAAL,CAAaoB,QAAzI,CAA3C;AACA,aAAKd,OAAL,GAAiB;AAAErC,UAAAA,KAAK,EAAE,KAAT;AAAgBwD,UAAAA,KAAK,EAAE,KAAvB;AAA8BC,UAAAA,KAAK,EAAE;AAArC,SAAjB;;AAEA,YAAI,KAAKrB,QAAL,CAAc,CAAd,aAA4BsB,QAAQ,CAAC/H,WAArC,IAAoD,CAAC,KAAKoG,OAAL,CAAaa,QAAtE,EAAgF;AAC9E,gBAAM,IAAI9J,KAAJ,CAAU,2DAA2D,KAAKkJ,IAAhE,GAAuE,iCAAjF,CAAN;AACD;;AAED,YAAI2B,QAAQ,GAAG,KAAK5B,OAAL,CAAae,OAAb,CAAqB5I,KAArB,CAA2B,GAA3B,CAAf;;AAEA,aAAK,IAAInG,CAAC,GAAG4P,QAAQ,CAAC1T,MAAtB,EAA8B8D,CAAC,EAA/B,GAAoC;AAClC,cAAI+O,OAAO,GAAGa,QAAQ,CAAC5P,CAAD,CAAtB;;AAEA,cAAI+O,OAAO,IAAI,OAAf,EAAwB;AACtB,iBAAKV,QAAL,CAAcwB,EAAd,CAAiB,WAAW,KAAK5B,IAAjC,EAAuC,KAAKD,OAAL,CAAaa,QAApD,EAA8DlU,CAAC,CAACmV,KAAF,CAAQ,KAAKC,MAAb,EAAqB,IAArB,CAA9D;AACD,WAFD,MAEO,IAAIhB,OAAO,IAAI,QAAf,EAAyB;AAC9B,gBAAIiB,OAAO,GAAIjB,OAAO,IAAI,OAAX,GAAqB,YAArB,GAAoC,SAAnD;AACA,gBAAIkB,QAAQ,GAAGlB,OAAO,IAAI,OAAX,GAAqB,YAArB,GAAoC,UAAnD;AAEA,iBAAKV,QAAL,CAAcwB,EAAd,CAAiBG,OAAO,GAAI,GAAX,GAAiB,KAAK/B,IAAvC,EAA6C,KAAKD,OAAL,CAAaa,QAA1D,EAAoElU,CAAC,CAACmV,KAAF,CAAQ,KAAK5Q,KAAb,EAAoB,IAApB,CAApE;AACA,iBAAKmP,QAAL,CAAcwB,EAAd,CAAiBI,QAAQ,GAAG,GAAX,GAAiB,KAAKhC,IAAvC,EAA6C,KAAKD,OAAL,CAAaa,QAA1D,EAAoElU,CAAC,CAACmV,KAAF,CAAQ,KAAKI,KAAb,EAAoB,IAApB,CAApE;AACD;AACF;;AAED,aAAKlC,OAAL,CAAaa,QAAb,GACG,KAAKsB,QAAL,GAAgBxV,CAAC,CAACyV,MAAF,CAAS,EAAT,EAAa,KAAKpC,OAAlB,EAA2B;AAAEe,UAAAA,OAAO,EAAE,QAAX;AAAqBF,UAAAA,QAAQ,EAAE;AAA/B,SAA3B,CADnB,GAEE,KAAKwB,QAAL,EAFF;AAGD,OA/BD;;AAiCAtC,MAAAA,OAAO,CAAClS,SAAR,CAAkByU,WAAlB,GAAgC,YAAY;AAC1C,eAAOvC,OAAO,CAACW,QAAf;AACD,OAFD;;AAIAX,MAAAA,OAAO,CAAClS,SAAR,CAAkByT,UAAlB,GAA+B,UAAUtB,OAAV,EAAmB;AAChDA,QAAAA,OAAO,GAAGrT,CAAC,CAACyV,MAAF,CAAS,EAAT,EAAa,KAAKE,WAAL,EAAb,EAAiC,KAAKjC,QAAL,CAAc1U,IAAd,EAAjC,EAAuDqU,OAAvD,CAAV;;AAEA,YAAIA,OAAO,CAACiB,KAAR,IAAiB,OAAOjB,OAAO,CAACiB,KAAf,IAAwB,QAA7C,EAAuD;AACrDjB,UAAAA,OAAO,CAACiB,KAAR,GAAgB;AACdsB,YAAAA,IAAI,EAAEvC,OAAO,CAACiB,KADA;AAEduB,YAAAA,IAAI,EAAExC,OAAO,CAACiB;AAFA,WAAhB;AAID;;AAED,eAAOjB,OAAP;AACD,OAXD;;AAaAD,MAAAA,OAAO,CAAClS,SAAR,CAAkB4U,kBAAlB,GAAuC,YAAY;AACjD,YAAIzC,OAAO,GAAI,EAAf;AACA,YAAIhH,QAAQ,GAAG,KAAKsJ,WAAL,EAAf;AAEA,aAAKH,QAAL,IAAiBxV,CAAC,CAACqI,IAAF,CAAO,KAAKmN,QAAZ,EAAsB,UAAUvC,GAAV,EAAe9J,KAAf,EAAsB;AAC3D,cAAIkD,QAAQ,CAAC4G,GAAD,CAAR,IAAiB9J,KAArB,EAA4BkK,OAAO,CAACJ,GAAD,CAAP,GAAe9J,KAAf;AAC7B,SAFgB,CAAjB;AAIA,eAAOkK,OAAP;AACD,OATD;;AAWAD,MAAAA,OAAO,CAAClS,SAAR,CAAkBqD,KAAlB,GAA0B,UAAU+D,GAAV,EAAe;AACvC,YAAIyN,IAAI,GAAGzN,GAAG,YAAY,KAAK2E,WAApB,GACT3E,GADS,GACHtI,CAAC,CAACsI,GAAG,CAAC0N,aAAL,CAAD,CAAqBhX,IAArB,CAA0B,QAAQ,KAAKsU,IAAvC,CADR;;AAGA,YAAI,CAACyC,IAAL,EAAW;AACTA,UAAAA,IAAI,GAAG,IAAI,KAAK9I,WAAT,CAAqB3E,GAAG,CAAC0N,aAAzB,EAAwC,KAAKF,kBAAL,EAAxC,CAAP;AACA9V,UAAAA,CAAC,CAACsI,GAAG,CAAC0N,aAAL,CAAD,CAAqBhX,IAArB,CAA0B,QAAQ,KAAKsU,IAAvC,EAA6CyC,IAA7C;AACD;;AAED,YAAIzN,GAAG,YAAYtI,CAAC,CAACiW,KAArB,EAA4B;AAC1BF,UAAAA,IAAI,CAACpC,OAAL,CAAarL,GAAG,CAACgL,IAAJ,IAAY,SAAZ,GAAwB,OAAxB,GAAkC,OAA/C,IAA0D,IAA1D;AACD;;AAED,YAAIyC,IAAI,CAACG,GAAL,GAAWC,QAAX,CAAoB,IAApB,KAA6BJ,IAAI,CAACtC,UAAL,IAAmB,IAApD,EAA0D;AACxDsC,UAAAA,IAAI,CAACtC,UAAL,GAAkB,IAAlB;AACA;AACD;;AAED2C,QAAAA,YAAY,CAACL,IAAI,CAACvC,OAAN,CAAZ;AAEAuC,QAAAA,IAAI,CAACtC,UAAL,GAAkB,IAAlB;AAEA,YAAI,CAACsC,IAAI,CAAC1C,OAAL,CAAaiB,KAAd,IAAuB,CAACyB,IAAI,CAAC1C,OAAL,CAAaiB,KAAb,CAAmBsB,IAA/C,EAAqD,OAAOG,IAAI,CAACH,IAAL,EAAP;AAErDG,QAAAA,IAAI,CAACvC,OAAL,GAAe6C,UAAU,CAAC,YAAY;AACpC,cAAIN,IAAI,CAACtC,UAAL,IAAmB,IAAvB,EAA6BsC,IAAI,CAACH,IAAL;AAC9B,SAFwB,EAEtBG,IAAI,CAAC1C,OAAL,CAAaiB,KAAb,CAAmBsB,IAFG,CAAzB;AAGD,OA3BD;;AA6BAxC,MAAAA,OAAO,CAAClS,SAAR,CAAkBoV,aAAlB,GAAkC,YAAY;AAC5C,aAAK,IAAIrD,GAAT,IAAgB,KAAKU,OAArB,EAA8B;AAC5B,cAAI,KAAKA,OAAL,CAAaV,GAAb,CAAJ,EAAuB,OAAO,IAAP;AACxB;;AAED,eAAO,KAAP;AACD,OAND;;AAQAG,MAAAA,OAAO,CAAClS,SAAR,CAAkBqU,KAAlB,GAA0B,UAAUjN,GAAV,EAAe;AACvC,YAAIyN,IAAI,GAAGzN,GAAG,YAAY,KAAK2E,WAApB,GACT3E,GADS,GACHtI,CAAC,CAACsI,GAAG,CAAC0N,aAAL,CAAD,CAAqBhX,IAArB,CAA0B,QAAQ,KAAKsU,IAAvC,CADR;;AAGA,YAAI,CAACyC,IAAL,EAAW;AACTA,UAAAA,IAAI,GAAG,IAAI,KAAK9I,WAAT,CAAqB3E,GAAG,CAAC0N,aAAzB,EAAwC,KAAKF,kBAAL,EAAxC,CAAP;AACA9V,UAAAA,CAAC,CAACsI,GAAG,CAAC0N,aAAL,CAAD,CAAqBhX,IAArB,CAA0B,QAAQ,KAAKsU,IAAvC,EAA6CyC,IAA7C;AACD;;AAED,YAAIzN,GAAG,YAAYtI,CAAC,CAACiW,KAArB,EAA4B;AAC1BF,UAAAA,IAAI,CAACpC,OAAL,CAAarL,GAAG,CAACgL,IAAJ,IAAY,UAAZ,GAAyB,OAAzB,GAAmC,OAAhD,IAA2D,KAA3D;AACD;;AAED,YAAIyC,IAAI,CAACO,aAAL,EAAJ,EAA0B;AAE1BF,QAAAA,YAAY,CAACL,IAAI,CAACvC,OAAN,CAAZ;AAEAuC,QAAAA,IAAI,CAACtC,UAAL,GAAkB,KAAlB;AAEA,YAAI,CAACsC,IAAI,CAAC1C,OAAL,CAAaiB,KAAd,IAAuB,CAACyB,IAAI,CAAC1C,OAAL,CAAaiB,KAAb,CAAmBuB,IAA/C,EAAqD,OAAOE,IAAI,CAACF,IAAL,EAAP;AAErDE,QAAAA,IAAI,CAACvC,OAAL,GAAe6C,UAAU,CAAC,YAAY;AACpC,cAAIN,IAAI,CAACtC,UAAL,IAAmB,KAAvB,EAA8BsC,IAAI,CAACF,IAAL;AAC/B,SAFwB,EAEtBE,IAAI,CAAC1C,OAAL,CAAaiB,KAAb,CAAmBuB,IAFG,CAAzB;AAGD,OAxBD;;AA0BAzC,MAAAA,OAAO,CAAClS,SAAR,CAAkB0U,IAAlB,GAAyB,YAAY;AACnC,YAAIW,CAAC,GAAGvW,CAAC,CAACiW,KAAF,CAAQ,aAAa,KAAK3C,IAA1B,CAAR;;AAEA,YAAI,KAAKkD,UAAL,MAAqB,KAAKjD,OAA9B,EAAuC;AACrC,eAAKG,QAAL,CAAcU,OAAd,CAAsBmC,CAAtB;AAEA,cAAIE,KAAK,GAAGzW,CAAC,CAAC0W,QAAF,CAAW,KAAKhD,QAAL,CAAc,CAAd,EAAiBiD,aAAjB,CAA+BC,eAA1C,EAA2D,KAAKlD,QAAL,CAAc,CAAd,CAA3D,CAAZ;AACA,cAAI6C,CAAC,CAACM,kBAAF,MAA0B,CAACJ,KAA/B,EAAsC;AACtC,cAAIK,IAAI,GAAG,IAAX;AAEA,cAAIC,IAAI,GAAG,KAAKb,GAAL,EAAX;AAEA,cAAIc,KAAK,GAAG,KAAKC,MAAL,CAAY,KAAK3D,IAAjB,CAAZ;AAEA,eAAK4D,UAAL;AACAH,UAAAA,IAAI,CAACvS,IAAL,CAAU,IAAV,EAAgBwS,KAAhB;AACA,eAAKtD,QAAL,CAAclP,IAAd,CAAmB,kBAAnB,EAAuCwS,KAAvC;AAEA,cAAI,KAAK3D,OAAL,CAAaW,SAAjB,EAA4B+C,IAAI,CAACI,QAAL,CAAc,MAAd;AAE5B,cAAIlD,SAAS,GAAG,OAAO,KAAKZ,OAAL,CAAaY,SAApB,IAAiC,UAAjC,GACd,KAAKZ,OAAL,CAAaY,SAAb,CAAuB7S,IAAvB,CAA4B,IAA5B,EAAkC2V,IAAI,CAAC,CAAD,CAAtC,EAA2C,KAAKrD,QAAL,CAAc,CAAd,CAA3C,CADc,GAEd,KAAKL,OAAL,CAAaY,SAFf;AAIA,cAAImD,SAAS,GAAG,cAAhB;AACA,cAAIC,SAAS,GAAGD,SAAS,CAACE,IAAV,CAAerD,SAAf,CAAhB;AACA,cAAIoD,SAAJ,EAAepD,SAAS,GAAGA,SAAS,CAACvM,OAAV,CAAkB0P,SAAlB,EAA6B,EAA7B,KAAoC,KAAhD;AAEfL,UAAAA,IAAI,CACDQ,MADH,GAEGC,GAFH,CAEO;AAAE9U,YAAAA,GAAG,EAAE,CAAP;AAAUG,YAAAA,IAAI,EAAE,CAAhB;AAAmB4U,YAAAA,OAAO,EAAE;AAA5B,WAFP,EAGGN,QAHH,CAGYlD,SAHZ,EAIGjV,IAJH,CAIQ,QAAQ,KAAKsU,IAJrB,EAI2B,IAJ3B;AAMA,eAAKD,OAAL,CAAamB,SAAb,GAAyBuC,IAAI,CAACW,QAAL,CAAc,KAAKrE,OAAL,CAAamB,SAA3B,CAAzB,GAAiEuC,IAAI,CAACY,WAAL,CAAiB,KAAKjE,QAAtB,CAAjE;AACA,eAAKA,QAAL,CAAcU,OAAd,CAAsB,iBAAiB,KAAKd,IAA5C;AAEA,cAAIsE,GAAG,GAAY,KAAKC,WAAL,EAAnB;AACA,cAAIC,WAAW,GAAIf,IAAI,CAAC,CAAD,CAAJ,CAAQgB,WAA3B;AACA,cAAIC,YAAY,GAAGjB,IAAI,CAAC,CAAD,CAAJ,CAAQkB,YAA3B;;AAEA,cAAIZ,SAAJ,EAAe;AACb,gBAAIa,YAAY,GAAGjE,SAAnB;AACA,gBAAIkE,WAAW,GAAG,KAAKN,WAAL,CAAiB,KAAKjD,SAAtB,CAAlB;AAEAX,YAAAA,SAAS,GAAGA,SAAS,IAAI,QAAb,IAAyB2D,GAAG,CAACtV,MAAJ,GAAa0V,YAAb,GAA4BG,WAAW,CAAC7V,MAAjE,GAA0E,KAA1E,GACA2R,SAAS,IAAI,KAAb,IAAyB2D,GAAG,CAAClV,GAAJ,GAAasV,YAAb,GAA4BG,WAAW,CAACzV,GAAjE,GAA0E,QAA1E,GACAuR,SAAS,IAAI,OAAb,IAAyB2D,GAAG,CAAC3U,KAAJ,GAAa6U,WAAb,GAA4BK,WAAW,CAACnV,KAAjE,GAA0E,MAA1E,GACAiR,SAAS,IAAI,MAAb,IAAyB2D,GAAG,CAAC/U,IAAJ,GAAaiV,WAAb,GAA4BK,WAAW,CAACtV,IAAjE,GAA0E,OAA1E,GACAoR,SAJZ;AAMA8C,YAAAA,IAAI,CACDqB,WADH,CACeF,YADf,EAEGf,QAFH,CAEYlD,SAFZ;AAGD;;AAED,cAAIoE,gBAAgB,GAAG,KAAKC,mBAAL,CAAyBrE,SAAzB,EAAoC2D,GAApC,EAAyCE,WAAzC,EAAsDE,YAAtD,CAAvB;AAEA,eAAKO,cAAL,CAAoBF,gBAApB,EAAsCpE,SAAtC;;AAEA,cAAIuE,QAAQ,GAAG,YAAY;AACzB,gBAAIC,cAAc,GAAG3B,IAAI,CAACrD,UAA1B;AACAqD,YAAAA,IAAI,CAACpD,QAAL,CAAcU,OAAd,CAAsB,cAAc0C,IAAI,CAACxD,IAAzC;AACAwD,YAAAA,IAAI,CAACrD,UAAL,GAAkB,IAAlB;AAEA,gBAAIgF,cAAc,IAAI,KAAtB,EAA6B3B,IAAI,CAACvB,KAAL,CAAWuB,IAAX;AAC9B,WAND;;AAQA9W,UAAAA,CAAC,CAAC0Y,OAAF,CAAUC,UAAV,IAAwB,KAAK5B,IAAL,CAAUZ,QAAV,CAAmB,MAAnB,CAAxB,GACEY,IAAI,CACD6B,GADH,CACO,iBADP,EAC0BJ,QAD1B,EAEGK,oBAFH,CAEwBzF,OAAO,CAACU,mBAFhC,CADF,GAIE0E,QAAQ,EAJV;AAKD;AACF,OA1ED;;AA4EApF,MAAAA,OAAO,CAAClS,SAAR,CAAkBqX,cAAlB,GAAmC,UAAUO,MAAV,EAAkB7E,SAAlB,EAA6B;AAC9D,YAAI8C,IAAI,GAAK,KAAKb,GAAL,EAAb;AACA,YAAIlT,KAAK,GAAI+T,IAAI,CAAC,CAAD,CAAJ,CAAQgB,WAArB;AACA,YAAI1V,MAAM,GAAG0U,IAAI,CAAC,CAAD,CAAJ,CAAQkB,YAArB,CAH8D,CAK9D;;AACA,YAAIc,SAAS,GAAGC,QAAQ,CAACjC,IAAI,CAACS,GAAL,CAAS,YAAT,CAAD,EAAyB,EAAzB,CAAxB;AACA,YAAIyB,UAAU,GAAGD,QAAQ,CAACjC,IAAI,CAACS,GAAL,CAAS,aAAT,CAAD,EAA0B,EAA1B,CAAzB,CAP8D,CAS9D;;AACA,YAAItP,KAAK,CAAC6Q,SAAD,CAAT,EAAuBA,SAAS,GAAI,CAAb;AACvB,YAAI7Q,KAAK,CAAC+Q,UAAD,CAAT,EAAuBA,UAAU,GAAG,CAAb;AAEvBH,QAAAA,MAAM,CAACpW,GAAP,IAAeqW,SAAf;AACAD,QAAAA,MAAM,CAACjW,IAAP,IAAeoW,UAAf,CAd8D,CAgB9D;AACA;;AACAjZ,QAAAA,CAAC,CAAC8Y,MAAF,CAASI,SAAT,CAAmBnC,IAAI,CAAC,CAAD,CAAvB,EAA4B/W,CAAC,CAACyV,MAAF,CAAS;AACnC0D,UAAAA,KAAK,EAAE,UAAUC,KAAV,EAAiB;AACtBrC,YAAAA,IAAI,CAACS,GAAL,CAAS;AACP9U,cAAAA,GAAG,EAAE2W,IAAI,CAACC,KAAL,CAAWF,KAAK,CAAC1W,GAAjB,CADE;AAEPG,cAAAA,IAAI,EAAEwW,IAAI,CAACC,KAAL,CAAWF,KAAK,CAACvW,IAAjB;AAFC,aAAT;AAID;AANkC,SAAT,EAOzBiW,MAPyB,CAA5B,EAOY,CAPZ;AASA/B,QAAAA,IAAI,CAACI,QAAL,CAAc,IAAd,EA3B8D,CA6B9D;;AACA,YAAIW,WAAW,GAAIf,IAAI,CAAC,CAAD,CAAJ,CAAQgB,WAA3B;AACA,YAAIC,YAAY,GAAGjB,IAAI,CAAC,CAAD,CAAJ,CAAQkB,YAA3B;;AAEA,YAAIhE,SAAS,IAAI,KAAb,IAAsB+D,YAAY,IAAI3V,MAA1C,EAAkD;AAChDyW,UAAAA,MAAM,CAACpW,GAAP,GAAaoW,MAAM,CAACpW,GAAP,GAAaL,MAAb,GAAsB2V,YAAnC;AACD;;AAED,YAAIuB,KAAK,GAAG,KAAKC,wBAAL,CAA8BvF,SAA9B,EAAyC6E,MAAzC,EAAiDhB,WAAjD,EAA8DE,YAA9D,CAAZ;AAEA,YAAIuB,KAAK,CAAC1W,IAAV,EAAgBiW,MAAM,CAACjW,IAAP,IAAe0W,KAAK,CAAC1W,IAArB,CAAhB,KACKiW,MAAM,CAACpW,GAAP,IAAc6W,KAAK,CAAC7W,GAApB;AAEL,YAAI+W,UAAU,GAAY,aAAanC,IAAb,CAAkBrD,SAAlB,CAA1B;AACA,YAAIyF,UAAU,GAAYD,UAAU,GAAGF,KAAK,CAAC1W,IAAN,GAAa,CAAb,GAAiBG,KAAjB,GAAyB8U,WAA5B,GAA0CyB,KAAK,CAAC7W,GAAN,GAAY,CAAZ,GAAgBL,MAAhB,GAAyB2V,YAAvG;AACA,YAAI2B,mBAAmB,GAAGF,UAAU,GAAG,aAAH,GAAmB,cAAvD;AAEA1C,QAAAA,IAAI,CAAC+B,MAAL,CAAYA,MAAZ;AACA,aAAKc,YAAL,CAAkBF,UAAlB,EAA8B3C,IAAI,CAAC,CAAD,CAAJ,CAAQ4C,mBAAR,CAA9B,EAA4DF,UAA5D;AACD,OAhDD;;AAkDArG,MAAAA,OAAO,CAAClS,SAAR,CAAkB0Y,YAAlB,GAAiC,UAAUL,KAAV,EAAiB3R,SAAjB,EAA4B6R,UAA5B,EAAwC;AACvE,aAAKI,KAAL,GACGrC,GADH,CACOiC,UAAU,GAAG,MAAH,GAAY,KAD7B,EACoC,MAAM,IAAIF,KAAK,GAAG3R,SAAlB,IAA+B,GADnE,EAEG4P,GAFH,CAEOiC,UAAU,GAAG,KAAH,GAAW,MAF5B,EAEoC,EAFpC;AAGD,OAJD;;AAMArG,MAAAA,OAAO,CAAClS,SAAR,CAAkBgW,UAAlB,GAA+B,YAAY;AACzC,YAAIH,IAAI,GAAI,KAAKb,GAAL,EAAZ;AACA,YAAI7B,KAAK,GAAG,KAAKyF,QAAL,EAAZ;AAEA/C,QAAAA,IAAI,CAACgD,IAAL,CAAU,gBAAV,EAA4B,KAAK1G,OAAL,CAAakB,IAAb,GAAoB,MAApB,GAA6B,MAAzD,EAAiEF,KAAjE;AACA0C,QAAAA,IAAI,CAACqB,WAAL,CAAiB,+BAAjB;AACD,OAND;;AAQAhF,MAAAA,OAAO,CAAClS,SAAR,CAAkB2U,IAAlB,GAAyB,UAAUmE,QAAV,EAAoB;AAC3C,YAAIlD,IAAI,GAAG,IAAX;AACA,YAAIC,IAAI,GAAG/W,CAAC,CAAC,KAAK+W,IAAN,CAAZ;AACA,YAAIR,CAAC,GAAMvW,CAAC,CAACiW,KAAF,CAAQ,aAAa,KAAK3C,IAA1B,CAAX;;AAEA,iBAASkF,QAAT,GAAoB;AAClB,cAAI1B,IAAI,CAACrD,UAAL,IAAmB,IAAvB,EAA6BsD,IAAI,CAACQ,MAAL;AAC7BT,UAAAA,IAAI,CAACpD,QAAL,CACGuG,UADH,CACc,kBADd,EAEG7F,OAFH,CAEW,eAAe0C,IAAI,CAACxD,IAF/B;AAGA0G,UAAAA,QAAQ,IAAIA,QAAQ,EAApB;AACD;;AAED,aAAKtG,QAAL,CAAcU,OAAd,CAAsBmC,CAAtB;AAEA,YAAIA,CAAC,CAACM,kBAAF,EAAJ,EAA4B;AAE5BE,QAAAA,IAAI,CAACqB,WAAL,CAAiB,IAAjB;AAEApY,QAAAA,CAAC,CAAC0Y,OAAF,CAAUC,UAAV,IAAwB5B,IAAI,CAACZ,QAAL,CAAc,MAAd,CAAxB,GACEY,IAAI,CACD6B,GADH,CACO,iBADP,EAC0BJ,QAD1B,EAEGK,oBAFH,CAEwBzF,OAAO,CAACU,mBAFhC,CADF,GAIE0E,QAAQ,EAJV;AAMA,aAAK/E,UAAL,GAAkB,IAAlB;AAEA,eAAO,IAAP;AACD,OA5BD;;AA8BAL,MAAAA,OAAO,CAAClS,SAAR,CAAkBwU,QAAlB,GAA6B,YAAY;AACvC,YAAIwE,EAAE,GAAG,KAAKxG,QAAd;;AACA,YAAIwG,EAAE,CAAC1V,IAAH,CAAQ,OAAR,KAAoB,OAAO0V,EAAE,CAAC1V,IAAH,CAAQ,qBAAR,CAAP,IAAyC,QAAjE,EAA2E;AACzE0V,UAAAA,EAAE,CAAC1V,IAAH,CAAQ,qBAAR,EAA+B0V,EAAE,CAAC1V,IAAH,CAAQ,OAAR,KAAoB,EAAnD,EAAuDA,IAAvD,CAA4D,OAA5D,EAAqE,EAArE;AACD;AACF,OALD;;AAOA4O,MAAAA,OAAO,CAAClS,SAAR,CAAkBsV,UAAlB,GAA+B,YAAY;AACzC,eAAO,KAAKsD,QAAL,EAAP;AACD,OAFD;;AAIA1G,MAAAA,OAAO,CAAClS,SAAR,CAAkB2W,WAAlB,GAAgC,UAAUnE,QAAV,EAAoB;AAClDA,QAAAA,QAAQ,GAAKA,QAAQ,IAAI,KAAKA,QAA9B;AAEA,YAAIyG,EAAE,GAAOzG,QAAQ,CAAC,CAAD,CAArB;AACA,YAAI0G,MAAM,GAAGD,EAAE,CAACE,OAAH,IAAc,MAA3B;AAEA,YAAIC,MAAM,GAAMH,EAAE,CAAC9T,qBAAH,EAAhB;;AACA,YAAIiU,MAAM,CAACtX,KAAP,IAAgB,IAApB,EAA0B;AACxB;AACAsX,UAAAA,MAAM,GAAGta,CAAC,CAACyV,MAAF,CAAS,EAAT,EAAa6E,MAAb,EAAqB;AAAEtX,YAAAA,KAAK,EAAEsX,MAAM,CAACrX,KAAP,GAAeqX,MAAM,CAACzX,IAA/B;AAAqCR,YAAAA,MAAM,EAAEiY,MAAM,CAAChY,MAAP,GAAgBgY,MAAM,CAAC5X;AAApE,WAArB,CAAT;AACD;;AACD,YAAI6X,QAAQ,GAAIH,MAAM,GAAG;AAAE1X,UAAAA,GAAG,EAAE,CAAP;AAAUG,UAAAA,IAAI,EAAE;AAAhB,SAAH,GAAyB6Q,QAAQ,CAACoF,MAAT,EAA/C;AACA,YAAI0B,MAAM,GAAM;AAAEA,UAAAA,MAAM,EAAEJ,MAAM,GAAGpF,QAAQ,CAAC4B,eAAT,CAAyB6D,SAAzB,IAAsCzF,QAAQ,CAAC0F,IAAT,CAAcD,SAAvD,GAAmE/G,QAAQ,CAAC+G,SAAT;AAAnF,SAAhB;AACA,YAAIE,SAAS,GAAGP,MAAM,GAAG;AAAEpX,UAAAA,KAAK,EAAEhD,CAAC,CAACrB,MAAD,CAAD,CAAUqE,KAAV,EAAT;AAA4BX,UAAAA,MAAM,EAAErC,CAAC,CAACrB,MAAD,CAAD,CAAU0D,MAAV;AAApC,SAAH,GAA8D,IAApF;AAEA,eAAOrC,CAAC,CAACyV,MAAF,CAAS,EAAT,EAAa6E,MAAb,EAAqBE,MAArB,EAA6BG,SAA7B,EAAwCJ,QAAxC,CAAP;AACD,OAhBD;;AAkBAnH,MAAAA,OAAO,CAAClS,SAAR,CAAkBoX,mBAAlB,GAAwC,UAAUrE,SAAV,EAAqB2D,GAArB,EAA0BE,WAA1B,EAAuCE,YAAvC,EAAqD;AAC3F,eAAO/D,SAAS,IAAI,QAAb,GAAwB;AAAEvR,UAAAA,GAAG,EAAEkV,GAAG,CAAClV,GAAJ,GAAUkV,GAAG,CAACvV,MAArB;AAA+BQ,UAAAA,IAAI,EAAE+U,GAAG,CAAC/U,IAAJ,GAAW+U,GAAG,CAAC5U,KAAJ,GAAY,CAAvB,GAA2B8U,WAAW,GAAG;AAA9E,SAAxB,GACA7D,SAAS,IAAI,KAAb,GAAwB;AAAEvR,UAAAA,GAAG,EAAEkV,GAAG,CAAClV,GAAJ,GAAUsV,YAAjB;AAA+BnV,UAAAA,IAAI,EAAE+U,GAAG,CAAC/U,IAAJ,GAAW+U,GAAG,CAAC5U,KAAJ,GAAY,CAAvB,GAA2B8U,WAAW,GAAG;AAA9E,SAAxB,GACA7D,SAAS,IAAI,MAAb,GAAwB;AAAEvR,UAAAA,GAAG,EAAEkV,GAAG,CAAClV,GAAJ,GAAUkV,GAAG,CAACvV,MAAJ,GAAa,CAAvB,GAA2B2V,YAAY,GAAG,CAAjD;AAAoDnV,UAAAA,IAAI,EAAE+U,GAAG,CAAC/U,IAAJ,GAAWiV;AAArE,SAAxB;AACH;AAA2B;AAAEpV,UAAAA,GAAG,EAAEkV,GAAG,CAAClV,GAAJ,GAAUkV,GAAG,CAACvV,MAAJ,GAAa,CAAvB,GAA2B2V,YAAY,GAAG,CAAjD;AAAoDnV,UAAAA,IAAI,EAAE+U,GAAG,CAAC/U,IAAJ,GAAW+U,GAAG,CAAC5U;AAAzE,SAH/B;AAKD,OAND;;AAQAoQ,MAAAA,OAAO,CAAClS,SAAR,CAAkBsY,wBAAlB,GAA6C,UAAUvF,SAAV,EAAqB2D,GAArB,EAA0BE,WAA1B,EAAuCE,YAAvC,EAAqD;AAChG,YAAIuB,KAAK,GAAG;AAAE7W,UAAAA,GAAG,EAAE,CAAP;AAAUG,UAAAA,IAAI,EAAE;AAAhB,SAAZ;AACA,YAAI,CAAC,KAAK+R,SAAV,EAAqB,OAAO2E,KAAP;AAErB,YAAIqB,eAAe,GAAG,KAAKvH,OAAL,CAAaoB,QAAb,IAAyB,KAAKpB,OAAL,CAAaoB,QAAb,CAAsBC,OAA/C,IAA0D,CAAhF;AACA,YAAImG,kBAAkB,GAAG,KAAKhD,WAAL,CAAiB,KAAKjD,SAAtB,CAAzB;;AAEA,YAAI,aAAa0C,IAAb,CAAkBrD,SAAlB,CAAJ,EAAkC;AAChC,cAAI6G,aAAa,GAAMlD,GAAG,CAAClV,GAAJ,GAAUkY,eAAV,GAA4BC,kBAAkB,CAACL,MAAtE;AACA,cAAIO,gBAAgB,GAAGnD,GAAG,CAAClV,GAAJ,GAAUkY,eAAV,GAA4BC,kBAAkB,CAACL,MAA/C,GAAwDxC,YAA/E;;AACA,cAAI8C,aAAa,GAAGD,kBAAkB,CAACnY,GAAvC,EAA4C;AAAE;AAC5C6W,YAAAA,KAAK,CAAC7W,GAAN,GAAYmY,kBAAkB,CAACnY,GAAnB,GAAyBoY,aAArC;AACD,WAFD,MAEO,IAAIC,gBAAgB,GAAGF,kBAAkB,CAACnY,GAAnB,GAAyBmY,kBAAkB,CAACxY,MAAnE,EAA2E;AAAE;AAClFkX,YAAAA,KAAK,CAAC7W,GAAN,GAAYmY,kBAAkB,CAACnY,GAAnB,GAAyBmY,kBAAkB,CAACxY,MAA5C,GAAqD0Y,gBAAjE;AACD;AACF,SARD,MAQO;AACL,cAAIC,cAAc,GAAIpD,GAAG,CAAC/U,IAAJ,GAAW+X,eAAjC;AACA,cAAIK,eAAe,GAAGrD,GAAG,CAAC/U,IAAJ,GAAW+X,eAAX,GAA6B9C,WAAnD;;AACA,cAAIkD,cAAc,GAAGH,kBAAkB,CAAChY,IAAxC,EAA8C;AAAE;AAC9C0W,YAAAA,KAAK,CAAC1W,IAAN,GAAagY,kBAAkB,CAAChY,IAAnB,GAA0BmY,cAAvC;AACD,WAFD,MAEO,IAAIC,eAAe,GAAGJ,kBAAkB,CAAC5X,KAAzC,EAAgD;AAAE;AACvDsW,YAAAA,KAAK,CAAC1W,IAAN,GAAagY,kBAAkB,CAAChY,IAAnB,GAA0BgY,kBAAkB,CAAC7X,KAA7C,GAAqDiY,eAAlE;AACD;AACF;;AAED,eAAO1B,KAAP;AACD,OA1BD;;AA4BAnG,MAAAA,OAAO,CAAClS,SAAR,CAAkB4Y,QAAlB,GAA6B,YAAY;AACvC,YAAIzF,KAAJ;AACA,YAAI6F,EAAE,GAAG,KAAKxG,QAAd;AACA,YAAIwH,CAAC,GAAI,KAAK7H,OAAd;AAEAgB,QAAAA,KAAK,GAAG6F,EAAE,CAAC1V,IAAH,CAAQ,qBAAR,MACF,OAAO0W,CAAC,CAAC7G,KAAT,IAAkB,UAAlB,GAA+B6G,CAAC,CAAC7G,KAAF,CAAQjT,IAAR,CAAa8Y,EAAE,CAAC,CAAD,CAAf,CAA/B,GAAsDgB,CAAC,CAAC7G,KADtD,CAAR;AAGA,eAAOA,KAAP;AACD,OATD;;AAWAjB,MAAAA,OAAO,CAAClS,SAAR,CAAkB+V,MAAlB,GAA2B,UAAUkE,MAAV,EAAkB;AAC3C,WAAGA,MAAM,IAAI,CAAC,EAAE9B,IAAI,CAAC+B,MAAL,KAAgB,OAAlB,CAAX,CAAH,QACOpG,QAAQ,CAACqG,cAAT,CAAwBF,MAAxB,CADP;;AAEA,eAAOA,MAAP;AACD,OAJD;;AAMA/H,MAAAA,OAAO,CAAClS,SAAR,CAAkBgV,GAAlB,GAAwB,YAAY;AAClC,YAAI,CAAC,KAAKa,IAAV,EAAgB;AACd,eAAKA,IAAL,GAAY/W,CAAC,CAAC,KAAKqT,OAAL,CAAac,QAAd,CAAb;;AACA,cAAI,KAAK4C,IAAL,CAAUxV,MAAV,IAAoB,CAAxB,EAA2B;AACzB,kBAAM,IAAI6I,KAAJ,CAAU,KAAKkJ,IAAL,GAAY,iEAAtB,CAAN;AACD;AACF;;AACD,eAAO,KAAKyD,IAAZ;AACD,OARD;;AAUA3D,MAAAA,OAAO,CAAClS,SAAR,CAAkB2Y,KAAlB,GAA0B,YAAY;AACpC,eAAQ,KAAKyB,MAAL,GAAc,KAAKA,MAAL,IAAe,KAAKpF,GAAL,GAAW6D,IAAX,CAAgB,gBAAhB,CAArC;AACD,OAFD;;AAIA3G,MAAAA,OAAO,CAAClS,SAAR,CAAkBqa,MAAlB,GAA2B,YAAY;AACrC,aAAKhI,OAAL,GAAe,IAAf;AACD,OAFD;;AAIAH,MAAAA,OAAO,CAAClS,SAAR,CAAkBsa,OAAlB,GAA4B,YAAY;AACtC,aAAKjI,OAAL,GAAe,KAAf;AACD,OAFD;;AAIAH,MAAAA,OAAO,CAAClS,SAAR,CAAkBua,aAAlB,GAAkC,YAAY;AAC5C,aAAKlI,OAAL,GAAe,CAAC,KAAKA,OAArB;AACD,OAFD;;AAIAH,MAAAA,OAAO,CAAClS,SAAR,CAAkBkU,MAAlB,GAA2B,UAAUmB,CAAV,EAAa;AACtC,YAAIR,IAAI,GAAG,IAAX;;AACA,YAAIQ,CAAJ,EAAO;AACLR,UAAAA,IAAI,GAAG/V,CAAC,CAACuW,CAAC,CAACP,aAAH,CAAD,CAAmBhX,IAAnB,CAAwB,QAAQ,KAAKsU,IAArC,CAAP;;AACA,cAAI,CAACyC,IAAL,EAAW;AACTA,YAAAA,IAAI,GAAG,IAAI,KAAK9I,WAAT,CAAqBsJ,CAAC,CAACP,aAAvB,EAAsC,KAAKF,kBAAL,EAAtC,CAAP;AACA9V,YAAAA,CAAC,CAACuW,CAAC,CAACP,aAAH,CAAD,CAAmBhX,IAAnB,CAAwB,QAAQ,KAAKsU,IAArC,EAA2CyC,IAA3C;AACD;AACF;;AAED,YAAIQ,CAAJ,EAAO;AACLR,UAAAA,IAAI,CAACpC,OAAL,CAAarC,KAAb,GAAqB,CAACyE,IAAI,CAACpC,OAAL,CAAarC,KAAnC;AACA,cAAIyE,IAAI,CAACO,aAAL,EAAJ,EAA0BP,IAAI,CAACxR,KAAL,CAAWwR,IAAX,EAA1B,KACKA,IAAI,CAACR,KAAL,CAAWQ,IAAX;AACN,SAJD,MAIO;AACLA,UAAAA,IAAI,CAACG,GAAL,GAAWC,QAAX,CAAoB,IAApB,IAA4BJ,IAAI,CAACR,KAAL,CAAWQ,IAAX,CAA5B,GAA+CA,IAAI,CAACxR,KAAL,CAAWwR,IAAX,CAA/C;AACD;AACF,OAjBD;;AAmBA3C,MAAAA,OAAO,CAAClS,SAAR,CAAkBwa,OAAlB,GAA4B,YAAY;AACtC,YAAI5E,IAAI,GAAG,IAAX;AACAV,QAAAA,YAAY,CAAC,KAAK5C,OAAN,CAAZ;AACA,aAAKqC,IAAL,CAAU,YAAY;AACpBiB,UAAAA,IAAI,CAACpD,QAAL,CAAciI,GAAd,CAAkB,MAAM7E,IAAI,CAACxD,IAA7B,EAAmCsI,UAAnC,CAA8C,QAAQ9E,IAAI,CAACxD,IAA3D;;AACA,cAAIwD,IAAI,CAACC,IAAT,EAAe;AACbD,YAAAA,IAAI,CAACC,IAAL,CAAUQ,MAAV;AACD;;AACDT,UAAAA,IAAI,CAACC,IAAL,GAAY,IAAZ;AACAD,UAAAA,IAAI,CAACwE,MAAL,GAAc,IAAd;AACAxE,UAAAA,IAAI,CAAClC,SAAL,GAAiB,IAAjB;AACD,SARD;AASD,OAZD,CA3cY,CA0dZ;AACA;;;AAEA,eAASiH,MAAT,CAAgBC,MAAhB,EAAwB;AACtB,eAAO,KAAKzT,IAAL,CAAU,YAAY;AAC3B,cAAI0T,KAAK,GAAK/b,CAAC,CAAC,IAAD,CAAf;AACA,cAAIhB,IAAI,GAAM+c,KAAK,CAAC/c,IAAN,CAAW,YAAX,CAAd;AACA,cAAIqU,OAAO,GAAG,OAAOyI,MAAP,IAAiB,QAAjB,IAA6BA,MAA3C;AAEA,cAAI,CAAC9c,IAAD,IAAS,eAAesY,IAAf,CAAoBwE,MAApB,CAAb,EAA0C;AAC1C,cAAI,CAAC9c,IAAL,EAAW+c,KAAK,CAAC/c,IAAN,CAAW,YAAX,EAA0BA,IAAI,GAAG,IAAIoU,OAAJ,CAAY,IAAZ,EAAkBC,OAAlB,CAAjC;AACX,cAAI,OAAOyI,MAAP,IAAiB,QAArB,EAA+B9c,IAAI,CAAC8c,MAAD,CAAJ;AAChC,SARM,CAAP;AASD;;AAED,UAAIE,GAAG,GAAGhc,CAAC,CAACic,EAAF,CAAKC,OAAf;AAEAlc,MAAAA,CAAC,CAACic,EAAF,CAAKC,OAAL,GAA2BL,MAA3B;AACA7b,MAAAA,CAAC,CAACic,EAAF,CAAKC,OAAL,CAAaC,WAAb,GAA2B/I,OAA3B,CA5eY,CA+eZ;AACA;;AAEApT,MAAAA,CAAC,CAACic,EAAF,CAAKC,OAAL,CAAaE,UAAb,GAA0B,YAAY;AACpCpc,QAAAA,CAAC,CAACic,EAAF,CAAKC,OAAL,GAAeF,GAAf;AACA,eAAO,IAAP;AACD,OAHD;AAKD,KAvfA,CAufCjc,MAvfD,CAAD;AA0fA;AACJ;AACA;AACA;AACA;AACA;AACA;;AAGI,KAAC,UAAUC,CAAV,EAAa;AACZ,mBADY,CAGZ;AACA;;AAEA,UAAIqc,OAAO,GAAG,UAAUnW,OAAV,EAAmBmN,OAAnB,EAA4B;AACxC,aAAKO,IAAL,CAAU,SAAV,EAAqB1N,OAArB,EAA8BmN,OAA9B;AACD,OAFD;;AAIA,UAAI,CAACrT,CAAC,CAACic,EAAF,CAAKC,OAAV,EAAmB,MAAM,IAAI9R,KAAJ,CAAU,6BAAV,CAAN;AAEnBiS,MAAAA,OAAO,CAACxI,OAAR,GAAmB,OAAnB;AAEAwI,MAAAA,OAAO,CAACtI,QAAR,GAAmB/T,CAAC,CAACyV,MAAF,CAAS,EAAT,EAAazV,CAAC,CAACic,EAAF,CAAKC,OAAL,CAAaC,WAAb,CAAyBpI,QAAtC,EAAgD;AACjEE,QAAAA,SAAS,EAAE,OADsD;AAEjEG,QAAAA,OAAO,EAAE,OAFwD;AAGjEkI,QAAAA,OAAO,EAAE,EAHwD;AAIjEnI,QAAAA,QAAQ,EAAE;AAJuD,OAAhD,CAAnB,CAdY,CAsBZ;AACA;;AAEAkI,MAAAA,OAAO,CAACnb,SAAR,GAAoBlB,CAAC,CAACyV,MAAF,CAAS,EAAT,EAAazV,CAAC,CAACic,EAAF,CAAKC,OAAL,CAAaC,WAAb,CAAyBjb,SAAtC,CAApB;AAEAmb,MAAAA,OAAO,CAACnb,SAAR,CAAkB+L,WAAlB,GAAgCoP,OAAhC;;AAEAA,MAAAA,OAAO,CAACnb,SAAR,CAAkByU,WAAlB,GAAgC,YAAY;AAC1C,eAAO0G,OAAO,CAACtI,QAAf;AACD,OAFD;;AAIAsI,MAAAA,OAAO,CAACnb,SAAR,CAAkBgW,UAAlB,GAA+B,YAAY;AACzC,YAAIH,IAAI,GAAM,KAAKb,GAAL,EAAd;AACA,YAAI7B,KAAK,GAAK,KAAKyF,QAAL,EAAd;AACA,YAAIwC,OAAO,GAAG,KAAKC,UAAL,EAAd;AAEAxF,QAAAA,IAAI,CAACgD,IAAL,CAAU,gBAAV,EAA4B,KAAK1G,OAAL,CAAakB,IAAb,GAAoB,MAApB,GAA6B,MAAzD,EAAiEF,KAAjE;AACA0C,QAAAA,IAAI,CAACgD,IAAL,CAAU,kBAAV,EAA8ByC,QAA9B,GAAyCjF,MAAzC,GAAkDkF,GAAlD,GAAyD;AACvD,aAAKpJ,OAAL,CAAakB,IAAb,GAAqB,OAAO+H,OAAP,IAAkB,QAAlB,GAA6B,MAA7B,GAAsC,QAA3D,GAAuE,MADzE,EAEEA,OAFF;AAIAvF,QAAAA,IAAI,CAACqB,WAAL,CAAiB,+BAAjB,EAVyC,CAYzC;AACA;;AACA,YAAI,CAACrB,IAAI,CAACgD,IAAL,CAAU,gBAAV,EAA4BxF,IAA5B,EAAL,EAAyCwC,IAAI,CAACgD,IAAL,CAAU,gBAAV,EAA4BlE,IAA5B;AAC1C,OAfD;;AAiBAwG,MAAAA,OAAO,CAACnb,SAAR,CAAkBsV,UAAlB,GAA+B,YAAY;AACzC,eAAO,KAAKsD,QAAL,MAAmB,KAAKyC,UAAL,EAA1B;AACD,OAFD;;AAIAF,MAAAA,OAAO,CAACnb,SAAR,CAAkBqb,UAAlB,GAA+B,YAAY;AACzC,YAAIrC,EAAE,GAAG,KAAKxG,QAAd;AACA,YAAIwH,CAAC,GAAI,KAAK7H,OAAd;AAEA,eAAO6G,EAAE,CAAC1V,IAAH,CAAQ,cAAR,MACD,OAAO0W,CAAC,CAACoB,OAAT,IAAoB,UAApB,GACEpB,CAAC,CAACoB,OAAF,CAAUlb,IAAV,CAAe8Y,EAAE,CAAC,CAAD,CAAjB,CADF,GAEEgB,CAAC,CAACoB,OAHH,CAAP;AAID,OARD;;AAUAD,MAAAA,OAAO,CAACnb,SAAR,CAAkB2Y,KAAlB,GAA0B,YAAY;AACpC,eAAQ,KAAKyB,MAAL,GAAc,KAAKA,MAAL,IAAe,KAAKpF,GAAL,GAAW6D,IAAX,CAAgB,QAAhB,CAArC;AACD,OAFD,CAhEY,CAqEZ;AACA;;;AAEA,eAAS8B,MAAT,CAAgBC,MAAhB,EAAwB;AACtB,eAAO,KAAKzT,IAAL,CAAU,YAAY;AAC3B,cAAI0T,KAAK,GAAK/b,CAAC,CAAC,IAAD,CAAf;AACA,cAAIhB,IAAI,GAAM+c,KAAK,CAAC/c,IAAN,CAAW,YAAX,CAAd;AACA,cAAIqU,OAAO,GAAG,OAAOyI,MAAP,IAAiB,QAAjB,IAA6BA,MAA3C;AAEA,cAAI,CAAC9c,IAAD,IAAS,eAAesY,IAAf,CAAoBwE,MAApB,CAAb,EAA0C;AAC1C,cAAI,CAAC9c,IAAL,EAAW+c,KAAK,CAAC/c,IAAN,CAAW,YAAX,EAA0BA,IAAI,GAAG,IAAIqd,OAAJ,CAAY,IAAZ,EAAkBhJ,OAAlB,CAAjC;AACX,cAAI,OAAOyI,MAAP,IAAiB,QAArB,EAA+B9c,IAAI,CAAC8c,MAAD,CAAJ;AAChC,SARM,CAAP;AASD;;AAED,UAAIE,GAAG,GAAGhc,CAAC,CAACic,EAAF,CAAKS,OAAf;AAEA1c,MAAAA,CAAC,CAACic,EAAF,CAAKS,OAAL,GAA2Bb,MAA3B;AACA7b,MAAAA,CAAC,CAACic,EAAF,CAAKS,OAAL,CAAaP,WAAb,GAA2BE,OAA3B,CAvFY,CA0FZ;AACA;;AAEArc,MAAAA,CAAC,CAACic,EAAF,CAAKS,OAAL,CAAaN,UAAb,GAA0B,YAAY;AACpCpc,QAAAA,CAAC,CAACic,EAAF,CAAKS,OAAL,GAAeV,GAAf;AACA,eAAO,IAAP;AACD,OAHD;AAKD,KAlGA,CAkGCjc,MAlGD,CAAD;AAmGH;;AAED,WAAS4c,WAAT,CAAqBzc,IAArB,EAA2B;AACzB;;AAEA,QAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B,CAHyB,CAKzB;;AACAX,IAAAA,GAAG,CAACO,MAAJ,CAAW,YAAX,EAAyBT,MAAzB;;AAEA,QAAIpD,IAAI,CAACiE,MAAL,IAAejE,IAAI,CAACmU,KAAxB,EAA+B;AAC7B,UAAIuI,UAAU,GAAGpZ,GAAG,CAACqZ,MAAJ,CAAW,MAAX,EACdrY,IADc,CACT,OADS,EACA,WADA,EAEdA,IAFc,CAET,GAFS,EAEJtE,IAAI,CAACoO,uBAAL,GAA+BpO,IAAI,CAAC8C,KAAL,GAAY,CAA3C,GAA+C,CAAC9C,IAAI,CAAC8C,KAAL,GAAa9C,IAAI,CAAC2C,IAAlB,GAAyB3C,IAAI,CAAC+C,KAA/B,IAAwC,CAFnF,EAGduB,IAHc,CAGT,GAHS,EAGJtE,IAAI,CAACmO,gBAHD,EAId7J,IAJc,CAIT,aAJS,EAIM,QAJN,EAKdA,IALc,CAKT,IALS,EAKH,QALG,CAAjB,CAD6B,CAQ7B;;AACAoY,MAAAA,UAAU,CAAChZ,MAAX,CAAkB,OAAlB,EACGY,IADH,CACQ,OADR,EACiB,gBADjB,EAEGuB,IAFH,CAEQ7F,IAAI,CAACmU,KAFb,EAT6B,CAa7B;;AACA,UAAInU,IAAI,CAAC6S,aAAL,IAAsB7S,IAAI,CAAC4c,WAA3B,IAA0Chd,gBAAgB,EAA9D,EAAkE;AAChE8c,QAAAA,UAAU,CAAChZ,MAAX,CAAkB,OAAlB,EACGY,IADH,CACQ,OADR,EACiB,sBADjB,EAEGA,IAFH,CAEQ,IAFR,EAEc,OAFd,EAGGuB,IAHH,CAGQ,QAHR,EADgE,CAMhE;AACA;;AACA,YAAIgX,WAAW,GAAG/c,CAAC,CAAC4c,UAAU,CAACxX,IAAX,EAAD,CAAnB;AACA2X,QAAAA,WAAW,CAACL,OAAZ,CAAoB;AAClBnI,UAAAA,IAAI,EAAE,IADY;AAElBP,UAAAA,SAAS,EAAE,KAFO;AAGlBC,UAAAA,SAAS,EAAE,KAHO;AAIlBqI,UAAAA,OAAO,EAAEpc,IAAI,CAAC4c,WAJI;AAKlBtI,UAAAA,SAAS,EAAEtU,IAAI,CAACiE,MALE;AAMlBiQ,UAAAA,OAAO,EAAE,QANS;AAOlBD,UAAAA,QAAQ,EAAE;AAPQ,SAApB,EAQGe,EARH,CAQM,YARN,EAQoB,YAAW;AAC7BxW,UAAAA,EAAE,CAACgF,SAAH,CAAaxD,IAAI,CAACiE,MAAlB,EACGT,SADH,CACa,aADb,EAEGJ,MAFH;AAIAtD,UAAAA,CAAC,CAAC,IAAD,CAAD,CAAQ0c,OAAR,CAAgB,MAAhB;AACA1c,UAAAA,CAAC,CAACtB,EAAE,CAACqF,MAAH,CAAU7D,IAAI,CAACiE,MAAf,EAAuBJ,MAAvB,CAA8B,UAA9B,EAA0CqB,IAA1C,EAAD,CAAD,CACG8P,EADH,CACM,YADN,EACoB,YAAY;AAC5B6H,YAAAA,WAAW,CAACL,OAAZ,CAAoB,MAApB;AACD,WAHH;AAID,SAlBD,EAkBGxH,EAlBH,CAkBM,YAlBN,EAkBoB,YAAY;AAC9BmB,UAAAA,UAAU,CAAC,YAAY;AACrB,gBAAI,CAACrW,CAAC,CAAC,gBAAD,CAAD,CAAoBuB,MAAzB,EAAiC;AAC/Bwb,cAAAA,WAAW,CAACL,OAAZ,CAAoB,MAApB;AACD;AACF,WAJS,EAIP,GAJO,CAAV;AAKD,SAxBD;AAyBD,OAlCD,MAkCO,IAAIxc,IAAI,CAAC6S,aAAL,IAAsB7S,IAAI,CAAC4c,WAA3B,IAA0C,OAAO9c,CAAP,KAAa,WAA3D,EAAwE;AAC7EE,QAAAA,IAAI,CAACiO,KAAL,GAAa,mEAAb;AACD;AACF;;AAED,QAAIjO,IAAI,CAACiO,KAAT,EAAgB;AACdA,MAAAA,KAAK,CAACjO,IAAD,CAAL;AACD;AACF;;AAEDzB,EAAAA,EAAE,CAACke,WAAH,GAAiBA,WAAjB;;AAEA,WAASK,qBAAT,CAA+B9c,IAA/B,EAAqC+c,aAArC,EAAoDC,KAApD,EAA2Dje,QAA3D,EAAqEke,SAArE,EAAgF;AAC9Ejd,IAAAA,IAAI,CAAC0E,QAAL,CAAcqY,aAAd,IAA+B,UAASG,EAAT,EAAa;AAC1C,UAAID,SAAS,KAAKE,SAAlB,EAA6B,OAAOnd,IAAI,CAACkS,MAAL,CAAY8K,KAAZ,EAAmBE,EAAE,CAACne,QAAD,CAArB,CAAP,CAA7B,KACK,OAAOiB,IAAI,CAACkS,MAAL,CAAY8K,KAAZ,EAAmBE,EAAE,CAACne,QAAD,CAArB,IAAmCke,SAA1C;AACN,KAHD;AAID;;AAED,WAASG,WAAT,CAAqBC,GAArB,EAA0Brd,IAA1B,EAAgC;AAC9B,QAAIqd,GAAG,KAAK,QAAR,IAAoBA,GAAG,KAAK,KAAhC,EAAuC;AACrC,aAAO,CAACza,gBAAgB,CAAC5C,IAAD,CAAjB,EAAyBgD,iBAAiB,CAAChD,IAAD,CAA1C,CAAP;AACD;;AAED,QAAIqd,GAAG,KAAK,MAAR,IAAkBA,GAAG,KAAK,OAA9B,EAAuC;AACrC,aAAO,CAAChb,kBAAkB,CAACrC,IAAD,CAAnB,EAA2BA,IAAI,CAACwC,GAAhC,CAAP;AACD;AACF;;AAED,WAAS8a,eAAT,CAAyBD,GAAzB,EAA8Brd,IAA9B,EAAoC;AAClC,QAAIqd,GAAG,KAAK,QAAR,IAAoBA,GAAG,KAAK,KAAhC,EAAuC;AACrC,aAAO,CAACza,gBAAgB,CAAC5C,IAAD,CAAjB,EAAyBgD,iBAAiB,CAAChD,IAAD,CAA1C,CAAP;AACD;;AAED,QAAIqd,GAAG,KAAK,MAAR,IAAkBA,GAAG,KAAK,OAA9B,EAAuC;AACrC,aAAO,CAAChb,kBAAkB,CAACrC,IAAD,CAAnB,EAA2ByC,eAAe,CAACzC,IAAD,CAA1C,CAAP;AACD;AACF;;AAED,WAASud,OAAT,CAAiBvd,IAAjB,EAAuB;AACrB;AACA;AACA,QAAIwd,SAAS,GAAG,EAAhB;AACAA,IAAAA,SAAS,CAACC,YAAV,GAAyB,KAAzB;AACAD,IAAAA,SAAS,CAACE,WAAV,GAAwB,KAAxB;AACAF,IAAAA,SAAS,CAACG,SAAV,GAAsB,WAAtB;;AAEA,SAAKC,SAAL,GAAiB,UAASC,UAAT,EAAqB;AACpCL,MAAAA,SAAS,CAACI,SAAV,GAAsBC,UAAtB;AACAL,MAAAA,SAAS,CAACM,uBAAV,GAAoCN,SAAS,CAACI,SAAV,GAAsB,WAA1D;AACAJ,MAAAA,SAAS,CAACO,UAAV,GAAuBP,SAAS,CAACI,SAAV,CAAoBI,WAApB,EAAvB;AACAR,MAAAA,SAAS,CAACS,YAAV,GAAyBT,SAAS,CAACI,SAAV,GAAsB,GAA/C;AACA,aAAO,IAAP;AACD,KAND;;AAQA,SAAKM,SAAL,GAAiB,UAASA,SAAT,EAAoB;AACnCV,MAAAA,SAAS,CAACO,UAAV,GAAuBG,SAAS,CAACF,WAAV,EAAvB;AACAR,MAAAA,SAAS,CAACS,YAAV,GAAyBC,SAAS,GAAE,GAApC;AACA,aAAO,IAAP;AACD,KAJD;;AAMA,SAAKC,aAAL,GAAqB,UAASC,EAAT,EAAa;AAChCZ,MAAAA,SAAS,CAACC,YAAV,GAAyBW,EAAzB;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,SAAKC,UAAL,GAAkB,UAASD,EAAT,EAAa;AAC7BZ,MAAAA,SAAS,CAACE,WAAV,GAAwBU,EAAxB;AACA,aAAO,IAAP;AACD,KAHD,CA3BqB,CAgCrB;AACA;AACA;AACA;;;AAEA,SAAKE,uBAAL,GAA+B,YAAW;AACxC,UAAIC,sBAAsB,GAAG,EAA7B;;AAEA,UAAI1V,SAAS,CAACxH,MAAV,GAAmB,CAAvB,EAA0B;AACxBkd,QAAAA,sBAAsB,GAAG1V,SAAzB;AACD,OALuC,CAOxC;;;AACA,UAAI2V,iBAAJ;;AACA,WAAK,IAAIrZ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnF,IAAI,CAAClB,IAAL,CAAUuC,MAA9B,EAAsC8D,CAAC,EAAvC,EAA2C;AACzC,YAAInF,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAa9D,MAAb,GAAsB,CAA1B,EAA6B;AAC3Bmd,UAAAA,iBAAiB,GAAGxe,IAAI,CAAClB,IAAL,CAAUqG,CAAV,CAApB;AACD;AACF;;AACDqY,MAAAA,SAAS,CAACiB,cAAV,GAA2BlV,UAAU,CAACiV,iBAAiB,CAAC,CAAD,CAAjB,CAAqBxe,IAAI,CAACwd,SAAS,CAACM,uBAAX,CAAzB,CAAD,CAAV,GACvB,IADuB,GAEvB,KAFJ;AAIAhB,MAAAA,qBAAqB,CAAC9c,IAAD,EAAOwd,SAAS,CAACS,YAAjB,EAA+BT,SAAS,CAACO,UAAzC,EAAqD/d,IAAI,CAACwd,SAAS,CAACM,uBAAX,CAAzD,CAArB;AAEAY,MAAAA,oBAAoB,CAAC1e,IAAD,EAAOwd,SAAP,EAAkBe,sBAAlB,EAA0Cf,SAAS,CAACC,YAApD,CAApB;AAEA,UAAIkB,UAAU,GAAI3e,IAAI,CAACI,QAAN,GACb5B,EAAE,CAACogB,QAAH,EADa,GAEbpgB,EAAE,CAACqgB,SAAH,EAFJ;AAIA7e,MAAAA,IAAI,CAACkS,MAAL,CAAYsL,SAAS,CAACO,UAAtB,IAAqCP,SAAS,CAACiB,cAAX,GAChCE,UADgC,GAE/B3e,IAAI,CAACwd,SAAS,CAACI,SAAV,GAAsB,aAAvB,CAAJ,KAA8C,KAA/C,GACEpf,EAAE,CAACsgB,QAAH,EADF,GAEEtgB,EAAE,CAACugB,WAAH,EAJN;AAMA/e,MAAAA,IAAI,CAACkS,MAAL,CAAYsL,SAAS,CAACO,UAAtB,EAAkCiB,MAAlC,CAAyC,CAAChf,IAAI,CAACE,SAAL,CAAe,SAASsd,SAAS,CAACI,SAAlC,CAAD,EAA+C5d,IAAI,CAACE,SAAL,CAAe,SAASsd,SAAS,CAACI,SAAlC,CAA/C,CAAzC;AACAJ,MAAAA,SAAS,CAACG,SAAV,GAAsB,WAAtB;AAEA,aAAO,IAAP;AACD,KApCD;;AAsCA,SAAKsB,iBAAL,GAAyB,UAASD,MAAT,EAAiB;AACxChf,MAAAA,IAAI,CAACkS,MAAL,CAAYsL,SAAS,CAACO,UAAtB,IAAoCvf,EAAE,CAAC0gB,YAAH,GAAkBF,MAAlB,CAAyBA,MAAzB,CAApC;AACAlC,MAAAA,qBAAqB,CAAC9c,IAAD,EAAOwd,SAAS,CAACS,YAAjB,EAA+BT,SAAS,CAACO,UAAzC,EAAqD/d,IAAI,CAACwd,SAAS,CAACM,uBAAX,CAAzD,CAArB;AACA,aAAO,IAAP;AACD,KAJD;;AAMA,SAAKqB,yBAAL,GAAiC,YAAW;AAC1C;AACA;AACA,UAAIjb,QAAQ,GAAGC,gBAAgB,CAACnE,IAAI,CAAClB,IAAN,CAA/B,CAH0C,CAI1C;;AACA0e,MAAAA,SAAS,CAAC4B,oBAAV,GAAiC5gB,EAAE,CAAC6gB,GAAH,CAAOnb,QAAQ,CAAC/E,GAAT,CAAa,UAASC,CAAT,EAAY;AAC/D,eAAOA,CAAC,CAACY,IAAI,CAACwd,SAAS,CAACM,uBAAX,CAAL,CAAR;AAAmD,OADb,CAAP,EACuB5U,MADvB,EAAjC;AAEAlJ,MAAAA,IAAI,CAACkS,MAAL,CAAYsL,SAAS,CAACO,UAAtB,IAAoCvf,EAAE,CAAC8gB,SAAH,GACjCN,MADiC,CAC1BxB,SAAS,CAAC4B,oBADgB,CAApC;AAGA5B,MAAAA,SAAS,CAACG,SAAV,GAAsB,aAAtB;AACA,aAAO,IAAP;AACD,KAZD,CAjFqB,CA+FrB;AACA;AACA;;;AAEA,SAAK4B,cAAL,GAAsB,UAASC,KAAT,EAAgB;AACpC,UAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;AAC7Bxf,QAAAA,IAAI,CACDkS,MADH,CACUsL,SAAS,CAACO,UADpB,EAEGyB,KAFH,CAESpC,WAAW,CAACoC,KAAD,EAAQxf,IAAR,CAFpB;AAGD,OAJD,MAIO;AACLA,QAAAA,IAAI,CACDkS,MADH,CACUsL,SAAS,CAACO,UADpB,EAEGyB,KAFH,CAESA,KAFT;AAGD;;AAED,aAAO,IAAP;AACD,KAZD;;AAcA,SAAKC,qBAAL,GAA6B,UAASD,KAAT,EAAgBE,OAAhB,EAAyB;AACpD,UAAIA,OAAO,KAAKvC,SAAhB,EAA2BuC,OAAO,GAAG,KAAV;AAE3B,UAAI9B,SAAS,GAAGJ,SAAS,CAACI,SAA1B;AACA,UAAI+B,iBAAiB,GAAG3f,IAAI,CAAC4d,SAAS,GAAG,qBAAb,CAA5B;AACA,UAAIgC,sBAAsB,GAAG5f,IAAI,CAAC4d,SAAS,GAAG,2BAAb,CAAjC;;AACA,UAAI,OAAO4B,KAAP,KAAiB,QAArB,EAA+B;AAC7B;AACAxf,QAAAA,IAAI,CAACkS,MAAL,CAAYsL,SAAS,CAACO,UAAtB,EACGyB,KADH,CACSpC,WAAW,CAACoC,KAAD,EAAQxf,IAAR,CADpB,EAEG6f,YAFH,CAEgBF,iBAFhB,EAGGG,YAHH,CAGgBF,sBAHhB;AAID,OAND,MAMO;AACL5f,QAAAA,IAAI,CAACkS,MAAL,CAAYsL,SAAS,CAACO,UAAtB,EACGyB,KADH,CACSA,KADT,EAEGK,YAFH,CAEgBF,iBAFhB,EAGGG,YAHH,CAGgBF,sBAHhB;AAID;;AAED9C,MAAAA,qBAAqB,CACnB9c,IADmB,EAEnBwd,SAAS,CAACS,YAFS,EAGnBT,SAAS,CAACO,UAHS,EAInB/d,IAAI,CAACwd,SAAS,CAACM,uBAAX,CAJe,EAKnB4B,OAAO,GACH1f,IAAI,CAACkS,MAAL,CAAYsL,SAAS,CAACO,UAAtB,EAAkCgC,SAAlC,KAAgD,CAD7C,GAEH,CAPe,CAArB;AAUA,aAAO,IAAP;AACD,KA9BD;;AAgCA,SAAKC,gBAAL,GAAwB,UAASR,KAAT,EAAgB;AACtCxf,MAAAA,IAAI,CAACkS,MAAL,CAAYsL,SAAS,CAACO,UAAtB,EAAkCyB,KAAlC,CAAwCA,KAAxC;AACA1C,MAAAA,qBAAqB,CAAC9c,IAAD,EAAOwd,SAAS,CAACS,YAAjB,EAA+BT,SAAS,CAACO,UAAzC,EAAqD/d,IAAI,CAACwd,SAAS,CAACM,uBAAX,CAAzD,CAArB;AACA,aAAO,IAAP;AACD,KAJD;;AAMA,SAAKmC,qBAAL,GAA6B,YAAW;AACtCjgB,MAAAA,IAAI,CAACkS,MAAL,CAAYsL,SAAS,CAACO,UAAtB,IAAoC/d,IAAI,CAACkS,MAAL,CAAYsL,SAAS,CAACO,UAAtB,EAAkCiB,MAAlC,GAA2C3d,MAA3C,GAAoD,EAApD,GAChC7C,EAAE,CAAC0gB,YAAH,CAAgB1gB,EAAE,CAAC0hB,gBAAnB,CADgC,GAEhC1hB,EAAE,CAAC0gB,YAAH,CAAgB1gB,EAAE,CAAC2hB,gBAAnB,CAFJ;AAIAngB,MAAAA,IAAI,CACDkS,MADH,CACUsL,SAAS,CAACO,UADpB,EAEGiB,MAFH,CAEUxB,SAAS,CAAC4B,oBAFpB;AAIAtC,MAAAA,qBAAqB,CAAC9c,IAAD,EAAOwd,SAAS,CAACS,YAAjB,EAA+BT,SAAS,CAACO,UAAzC,EAAqD/d,IAAI,CAACwd,SAAS,CAACM,uBAAX,CAAzD,CAArB;AACA,aAAO,IAAP;AACD,KAXD;;AAaA,SAAKsC,KAAL,GAAa,UAASC,EAAT,EAAa;AACxBrgB,MAAAA,IAAI,CAACkS,MAAL,CAAYsL,SAAS,CAACO,UAAtB,EAAkCqC,KAAlC,CAAwCC,EAAxC;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,WAAO,IAAP;AACD;;AAED9hB,EAAAA,EAAE,CAAC+hB,aAAH,GAAmB/C,OAAnB,CA3rDqB,CA6rDrB;;AACA,WAASmB,oBAAT,CAA8B1e,IAA9B,EAAoCwd,SAApC,EAA+C+C,sBAA/C,EAAuE;AACrE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAI3C,SAAS,GAAGJ,SAAS,CAACI,SAA1B;AACA,QAAIE,uBAAuB,GAAGN,SAAS,CAACM,uBAAxC;AACA,QAAIL,YAAY,GAAGD,SAAS,CAACC,YAA7B;AACA,QAAIC,WAAW,GAAGF,SAAS,CAACE,WAA5B;AAEA,QAAI3e,QAAQ,GAAGiB,IAAI,CAAC8d,uBAAD,CAAnB,CAjBqE,CAmBrE;;AACA,QAAI5Z,QAAQ,GAAGC,gBAAgB,CAACnE,IAAI,CAAClB,IAAN,CAAhB,CACZK,GADY,CACR,UAASqhB,EAAT,EAAa;AAChB,aAAOA,EAAE,CAACzhB,QAAD,CAAT;AAAqB,KAFV,EAGZ4H,MAHY,CAGLxC,gBAAgB,CAACoc,sBAAD,CAHX,CAAf,CApBqE,CAyBrE;;AACA,QAAIvgB,IAAI,CAAC4d,SAAS,GAAG,aAAb,CAAJ,KAAoC,KAAxC,EAA+C;AAC7C1Z,MAAAA,QAAQ,GAAGA,QAAQ,CAACiF,MAAT,CAAgB,UAAS/J,CAAT,EAAY;AACrC,eAAOA,CAAC,GAAG,CAAX;AACD,OAFU,CAAX;AAGD,KA9BoE,CAgCrE;;;AACA,QAAIqhB,OAAO,GAAGjiB,EAAE,CAACkiB,MAAH,CAAUxc,QAAV,CAAd;AACA,QAAIyc,OAAO,GAAGF,OAAO,CAAC,CAAD,CAArB;AACA,QAAIG,OAAO,GAAGH,OAAO,CAAC,CAAD,CAArB,CAnCqE,CAqCrE;AACA;AACA;AACA;;AACA,QAAI/C,WAAW,IAAI,CAAC1d,IAAI,CAAC,SAAS4d,SAAT,GAAqB,YAAtB,CAApB,IAA2D+C,OAAO,GAAG,CAArE,IAA0E,CAACnD,SAAS,CAACiB,cAAzF,EAAyG;AACvGkC,MAAAA,OAAO,GAAG3gB,IAAI,CAAC4d,SAAS,GAAG,aAAb,CAAJ,KAAoC,KAApC,GAA4C,CAA5C,GAAgD,CAA1D;AACD;;AAED,QAAI5d,IAAI,CAAC4d,SAAS,GAAG,aAAb,CAAJ,KAAoC,KAApC,IAA6C+C,OAAO,GAAG,CAAvD,IAA4D,CAACnD,SAAS,CAACiB,cAA3E,EAA2F;AACzFkC,MAAAA,OAAO,GAAGA,OAAO,GAAG,CAACA,OAAO,GAAGA,OAAO,GAAG3gB,IAAI,CAAC4R,QAA1B,IAAsC6L,YAA1D;AACD;;AAED,QAAI,CAACD,SAAS,CAACiB,cAAf,EAA+B;AAC7BmC,MAAAA,OAAO,GAAIA,OAAO,GAAG,CAAX,GAAgBA,OAAO,GAAG,CAACA,OAAO,GAAGA,OAAO,GAAG5gB,IAAI,CAAC4R,QAA1B,IAAsC6L,YAAhE,GAA+EmD,OAAO,IAAInD,YAAY,GAAGzd,IAAI,CAAC4R,QAAR,GAAmB,CAAnC,CAAhG;AACD;;AAED+O,IAAAA,OAAO,GAAG3gB,IAAI,CAAC,SAAS4d,SAAV,CAAJ,IAA4B+C,OAAtC;AACAC,IAAAA,OAAO,GAAG5gB,IAAI,CAAC,SAAS4d,SAAV,CAAJ,IAA4BgD,OAAtC,CAtDqE,CAuDrE;;AAEA,QAAID,OAAO,KAAKC,OAAZ,IAAuB,EAAE5gB,IAAI,CAAC,SAAS4d,SAAV,CAAJ,IAA4B5d,IAAI,CAAC,SAAS4d,SAAV,CAAlC,CAA3B,EAAoF;AAElF,UAAIrU,UAAU,CAACoX,OAAD,CAAd,EAAyB;AACvBC,QAAAA,OAAO,GAAG,IAAI/W,IAAJ,CAAStL,EAAE,CAACoL,KAAH,CAASgX,OAAT,EAAkBE,OAAlB,CAA0BF,OAAO,CAACG,OAAR,KAAoB,CAA9C,CAAT,CAAV;AACAH,QAAAA,OAAO,GAAG,IAAI9W,IAAJ,CAAStL,EAAE,CAACoL,KAAH,CAASgX,OAAT,EAAkBE,OAAlB,CAA0BF,OAAO,CAACG,OAAR,KAAoB,CAA9C,CAAT,CAAV;AACD,OAHD,MAGO,IAAI,OAAOH,OAAP,KAAmB,QAAvB,EAAiC;AACtCA,QAAAA,OAAO,GAAGA,OAAO,GAAG,CAApB;AACAC,QAAAA,OAAO,GAAGD,OAAO,GAAG,CAApB;AACAI,QAAAA,4BAA4B,CAAC/gB,IAAD,CAA5B;AACD;AACF;;AAEDA,IAAAA,IAAI,CAACE,SAAL,CAAe,SAAS0d,SAAxB,IAAqC+C,OAArC;AACA3gB,IAAAA,IAAI,CAACE,SAAL,CAAe,SAAS0d,SAAxB,IAAqCgD,OAArC;AAEAriB,IAAAA,EAAE,CAACqO,SAAH,CAAa,wBAAb,EAAuC5M,IAAvC,EAA6CA,IAAI,CAACE,SAAL,CAAeM,KAA5D,EAAmER,IAAI,CAACE,SAAL,CAAeO,KAAlF;AACAlC,IAAAA,EAAE,CAACqO,SAAH,CAAa,wBAAb,EAAuC5M,IAAvC,EAA6CA,IAAI,CAACE,SAAL,CAAeS,KAA5D,EAAmEX,IAAI,CAACE,SAAL,CAAeU,KAAlF;AACD;;AAED,WAASogB,gCAAT,CAA0ChhB,IAA1C,EAAgD;AAC9C,QAAIA,IAAI,CAACyE,cAAL,KAAwB,KAA5B,EAAmC;AACjC,UAAIzE,IAAI,CAAC4P,eAAT,EAA0B;AACxB;AACA,YAAI5P,IAAI,CAACyE,cAAL,KAAwB,IAA5B,EAAkC;AAChCzE,UAAAA,IAAI,CAACyE,cAAL,GAAsBzE,IAAI,CAACU,UAA3B;AACD,SAFD,MAEO,CAAE;AACV;;AACD,UAAIV,IAAI,CAACyE,cAAL,KAAwB,IAA5B,EAAkC;AAChC,YAAIlG,EAAE,CAAC+hB,aAAP,CAAqBtgB,IAArB,EACG4d,SADH,CACa,OADb,EAEGuB,yBAFH,GAGGc,qBAHH;AAID;AACF;AACF;;AAED,WAASgB,8BAAT,CAAwCjhB,IAAxC,EAA8Cgf,MAA9C,EAAsDjgB,QAAtD,EAAgE;AAC9DiB,IAAAA,IAAI,CAACkS,MAAL,CAAYgP,KAAZ,GAAoB1iB,EAAE,CAAC0gB,YAAH,CAAgB1gB,EAAE,CAAC0hB,gBAAnB,EAAqClB,MAArC,CAA4CA,MAA5C,CAApB;;AACAhf,IAAAA,IAAI,CAAC0E,QAAL,CAAcwc,KAAd,GAAsB,UAAS9hB,CAAT,EAAY;AAChC,aAAOY,IAAI,CAACkS,MAAL,CAAYgP,KAAZ,CAAkB9hB,CAAC,CAACL,QAAD,CAAnB,CAAP;AACD,KAFD;AAGD;;AAED,WAASoiB,yBAAT,CAAmCriB,IAAnC,EAAyCC,QAAzC,EAAmD;AACjD,WAAOP,EAAE,CAAC6gB,GAAH,CAAOvgB,IAAI,CAACK,GAAL,CAAS,UAASC,CAAT,EAAY;AAC/B,aAAOA,CAAC,CAACL,QAAD,CAAR;AAAqB,KADX,CAAP,EAEJmK,MAFI,EAAP;AAGD;;AAED,WAASkY,mBAAT,CAA6BphB,IAA7B,EAAmC;AACjC,QAAIqhB,YAAJ;;AACA,QAAIrhB,IAAI,CAACqhB,YAAL,KAAsB,IAA1B,EAAgC;AAC9B,UAAIrhB,IAAI,CAACshB,UAAL,KAAoB,QAAxB,EAAkC;AAChCD,QAAAA,YAAY,GAAG7iB,EAAE,CAACkiB,MAAH,CAAU1gB,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAV,EAAwB,UAASM,CAAT,EAAY;AACjD,iBAAOA,CAAC,CAACY,IAAI,CAACyE,cAAN,CAAR;AAAgC,SADnB,CAAf;AAED,OAHD,MAGO,IAAIzE,IAAI,CAACshB,UAAL,KAAoB,UAAxB,EAAoC;AACzCD,QAAAA,YAAY,GAAGF,yBAAyB,CAACnhB,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAD,EAAekB,IAAI,CAACyE,cAApB,CAAxC;AAED;AACF,KARD,MAQO;AACL4c,MAAAA,YAAY,GAAGrhB,IAAI,CAACqhB,YAApB;AACD;;AACD,WAAOA,YAAP;AACD;;AAED,WAASE,kBAAT,CAA4BvhB,IAA5B,EAAkC;AAChC,QAAIwhB,WAAJ;;AACA,QAAIxhB,IAAI,CAACwhB,WAAL,KAAqB,IAAzB,EAA+B;AAC7B,UAAIxhB,IAAI,CAACshB,UAAL,KAAoB,QAAxB,EAAkC;AAChCE,QAAAA,WAAW,GAAG,CAAC,MAAD,EAAS,KAAT,CAAd;AACD,OAFD,MAEO;AACLA,QAAAA,WAAW,GAAG,IAAd;AACD;AACF,KAND,MAMO;AACLA,MAAAA,WAAW,GAAGxhB,IAAI,CAACwhB,WAAnB;AACD;;AACD,WAAOA,WAAP;AACD;;AAED,WAASC,iBAAT,CAA4BzhB,IAA5B,EAAkC0hB,IAAlC,EAAwC;AACtC,QAAI3iB,QAAQ,GAAGiB,IAAI,CAAC0hB,IAAI,GAAG,WAAR,CAAnB;AACA,QAAIC,WAAW,GAAG3hB,IAAI,CAACkS,MAAL,CAAYwP,IAAI,CAAC1D,WAAL,EAAZ,EAAgC4D,KAAhC,CAAsC5hB,IAAI,CAAC0hB,IAAI,GAAG,UAAR,CAA1C,CAAlB;AACA,QAAIG,GAAG,GAAG7hB,IAAI,CAACE,SAAL,CAAe,SAASwhB,IAAxB,CAAV;;AAEA,aAASI,KAAT,CAAgBC,GAAhB,EAAqB;AACnB,UAAIA,GAAG,KAAK,IAAZ,EAAkB;AAChB,eAAO,CAAP;AACD;;AACD,UAAIA,GAAG,KAAK,OAAZ,EAAqB;AACnB,eAAO,CAAP;AACD;;AACD,aAAO5I,IAAI,CAAC6I,GAAL,CAASD,GAAT,IAAgB5I,IAAI,CAAC8I,IAA5B;AACD;;AAED,QAAIjiB,IAAI,CAAC0hB,IAAI,GAAG,aAAR,CAAJ,KAA+B,KAAnC,EAA0C;AACxC;AACAC,MAAAA,WAAW,GAAGA,WAAW,CAACxY,MAAZ,CAAmB,UAAU/J,CAAV,EAAa;AAC5C,eAAO+Z,IAAI,CAAC+I,GAAL,CAASJ,KAAK,CAAC1iB,CAAD,CAAd,IAAqB,CAArB,GAAyB,IAAzB,IAAiC+Z,IAAI,CAAC+I,GAAL,CAASJ,KAAK,CAAC1iB,CAAD,CAAd,IAAqB,CAArB,GAAyB,IAAI,IAArE;AACD,OAFa,CAAd;AAGD,KApBqC,CAsBtC;;;AACA,QAAI+iB,eAAe,GAAGR,WAAW,CAACtgB,MAAlC,CAvBsC,CAyBtC;;AACA,QAAI+gB,WAAW,GAAG,IAAlB;AACApiB,IAAAA,IAAI,CAAClB,IAAL,CAAU2J,OAAV,CAAkB,UAAUrJ,CAAV,EAAa+F,CAAb,EAAgB;AAChC/F,MAAAA,CAAC,CAACqJ,OAAF,CAAU,UAAUrJ,CAAV,EAAa+F,CAAb,EAAgB;AACxB,YAAI/F,CAAC,CAACL,QAAD,CAAD,GAAc,CAAd,KAAoB,CAAxB,EAA2B;AACzBqjB,UAAAA,WAAW,GAAG,KAAd;AACA,iBAAO,KAAP;AACD;AACF,OALD;AAMD,KAPD;;AASA,QAAIA,WAAW,IAAID,eAAe,GAAGN,GAAjC,IAAwC7hB,IAAI,CAAC2R,MAAL,KAAgB,OAA5D,EAAqE;AACnE;AACAgQ,MAAAA,WAAW,GAAGA,WAAW,CAACxY,MAAZ,CAAmB,UAAU/J,CAAV,EAAa;AAC5C,eAAOA,CAAC,GAAG,CAAJ,KAAU,CAAjB;AACD,OAFa,CAAd;AAGD;;AACDY,IAAAA,IAAI,CAACE,SAAL,CAAewhB,IAAI,GAAG,QAAtB,IAAkCC,WAAlC;AACD;;AAED,WAASU,YAAT,CAAuBriB,IAAvB,EAA6BsiB,QAA7B,EAAuC;AACrC,QAAIvX,QAAQ,GAAGuX,QAAQ,CAACvX,QAAxB;AACA,QAAIxE,EAAE,GAAG+b,QAAQ,CAAC1E,SAAlB;AACA,QAAI2E,WAAW,GAAG,EAAlB;;AACA,QAAIxX,QAAQ,KAAK,MAAjB,EAAyB;AACvBwX,MAAAA,WAAW,CAACC,EAAZ,GAAiB9f,WAAW,CAAC1C,IAAD,CAAX,GAAoB,CAArC;AACAuiB,MAAAA,WAAW,CAACE,EAAZ,GAAiB/f,WAAW,CAAC1C,IAAD,CAAX,GAAoBA,IAAI,CAAC0iB,eAA1C;AACAH,MAAAA,WAAW,CAACI,EAAZ,GAAiB3iB,IAAI,CAAC0E,QAAL,CAAc6B,EAAE,GAAG,GAAnB,CAAjB;AACAgc,MAAAA,WAAW,CAACK,EAAZ,GAAiB5iB,IAAI,CAAC0E,QAAL,CAAc6B,EAAE,GAAG,GAAnB,CAAjB;AACD;;AACD,QAAIwE,QAAQ,KAAK,OAAjB,EAA0B;AACxBwX,MAAAA,WAAW,CAACC,EAAZ,GAAiB3f,YAAY,CAAC7C,IAAD,CAAZ,GAAqB,CAAtC,EACAuiB,WAAW,CAACE,EAAZ,GAAiB5f,YAAY,CAAC7C,IAAD,CAAZ,GAAqBA,IAAI,CAAC0iB,eAD3C,EAEAH,WAAW,CAACI,EAAZ,GAAiB3iB,IAAI,CAAC0E,QAAL,CAAc6B,EAAE,GAAG,GAAnB,CAFjB;AAGAgc,MAAAA,WAAW,CAACK,EAAZ,GAAiB5iB,IAAI,CAAC0E,QAAL,CAAc6B,EAAE,GAAG,GAAnB,CAAjB;AACD;;AACD,QAAIwE,QAAQ,KAAK,KAAjB,EAAwB;AACtBwX,MAAAA,WAAW,CAACC,EAAZ,GAAiBxiB,IAAI,CAAC0E,QAAL,CAAc6B,EAAE,GAAG,GAAnB,CAAjB;AACAgc,MAAAA,WAAW,CAACE,EAAZ,GAAiBziB,IAAI,CAAC0E,QAAL,CAAc6B,EAAE,GAAG,GAAnB,CAAjB;AACAgc,MAAAA,WAAW,CAACI,EAAZ,GAAiBpgB,UAAU,CAACvC,IAAD,CAAV,GAAmB,CAApC;AACAuiB,MAAAA,WAAW,CAACK,EAAZ,GAAiBrgB,UAAU,CAACvC,IAAD,CAAV,GAAmBA,IAAI,CAAC0iB,eAAzC;AACD;;AACD,QAAI3X,QAAQ,KAAK,QAAjB,EAA2B;AACzBwX,MAAAA,WAAW,CAACC,EAAZ,GAAiBxiB,IAAI,CAAC0E,QAAL,CAAc6B,EAAE,GAAG,GAAnB,CAAjB;AACAgc,MAAAA,WAAW,CAACE,EAAZ,GAAiBziB,IAAI,CAAC0E,QAAL,CAAc6B,EAAE,GAAG,GAAnB,CAAjB;AACAgc,MAAAA,WAAW,CAACI,EAAZ,GAAiBzgB,aAAa,CAAClC,IAAD,CAAb,GAAsB,CAAvC;AACAuiB,MAAAA,WAAW,CAACK,EAAZ,GAAiB1gB,aAAa,CAAClC,IAAD,CAAb,GAAsBA,IAAI,CAAC0iB,eAA5C;AACD;;AACD,WAAOH,WAAP;AACD;;AAED,WAASM,YAAT,CAAuB7iB,IAAvB,EAA6BsiB,QAA7B,EAAuC;AACrC,QAAI/b,EAAE,GAAG+b,QAAQ,CAAC1E,SAAlB;AACA,QAAI7S,QAAQ,GAAGuX,QAAQ,CAACvX,QAAxB;AACA,QAAI+X,WAAW,GAAG9iB,IAAI,CAACE,SAAL,CAAeqG,EAAE,GAAG,QAApB,EAA8BlF,MAAhD;AACA,QAAIugB,KAAK,GAAG5hB,IAAI,CAACE,SAAL,CAAeqG,EAAE,GAAG,QAApB,CAAZ;AACA,QAAIyW,KAAK,GAAGhd,IAAI,CAACkS,MAAL,CAAY3L,EAAE,CAACyX,WAAH,EAAZ,CAAZ;AACA,QAAIuE,WAAW,GAAG,EAAlB;;AAEA,QAAIxX,QAAQ,KAAK,MAAjB,EAAyB;AACvBwX,MAAAA,WAAW,CAACC,EAAZ,GAAiB9f,WAAW,CAAC1C,IAAD,CAA5B;AACAuiB,MAAAA,WAAW,CAACE,EAAZ,GAAiB/f,WAAW,CAAC1C,IAAD,CAA5B;AACAuiB,MAAAA,WAAW,CAACI,EAAZ,GAAiB3F,KAAK,CAAC4E,KAAK,CAAC,CAAD,CAAN,CAAL,CAAgBmB,OAAhB,CAAwB,CAAxB,CAAjB;AACAR,MAAAA,WAAW,CAACK,EAAZ,GAAiB5F,KAAK,CAAC4E,KAAK,CAACkB,WAAW,GAAG,CAAf,CAAN,CAAL,CAA8BC,OAA9B,CAAsC,CAAtC,CAAjB;AACD;;AACD,QAAIhY,QAAQ,KAAK,OAAjB,EAA0B;AACxBwX,MAAAA,WAAW,CAACC,EAAZ,GAAiB3f,YAAY,CAAC7C,IAAD,CAA7B;AACAuiB,MAAAA,WAAW,CAACE,EAAZ,GAAiB5f,YAAY,CAAC7C,IAAD,CAA7B;AACAuiB,MAAAA,WAAW,CAACI,EAAZ,GAAiB3F,KAAK,CAAC4E,KAAK,CAAC,CAAD,CAAN,CAAL,CAAgBmB,OAAhB,CAAwB,CAAxB,CAAjB;AACAR,MAAAA,WAAW,CAACK,EAAZ,GAAiB5F,KAAK,CAAC4E,KAAK,CAACkB,WAAW,GAAG,CAAf,CAAN,CAAL,CAA8BC,OAA9B,CAAsC,CAAtC,CAAjB;AACD;;AACD,QAAIhY,QAAQ,KAAK,KAAjB,EAAwB;AACtBwX,MAAAA,WAAW,CAACC,EAAZ,GAAiB9f,WAAW,CAAC1C,IAAD,CAA5B;AACAuiB,MAAAA,WAAW,CAACE,EAAZ,GAAiB5f,YAAY,CAAC7C,IAAD,CAA7B;AACAuiB,MAAAA,WAAW,CAACI,EAAZ,GAAiBpgB,UAAU,CAACvC,IAAD,CAA3B;AACAuiB,MAAAA,WAAW,CAACK,EAAZ,GAAiBrgB,UAAU,CAACvC,IAAD,CAA3B;AACD;;AACD,QAAI+K,QAAQ,KAAK,QAAjB,EAA2B;AACzBwX,MAAAA,WAAW,CAACC,EAAZ,GAAiB9f,WAAW,CAAC1C,IAAD,CAA5B;AACAuiB,MAAAA,WAAW,CAACE,EAAZ,GAAiB5f,YAAY,CAAC7C,IAAD,CAA7B;AACAuiB,MAAAA,WAAW,CAACI,EAAZ,GAAiBzgB,aAAa,CAAClC,IAAD,CAA9B;AACAuiB,MAAAA,WAAW,CAACK,EAAZ,GAAiB1gB,aAAa,CAAClC,IAAD,CAA9B;AACD;;AAED,QAAI+K,QAAQ,KAAK,MAAb,IAAuBA,QAAQ,KAAK,OAAxC,EAAiD;AAC/C,UAAI/K,IAAI,CAAC2O,gBAAT,EAA2B;AACzB4T,QAAAA,WAAW,CAACI,EAAZ,GAAiBzgB,aAAa,CAAClC,IAAD,CAA9B;AACAuiB,QAAAA,WAAW,CAACK,EAAZ,GAAiBrgB,UAAU,CAACvC,IAAD,CAA3B;AACD,OAHD,MAGO,IAAI8iB,WAAJ,EAAiB;AACtBP,QAAAA,WAAW,CAACI,EAAZ,GAAiB3F,KAAK,CAAC4E,KAAK,CAAC,CAAD,CAAN,CAAL,CAAgBmB,OAAhB,CAAwB,CAAxB,CAAjB;AACAR,QAAAA,WAAW,CAACK,EAAZ,GAAiB5F,KAAK,CAAC4E,KAAK,CAACkB,WAAW,GAAG,CAAf,CAAN,CAAL,CAA8BC,OAA9B,CAAsC,CAAtC,CAAjB;AACD;AACF;;AAED,WAAOR,WAAP;AACD;;AAED,WAASS,cAAT,CAAyBhjB,IAAzB,EAA+BsiB,QAA/B,EAAyC;AACvC,QAAIvX,QAAQ,GAAGuX,QAAQ,CAACvX,QAAxB;AACA,QAAIxE,EAAE,GAAG+b,QAAQ,CAAC1E,SAAlB;AACA,QAAIqF,UAAU,GAAGjjB,IAAI,CAACuG,EAAE,GAAG,gBAAN,CAArB;AACA,QAAIyW,KAAK,GAAGhd,IAAI,CAACkS,MAAL,CAAY3L,EAAE,CAACyX,WAAH,EAAZ,CAAZ;AACA,QAAIuE,WAAW,GAAG,EAAlB;;AAEA,QAAIxX,QAAQ,KAAK,MAAjB,EAAyB;AACvBwX,MAAAA,WAAW,CAACW,CAAZ,GAAgBxgB,WAAW,CAAC1C,IAAD,CAAX,GAAoBijB,UAAU,GAAG,CAAb,GAAiB,CAArD;;AACAV,MAAAA,WAAW,CAAC5W,CAAZ,GAAgB,UAAUvM,CAAV,EAAa;AAC3B,eAAO4d,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AACD,OAFD;;AAGAR,MAAAA,WAAW,CAACY,EAAZ,GAAiB,CAAC,CAAlB;AACAZ,MAAAA,WAAW,CAACxd,EAAZ,GAAiB,OAAjB;AACAwd,MAAAA,WAAW,CAACa,UAAZ,GAAyB,KAAzB;;AACAb,MAAAA,WAAW,CAAC1c,IAAZ,GAAmB,UAAUzG,CAAV,EAAa;AAC9B,eAAOikB,qBAAqB,CAACrjB,IAAD,CAArB,CAA4BZ,CAA5B,CAAP;AACD,OAFD;AAGD;;AACD,QAAI2L,QAAQ,KAAK,OAAjB,EAA0B;AACxBwX,MAAAA,WAAW,CAACW,CAAZ,GAAgBrgB,YAAY,CAAC7C,IAAD,CAAZ,GAAqBijB,UAAU,GAAG,CAAb,GAAiB,CAAtD;;AACAV,MAAAA,WAAW,CAAC5W,CAAZ,GAAgB,UAAUvM,CAAV,EAAa;AAC3B,eAAO4d,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AACD,OAFD;;AAGAR,MAAAA,WAAW,CAACY,EAAZ,GAAiB,CAAjB;AACAZ,MAAAA,WAAW,CAACxd,EAAZ,GAAiB,OAAjB;AACAwd,MAAAA,WAAW,CAACa,UAAZ,GAAyB,OAAzB;;AACAb,MAAAA,WAAW,CAAC1c,IAAZ,GAAmB,UAAUzG,CAAV,EAAa;AAC9B,eAAOikB,qBAAqB,CAACrjB,IAAD,CAArB,CAA4BZ,CAA5B,CAAP;AAAwC,OAD1C;AAED;;AACD,QAAI2L,QAAQ,KAAK,KAAjB,EAAwB;AACtBwX,MAAAA,WAAW,CAACW,CAAZ,GAAgB,UAAU9jB,CAAV,EAAa;AAC3B,eAAO4d,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AACD,OAFD;;AAGAR,MAAAA,WAAW,CAAC5W,CAAZ,GAAgB,CAACpJ,UAAU,CAACvC,IAAD,CAAV,GAAmBijB,UAAU,GAAG,CAAb,GAAiB,CAArC,EAAwCF,OAAxC,CAAgD,CAAhD,CAAhB;AACAR,MAAAA,WAAW,CAACY,EAAZ,GAAiB,CAAjB;AACAZ,MAAAA,WAAW,CAACxd,EAAZ,GAAiB,KAAjB;AACAwd,MAAAA,WAAW,CAACa,UAAZ,GAAyB,QAAzB;;AACAb,MAAAA,WAAW,CAAC1c,IAAZ,GAAmB,UAAUzG,CAAV,EAAa;AAC9B,eAAOkkB,qBAAqB,CAACtjB,IAAD,CAArB,CAA4BZ,CAA5B,CAAP;AACD,OAFD;AAGD;;AACD,QAAI2L,QAAQ,KAAK,QAAjB,EAA2B;AACzBwX,MAAAA,WAAW,CAACW,CAAZ,GAAgB,UAAU9jB,CAAV,EAAa;AAC3B,eAAO4d,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AACD,OAFD;;AAGAR,MAAAA,WAAW,CAAC5W,CAAZ,GAAgB,CAACzJ,aAAa,CAAClC,IAAD,CAAb,GAAsBijB,UAAU,GAAG,CAAb,GAAiB,CAAxC,EAA2CF,OAA3C,CAAmD,CAAnD,CAAhB;AACAR,MAAAA,WAAW,CAACY,EAAZ,GAAiB,CAAjB;AACAZ,MAAAA,WAAW,CAACxd,EAAZ,GAAiB,OAAjB;AACAwd,MAAAA,WAAW,CAACa,UAAZ,GAAyB,QAAzB;;AACAb,MAAAA,WAAW,CAAC1c,IAAZ,GAAmB,UAAUzG,CAAV,EAAa;AAC9B,eAAOkkB,qBAAqB,CAACtjB,IAAD,CAArB,CAA4BZ,CAA5B,CAAP;AACD,OAFD;AAGD;;AAED,WAAOmjB,WAAP;AACD;;AAED,WAASgB,eAAT,CAA0BvjB,IAA1B,EAAgC;AAC9B,QAAIwjB,CAAC,GAAGxjB,IAAI,CAACyR,UAAb;;AACA,QAAI,CAACzR,IAAI,CAACE,SAAL,CAAeqR,UAApB,EAAgC;AAC9B,UAAIvR,IAAI,CAACuR,UAAT,EAAqB;AACnBvR,QAAAA,IAAI,CAACE,SAAL,CAAeqR,UAAf,GAA4BvR,IAAI,CAACuR,UAAjC;AACD,OAFD,MAEO;AACL,YAAIiS,CAAC,KAAK,MAAN,IAAgBA,CAAC,KAAK,OAAtB,IAAiCA,CAAC,KAAK,WAA3C,EAAwD;AACtDxjB,UAAAA,IAAI,CAACE,SAAL,CAAeqR,UAAf,GAA4B+R,qBAAqB,CAACtjB,IAAD,CAAjD;AACD,SAFD,MAEO,IAAIwjB,CAAC,KAAK,KAAV,EAAiB;AACtBxjB,UAAAA,IAAI,CAACE,SAAL,CAAeqR,UAAf,GAA4BkS,yBAAyB,CAACzjB,IAAD,CAArD;AACD;AACF;AACF;AACF;;AAED,WAAS0jB,eAAT,CAA0BC,CAA1B,EAA6B3jB,IAA7B,EAAmCsiB,QAAnC,EAA6C;AAC3C,QAAItiB,IAAI,CAAC4jB,WAAL,KAAqB5jB,IAAI,CAACuN,UAAL,IAAmBvN,IAAI,CAACqS,sBAA7C,CAAJ,EAA0E;AACxE,UAAI+L,EAAE,GAAGyF,0CAA0C,CAAC7jB,IAAD,CAAnD;AACA8jB,MAAAA,yBAAyB,CAAC9jB,IAAD,EAAOsiB,QAAP,EAAiBqB,CAAjB,EAAoBvF,EAAE,CAAC2F,SAAvB,EAAkC3F,EAAE,CAAC4F,OAArC,EAA8C5F,EAAE,CAAC6F,SAAjD,CAAzB;AACD;AACF;;AAED,WAASH,yBAAT,CAAoC9jB,IAApC,EAA0CsiB,QAA1C,EAAoDqB,CAApD,EAAuDO,UAAvD,EAAmEF,OAAnE,EAA4EG,kBAA5E,EAAgG;AAC9F,QAAIC,KAAK,GAAGD,kBAAkB,CAACnkB,IAAI,CAACE,SAAL,CAAeM,KAAhB,EAAuBR,IAAI,CAACE,SAAL,CAAeO,KAAtC,CAA9B;;AACA,QAAI2jB,KAAK,CAAC/iB,MAAN,KAAiB,CAArB,EAAwB;AACtB,UAAIgjB,UAAU,GAAGrkB,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAc1C,KAAd,CAAoB5hB,IAAI,CAACyO,SAAzB,EAAoC,CAApC,CAAjB;AACA2V,MAAAA,KAAK,GAAG,CAACC,UAAD,CAAR;AACD;;AAED,QAAIE,EAAE,GAAG9gB,QAAQ,CAACkgB,CAAD,EAAI,gBAAJ,CAAjB;;AACA,QAAIO,UAAU,KAAK,SAAf,IAA4BlkB,IAAI,CAACoS,iBAArC,EAAwD;AACtDoS,MAAAA,cAAc,CAACxkB,IAAD,EAAOsiB,QAAP,EAAiBiC,EAAjB,EAAqBH,KAArB,EAA4BJ,OAA5B,CAAd;AACD;;AACD,QAAIE,UAAU,IAAI,OAAlB,EAA2BO,cAAc,CAACzkB,IAAD,EAAOsiB,QAAP,EAAiBiC,EAAjB,EAAqBH,KAArB,EAA4BJ,OAA5B,CAAd;AAC5B;;AAED,WAASQ,cAAT,CAAyBxkB,IAAzB,EAA+BsiB,QAA/B,EAAyCqB,CAAzC,EAA4CS,KAA5C,EAAmDJ,OAAnD,EAA4D;AAC1DL,IAAAA,CAAC,CAACngB,SAAF,CAAY,iBAAZ,EACG1E,IADH,CACQslB,KADR,EACe/f,KADf,GAEGX,MAFH,CAEU,MAFV,EAGGY,IAHH,CAGQ,IAHR,EAGc,UAAUlF,CAAV,EAAa;AACvB,aAAOY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAd,EAAiB2jB,OAAjB,CAAyB,CAAzB,CAAP;AAAqC,KAJzC,EAKGze,IALH,CAKQ,IALR,EAKc,UAAUlF,CAAV,EAAa;AACvB,aAAOY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAd,EAAiB2jB,OAAjB,CAAyB,CAAzB,CAAP;AAAqC,KANzC,EAOGze,IAPH,CAOQ,IAPR,EAOc/B,UAAU,CAACvC,IAAD,CAPxB,EAQGsE,IARH,CAQQ,IARR,EAQcpC,aAAa,CAAClC,IAAD,CAR3B;AASD;;AAED,WAASykB,cAAT,CAAyBzkB,IAAzB,EAA+BsiB,QAA/B,EAAyCqB,CAAzC,EAA4CS,KAA5C,EAAmDJ,OAAnD,EAA4D;AAC1D,QAAIjZ,QAAQ,GAAGuX,QAAQ,CAACvX,QAAxB;AACA,QAAIxE,EAAE,GAAG+b,QAAQ,CAAC1E,SAAlB;AACA,QAAIZ,KAAK,GAAGhd,IAAI,CAACkS,MAAL,CAAY3L,EAAE,CAACyX,WAAH,EAAZ,CAAZ;AACA,QAAIkF,CAAJ,EAAOvX,CAAP,EAAU5G,EAAV,EAAcqe,UAAd,EAA0BsB,OAA1B;AACA,QAAIC,gBAAgB,GAAGnmB,EAAE,CAACqF,MAAH,CAAU7D,IAAI,CAACiE,MAAf,EACpBJ,MADoB,CACb,iBADa,EACMqB,IADN,GACaiB,qBADb,EAAvB;;AAGA,QAAI4E,QAAQ,KAAK,KAAjB,EAAwB;AACtBmY,MAAAA,CAAC,GAAG,UAAU9jB,CAAV,EAAa+F,CAAb,EAAgB;AAClB,eAAO6X,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AAA6B,OAD/B;;AAEApX,MAAAA,CAAC,GAAIpJ,UAAU,CAACvC,IAAD,CAAV,GAAmBA,IAAI,CAAC0O,eAAL,GAAuB,CAAvB,GAA2B,CAA/C,GAAqDiW,gBAAgB,CAACxiB,MAA1E;AACA4C,MAAAA,EAAE,GAAG,OAAL;AACAqe,MAAAA,UAAU,GAAG,QAAb;;AACAsB,MAAAA,OAAO,GAAG,UAAUtlB,CAAV,EAAa;AACrB,eAAO4kB,OAAO,CAAC,IAAIna,IAAJ,CAASzK,CAAT,CAAD,CAAd;AAA8B,OADhC;AAED;;AACD,QAAI2L,QAAQ,KAAK,QAAjB,EAA2B;AACzBmY,MAAAA,CAAC,GAAG,UAAU9jB,CAAV,EAAa+F,CAAb,EAAgB;AAClB,eAAO6X,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AAA6B,OAD/B;;AAEApX,MAAAA,CAAC,GAAIzJ,aAAa,CAAClC,IAAD,CAAb,GAAsBA,IAAI,CAAC0O,eAAL,GAAuB,CAAvB,GAA2B,CAAlD,GAAwDiW,gBAAgB,CAACxiB,MAAjB,GAA0B,GAAtF;AACA4C,MAAAA,EAAE,GAAG,OAAL;AACAqe,MAAAA,UAAU,GAAG,QAAb;;AACAsB,MAAAA,OAAO,GAAG,UAAUtlB,CAAV,EAAa;AACrB,eAAO4kB,OAAO,CAAC,IAAIna,IAAJ,CAASzK,CAAT,CAAD,CAAd;AAA8B,OADhC;AAED;;AAEDukB,IAAAA,CAAC,CAACngB,SAAF,CAAY,iBAAZ,EACG1E,IADH,CACQslB,KADR,EACe/f,KADf,GAEGX,MAFH,CAEU,MAFV,EAGGY,IAHH,CAGQ,GAHR,EAGa4e,CAHb,EAIG5e,IAJH,CAIQ,GAJR,EAIaqH,CAJb,EAKGrH,IALH,CAKQ,IALR,EAKcS,EALd,EAMGT,IANH,CAMQ,aANR,EAMuB8e,UANvB,EAOGvd,IAPH,CAOQ6e,OAPR;AAQD;;AAED,WAASE,kBAAT,CAA6BjB,CAA7B,EAAgC3jB,IAAhC,EAAsCsiB,QAAtC,EAAgD;AAC9C,QAAI/b,EAAE,GAAG+b,QAAQ,CAAC1E,SAAlB;AACA,QAAIiH,MAAM,GAAG7B,cAAc,CAAChjB,IAAD,EAAOsiB,QAAP,CAA3B;AACA,QAAIV,KAAK,GAAG5hB,IAAI,CAACE,SAAL,CAAeqG,EAAE,GAAG,QAApB,CAAZ;AAEA,QAAI1B,MAAM,GAAG8e,CAAC,CAACngB,SAAF,CAAY,gBAAZ,EACV1E,IADU,CACL8iB,KADK,EACEvd,KADF,GAEVX,MAFU,CAEH,MAFG,EAGVY,IAHU,CAGL,GAHK,EAGAugB,MAAM,CAAC3B,CAHP,EAIV5e,IAJU,CAIL,IAJK,EAICugB,MAAM,CAAC1B,EAJR,EAKV7e,IALU,CAKL,GALK,EAKAugB,MAAM,CAAClZ,CALP,EAMVrH,IANU,CAML,IANK,EAMCugB,MAAM,CAAC9f,EANR,EAOVT,IAPU,CAOL,aAPK,EAOUugB,MAAM,CAACzB,UAPjB,EAQVvd,IARU,CAQLgf,MAAM,CAAChf,IARF,CAAb,CAL8C,CAe9C;;AACA,QAAIU,EAAE,IAAI,GAAV,EAAe;AACbgd,MAAAA,eAAe,CAACvjB,IAAD,CAAf;;AACA,UAAIA,IAAI,CAAC4jB,WAAL,IAAoB5jB,IAAI,CAACmS,cAA7B,EAA6C;AAC3CtN,QAAAA,MAAM,CAACnB,MAAP,CAAc,OAAd,EAAuBC,OAAvB,CAA+B,mBAA/B,EAAoD,IAApD,EAA0DkC,IAA1D,CAA+D,UAAUif,EAAV,EAAc3f,CAAd,EAAiB;AAC9E,cAAI/F,CAAC,GAAG,IAAIyK,IAAJ,CAASib,EAAT,CAAR;AACA,cAAI3f,CAAC,KAAK,CAAV,EAAa,OAAO3G,EAAE,CAACmB,UAAH,CAAc,IAAd,EAAoBP,CAApB,CAAP,CAAb,KACK,OAAO,EAAP;AACN,SAJD;AAKAyF,QAAAA,MAAM,CAACnB,MAAP,CAAc,OAAd,EAAuBC,OAAvB,CAA+B,6BAA/B,EAA8D,IAA9D,EAAoEkC,IAApE,CAAyE,UAAUif,EAAV,EAAc3f,CAAd,EAAiB;AACxF,cAAI/F,CAAC,GAAG,IAAIyK,IAAJ,CAASib,EAAT,CAAR;AACA,iBAAO,MAAM9kB,IAAI,CAACE,SAAL,CAAeqR,UAAf,CAA0BnS,CAA1B,CAAb;AACD,SAHD;AAID,OAVD,MAUO;AACLyF,QAAAA,MAAM,CAACgB,IAAP,CAAY,UAAUzG,CAAV,EAAa;AACvB,iBAAOY,IAAI,CAACmP,SAAL,GAAiBnP,IAAI,CAACE,SAAL,CAAeqR,UAAf,CAA0BnS,CAA1B,CAAxB;AACD,SAFD;AAGD;;AACDskB,MAAAA,eAAe,CAACC,CAAD,EAAI3jB,IAAJ,EAAUsiB,QAAV,CAAf;AACD;;AAED,QAAIrd,2BAA2B,CAACJ,MAAD,CAA/B,EAAyC;AACvCA,MAAAA,MAAM,CAACsE,MAAP,CAAc,UAAU/J,CAAV,EAAa+F,CAAb,EAAgB;AAC5B,eAAO,CAACA,CAAC,GAAG,CAAL,IAAU,CAAV,KAAgB,CAAvB;AACD,OAFD,EAEG/B,MAFH;AAIA,UAAIE,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACAX,MAAAA,GAAG,CAACE,SAAJ,CAAc,SAAS+C,EAAT,GAAc,UAA5B,EAAwC4C,MAAxC,CAA+C,UAAU/J,CAAV,EAAa+F,CAAb,EAAgB;AAC7D,eAAO,CAACA,CAAC,GAAG,CAAL,IAAU,CAAV,KAAgB,CAAvB;AAA2B,OAD7B,EAEG/B,MAFH;AAGD;AACF;;AAED,WAAS2hB,YAAT,CAAuBpB,CAAvB,EAA0B3jB,IAA1B,EAAgCsiB,QAAhC,EAA0C;AACxC;AACA,QAAI/b,EAAE,GAAG+b,QAAQ,CAAC1E,SAAlB;AACA,QAAI7S,QAAQ,GAAGuX,QAAQ,CAACvX,QAAxB;AACA,QAAIiS,KAAK,GAAGhd,IAAI,CAACkS,MAAL,CAAY3L,EAAE,CAACyX,WAAH,EAAZ,CAAZ;AAEA,QAAI4D,KAAK,GAAG5hB,IAAI,CAACE,SAAL,CAAeqG,EAAE,GAAG,QAApB,CAAZ;AACA,QAAIye,UAAU,GAAG,QAAQze,EAAR,GAAa,UAA9B;AACA,QAAI0e,kBAAkB,GAAG,iBAAiB1e,EAAjB,GAAsB,UAA/C;AACA,QAAI2e,aAAa,GAAGllB,IAAI,CAACuG,EAAE,GAAG,iBAAN,CAAxB;AACA,QAAI0c,UAAU,GAAGjjB,IAAI,CAACuG,EAAE,GAAG,gBAAN,CAArB;AAEA,QAAIic,EAAJ,EAAQC,EAAR,EAAYE,EAAZ,EAAgBC,EAAhB;;AAEA,QAAI7X,QAAQ,KAAK,MAAjB,EAAyB;AACvByX,MAAAA,EAAE,GAAG9f,WAAW,CAAC1C,IAAD,CAAhB;AACAyiB,MAAAA,EAAE,GAAGyC,aAAa,GAAGriB,YAAY,CAAC7C,IAAD,CAAf,GAAwB0C,WAAW,CAAC1C,IAAD,CAAX,GAAoBijB,UAA9D;;AACAN,MAAAA,EAAE,GAAG,UAAUvjB,CAAV,EAAa;AAChB,eAAO4d,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AACD,OAFD;;AAGAH,MAAAA,EAAE,GAAG,UAAUxjB,CAAV,EAAa;AAChB,eAAO4d,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AACD,OAFD;AAGD;;AACD,QAAIhY,QAAQ,KAAK,OAAjB,EAA0B;AACxByX,MAAAA,EAAE,GAAG3f,YAAY,CAAC7C,IAAD,CAAjB;AACAyiB,MAAAA,EAAE,GAAGyC,aAAa,GAAGxiB,WAAW,CAAC1C,IAAD,CAAd,GAAuB6C,YAAY,CAAC7C,IAAD,CAAZ,GAAqBijB,UAA9D;;AACAN,MAAAA,EAAE,GAAG,UAAUvjB,CAAV,EAAa;AAChB,eAAO4d,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AACD,OAFD;;AAGAH,MAAAA,EAAE,GAAG,UAAUxjB,CAAV,EAAa;AAChB,eAAO4d,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AACD,OAFD;AAGD;;AACD,QAAIhY,QAAQ,KAAK,KAAjB,EAAwB;AACtByX,MAAAA,EAAE,GAAG,UAAUpjB,CAAV,EAAa;AAChB,eAAO4d,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AACD,OAFD;;AAGAN,MAAAA,EAAE,GAAG,UAAUrjB,CAAV,EAAa;AAChB,eAAO4d,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AACD,OAFD;;AAGAJ,MAAAA,EAAE,GAAGpgB,UAAU,CAACvC,IAAD,CAAf;AACA4iB,MAAAA,EAAE,GAAGsC,aAAa,GAAGhjB,aAAa,CAAClC,IAAD,CAAhB,GAAyBuC,UAAU,CAACvC,IAAD,CAAV,GAAmBijB,UAA9D;AACD;;AACD,QAAIlY,QAAQ,KAAK,QAAjB,EAA2B;AACzByX,MAAAA,EAAE,GAAG,UAAUpjB,CAAV,EAAa;AAChB,eAAO4d,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AACD,OAFD;;AAGAN,MAAAA,EAAE,GAAG,UAAUrjB,CAAV,EAAa;AAChB,eAAO4d,KAAK,CAAC5d,CAAD,CAAL,CAAS2jB,OAAT,CAAiB,CAAjB,CAAP;AACD,OAFD;;AAGAJ,MAAAA,EAAE,GAAGzgB,aAAa,CAAClC,IAAD,CAAlB;AACA4iB,MAAAA,EAAE,GAAGsC,aAAa,GAAG3iB,UAAU,CAACvC,IAAD,CAAb,GAAsBkC,aAAa,CAAClC,IAAD,CAAb,GAAsBijB,UAA9D;AACD;;AAEDU,IAAAA,CAAC,CAACngB,SAAF,CAAY,MAAMwhB,UAAlB,EACGlmB,IADH,CACQ8iB,KADR,EACevd,KADf,GAEGX,MAFH,CAEU,MAFV,EAGGC,OAHH,CAGWshB,kBAHX,EAG+BC,aAH/B,EAIG5gB,IAJH,CAIQ,IAJR,EAIcke,EAJd,EAKGle,IALH,CAKQ,IALR,EAKcme,EALd,EAMGne,IANH,CAMQ,IANR,EAMcqe,EANd,EAOGre,IAPH,CAOQ,IAPR,EAOcse,EAPd;AAQD;;AAED,WAASuC,iBAAT,CAA4BxB,CAA5B,EAA+B3jB,IAA/B,EAAqCsiB,QAArC,EAA+C;AAC7C,QAAI1E,SAAS,GAAG0E,QAAQ,CAAC1E,SAAzB;AACA,QAAIkF,WAAW,GAAG9iB,IAAI,CAACE,SAAL,CAAe0d,SAAS,GAAG,QAA3B,EAAqCvc,MAAvD;AAEA,QAAI+jB,GAAG,GAAGvC,YAAY,CAAC7iB,IAAD,EAAOsiB,QAAP,CAAtB;;AAEA,QAAI,CAACtiB,IAAI,CAAC4d,SAAS,GAAG,iBAAb,CAAL,IAAwC,CAAC5d,IAAI,CAAC4d,SAAS,GAAG,iBAAb,CAA7C,IAAgFkF,WAApF,EAAiG;AAC/Fa,MAAAA,CAAC,CAACjgB,MAAF,CAAS,MAAT,EACGY,IADH,CACQ,IADR,EACc8gB,GAAG,CAAC5C,EADlB,EAEGle,IAFH,CAEQ,IAFR,EAEc8gB,GAAG,CAAC3C,EAFlB,EAGGne,IAHH,CAGQ,IAHR,EAGc8gB,GAAG,CAACzC,EAHlB,EAIGre,IAJH,CAIQ,IAJR,EAIc8gB,GAAG,CAACxC,EAJlB;AAKD;AACF;;AAED,WAASyC,aAAT,CAAwBrlB,IAAxB,EAA8B+D,SAA9B,EAAyC;AACvC,QAAIT,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,QAAIC,QAAQ,GAAGC,gBAAgB,CAACnE,IAAI,CAAClB,IAAN,CAA/B;AACA,QAAIsF,GAAG,GAAGd,GAAG,CAACE,SAAJ,CAAc,UAAUO,SAAxB,EAAmCjF,IAAnC,CAAwCoF,QAAxC,CAAV,CAHuC,CAKvC;;AACAE,IAAAA,GAAG,CAACC,KAAJ,GAAYX,MAAZ,CAAmB,UAAnB,EAA+BY,IAA/B,CAAoC,OAApC,EAA6CP,SAA7C,EAAwDO,IAAxD,CAA6D,SAA7D,EAAwE,GAAxE,EANuC,CAQvC;;AACArB,IAAAA,kBAAkB,CAACmB,GAAD,CAAlB,CATuC,CAWvC;;AACAnB,IAAAA,kBAAkB,CAACmB,GAAD,CAAlB;AACA,WAAOA,GAAP;AACD;;AAED,WAASA,GAAT,CAAcpE,IAAd,EAAoBsiB,QAApB,EAA8B;AAC5B;;AACAtiB,IAAAA,IAAI,CAAC0iB,eAAL,GAAuB1iB,IAAI,CAACyR,UAAL,KAAoB,OAApB,GAA8BzR,IAAI,CAACsC,MAAL,GAAc,CAA5C,GAAgDtC,IAAI,CAACsC,MAAL,GAAc,CAAd,GAAkB,CAAzF;AAEA,QAAI8B,GAAG,GAAGihB,aAAa,CAACrlB,IAAD,EAAO,QAAQsiB,QAAQ,CAAC1E,SAAjB,GAA6B,MAApC,CAAvB;AACA,QAAI0H,aAAa,GAAGjD,YAAY,CAACriB,IAAD,EAAOsiB,QAAP,CAAhC;AACAle,IAAAA,GAAG,CAACE,IAAJ,CAAS,IAAT,EAAeghB,aAAa,CAAC9C,EAA7B,EACGle,IADH,CACQ,IADR,EACcghB,aAAa,CAAC7C,EAD5B,EAEGne,IAFH,CAEQ,IAFR,EAEcghB,aAAa,CAAC3C,EAF5B,EAGGre,IAHH,CAGQ,IAHR,EAGcghB,aAAa,CAAC1C,EAH5B;AAKAre,IAAAA,4BAA4B,CAACH,GAAD,EAAMpE,IAAN,EAAY,QAAQsiB,QAAQ,CAAC1E,SAAjB,GAA6B,WAAzC,CAA5B;AACD;;AAED,WAAS2H,yBAAT,CAAoCvlB,IAApC,EAA0CsiB,QAA1C,EAAoDkD,KAApD,EAA2D;AACzD,QAAIjf,EAAE,GAAG+b,QAAQ,CAAC1E,SAAlB;AACA,QAAI7S,QAAQ,GAAGuX,QAAQ,CAACvX,QAAxB;AACA,QAAIiS,KAAK,GAAGhd,IAAI,CAACkS,MAAL,CAAY3L,EAAE,CAACyX,WAAH,EAAZ,CAAZ;AACA,QAAIyH,UAAU,GAAGzlB,IAAI,CAACkS,MAAL,CAAY,CAAC3L,EAAE,GAAG,OAAN,EAAeyX,WAAf,EAAZ,CAAjB;AACA,QAAI6G,MAAM,GAAG,EAAb;AACAA,IAAAA,MAAM,CAACa,GAAP,GAAa,EAAb;AACAb,IAAAA,MAAM,CAACW,KAAP,GAAe,EAAf,CAPyD,CAQzD;;AAEA,QAAIza,QAAQ,KAAK,MAAjB,EAAyB;AACvB8Z,MAAAA,MAAM,CAACa,GAAP,CAAWxC,CAAX,GAAetgB,gBAAgB,CAAC5C,IAAD,CAAhB,GAAyBA,IAAI,CAACsC,MAA7C;;AACAuiB,MAAAA,MAAM,CAACa,GAAP,CAAW/Z,CAAX,GAAe,UAAUvM,CAAV,EAAa;AAC1B,eAAOqmB,UAAU,CAACD,KAAD,CAAV,GAAoBxI,KAAK,CAAC5d,CAAD,CAAzB,GAA+B4d,KAAK,CAAC+C,SAAN,KAAoB,CAA1D;AACD,OAFD;;AAGA8E,MAAAA,MAAM,CAACa,GAAP,CAAW3gB,EAAX,GAAgB,OAAhB;AACA8f,MAAAA,MAAM,CAACa,GAAP,CAAWtC,UAAX,GAAwB,KAAxB;AACAyB,MAAAA,MAAM,CAACW,KAAP,CAAatC,CAAb,GAAiBtgB,gBAAgB,CAAC5C,IAAD,CAAhB,GAAyBA,IAAI,CAACsC,MAA/C;AACAuiB,MAAAA,MAAM,CAACW,KAAP,CAAa7Z,CAAb,GAAiB8Z,UAAU,CAACD,KAAD,CAAV,IAAqBC,UAAU,CAAC1F,SAAX,GAAuB0F,UAAU,CAAC1F,SAAX,KAAyB,CAAhD,GAAoD,CAAzE,CAAjB;AACA8E,MAAAA,MAAM,CAACW,KAAP,CAAazgB,EAAb,GAAkB,OAAlB;AACA8f,MAAAA,MAAM,CAACW,KAAP,CAAapC,UAAb,GAA0BpjB,IAAI,CAAC,YAAYuG,EAAZ,GAAiB,SAAlB,CAAJ,GAAmC,KAAnC,GAA2C,KAArE;AACD;;AAED,QAAIwE,QAAQ,KAAK,OAAjB,EAA0B;AACxB8Z,MAAAA,MAAM,CAACa,GAAP,CAAWxC,CAAX,GAAelgB,iBAAiB,CAAChD,IAAD,CAAjB,GAA0BA,IAAI,CAACsC,MAA9C;;AACAuiB,MAAAA,MAAM,CAACa,GAAP,CAAW/Z,CAAX,GAAe,UAAUvM,CAAV,EAAa;AAC1B,eAAOqmB,UAAU,CAACD,KAAD,CAAV,GAAoBxI,KAAK,CAAC5d,CAAD,CAAzB,GAA+B4d,KAAK,CAAC+C,SAAN,KAAoB,CAA1D;AACD,OAFD;;AAGA8E,MAAAA,MAAM,CAACa,GAAP,CAAW3gB,EAAX,GAAgB,OAAhB;AACA8f,MAAAA,MAAM,CAACa,GAAP,CAAWtC,UAAX,GAAwB,OAAxB;AACAyB,MAAAA,MAAM,CAACW,KAAP,CAAatC,CAAb,GAAiBlgB,iBAAiB,CAAChD,IAAD,CAAjB,GAA0BA,IAAI,CAACsC,MAAhD;AACAuiB,MAAAA,MAAM,CAACW,KAAP,CAAa7Z,CAAb,GAAiB8Z,UAAU,CAACD,KAAD,CAAV,IAAqBC,UAAU,CAAC1F,SAAX,GAAuB0F,UAAU,CAAC1F,SAAX,KAAyB,CAAhD,GAAoD,CAAzE,CAAjB;AACA8E,MAAAA,MAAM,CAACW,KAAP,CAAazgB,EAAb,GAAkB,OAAlB;AACA8f,MAAAA,MAAM,CAACW,KAAP,CAAapC,UAAb,GAA0B,OAA1B;AACD;;AAED,QAAIrY,QAAQ,KAAK,KAAjB,EAAwB;AACtB8Z,MAAAA,MAAM,CAACa,GAAP,CAAWxC,CAAX,GAAe,UAAU9jB,CAAV,EAAa;AAC1B,eAAOqmB,UAAU,CAACD,KAAD,CAAV,GAAoBxI,KAAK,CAAC5d,CAAD,CAAzB,GAA+B4d,KAAK,CAAC+C,SAAN,KAAoB,CAA1D;AACD,OAFD;;AAGA8E,MAAAA,MAAM,CAACa,GAAP,CAAW/Z,CAAX,GAAelJ,eAAe,CAACzC,IAAD,CAAf,GAAwBA,IAAI,CAACsC,MAA5C;AACAuiB,MAAAA,MAAM,CAACa,GAAP,CAAW3gB,EAAX,GAAgB,OAAhB;AACA8f,MAAAA,MAAM,CAACa,GAAP,CAAWtC,UAAX,GAAwBpjB,IAAI,CAAC,YAAYuG,EAAZ,GAAiB,SAAlB,CAAJ,GAAmC,OAAnC,GAA6C,QAArE;AACAse,MAAAA,MAAM,CAACW,KAAP,CAAatC,CAAb,GAAiBuC,UAAU,CAACD,KAAD,CAAV,IAAqBC,UAAU,CAAC1F,SAAX,GAAuB0F,UAAU,CAAC1F,SAAX,KAAyB,CAAhD,GAAoD,CAAzE,CAAjB;AACA8E,MAAAA,MAAM,CAACW,KAAP,CAAa7Z,CAAb,GAAiBlJ,eAAe,CAACzC,IAAD,CAAf,GAAwBA,IAAI,CAACsC,MAA9C;AACAuiB,MAAAA,MAAM,CAACW,KAAP,CAAazgB,EAAb,GAAkB,OAAlB;AACA8f,MAAAA,MAAM,CAACW,KAAP,CAAapC,UAAb,GAA0BpjB,IAAI,CAAC,YAAYuG,EAAZ,GAAiB,SAAlB,CAAJ,GAAmC,OAAnC,GAA6C,QAAvE;AACD;;AAED,QAAIwE,QAAQ,KAAK,QAAjB,EAA2B;AACzB8Z,MAAAA,MAAM,CAACa,GAAP,CAAWxC,CAAX,GAAe,UAAU9jB,CAAV,EAAa;AAC1B,eAAOqmB,UAAU,CAACD,KAAD,CAAV,GAAoBxI,KAAK,CAAC5d,CAAD,CAAzB,GAA+B4d,KAAK,CAAC+C,SAAN,KAAoB,CAA1D;AACD,OAFD;;AAGA8E,MAAAA,MAAM,CAACa,GAAP,CAAW/Z,CAAX,GAAetJ,kBAAkB,CAACrC,IAAD,CAAlB,GAA2BA,IAAI,CAACsC,MAA/C;AACAuiB,MAAAA,MAAM,CAACa,GAAP,CAAW3gB,EAAX,GAAgB,OAAhB;AACA8f,MAAAA,MAAM,CAACa,GAAP,CAAWtC,UAAX,GAAwBpjB,IAAI,CAAC,YAAYuG,EAAZ,GAAiB,SAAlB,CAAJ,GAAmC,OAAnC,GAA6C,QAArE;AACAse,MAAAA,MAAM,CAACW,KAAP,CAAatC,CAAb,GAAiBuC,UAAU,CAACD,KAAD,CAAV,IAAqBC,UAAU,CAAC1F,SAAX,GAAuB0F,UAAU,CAAC1F,SAAX,KAAyB,CAAzB,GAA6B/C,KAAK,CAAC+C,SAAN,KAAoB,CAAxE,GAA4E,CAAjG,CAAjB;AACA8E,MAAAA,MAAM,CAACW,KAAP,CAAa7Z,CAAb,GAAiBtJ,kBAAkB,CAACrC,IAAD,CAAlB,GAA2BA,IAAI,CAACsC,MAAjD;AACAuiB,MAAAA,MAAM,CAACW,KAAP,CAAazgB,EAAb,GAAkB,OAAlB;AACA8f,MAAAA,MAAM,CAACW,KAAP,CAAapC,UAAb,GAA0BpjB,IAAI,CAAC,YAAYuG,EAAZ,GAAiB,SAAlB,CAAJ,GAAmC,OAAnC,GAA6C,QAAvE;AACD;;AAED,WAAOse,MAAP;AACD;;AAED,WAASc,iBAAT,CAA4B3lB,IAA5B,EAAkCsiB,QAAlC,EAA4C;AAC1C,QAAI/b,EAAE,GAAG+b,QAAQ,CAAC1E,SAAlB;AACA,QAAIgI,OAAO,GAAG,QAAQrf,EAAR,GAAa,OAA3B;AACA,QAAIyW,KAAK,GAAGhd,IAAI,CAACkS,MAAL,CAAY3L,EAAE,CAACyX,WAAH,EAAZ,CAAZ;AACA,QAAIyH,UAAU,GAAGzlB,IAAI,CAACkS,MAAL,CAAY,CAAC3L,EAAE,GAAG,OAAN,EAAeyX,WAAf,EAAZ,CAAjB;AACA,QAAI6H,aAAa,GAAGtf,EAAE,GAAG,gBAAzB;AAEA,QAAIjD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACAZ,IAAAA,uBAAuB,CAACC,GAAD,EAAM,MAAMsiB,OAAZ,CAAvB;AACA,QAAIjC,CAAC,GAAGlgB,QAAQ,CAACH,GAAD,EAAMsiB,OAAN,CAAhB;AACA,QAAIE,OAAJ;AACA,QAAIC,MAAM,GAAGN,UAAU,CAACzG,MAAX,IAAqByG,UAAU,CAACzG,MAAX,EAArB,GACTyG,UAAU,CAACzG,MAAX,EADS,GAET,CAAC,GAAD,CAFJ;AAIA+G,IAAAA,MAAM,CAACtd,OAAP,CAAe,UAAU+c,KAAV,EAAiB;AAC9B;AACA,UAAIX,MAAM,GAAGU,yBAAyB,CAACvlB,IAAD,EAAOsiB,QAAP,EAAiBkD,KAAjB,CAAtC;AAEAM,MAAAA,OAAO,GAAGriB,QAAQ,CAACkgB,CAAD,EAAI,cAAc3c,YAAY,CAACwe,KAAD,CAA9B,CAAlB;;AACA,UAAIxlB,IAAI,CAAC6lB,aAAD,CAAJ,KAAwB,IAA5B,EAAkC;AAChC,YAAIhhB,MAAM,GAAGihB,OAAO,CAACpiB,MAAR,CAAe,MAAf,EACVC,OADU,CACF,wBADE,EACwB,IADxB,EAEVW,IAFU,CAEL,GAFK,EAEAugB,MAAM,CAACW,KAAP,CAAatC,CAFb,EAGV5e,IAHU,CAGL,GAHK,EAGAugB,MAAM,CAACW,KAAP,CAAa7Z,CAHb,EAIVrH,IAJU,CAIL,IAJK,EAICugB,MAAM,CAACW,KAAP,CAAazgB,EAJd,EAKVT,IALU,CAKL,aALK,EAKUugB,MAAM,CAACW,KAAP,CAAapC,UALvB,EAMVvd,IANU,CAML2f,KANK,CAAb;AAQD,OATD,MASO;AACL,YAAI3gB,MAAM,GAAGihB,OAAO,CAACtiB,SAAR,CAAkB,MAAlB,EACV1E,IADU,CACLke,KAAK,CAACgC,MAAN,EADK,EAEV3a,KAFU,GAGVX,MAHU,CAGH,MAHG,EAIVY,IAJU,CAIL,GAJK,EAIAugB,MAAM,CAACa,GAAP,CAAWxC,CAJX,EAKV5e,IALU,CAKL,GALK,EAKAugB,MAAM,CAACa,GAAP,CAAW/Z,CALX,EAMVrH,IANU,CAML,IANK,EAMCugB,MAAM,CAACa,GAAP,CAAW3gB,EANZ,EAOVT,IAPU,CAOL,aAPK,EAOUugB,MAAM,CAACa,GAAP,CAAWtC,UAPrB,EAQVvd,IARU,CAQLmgB,MARK,CAAb;AASD;;AACD,UAAIhmB,IAAI,CAAC,YAAYuG,EAAZ,GAAiB,SAAlB,CAAR,EAAsC;AACpC0f,QAAAA,YAAY,CAACphB,MAAD,EAAS7E,IAAI,CAAC,YAAYuG,EAAZ,GAAiB,SAAlB,CAAb,CAAZ;AACD;AACF,KA5BD;AA6BD;;AAED,WAAS2f,iBAAT,CAA4BlmB,IAA5B,EAAkCsiB,QAAlC,EAA4C;AAC1C;AACA;AAEA,QAAI/b,EAAE,GAAG+b,QAAQ,CAAC1E,SAAlB;AACA,QAAIuI,MAAM,GAAGnmB,IAAI,CAAC0E,QAAL,CAAc6B,EAAE,GAAG,GAAnB,CAAb;AACA,QAAI6f,MAAM,GAAGpmB,IAAI,CAAC0E,QAAL,CAAc6B,EAAE,GAAG,QAAnB,CAAb;AACA,QAAIkf,UAAU,GAAGzlB,IAAI,CAACkS,MAAL,CAAY,CAAC3L,EAAE,GAAG,OAAN,EAAeyX,WAAf,EAAZ,CAAjB;AACA,QAAIhB,KAAK,GAAGhd,IAAI,CAACkS,MAAL,CAAY3L,EAAE,CAACyX,WAAH,EAAZ,CAAZ;AACA,QAAIjT,QAAQ,GAAGuX,QAAQ,CAACvX,QAAxB;AAEA,QAAIzH,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,QAAIoiB,cAAc,GAAG,EAArB;AAEA,QAAI7D,EAAJ,EAAQC,EAAR,EAAYE,EAAZ,EAAgBC,EAAhB;AACA,QAAI0D,GAAG,GAAIb,UAAU,CAACzG,MAAX,IAAqByG,UAAU,CAACzG,MAAX,EAAtB,GAA6CyG,UAAU,CAACzG,MAAX,EAA7C,GAAmE,CAAC,IAAD,CAA7E;AAEA3b,IAAAA,uBAAuB,CAACC,GAAD,EAAM,qBAAN,CAAvB;AACA,QAAIqgB,CAAC,GAAGlgB,QAAQ,CAACH,GAAD,EAAM,oBAAN,CAAhB;AAEAgjB,IAAAA,GAAG,CAAC7d,OAAJ,CAAY,UAAU+c,KAAV,EAAiB;AAC3BxI,MAAAA,KAAK,CAACgC,MAAN,GAAevW,OAAf,CAAuB,UAAUid,GAAV,EAAe;AACpC,YAAI3a,QAAQ,KAAK,MAAb,IAAuBA,QAAQ,KAAK,OAAxC,EAAiD;AAC/CyX,UAAAA,EAAE,GAAG5f,gBAAgB,CAAC5C,IAAD,CAArB;AACAyiB,UAAAA,EAAE,GAAGzf,iBAAiB,CAAChD,IAAD,CAAtB;AACA2iB,UAAAA,EAAE,GAAG3F,KAAK,CAAC0I,GAAD,CAAL,GAAaD,UAAU,CAACD,KAAD,CAAvB,GAAiCxI,KAAK,CAAC+C,SAAN,KAAoB,CAA1D;AACA6C,UAAAA,EAAE,GAAG5F,KAAK,CAAC0I,GAAD,CAAL,GAAaD,UAAU,CAACD,KAAD,CAAvB,GAAiCxI,KAAK,CAAC+C,SAAN,KAAoB,CAA1D;AACD;;AAED,YAAIhV,QAAQ,KAAK,KAAb,IAAsBA,QAAQ,KAAK,QAAvC,EAAiD;AAC/CyX,UAAAA,EAAE,GAAGxF,KAAK,CAAC0I,GAAD,CAAL,GAAaD,UAAU,CAACD,KAAD,CAAvB,GAAiCxI,KAAK,CAAC+C,SAAN,KAAoB,CAApB,IAAyByF,KAAK,KAAK,IAAnC,CAAtC;AACA/C,UAAAA,EAAE,GAAGzF,KAAK,CAAC0I,GAAD,CAAL,GAAaD,UAAU,CAACD,KAAD,CAAvB,GAAiCxI,KAAK,CAAC+C,SAAN,KAAoB,CAApB,IAAyByF,KAAK,KAAK,IAAnC,CAAtC;AACA7C,UAAAA,EAAE,GAAGtgB,kBAAkB,CAACrC,IAAD,CAAvB;AACA4iB,UAAAA,EAAE,GAAGngB,eAAe,CAACzC,IAAD,CAApB;AACD;;AAED2jB,QAAAA,CAAC,CAACjgB,MAAF,CAAS,MAAT,EACGY,IADH,CACQ,IADR,EACcke,EADd,EAEGle,IAFH,CAEQ,IAFR,EAEcme,EAFd,EAGGne,IAHH,CAGQ,IAHR,EAGcqe,EAHd,EAIGre,IAJH,CAIQ,IAJR,EAIcse,EAJd,EAKGte,IALH,CAKQ,kBALR,EAK4B,KAL5B;AAMD,OArBD;AAuBA,UAAIiiB,KAAK,GAAGd,UAAU,CAACD,KAAD,CAAV,GAAoBxI,KAAK,CAACA,KAAK,CAACgC,MAAN,GAAe,CAAf,CAAD,CAAzB,GAA+ChC,KAAK,CAAC+C,SAAN,KAAoB,CAApB,IAAyByF,KAAK,KAAK,IAAV,IAAmBza,QAAQ,KAAK,KAAb,IAAsBA,QAAQ,IAAI,QAA9E,CAA3D;AACA,UAAIyb,IAAI,GAAGf,UAAU,CAACD,KAAD,CAAV,GAAoBxI,KAAK,CAACA,KAAK,CAACgC,MAAN,GAAehC,KAAK,CAACgC,MAAN,GAAe3d,MAAf,GAAwB,CAAvC,CAAD,CAAzB,GAAuE2b,KAAK,CAAC+C,SAAN,KAAoB,CAApB,IAAyByF,KAAK,KAAK,IAAV,IAAmBza,QAAQ,KAAK,KAAb,IAAsBA,QAAQ,IAAI,QAA9E,CAAlF;;AAEA,UAAIA,QAAQ,KAAK,MAAb,IAAuBA,QAAQ,KAAK,OAAxC,EAAiD;AAC/C0b,QAAAA,GAAG,GAAG7jB,gBAAgB,CAAC5C,IAAD,CAAtB;AACA0mB,QAAAA,GAAG,GAAG9jB,gBAAgB,CAAC5C,IAAD,CAAtB;AACA2mB,QAAAA,GAAG,GAAGJ,KAAN;AACAK,QAAAA,GAAG,GAAGJ,IAAN;AAEAK,QAAAA,GAAG,GAAG7jB,iBAAiB,CAAChD,IAAD,CAAvB;AACA8mB,QAAAA,GAAG,GAAG9jB,iBAAiB,CAAChD,IAAD,CAAvB;AACA+mB,QAAAA,GAAG,GAAGR,KAAN;AACAS,QAAAA,GAAG,GAAGR,IAAN;AACD;;AAED,UAAIzb,QAAQ,KAAK,QAAb,IAAyBA,QAAQ,KAAK,KAA1C,EAAiD;AAC/C0b,QAAAA,GAAG,GAAGF,KAAN;AACAG,QAAAA,GAAG,GAAGF,IAAN;AACAG,QAAAA,GAAG,GAAGtkB,kBAAkB,CAACrC,IAAD,CAAxB;AACA4mB,QAAAA,GAAG,GAAGvkB,kBAAkB,CAACrC,IAAD,CAAxB;AAEA6mB,QAAAA,GAAG,GAAGN,KAAN;AACAO,QAAAA,GAAG,GAAGN,IAAN;AACAO,QAAAA,GAAG,GAAGtkB,eAAe,CAACzC,IAAD,CAArB;AACAgnB,QAAAA,GAAG,GAAGvkB,eAAe,CAACzC,IAAD,CAArB;AACD;;AAED2jB,MAAAA,CAAC,CAACjgB,MAAF,CAAS,MAAT,EACGY,IADH,CACQ,IADR,EACcmiB,GADd,EAEGniB,IAFH,CAEQ,IAFR,EAEcoiB,GAFd,EAGGpiB,IAHH,CAGQ,IAHR,EAGcqiB,GAHd,EAIGriB,IAJH,CAIQ,IAJR,EAIcsiB,GAJd,EAKGtiB,IALH,CAKQ,kBALR,EAK4B,KAL5B;AAOAqf,MAAAA,CAAC,CAACjgB,MAAF,CAAS,MAAT,EACGY,IADH,CACQ,IADR,EACcuiB,GADd,EAEGviB,IAFH,CAEQ,IAFR,EAEcwiB,GAFd,EAGGxiB,IAHH,CAGQ,IAHR,EAGcyiB,GAHd,EAIGziB,IAJH,CAIQ,IAJR,EAIc0iB,GAJd,EAKG1iB,IALH,CAKQ,kBALR,EAK4B,KAL5B;AAMD,KAhED;AAiED;;AAED,WAAS2hB,YAAT,CAAuBphB,MAAvB,EAA+BC,eAA/B,EAAgD;AAC9C,QAAIA,eAAJ,EAAqB;AACnBD,MAAAA,MAAM,CAACP,IAAP,CAAY,WAAZ,EAAyB,YAAY;AACnC,YAAIpB,IAAI,GAAG1E,EAAE,CAACqF,MAAH,CAAU,IAAV,CAAX;AACA,eAAO,YAAYiB,eAAZ,GAA8B,GAA9B,GAAoC5B,IAAI,CAACoB,IAAL,CAAU,GAAV,CAApC,GAAqD,GAArD,GAA2DpB,IAAI,CAACoB,IAAL,CAAU,GAAV,CAA3D,GAA4E,GAAnF;AACD,OAHD;AAKD;AACF;;AAED,WAAS2iB,QAAT,CAAmBjnB,IAAnB,EAAyBsiB,QAAzB,EAAmC;AACjC,QAAIhf,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,QAAIsC,EAAE,GAAG+b,QAAQ,CAAC1E,SAAlB;AACA,QAAI7S,QAAQ,GAAGuX,QAAQ,CAACvX,QAAxB;AACA,QAAIiS,KAAK,GAAGhd,IAAI,CAACkS,MAAL,CAAY3L,EAAE,CAACyX,WAAH,EAAZ,CAAZ;AACA,QAAIwE,EAAJ,EAAQC,EAAR,EAAYE,EAAZ,EAAgBC,EAAhB;;AACA,QAAI7X,QAAQ,KAAK,MAAb,IAAuBA,QAAQ,KAAK,OAAxC,EAAiD;AAC/CyX,MAAAA,EAAE,GAAG5f,gBAAgB,CAAC5C,IAAD,CAArB;AACAyiB,MAAAA,EAAE,GAAGzf,iBAAiB,CAAChD,IAAD,CAAtB;AACA2iB,MAAAA,EAAE,GAAG3F,KAAK,CAAC,CAAD,CAAL,GAAW,CAAhB;AACA4F,MAAAA,EAAE,GAAG5F,KAAK,CAAC,CAAD,CAAL,GAAW,CAAhB;AACD;;AACD,QAAIjS,QAAQ,KAAK,QAAb,IAAyBA,QAAQ,KAAK,KAA1C,EAAiD;AAC/C4X,MAAAA,EAAE,GAAGlgB,eAAe,CAACzC,IAAD,CAApB;AACA4iB,MAAAA,EAAE,GAAGvgB,kBAAkB,CAACrC,IAAD,CAAvB;AACAwiB,MAAAA,EAAE,GAAGxF,KAAK,CAAC,CAAD,CAAL,GAAW,CAAhB;AACAyF,MAAAA,EAAE,GAAGzF,KAAK,CAAC,CAAD,CAAL,GAAW,CAAhB;AACD;;AAED1Z,IAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,IADR,EACcke,EADd,EAEGle,IAFH,CAEQ,IAFR,EAEcme,EAFd,EAGGne,IAHH,CAGQ,IAHR,EAGcqe,EAHd,EAIGre,IAJH,CAIQ,IAJR,EAIcse,EAJd,EAKGte,IALH,CAKQ,QALR,EAKkB,OALlB;AAMD;;AAED,MAAI4iB,UAAU,GAAG,EAAjB;;AAEAA,EAAAA,UAAU,CAACC,WAAX,GAAyB,UAAUnnB,IAAV,EAAgBsiB,QAAhB,EAA0B;AACjD,QAAI/b,EAAE,GAAG+b,QAAQ,CAAC1E,SAAlB;AAEA+H,IAAAA,iBAAiB,CAAC3lB,IAAD,EAAOsiB,QAAP,CAAjB;AACA4D,IAAAA,iBAAiB,CAAClmB,IAAD,EAAOsiB,QAAP,CAAjB;AACD,GALD;;AAOA4E,EAAAA,UAAU,CAACE,SAAX,GAAuB,UAAUpnB,IAAV,EAAgBsiB,QAAhB,EAA0B;AAC/C,QAAI1E,SAAS,GAAG0E,QAAQ,CAAC1E,SAAzB;AACA,QAAIyJ,QAAQ,GAAGzJ,SAAS,GAAG,OAA3B;AACA,QAAI0J,SAAS,GAAG,QAAQ1J,SAAR,GAAoB,OAApC;AACA,QAAIta,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AAEAZ,IAAAA,uBAAuB,CAACC,GAAD,EAAM,MAAMgkB,SAAZ,CAAvB;;AAEA,QAAI,CAACtnB,IAAI,CAACqnB,QAAD,CAAT,EAAqB;AACnB,aAAO,IAAP;AACD;;AAED,QAAI1D,CAAC,GAAGlgB,QAAQ,CAACH,GAAD,EAAMgkB,SAAN,CAAhB;AAEA7F,IAAAA,iBAAiB,CAACzhB,IAAD,EAAO4d,SAAP,CAAjB;AACAuH,IAAAA,iBAAiB,CAACxB,CAAD,EAAI3jB,IAAJ,EAAUsiB,QAAV,CAAjB;AACAyC,IAAAA,YAAY,CAACpB,CAAD,EAAI3jB,IAAJ,EAAUsiB,QAAV,CAAZ;AACAsC,IAAAA,kBAAkB,CAACjB,CAAD,EAAI3jB,IAAJ,EAAUsiB,QAAV,CAAlB,CAjB+C,CAmB/C;;AACA,QAAItiB,IAAI,CAAC4d,SAAS,GAAG,QAAb,CAAR,EAAgC;AAC9B0E,MAAAA,QAAQ,CAACiF,KAAT,CAAejkB,GAAG,CAACO,MAAJ,CAAW,SAAS+Z,SAAT,GAAqB,OAAhC,CAAf,EAAyD5d,IAAzD;AACD,KAtB8C,CAwB/C;;;AACA,QAAIA,IAAI,CAAC4d,SAAS,GAAG,MAAb,CAAR,EAA8B;AAC5BxZ,MAAAA,GAAG,CAACpE,IAAD,EAAOsiB,QAAP,CAAH;AACD;;AAED,QAAItiB,IAAI,CAACwnB,aAAT,EAAwB;AACtBC,MAAAA,oBAAoB,CAACznB,IAAD,CAApB;AACD;;AAED,WAAO,IAAP;AACD,GAlCD;;AAoCA,WAAS0nB,WAAT,CAAsB1nB,IAAtB,EAA4B;AAC1B,QAAIsiB,QAAQ,GAAG,EAAf;AACAA,IAAAA,QAAQ,CAAClP,IAAT,GAAgB,WAAhB;;AAEA,SAAKwK,SAAL,GAAiB,UAAUrX,EAAV,EAAc;AAC7B;AACA+b,MAAAA,QAAQ,CAAC1E,SAAT,GAAqBrX,EAArB;AACA,aAAO,IAAP;AACD,KAJD;;AAMA,SAAKnC,GAAL,GAAW,UAAUga,EAAV,EAAc;AACvBkE,MAAAA,QAAQ,CAACle,GAAT,GAAega,EAAf;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,SAAKmJ,KAAL,GAAa,UAAUnJ,EAAV,EAAc;AACzBkE,MAAAA,QAAQ,CAACiF,KAAT,GAAiBnJ,EAAjB;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,SAAKhL,IAAL,GAAY,UAAUuU,CAAV,EAAa;AACvBrF,MAAAA,QAAQ,CAAClP,IAAT,GAAgBuU,CAAhB;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,SAAK5c,QAAL,GAAgB,UAAU2M,GAAV,EAAe;AAC7B4K,MAAAA,QAAQ,CAACvX,QAAT,GAAoB2M,GAApB;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,SAAKuP,QAAL,GAAgB,UAAU7I,EAAV,EAAc;AAC5BkE,MAAAA,QAAQ,CAAC2E,QAAT,GAAoB7I,EAApB;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,SAAKwJ,IAAL,GAAY,YAAY;AACtBV,MAAAA,UAAU,CAAC5E,QAAQ,CAAClP,IAAV,CAAV,CAA0BpT,IAA1B,EAAgCsiB,QAAhC;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,WAAO,IAAP;AAED;;AAED/jB,EAAAA,EAAE,CAACspB,YAAH,GAAkBH,WAAlB;AAEA;;AACA;;AACA;;AAEA,WAAS5W,KAAT,CAAgB9Q,IAAhB,EAAsB;AACpB;;AAEA,QAAI,CAACA,IAAI,CAAC8Q,KAAV,EAAiB;AACf;AACD;;AAED9Q,IAAAA,IAAI,CAAC0iB,eAAL,GAAuB1iB,IAAI,CAACyR,UAAL,KAAoB,OAApB,GACnBzR,IAAI,CAACsC,MAAL,GAAc,CADK,GAEnBtC,IAAI,CAACsC,MAAL,GAAc,CAAd,GAAkB,CAFtB;AAIA,QAAI8B,GAAG,GAAGN,WAAW,CAAC9D,IAAD,EAAO,UAAP,CAArB;AAEAoE,IAAAA,GAAG,CAACE,IAAJ,CAAS,IAAT,EAAetE,IAAI,CAAC2C,IAAL,GAAY,CAA3B,EACG2B,IADH,CACQ,IADR,EACctE,IAAI,CAAC2C,IAAL,GAAY3C,IAAI,CAAC0iB,eAD/B,EAEGpe,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAAC0E,QAAL,CAAcojB,EAF5B,EAGGxjB,IAHH,CAGQ,IAHR,EAGctE,IAAI,CAAC0E,QAAL,CAAcojB,EAH5B;AAKAvjB,IAAAA,4BAA4B,CAACH,GAAD,EAAMpE,IAAN,EAAY,eAAZ,CAA5B;AACD;;AAEDzB,EAAAA,EAAE,CAACuS,KAAH,GAAWA,KAAX;;AAEA,WAASiX,4BAAT,CAAuC/nB,IAAvC,EAA6CgoB,EAA7C,EAAiD;AAC/C,QAAIhoB,IAAI,CAACyR,UAAL,KAAoB,KAAxB,EAA+B;AAC7BuW,MAAAA,EAAE,CAACC,GAAH,GAAS,CAAT;AACAD,MAAAA,EAAE,CAACnG,GAAH,GAASrjB,EAAE,CAACqjB,GAAH,CAAO7hB,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAP,EAAqB,UAAUM,CAAV,EAAa;AACzC,YAAI8oB,IAAI,GAAG,EAAX;AACAA,QAAAA,IAAI,CAAC5d,IAAL,CAAUlL,CAAC,CAACY,IAAI,CAACU,UAAN,CAAX;;AAEA,YAAIV,IAAI,CAACmoB,iBAAL,KAA2B,IAA/B,EAAqC;AACnCD,UAAAA,IAAI,CAAC5d,IAAL,CAAUlL,CAAC,CAACY,IAAI,CAACmoB,iBAAN,CAAX;AACD;;AAED,YAAInoB,IAAI,CAACooB,kBAAL,KAA4B,IAAhC,EAAsC;AACpCF,UAAAA,IAAI,CAAC5d,IAAL,CAAUlL,CAAC,CAACY,IAAI,CAACooB,kBAAN,CAAX;AACD;;AAED,eAAOjP,IAAI,CAAC0I,GAAL,CAASjb,KAAT,CAAe,IAAf,EAAqBshB,IAArB,CAAP;AACD,OAbQ,CAAT;AAcD;;AACD,WAAOF,EAAP;AACD;;AAED,WAAS3E,qBAAT,CAAgCrjB,IAAhC,EAAsC;AACpC,QAAIqoB,UAAU,GAAGroB,IAAI,CAACqoB,UAAtB;;AACA,QAAI,CAACA,UAAL,EAAiB;AACf,UAAIroB,IAAI,CAAC2R,MAAL,KAAgB,OAApB,EAA6B;AAC3B;AACA,YAAI3R,IAAI,CAACE,SAAL,CAAeU,KAAf,GAAuB,MAA3B,EAAmC;AACjCZ,UAAAA,IAAI,CAAC0R,QAAL,GAAgB,CAAhB;AACD,SAFD,MAEO,IAAI1R,IAAI,CAACE,SAAL,CAAeU,KAAf,GAAuB,GAA3B,EAAgC;AACrCZ,UAAAA,IAAI,CAAC0R,QAAL,GAAgB,CAAhB;AACD;;AAED2W,QAAAA,UAAU,GAAG,UAAUjpB,CAAV,EAAa;AACxB,cAAIkpB,EAAJ;;AAEA,cAAIlpB,CAAC,GAAG,GAAJ,IAAWA,CAAC,GAAG,CAAC,GAAhB,IAAuBA,CAAC,KAAK,CAAjC,EAAoC;AAClC;AACAkpB,YAAAA,EAAE,GAAG9pB,EAAE,CAACmT,MAAH,CAAU,OAAO3R,IAAI,CAAC0R,QAAZ,GAAuB,GAAjC,CAAL;AACD,WAHD,MAGO,IAAItS,CAAC,GAAG,IAAR,EAAc;AACnBkpB,YAAAA,EAAE,GAAG9pB,EAAE,CAACmT,MAAH,CAAU,MAAV,CAAL;AACD,WAFM,MAEA;AACL2W,YAAAA,EAAE,GAAG9pB,EAAE,CAACmT,MAAH,CAAU,MAAV,CAAL;AACD,WAVuB,CAYxB;;;AACA,cAAI3R,IAAI,CAAC4Q,gBAAT,EAA2B;AACzB,mBAAO0X,EAAE,CAAClpB,CAAD,CAAF,GAAQY,IAAI,CAAC2Q,SAApB;AACD,WAFD,MAEO;AACL,mBAAO3Q,IAAI,CAAC2Q,SAAL,GAAiB2X,EAAE,CAAClpB,CAAD,CAA1B;AACD;AACF,SAlBD;AAmBD,OA3BD,MA2BO;AAAE;AACPipB,QAAAA,UAAU,GAAG,UAAUE,EAAV,EAAc;AACzB,cAAIxgB,CAAC,GAAGvJ,EAAE,CAACmT,MAAH,CAAU,KAAV,CAAR;AACA,iBAAO5J,CAAC,CAACwgB,EAAD,CAAR;AACD,SAHD;AAID;AACF;;AACD,WAAOF,UAAP;AACD;;AAED,WAASZ,oBAAT,CAA+BznB,IAA/B,EAAqC;AACnC,QAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,QAAIwc,OAAO,GAAGzgB,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAActF,MAAd,EAAd;;AACA,QAAI,KAAKyB,OAAO,CAAC,CAAD,CAAZ,IAAmBA,OAAO,CAAC,CAAD,CAAP,IAAc,CAArC,EAAwC;AACtC,UAAI+H,CAAC,GAAGxoB,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcjJ,KAAd,EAAR;AACA,UAAImE,CAAC,GAAG3jB,IAAI,CAAC0oB,kBAAL,CAAwBrnB,MAAxB,GACJrB,IAAI,CAACkS,MAAL,CAAYyW,MAAZ,CAAmB3oB,IAAI,CAAC0oB,kBAAL,CAAwB1oB,IAAI,CAAC0oB,kBAAL,CAAwBrnB,MAAxB,GAAiC,CAAzD,CAAnB,CADI,GAEJrB,IAAI,CAACkS,MAAL,CAAYyW,MAAZ,EAFJ;AAIArlB,MAAAA,GAAG,CAACI,MAAJ,CAAW,UAAX,EACGY,IADH,CACQ,IADR,EACctE,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAc,CAAd,CADd,EAEGhgB,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAc,CAAd,CAFd,EAGGhgB,IAHH,CAGQ,IAHR,EAGckkB,CAAC,CAAC,CAAD,CAAD,GAAO/lB,eAAe,CAACzC,IAAD,CAHpC,EAIGsE,IAJH,CAIQ,IAJR,EAIckkB,CAAC,CAACA,CAAC,CAACnnB,MAAF,GAAW,CAAZ,CAAD,GAAkBsiB,CAJhC,EAKGrf,IALH,CAKQ,QALR,EAKkB,OALlB,EAMGA,IANH,CAMQ,SANR,EAMmB,EANnB;AAOD;AACF;;AAED,WAASskB,aAAT,CAAwB5oB,IAAxB,EAA8B;AAC5B;AACA;AACA,QAAIlB,IAAI,GAAGqF,gBAAgB,CAACnE,IAAI,CAAClB,IAAN,CAA3B;;AAEA,QAAIkB,IAAI,CAACgP,YAAL,KAAsB,KAA1B,EAAiC;AAC/BlQ,MAAAA,IAAI,GAAGA,IAAI,CAACqK,MAAL,CAAY,UAAU/J,CAAV,EAAa;AAC9B,eAAOA,CAAC,CAACY,IAAI,CAACU,UAAN,CAAD,GAAqB,CAA5B;AACD,OAFM,CAAP;AAGD;;AAED,QAAIV,IAAI,CAACgS,SAAT,EAAoB;AAClBlT,MAAAA,IAAI,GAAGA,IAAI,CAAC6H,MAAL,CAAY3G,IAAI,CAACgS,SAAjB,CAAP;AACD;;AAED,QAAIyO,OAAO,GAAGjiB,EAAE,CAACkiB,MAAH,CAAU5hB,IAAV,EAAgB,UAAUM,CAAV,EAAa;AACzC,aAAOA,CAAC,CAACY,IAAI,CAACU,UAAN,CAAR;AACD,KAFa,CAAd;AAIA,QAAIsnB,EAAE,GAAG,EAAT;AACAA,IAAAA,EAAE,CAACC,GAAH,GAASxH,OAAO,CAAC,CAAD,CAAhB;AACAuH,IAAAA,EAAE,CAACnG,GAAH,GAASpB,OAAO,CAAC,CAAD,CAAhB,CArB4B,CAsB5B;AACA;;AACA,QAAIuH,EAAE,CAACC,GAAH,IAAU,CAAV,IAAe,CAACjoB,IAAI,CAACW,KAArB,IAA8B,CAACX,IAAI,CAACiP,eAAxC,EAAyD;AACvD+Y,MAAAA,EAAE,CAACC,GAAH,GAAS,CAAT;AACD;;AAEDF,IAAAA,4BAA4B,CAAC/nB,IAAD,EAAOgoB,EAAP,CAA5B;AACAA,IAAAA,EAAE,CAACC,GAAH,GAAUjoB,IAAI,CAACW,KAAL,KAAe,IAAhB,GAAwBX,IAAI,CAACW,KAA7B,GAAqCqnB,EAAE,CAACC,GAAjD;AAEAD,IAAAA,EAAE,CAACnG,GAAH,GAAU7hB,IAAI,CAACY,KAAL,KAAe,IAAhB,GAAwBZ,IAAI,CAACY,KAA7B,GAAsConB,EAAE,CAACnG,GAAH,GAAS,CAAV,GAAemG,EAAE,CAACnG,GAAH,IAAUmG,EAAE,CAACnG,GAAH,GAASmG,EAAE,CAACnG,GAAH,GAAS7hB,IAAI,CAAC4R,QAAjC,CAAf,GAA4DoW,EAAE,CAACnG,GAAH,GAAS7hB,IAAI,CAAC4R,QAAxH;;AAEA,QAAI5R,IAAI,CAACgP,YAAL,KAAsB,KAAtB,IAA+BgZ,EAAE,CAACC,GAAH,GAAS,CAA5C,EAA+C;AAC7CD,MAAAA,EAAE,CAACC,GAAH,GAASD,EAAE,CAACC,GAAH,IAAUD,EAAE,CAACC,GAAH,GAASD,EAAE,CAACC,GAAH,GAASjoB,IAAI,CAAC4R,QAAjC,CAAT;AACD;;AAED,QAAI,CAAC5R,IAAI,CAACW,KAAN,IAAeX,IAAI,CAACiP,eAAxB,EAAyC;AACvC,UAAI4Z,IAAI,GAAG,CAACb,EAAE,CAACnG,GAAH,GAASmG,EAAE,CAACC,GAAb,IAAoB,GAA/B;AACAD,MAAAA,EAAE,CAACC,GAAH,GAASxH,OAAO,CAAC,CAAD,CAAP,GAAaoI,IAAtB;AACAb,MAAAA,EAAE,CAACnG,GAAH,GAASpB,OAAO,CAAC,CAAD,CAAP,GAAaoI,IAAtB;AACD;;AACD7oB,IAAAA,IAAI,CAACE,SAAL,CAAeS,KAAf,GAAuBqnB,EAAE,CAACC,GAA1B;AACAjoB,IAAAA,IAAI,CAACE,SAAL,CAAeU,KAAf,GAAuBonB,EAAE,CAACnG,GAA1B;AACD;;AAED,WAASiH,iBAAT,CAA4B9oB,IAA5B,EAAkCgd,KAAlC,EAAyC;AACvCA,IAAAA,KAAK,CAACgC,MAAN,CAAa,CAAChf,IAAI,CAACE,SAAL,CAAeS,KAAhB,EAAuBX,IAAI,CAACE,SAAL,CAAeU,KAAtC,CAAb,EACG4e,KADH,CACS,CAACnd,kBAAkB,CAACrC,IAAD,CAAnB,EAA2BA,IAAI,CAACwC,GAAhC,CADT;AAEA,WAAOwa,KAAP;AACD;;AAED,WAAS+L,kBAAT,CAA6B/oB,IAA7B,EAAmC;AACjC,QAAIgd,KAAK,GAAGhd,IAAI,CAACgP,YAAL,KAAsB,KAAtB,GAA8BxQ,EAAE,CAACsgB,QAAH,EAA9B,GAA8CtgB,EAAE,CAACugB,WAAH,EAA1D;;AACA,QAAI/e,IAAI,CAACgP,YAAL,KAAsB,KAA1B,EAAiC;AAC/B,UAAIhP,IAAI,CAACyR,UAAL,KAAoB,WAAxB,EAAqC;AACnC;AACA;AACAzR,QAAAA,IAAI,CAACE,SAAL,CAAeS,KAAf,GAAuB,GAAvB;AACD,OAJD,MAIO;AACL,YAAIX,IAAI,CAACE,SAAL,CAAeS,KAAf,IAAwB,CAA5B,EAA+B;AAC7BX,UAAAA,IAAI,CAACE,SAAL,CAAeS,KAAf,GAAuB,CAAvB;AACD;AACF;AACF;;AACDX,IAAAA,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,GAAgBK,iBAAiB,CAAC9oB,IAAD,EAAOgd,KAAP,CAAjC;AACAhd,IAAAA,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrI,KAAd,CAAoBpgB,IAAI,CAACgP,YAAL,KAAsB,KAA1C,EAdiC,CAgBjC;;AACAhP,IAAAA,IAAI,CAACkS,MAAL,CAAY8W,MAAZ,GAAqBF,iBAAiB,CAAC9oB,IAAD,EAAOxB,EAAE,CAACugB,WAAH,EAAP,CAAtC;AACD;;AAED,WAASkK,cAAT,CAAyBtF,CAAzB,EAA4B3jB,IAA5B,EAAkC;AAChC,QAAIA,IAAI,CAAC0Q,OAAT,EAAkB;AAChBiT,MAAAA,CAAC,CAACjgB,MAAF,CAAS,MAAT,EACGY,IADH,CACQ,OADR,EACiB,OADjB,EAEGA,IAFH,CAEQ,GAFR,EAEa,YAAY;AACrB,eAAO,CAAC,CAAD,IAAM7B,eAAe,CAACzC,IAAD,CAAf,GACb,CAAEqC,kBAAkB,CAACrC,IAAD,CAAnB,GAA8ByC,eAAe,CAACzC,IAAD,CAA9C,IAAyD,CADlD,CAAP;AAED,OALH,EAMGsE,IANH,CAMQ,GANR,EAMa,YAAY;AACrB,eAAOtE,IAAI,CAAC2C,IAAL,GAAY,CAAnB;AACD,OARH,EASG2B,IATH,CASQ,IATR,EASc,OATd,EAUGA,IAVH,CAUQ,aAVR,EAUuB,QAVvB,EAWGuB,IAXH,CAWQ,UAAUzG,CAAV,EAAa;AACjB,eAAOY,IAAI,CAAC0Q,OAAZ;AACD,OAbH,EAcGpM,IAdH,CAcQ,WAdR,EAcqB,UAAUlF,CAAV,EAAa;AAC9B,eAAO,aAAP;AACD,OAhBH;AAiBD;AACF;;AAED,WAAS8pB,iBAAT,CAA4BvF,CAA5B,EAA+B3jB,IAA/B,EAAqC;AACnC,QAAI8iB,WAAW,GAAG9iB,IAAI,CAACE,SAAL,CAAeipB,OAAf,CAAuB9nB,MAAzC;;AACA,QAAI,CAACrB,IAAI,CAAC8O,gBAAN,IAA0B,CAAC9O,IAAI,CAAC+O,gBAAhC,IAAoD+T,WAAxD,EAAqE;AACnE,UAAIsG,OAAJ,EAAaC,OAAb;;AAEA,UAAIrpB,IAAI,CAAC2O,gBAAL,IAAyB3O,IAAI,CAACyR,UAAL,KAAoB,KAAjD,EAAwD;AACtD2X,QAAAA,OAAO,GAAGppB,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACoC,MAA7B;AACAinB,QAAAA,OAAO,GAAGrpB,IAAI,CAACwC,GAAf;AACD,OAHD,MAGO,IAAIsgB,WAAJ,EAAiB;AACtBsG,QAAAA,OAAO,GAAGppB,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAczoB,IAAI,CAACE,SAAL,CAAeipB,OAAf,CAAuB,CAAvB,CAAd,EAAyCpG,OAAzC,CAAiD,CAAjD,CAAV;AACAsG,QAAAA,OAAO,GAAGrpB,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAczoB,IAAI,CAACE,SAAL,CAAeipB,OAAf,CAAuBrG,WAAW,GAAG,CAArC,CAAd,EAAuDC,OAAvD,CAA+D,CAA/D,CAAV;AACD,OAHM,MAGA;AACLqG,QAAAA,OAAO,GAAG,CAAV;AACAC,QAAAA,OAAO,GAAG,CAAV;AACD;;AAED1F,MAAAA,CAAC,CAACjgB,MAAF,CAAS,MAAT,EACGY,IADH,CACQ,IADR,EACctE,IAAI,CAAC2C,IADnB,EAEG2B,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAAC2C,IAFnB,EAGG2B,IAHH,CAGQ,IAHR,EAGc8kB,OAHd,EAIG9kB,IAJH,CAIQ,IAJR,EAIc+kB,OAJd;AAKD;AACF;;AAED,WAASC,wBAAT,CAAmC3F,CAAnC,EAAsC3jB,IAAtC,EAA4C;AAC1C2jB,IAAAA,CAAC,CAACngB,SAAF,CAAY,eAAZ,EACG1E,IADH,CACQkB,IAAI,CAACE,SAAL,CAAeipB,OADvB,EACgC9kB,KADhC,GAEGX,MAFH,CAEU,MAFV,EAGGC,OAHH,CAGW,uBAHX,EAGoC3D,IAAI,CAAC+O,gBAHzC,EAIGzK,IAJH,CAIQ,IAJR,EAIctE,IAAI,CAAC2C,IAJnB,EAKG2B,IALH,CAKQ,IALR,EAKc,YAAY;AACtB,aAAQtE,IAAI,CAAC+O,gBAAN,GAA0B/O,IAAI,CAAC8C,KAAL,GAAa9C,IAAI,CAAC+C,KAA5C,GAAoD/C,IAAI,CAAC2C,IAAL,GAAY3C,IAAI,CAAC6O,eAA5E;AACD,KAPH,EAQGvK,IARH,CAQQ,IARR,EAQc,UAAUlF,CAAV,EAAa;AACvB,aAAOY,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrpB,CAAd,EAAiB2jB,OAAjB,CAAyB,CAAzB,CAAP;AACD,KAVH,EAWGze,IAXH,CAWQ,IAXR,EAWc,UAAUlF,CAAV,EAAa;AACvB,aAAOY,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrpB,CAAd,EAAiB2jB,OAAjB,CAAyB,CAAzB,CAAP;AACD,KAbH;AAcD;;AAED,WAASwG,yBAAT,CAAoC5F,CAApC,EAAuC3jB,IAAvC,EAA6C;AAC3C,QAAIqoB,UAAU,GAAGhF,qBAAqB,CAACrjB,IAAD,CAAtC;AACA2jB,IAAAA,CAAC,CAACngB,SAAF,CAAY,gBAAZ,EACG1E,IADH,CACQkB,IAAI,CAACE,SAAL,CAAeipB,OADvB,EACgC9kB,KADhC,GAEGX,MAFH,CAEU,MAFV,EAGGY,IAHH,CAGQ,GAHR,EAGatE,IAAI,CAAC2C,IAAL,GAAY3C,IAAI,CAAC6O,eAAL,GAAuB,CAAvB,GAA2B,CAHpD,EAIGvK,IAJH,CAIQ,IAJR,EAIc,CAAC,CAJf,EAKGA,IALH,CAKQ,GALR,EAKa,UAAUlF,CAAV,EAAa;AACtB,aAAOY,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrpB,CAAd,EAAiB2jB,OAAjB,CAAyB,CAAzB,CAAP;AACD,KAPH,EAQGze,IARH,CAQQ,IARR,EAQc,OARd,EASGA,IATH,CASQ,aATR,EASuB,KATvB,EAUGuB,IAVH,CAUQ,UAAUzG,CAAV,EAAa;AACjB,UAAI4b,CAAC,GAAGqN,UAAU,CAACjpB,CAAD,CAAlB;AACA,aAAO4b,CAAP;AACD,KAbH;AAcD,GArzFoB,CAuzFrB;;;AACA,WAASzL,MAAT,CAAiBvP,IAAjB,EAAuB;AACrB,QAAI,CAACA,IAAI,CAACE,SAAV,EAAqB;AACnBF,MAAAA,IAAI,CAACE,SAAL,GAAiB,EAAjB;AACD;;AAED,QAAIoD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA1F,IAAAA,EAAE,CAACqO,SAAH,CAAa,wBAAb,EAAuC5M,IAAvC,EAA6CA,IAAI,CAACE,SAAL,CAAeS,KAA5D,EAAmEX,IAAI,CAACE,SAAL,CAAeU,KAAlF;AACAyC,IAAAA,uBAAuB,CAACC,GAAD,EAAM,YAAN,CAAvB;;AAEA,QAAI,CAACtD,IAAI,CAACuP,MAAV,EAAkB;AAChB,aAAO,IAAP;AACD;;AAED,QAAIoU,CAAC,GAAGlgB,QAAQ,CAACH,GAAD,EAAM,WAAN,CAAhB;AACA2lB,IAAAA,cAAc,CAACtF,CAAD,EAAI3jB,IAAJ,CAAd;AACAwpB,IAAAA,sBAAsB,CAACxpB,IAAD,EAAO,GAAP,CAAtB;AACAkpB,IAAAA,iBAAiB,CAACvF,CAAD,EAAI3jB,IAAJ,CAAjB;AACAspB,IAAAA,wBAAwB,CAAC3F,CAAD,EAAI3jB,IAAJ,CAAxB;AACAupB,IAAAA,yBAAyB,CAAC5F,CAAD,EAAI3jB,IAAJ,CAAzB;;AAEA,QAAIA,IAAI,CAAC8Q,KAAT,EAAgB;AACdA,MAAAA,KAAK,CAAC9Q,IAAD,CAAL;AACD;;AAED,WAAO,IAAP;AACD;;AAEDzB,EAAAA,EAAE,CAACgR,MAAH,GAAYA,MAAZ;;AAEA,WAASka,yBAAT,CAAoCzpB,IAApC,EAA0C;AACxC,QAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACAZ,IAAAA,uBAAuB,CAACC,GAAD,EAAM,YAAN,CAAvB;AACA,QAAIqgB,CAAC,GAAGlgB,QAAQ,CAACH,GAAD,EAAM,WAAN,CAAhB;AACA,QAAIwiB,OAAJ;AAAY,KAAC9lB,IAAI,CAAC0oB,kBAAL,CAAwBrnB,MAAxB,GAAiCrB,IAAI,CAAC0oB,kBAAtC,GAA2D,CAAC,GAAD,CAA5D,EAAmEjgB,OAAnE,CAA2E,UAAU+c,KAAV,EAAiB;AACtGM,MAAAA,OAAO,GAAGriB,QAAQ,CAACkgB,CAAD,EAAI,cAAc3c,YAAY,CAACwe,KAAD,CAA9B,CAAlB;;AAEA,UAAIxlB,IAAI,CAAC4P,eAAL,KAAyB,IAA7B,EAAmC;AACjC8Z,QAAAA,kBAAkB,CAAC5D,OAAD,EAAUN,KAAV,EAAiBxlB,IAAjB,CAAlB;AACD,OAFD,MAEO;AACL,YAAI6E,MAAM,GAAG8kB,qBAAqB,CAAC7D,OAAD,EAAUN,KAAV,EAAiBxlB,IAAjB,CAAlC;AACA4E,QAAAA,gBAAgB,CAACC,MAAD,EAAS7E,IAAI,CAACyQ,eAAd,CAAhB;AACD;AACF,KATW;AAUb;;AAED,WAASkZ,qBAAT,CAAgChG,CAAhC,EAAmC6B,KAAnC,EAA0CxlB,IAA1C,EAAgD;AAC9C,WAAO2jB,CAAC,CAACngB,SAAF,CAAY,MAAZ,EAAoB1E,IAApB,CAAyBkB,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAczJ,MAAd,EAAzB,EAAiD3a,KAAjD,GAAyDX,MAAzD,CAAgE,UAAhE,EACJY,IADI,CACC,GADD,EACMtE,IAAI,CAAC2C,IAAL,GAAY3C,IAAI,CAACsC,MADvB,EAEJgC,IAFI,CAEC,GAFD,EAEM,UAAUlF,CAAV,EAAa;AACtB,aAAOY,IAAI,CAACkS,MAAL,CAAYyW,MAAZ,CAAmBnD,KAAnB,IAA4BxlB,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrpB,CAAd,CAA5B,GAA+CY,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAc1I,SAAd,KAA4B,CAAlF;AACD,KAJI,EAKJzb,IALI,CAKC,IALD,EAKO,OALP,EAMJA,IANI,CAMC,aAND,EAMgB,KANhB,EAOJuB,IAPI,CAOCmgB,MAPD,CAAP;AAQD;;AAED,WAAS0D,kBAAT,CAA6B/F,CAA7B,EAAgC6B,KAAhC,EAAuCxlB,IAAvC,EAA6C;AAC3C2jB,IAAAA,CAAC,CAACjgB,MAAF,CAAS,UAAT,EACGC,OADH,CACW,wBADX,EACqC,IADrC,EAEGW,IAFH,CAEQ,GAFR,EAEatE,IAAI,CAAC2C,IAAL,GAAY3C,IAAI,CAACsC,MAF9B,EAGGgC,IAHH,CAGQ,GAHR,EAGatE,IAAI,CAACkS,MAAL,CAAYyW,MAAZ,CAAmBnD,KAAnB,IAA4BxlB,IAAI,CAACkS,MAAL,CAAYyW,MAAZ,CAAmB5I,SAAnB,KAAiC,CAH1E,EAIGzb,IAJH,CAIQ,IAJR,EAIc,OAJd,EAKGA,IALH,CAKQ,aALR,EAKuB,KALvB,EAMGuB,IANH,CAMQ2f,KANR;AAOD;;AAED,WAASoE,mBAAT,CAA8B5pB,IAA9B,EAAoC;AAClC,QAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,QAAI8hB,MAAM,GAAG/lB,IAAI,CAACkS,MAAL,CAAYyW,MAAZ,CAAmB3J,MAAnB,EAAb;AACA,QAAIuH,KAAK,GAAGR,MAAM,CAAC,CAAD,CAAlB;AACA,QAAIS,IAAI,GAAGT,MAAM,CAACA,MAAM,CAAC1kB,MAAP,GAAgB,CAAjB,CAAjB;AAEAiC,IAAAA,GAAG,CAACO,MAAJ,CAAW,qBAAX,EAAkCL,SAAlC,CAA4C,gBAA5C,EACG1E,IADH,CACQinB,MADR,EAEG1hB,KAFH,GAEWX,MAFX,CAEkB,MAFlB,EAGKY,IAHL,CAGU,IAHV,EAGgB1B,gBAAgB,CAAC5C,IAAD,CAHhC,EAIKsE,IAJL,CAIU,IAJV,EAIgB1B,gBAAgB,CAAC5C,IAAD,CAJhC,EAKKsE,IALL,CAKU,IALV,EAKgB,UAAUlF,CAAV,EAAa;AACvB,aAAOY,IAAI,CAACkS,MAAL,CAAYyW,MAAZ,CAAmBvpB,CAAnB,CAAP;AACD,KAPL,EAQKkF,IARL,CAQU,IARV,EAQgB,UAAUlF,CAAV,EAAa;AACvB,aAAOY,IAAI,CAACkS,MAAL,CAAYyW,MAAZ,CAAmBvpB,CAAnB,IAAwBY,IAAI,CAAC6pB,aAApC;AACD,KAVL,EAWKvlB,IAXL,CAWU,cAXV,EAW0B,CAX1B;AAYD;;AAED,WAASwlB,4BAAT,CAAuC9pB,IAAvC,EAA6C;AAC3C;AACA;AACA,QAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,QAAIoiB,cAAc,GAAG,EAArB;AACArmB,IAAAA,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAa2J,OAAb,CAAqB,UAAUrJ,CAAV,EAAa;AAChC,UAAIinB,cAAc,CAAC0D,OAAf,CAAuB3qB,CAAC,CAACY,IAAI,CAACU,UAAN,CAAxB,MAA+C,CAAC,CAApD,EAAuD;AACrD4C,QAAAA,GAAG,CAACO,MAAJ,CAAW,qBAAX,EAAkCH,MAAlC,CAAyC,MAAzC,EACGY,IADH,CACQ,IADR,EACc1B,gBAAgB,CAAC5C,IAAD,CAD9B,EAEGsE,IAFH,CAEQ,IAFR,EAEctB,iBAAiB,CAAChD,IAAD,CAF/B,EAGGsE,IAHH,CAGQ,IAHR,EAGctE,IAAI,CAAC0E,QAAL,CAAcojB,EAAd,CAAiB1oB,CAAjB,IAAsBY,IAAI,CAAC0E,QAAL,CAAcslB,OAAd,CAAsB5qB,CAAtB,CAHpC,EAIGkF,IAJH,CAIQ,IAJR,EAIctE,IAAI,CAAC0E,QAAL,CAAcojB,EAAd,CAAiB1oB,CAAjB,IAAsBY,IAAI,CAAC0E,QAAL,CAAcslB,OAAd,CAAsB5qB,CAAtB,CAJpC,EAKGkF,IALH,CAKQ,kBALR,EAK4B,KAL5B;AAMD;AACF,KATD;AAUD;;AAED,WAAS2lB,kBAAT,CAA6BjqB,IAA7B,EAAmC;AACjC,QAAI,CAACA,IAAI,CAACuP,MAAV,EAAkB;AAChB,aAAO,IAAP;AACD;;AAEDka,IAAAA,yBAAyB,CAACzpB,IAAD,CAAzB,CALiC,CAMjC;;AACA,QAAIA,IAAI,CAACwnB,aAAT,EAAwBC,oBAAoB,CAACznB,IAAD,CAApB;AACxB,QAAIA,IAAI,CAAC4P,eAAT,EAA0Bga,mBAAmB,CAAC5pB,IAAD,CAAnB;AAC1B,QAAIA,IAAI,CAACsQ,yBAAT,EAAoCwZ,4BAA4B,CAAC9pB,IAAD,CAA5B;AACpC,WAAO,IAAP;AACD;;AAEDzB,EAAAA,EAAE,CAAC0rB,kBAAH,GAAwBA,kBAAxB;;AAEA,WAASpZ,KAAT,CAAe7Q,IAAf,EAAqB;AACnB;;AAEA,QAAG,CAACA,IAAI,CAAC6Q,KAAT,EAAgB;AACd;AACD;;AAED7Q,IAAAA,IAAI,CAAC0iB,eAAL,GAAuB1iB,IAAI,CAACyR,UAAL,KAAoB,OAApB,GACnBzR,IAAI,CAACsC,MAAL,GAAc,CADK,GAEnBtC,IAAI,CAACsC,MAFT;AAIA,QAAI8B,GAAG,GAAGN,WAAW,CAAC9D,IAAD,EAAO,UAAP,CAArB;AAEAoE,IAAAA,GAAG,CAACE,IAAJ,CAAS,IAAT,EAAetE,IAAI,CAAC0E,QAAL,CAAcwlB,EAA7B,EACG5lB,IADH,CACQ,IADR,EACctE,IAAI,CAAC0E,QAAL,CAAcwlB,EAD5B,EAEG5lB,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACoC,MAAnB,GAA4BpC,IAAI,CAAC0iB,eAF/C,EAGGpe,IAHH,CAGQ,IAHR,EAGctE,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACoC,MAHjC;AAKAmC,IAAAA,4BAA4B,CAACH,GAAD,EAAMpE,IAAN,EAAY,eAAZ,CAA5B;AACD;;AAEDzB,EAAAA,EAAE,CAACsS,KAAH,GAAWA,KAAX;;AAEA,WAASsZ,uBAAT,CAAiCnqB,IAAjC,EAAuC;AACrC,QAAI,CAACA,IAAI,CAACE,SAAV,EAAqB;AACnBF,MAAAA,IAAI,CAACE,SAAL,GAAiB,EAAjB;AACD;AACF,GAz8FoB,CA28FrB;;;AACA,WAASoP,MAAT,CAAgBtP,IAAhB,EAAsB;AACpB;;AAEA,QAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACAkmB,IAAAA,uBAAuB,CAACnqB,IAAD,CAAvB;AAEAoqB,IAAAA,oBAAoB,CAACpqB,IAAD,CAApB;AACAqD,IAAAA,uBAAuB,CAACC,GAAD,EAAM,YAAN,CAAvB;;AAEA,QAAI,CAACtD,IAAI,CAACsP,MAAV,EAAkB;AAChB,aAAO,IAAP;AACD;;AAED,QAAIqU,CAAC,GAAGlgB,QAAQ,CAACH,GAAD,EAAM,WAAN,CAAhB;AAEA+mB,IAAAA,cAAc,CAAC1G,CAAD,EAAI3jB,IAAJ,CAAd;AACAsqB,IAAAA,oBAAoB,CAAC3G,CAAD,EAAI3jB,IAAJ,CAApB;;AACA,QAAIA,IAAI,CAACoP,OAAT,EAAkB;AAAEmb,MAAAA,cAAc,CAAC5G,CAAD,EAAI3jB,IAAJ,CAAd;AAA0B;;AAC9C,QAAIA,IAAI,CAAC6Q,KAAT,EAAgB;AAAEA,MAAAA,KAAK,CAAC7Q,IAAD,CAAL;AAAc;;AAEhC,WAAO,IAAP;AACD;;AAEDzB,EAAAA,EAAE,CAAC+Q,MAAH,GAAYA,MAAZ;;AAEA,WAASkb,kBAAT,CAA4BxqB,IAA5B,EAAkC;AAChC,QAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,QAAIwmB,iBAAiB,GAAG,CAAxB;;AACA,QAAIzqB,IAAI,CAACyR,UAAL,KAAoB,KAAxB,EAA+B;AAC7BgZ,MAAAA,iBAAiB,GAAGzqB,IAAI,CAACsC,MAAL,GAAc,CAAlC;AACD;;AAEDooB,IAAAA,wBAAwB,CAAC1qB,IAAD,EAAO,GAAP,EAAYA,IAAI,CAAC2qB,qBAAL,CAA2BllB,OAA3B,EAAZ,EAAkDzF,IAAI,CAAC2C,IAAvD,EAA6DK,iBAAiB,CAAChD,IAAD,CAAjB,GAA0ByqB,iBAAvF,CAAxB;AACA3N,IAAAA,qBAAqB,CAAC9c,IAAD,EAAO,IAAP,EAAa,GAAb,EAAkB,OAAlB,CAArB;AACAqD,IAAAA,uBAAuB,CAACC,GAAD,EAAM,YAAN,CAAvB;AAEA,QAAIqgB,CAAC,GAAGlgB,QAAQ,CAACH,GAAD,EAAM,WAAN,CAAhB;;AAEA,QAAI,CAACtD,IAAI,CAACsP,MAAV,EAAkB;AAChB,aAAO,IAAP;AACD;;AAEDsb,IAAAA,gCAAgC,CAACjH,CAAD,EAAI3jB,IAAJ,EAAUyqB,iBAAV,CAAhC;AACA,WAAO,IAAP;AACD;;AAED,WAASG,gCAAT,CAA0CjH,CAA1C,EAA6C3jB,IAA7C,EAAmDyqB,iBAAnD,EAAsE;AACpE,QAAI5lB,MAAM,GAAG8e,CAAC,CAACngB,SAAF,CAAY,MAAZ,EACV1E,IADU,CACLkB,IAAI,CAAC2qB,qBADA,EAEVtmB,KAFU,GAGVX,MAHU,CAGH,MAHG,CAAb;AAKAmB,IAAAA,MAAM,CACHP,IADH,CACQ,GADR,EACa,UAASlF,CAAT,EAAY;AACrB,aAAOY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAd,IAAmBY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcvE,SAAd,KAA4B,CAA/C,GAAoD/f,IAAI,CAACsC,MAAN,GAAgBtC,IAAI,CAAC6qB,4BAAxE,GAAwGJ,iBAAiB,GAAG,CAAnI;AACD,KAHH,EAIGnmB,IAJH,CAIQ,GAJR,EAIajC,kBAAkB,CAACrC,IAAD,CAJ/B,EAKGsE,IALH,CAKQ,IALR,EAKc,OALd,EAMGA,IANH,CAMQ,aANR,EAMuB,QANvB,EAOGuB,IAPH,CAOQmgB,MAPR;;AASA,QAAIhmB,IAAI,CAAC8qB,iBAAT,EAA4B;AAC1BjmB,MAAAA,MAAM,CAACsD,IAAP,CAAY,UAAS/I,CAAT,EAAY2rB,GAAZ,EAAiB;AAC3B,YAAI7nB,IAAI,GAAG,IAAX;AAAA,YAAiBJ,KAAK,GAAG9C,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcvE,SAAd,EAAzB;AACApV,QAAAA,aAAa,CAACzH,IAAD,EAAO9D,CAAP,EAAU0D,KAAV,CAAb;AACD,OAHD;AAID;;AACD8B,IAAAA,gBAAgB,CAACC,MAAD,EAAS7E,IAAI,CAACwQ,eAAd,CAAhB;AACD;;AAEDjS,EAAAA,EAAE,CAACisB,kBAAH,GAAwBA,kBAAxB;;AAEA,WAASQ,wBAAT,CAAkChrB,IAAlC,EAAwC;AACtC,QAAIqhB,YAAJ,EAAkBG,WAAlB;;AAEA,QAAIxhB,IAAI,CAACyE,cAAL,KAAwB,IAA5B,EAAkC;AAChC4c,MAAAA,YAAY,GAAGD,mBAAmB,CAACphB,IAAD,CAAlC;AACAwhB,MAAAA,WAAW,GAAGD,kBAAkB,CAACvhB,IAAD,CAAhC;;AAEA,UAAIA,IAAI,CAACshB,UAAL,KAAoB,QAAxB,EAAkC;AAChCthB,QAAAA,IAAI,CAACkS,MAAL,CAAYgP,KAAZ,GAAoB1iB,EAAE,CAACugB,WAAH,GACjBC,MADiB,CACVqC,YADU,EAEjB7B,KAFiB,CAEXgC,WAFW,EAGjBpB,KAHiB,CAGX,IAHW,CAApB;AAID,OALD,MAKO;AACLpgB,QAAAA,IAAI,CAACkS,MAAL,CAAYgP,KAAZ,GAAoBlhB,IAAI,CAACwhB,WAAL,KAAqB,IAArB,GAChBhjB,EAAE,CAAC0gB,YAAH,GAAkBM,KAAlB,CAAwBgC,WAAxB,CADgB,GAEfH,YAAY,CAAChgB,MAAb,GAAsB,EAAtB,GACC7C,EAAE,CAAC0gB,YAAH,CAAgB1gB,EAAE,CAAC0hB,gBAAnB,CADD,GAEC1hB,EAAE,CAAC0gB,YAAH,CAAgB1gB,EAAE,CAAC2hB,gBAAnB,CAJN;AAMAngB,QAAAA,IAAI,CAACkS,MAAL,CAAYgP,KAAZ,CAAkBlC,MAAlB,CAAyBqC,YAAzB;AACD;;AACDvE,MAAAA,qBAAqB,CAAC9c,IAAD,EAAO,OAAP,EAAgB,OAAhB,EAAyBA,IAAI,CAACyE,cAA9B,CAArB;AACD;AACF;;AAED,WAAS2c,mBAAT,CAA6BphB,IAA7B,EAAmC;AACjC,QAAIqhB,YAAJ;;AACA,QAAIrhB,IAAI,CAACqhB,YAAL,KAAsB,IAA1B,EAAgC;AAC9B,UAAIrhB,IAAI,CAACshB,UAAL,KAAoB,QAAxB,EAAkC;AAChCD,QAAAA,YAAY,GAAG7iB,EAAE,CAACkiB,MAAH,CAAU1gB,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAV,EAAwB,UAASM,CAAT,EAAY;AACjD,iBAAOA,CAAC,CAACY,IAAI,CAACyE,cAAN,CAAR;AACD,SAFc,CAAf;AAGD,OAJD,MAIO,IAAIzE,IAAI,CAACshB,UAAL,KAAoB,UAAxB,EAAoC;AACzCD,QAAAA,YAAY,GAAG7iB,EAAE,CAAC6gB,GAAH,CAAOrf,IAAI,CAAClB,IAAL,CAAU,CAAV,EACjBK,GADiB,CACb,UAASC,CAAT,EAAY;AACf,iBAAOA,CAAC,CAACY,IAAI,CAACyE,cAAN,CAAR;AACH,SAHmB,CAAP,EAIZyE,MAJY,EAAf;AAMAmY,QAAAA,YAAY,CAAC7b,IAAb;AACD;AACF,KAdD,MAcO;AACL6b,MAAAA,YAAY,GAAGrhB,IAAI,CAACqhB,YAApB;AACD;;AACD,WAAOA,YAAP;AACD;;AAED,WAASE,kBAAT,CAA4BvhB,IAA5B,EAAkC;AAChC,QAAIwhB,WAAJ;;AACA,QAAIxhB,IAAI,CAACwhB,WAAL,KAAqB,IAAzB,EAA+B;AAC7B,UAAIxhB,IAAI,CAACshB,UAAL,KAAoB,QAAxB,EAAkC;AAChCE,QAAAA,WAAW,GAAG,CAAC,MAAD,EAAS,KAAT,CAAd;AACD,OAFD,MAEO;AACLA,QAAAA,WAAW,GAAG,IAAd;AACD;AACF,KAND,MAMO;AACLA,MAAAA,WAAW,GAAGxhB,IAAI,CAACwhB,WAAnB;AACD;;AACD,WAAOA,WAAP;AACD;;AAED,WAASyJ,uBAAT,CAAiCjrB,IAAjC,EAAuC;AACrC,QAAIkrB,QAAJ,EAAcC,QAAd,EAAwBC,WAAxB,EAAqCC,UAArC;;AACA,QAAIrrB,IAAI,CAACsrB,aAAL,KAAuB,IAA3B,EAAiC;AAC/BF,MAAAA,WAAW,GAAGG,kBAAkB,CAACvrB,IAAD,CAAhC;AACAqrB,MAAAA,UAAU,GAAGG,iBAAiB,CAACxrB,IAAD,CAA9B;AAEAA,MAAAA,IAAI,CAACkS,MAAL,CAAYuZ,IAAZ,GAAmBjtB,EAAE,CAACugB,WAAH,GAChBC,MADgB,CACToM,WADS,EAEhB5L,KAFgB,CAEV6L,UAFU,EAGhBjL,KAHgB,CAGV,IAHU,CAAnB;AAKAtD,MAAAA,qBAAqB,CAAC9c,IAAD,EAAO,MAAP,EAAe,MAAf,EAAuBA,IAAI,CAACsrB,aAA5B,CAArB;AACD;AACF;;AAED,WAASC,kBAAT,CAA4BvrB,IAA5B,EAAkC;AAChC,WAAQA,IAAI,CAACorB,WAAL,KAAqB,IAAtB,GACH5sB,EAAE,CAACkiB,MAAH,CAAU1gB,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAV,EAAwB,UAASM,CAAT,EAAY;AAAE,aAAOA,CAAC,CAACY,IAAI,CAACsrB,aAAN,CAAR;AAA+B,KAArE,CADG,GAEHtrB,IAAI,CAACorB,WAFT;AAGD;;AAED,WAASI,iBAAT,CAA2BxrB,IAA3B,EAAiC;AAC/B,QAAIqrB,UAAJ;;AACA,QAAIrrB,IAAI,CAACqrB,UAAL,KAAoB,IAAxB,EAA8B;AAC5BA,MAAAA,UAAU,GAAG,CAAC,CAAD,EAAI,CAAJ,CAAb;AACD,KAFD,MAEO;AACLA,MAAAA,UAAU,GAAGrrB,IAAI,CAACqrB,UAAlB;AACD;;AACD,WAAOA,UAAP;AACD;;AAED,WAASd,cAAT,CAAwB5G,CAAxB,EAA2B3jB,IAA3B,EAAiC;AAC/B,QAAIA,IAAI,CAACoP,OAAT,EAAkB;AAChBuU,MAAAA,CAAC,CAACjgB,MAAF,CAAS,MAAT,EACGY,IADH,CACQ,OADR,EACiB,OADjB,EAEGA,IAFH,CAEQ,GAFR,EAEa,YAAW;AACpB,eAAO1B,gBAAgB,CAAC5C,IAAD,CAAhB,GAAyB,CAACgD,iBAAiB,CAAChD,IAAD,CAAjB,GAA0B4C,gBAAgB,CAAC5C,IAAD,CAA3C,IAAqD,CAArF;AACD,OAJH,EAKGsE,IALH,CAKQ,IALR,EAKctE,IAAI,CAAC0rB,eAAL,IAAwB,IAAxB,GAA+B1rB,IAAI,CAAC0rB,eAApC,GAAsD,CALpE,EAMGpnB,IANH,CAMQ,GANR,EAMa,YAAW;AACpB,YAAIqgB,gBAAgB,GAAGnmB,EAAE,CAACqF,MAAH,CAAU7D,IAAI,CAACiE,MAAf,EACpBJ,MADoB,CACb,iBADa,EACMqB,IADN,GACaiB,qBADb,EAAvB;AAEA,eAAOjE,aAAa,CAAClC,IAAD,CAAb,GAAsBA,IAAI,CAAC0O,eAAL,IAAwB,IAAI,CAA5B,CAAtB,GAAuDiW,gBAAgB,CAACxiB,MAAjB,GAA0B,GAAjF,GAAuF,EAA9F;AACD,OAVH,EAWGmC,IAXH,CAWQ,IAXR,EAWc,MAXd,EAYGA,IAZH,CAYQ,aAZR,EAYuB,QAZvB,EAaGuB,IAbH,CAaQ,UAASzG,CAAT,EAAY;AAChB,eAAOY,IAAI,CAACoP,OAAZ;AACD,OAfH;AAgBD;AACF;;AAED,WAASqU,yBAAT,CAAmCzjB,IAAnC,EAAyC;AACvC,WAAO,UAASZ,CAAT,EAAY;AACjB,UAAIA,CAAC,GAAG,GAAJ,IAAWA,CAAC,GAAG,CAAC,GAAhB,IAAuBA,CAAC,KAAK,CAAjC,EAAoC;AAClC;AACA,eAAOY,IAAI,CAACmP,SAAL,GAAiB/P,CAAC,CAAC2jB,OAAF,CAAU/iB,IAAI,CAAC0R,QAAf,CAAxB;AACD,OAHD,MAGO;AACL,YAAI4W,EAAE,GAAG9pB,EAAE,CAACmT,MAAH,CAAU,MAAV,CAAT;AACA,eAAO3R,IAAI,CAACmP,SAAL,GAAiBmZ,EAAE,CAAClpB,CAAD,CAA1B;AACD;AACF,KARD;AASD;;AAED,WAASusB,iBAAT,CAA2BthB,IAA3B,EAAiC;AAC/B;AACA,QAAI6Z,UAAJ;;AACA,QAAI0H,eAAe,CAACvhB,IAAD,CAAnB,EAA2B;AACzB6Z,MAAAA,UAAU,GAAG,QAAb;AACD,KAFD,MAEO,IAAI2H,WAAW,CAACxhB,IAAD,CAAf,EAAuB;AAC5B6Z,MAAAA,UAAU,GAAG,SAAb;AACD,KAFM,MAEA,IAAI4H,WAAW,CAACzhB,IAAD,CAAf,EAAuB;AAC5B6Z,MAAAA,UAAU,GAAG,iBAAb;AACD,KAFM,MAEA,IAAI6H,YAAY,CAAC1hB,IAAD,CAAhB,EAAwB;AAC7B6Z,MAAAA,UAAU,GAAG,WAAb;AACD,KAFM,MAEA,IAAI8H,YAAY,CAAC3hB,IAAD,CAAhB,EAAwB;AAAE;AAC/B6Z,MAAAA,UAAU,GAAG,WAAb;AACD,KAFM,MAEA,IAAI+H,cAAc,CAAC5hB,IAAD,CAAlB,EAA0B;AAC/B6Z,MAAAA,UAAU,GAAG,aAAb;AACD,KAFM,MAEA,IAAIgI,QAAQ,CAAC7hB,IAAD,CAAZ,EAAoB;AACzB6Z,MAAAA,UAAU,GAAG,OAAb;AACD,KAFM,MAEA;AACLA,MAAAA,UAAU,GAAG,SAAb;AACD;;AACD,WAAOA,UAAP;AACD;;AAED,WAAS0H,eAAT,CAAyBvhB,IAAzB,EAA+B;AAC7B,WAAOA,IAAI,GAAG,EAAd;AACD;;AAED,WAASwhB,WAAT,CAAqBxhB,IAArB,EAA2B;AACzB,WAAOA,IAAI,GAAG,EAAd;AACD;;AAED,WAASyhB,WAAT,CAAqBzhB,IAArB,EAA2B;AACzB,WAAOA,IAAI,IAAI,KAAK,EAAT,CAAJ,IAAoB,EAA3B;AACD;;AAED,WAAS0hB,YAAT,CAAsB1hB,IAAtB,EAA4B;AAC1B,WAAOA,IAAI,IAAI,KAAK,EAAT,CAAJ,IAAoB,KAAK,CAAhC;AACD;;AAED,WAAS2hB,YAAT,CAAsB3hB,IAAtB,EAA4B;AAC1B,WAAOA,IAAI,IAAI,KAAK,EAAL,GAAU,EAAd,CAAJ,IAAyB,EAAhC;AACD;;AAED,WAAS4hB,cAAT,CAAwB5hB,IAAxB,EAA8B;AAC5B,WAAOA,IAAI,IAAI,KAAK,EAAL,GAAU,EAAd,CAAJ,GAAwB,MAAM,CAArC;AACD;;AAED,WAAS6hB,QAAT,CAAkB7hB,IAAlB,EAAwB;AACtB,WAAOA,IAAI,IAAI,KAAK,EAAL,GAAU,EAAd,CAAJ,IAAyB,MAAM,CAAtC;AACD;;AAED,WAAS8hB,kBAAT,CAA4B3sB,GAA5B,EAAiC6K,IAAjC,EAAuC;AACrC,QAAI+hB,gBAAJ;;AACA,QAAIR,eAAe,CAACvhB,IAAD,CAAnB,EAA2B;AACzB+hB,MAAAA,gBAAgB,GAAG7tB,EAAE,CAACS,WAAH,CAAeQ,GAAf,EAAoB,UAApB,CAAnB;AACD,KAFD,MAEO,IAAIqsB,WAAW,CAACxhB,IAAD,CAAf,EAAuB;AAC5B+hB,MAAAA,gBAAgB,GAAG7tB,EAAE,CAACS,WAAH,CAAeQ,GAAf,EAAoB,OAApB,CAAnB;AACD,KAFM,MAEA,IAAIssB,WAAW,CAACzhB,IAAD,CAAf,EAAuB;AAC5B+hB,MAAAA,gBAAgB,GAAG7tB,EAAE,CAACS,WAAH,CAAeQ,GAAf,EAAoB,OAApB,CAAnB;AACD,KAFM,MAEA,IAAIusB,YAAY,CAAC1hB,IAAD,CAAhB,EAAwB;AAC7B+hB,MAAAA,gBAAgB,GAAG7tB,EAAE,CAACS,WAAH,CAAeQ,GAAf,EAAoB,OAApB,CAAnB;AACD,KAFM,MAEA,IAAIwsB,YAAY,CAAC3hB,IAAD,CAAhB,EAAwB;AAC7B+hB,MAAAA,gBAAgB,GAAG7tB,EAAE,CAACS,WAAH,CAAeQ,GAAf,EAAoB,OAApB,CAAnB;AACD,KAFM,MAEA,IAAIysB,cAAc,CAAC5hB,IAAD,CAAlB,EAA0B;AAC/B+hB,MAAAA,gBAAgB,GAAG7tB,EAAE,CAACS,WAAH,CAAeQ,GAAf,EAAoB,IAApB,CAAnB;AACD,KAFM,MAEA;AACL4sB,MAAAA,gBAAgB,GAAG7tB,EAAE,CAACS,WAAH,CAAeQ,GAAf,EAAoB,IAApB,CAAnB;AACD;;AACD,WAAO4sB,gBAAP;AACD;;AAED,WAASC,sBAAT,CAAgCrsB,IAAhC,EAAsC;AACpC,QAAIqK,IAAJ;AACA,QAAI+hB,gBAAJ;AACA,QAAIlI,UAAJ;;AAEA,QAAIlkB,IAAI,CAAC4jB,WAAT,EAAsB;AACpBvZ,MAAAA,IAAI,GAAG,CAACrK,IAAI,CAACE,SAAL,CAAeO,KAAf,GAAuBT,IAAI,CAACE,SAAL,CAAeM,KAAvC,IAAgD,IAAvD;AACA0jB,MAAAA,UAAU,GAAGyH,iBAAiB,CAACthB,IAAD,CAA9B;AACA+hB,MAAAA,gBAAgB,GAAGD,kBAAkB,CAACnsB,IAAI,CAACI,QAAN,EAAgBiK,IAAhB,CAArC;AACD;;AAEDrK,IAAAA,IAAI,CAACE,SAAL,CAAeosB,kBAAf,GAAoCF,gBAApC;AACApsB,IAAAA,IAAI,CAACE,SAAL,CAAeC,YAAf,GAA8B+jB,UAA9B;AACD;;AAED,WAASZ,qBAAT,CAA+BtjB,IAA/B,EAAqC;AACnC,QAAIA,IAAI,CAACuR,UAAT,EAAqB;AACnB,aAAOvR,IAAI,CAACuR,UAAZ;AACD;;AAED,QAAIzS,IAAI,GAAGkB,IAAI,CAACE,SAAL,CAAeqsB,aAAf,IAAgCvsB,IAAI,CAAClB,IAAhD;AACA,QAAI0tB,SAAS,GAAGroB,gBAAgB,CAACrF,IAAD,CAAhB,CAAuB,CAAvB,CAAhB;AACA,QAAI2tB,YAAY,GAAGD,SAAS,CAACxsB,IAAI,CAACE,SAAL,CAAewsB,mBAAf,IAAsC1sB,IAAI,CAACO,UAA5C,CAA5B;;AACA,QAAIksB,YAAY,KAAKtP,SAArB,EAAgC;AAC9BsP,MAAAA,YAAY,GAAGD,SAAf;AACD;;AAED,WAAO,UAASptB,CAAT,EAAY;AACjBitB,MAAAA,sBAAsB,CAACrsB,IAAD,CAAtB;;AAEA,UAAIuJ,UAAU,CAACkjB,YAAD,CAAd,EAA8B;AAC5B,eAAOzsB,IAAI,CAACE,SAAL,CAAeosB,kBAAf,CAAkC,IAAIziB,IAAJ,CAASzK,CAAT,CAAlC,CAAP;AACD,OAFD,MAEO,IAAI,OAAOqtB,YAAP,KAAwB,QAA5B,EAAsC;AAC3C,YAAIE,QAAQ,GAAGvtB,CAAC,GAAG,CAAJ,KAAU,CAAzB;AACA,YAAIkpB,EAAJ;;AAEA,YAAIqE,QAAJ,EAAc;AACZrE,UAAAA,EAAE,GAAG9pB,EAAE,CAACmT,MAAH,CAAU,OAAO3R,IAAI,CAAC0R,QAAZ,GAAuB,GAAjC,CAAL;AACD,SAFD,MAEO,IAAItS,CAAC,GAAG,IAAR,EAAc;AACnBkpB,UAAAA,EAAE,GAAG9pB,EAAE,CAACmT,MAAH,CAAU,MAAV,CAAL;AACD,SAFM,MAEA;AACL2W,UAAAA,EAAE,GAAG9pB,EAAE,CAACmT,MAAH,CAAU,MAAV,CAAL;AACD;;AACD,eAAO3R,IAAI,CAACmP,SAAL,GAAiBmZ,EAAE,CAAClpB,CAAD,CAA1B;AACD,OAZM,MAYA;AACL,eAAOY,IAAI,CAACmP,SAAL,GAAiB/P,CAAxB;AACD;AACF,KApBD;AAqBD;;AAED,WAASirB,cAAT,CAAwB1G,CAAxB,EAA2B3jB,IAA3B,EAAiC;AAC/BwpB,IAAAA,sBAAsB,CAACxpB,IAAD,EAAO,GAAP,CAAtB;AACA4sB,IAAAA,iBAAiB,CAAC5sB,IAAD,EAAO2jB,CAAP,CAAjB;AACAkJ,IAAAA,wBAAwB,CAAC7sB,IAAD,EAAO2jB,CAAP,CAAxB;AACD;;AAED,WAASiJ,iBAAT,CAA2B5sB,IAA3B,EAAiC2jB,CAAjC,EAAoC;AAClC,QAAIb,WAAW,GAAG9iB,IAAI,CAACE,SAAL,CAAe4sB,OAAf,CAAuBzrB,MAAzC;AACA,QAAI0rB,MAAM,GAAG/sB,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAc1C,KAAd,CAAoB5hB,IAAI,CAACyO,SAAzB,EAAoCpN,MAApC,GAA6C,CAA1D;;AAEA,QAAI,CAACrB,IAAI,CAAC8O,gBAAV,EAA4B;AAC1B6U,MAAAA,CAAC,CAACjgB,MAAF,CAAS,MAAT,EACGY,IADH,CACQ,IADR,EACc,YAAW;AACrB,YAAItE,IAAI,CAACyO,SAAL,KAAmB,CAAvB,EAA0B;AACxB,iBAAO7L,gBAAgB,CAAC5C,IAAD,CAAvB;AACD,SAFD,MAEO,IAAIA,IAAI,CAAC2O,gBAAL,IAAyB3O,IAAI,CAACyR,UAAL,KAAoB,KAAjD,EAAwD;AAC7D,iBAAOzR,IAAI,CAAC2C,IAAZ;AACD,SAFM,MAEA;AACL,iBAAQ3C,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAActkB,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAc1C,KAAd,CAAoB5hB,IAAI,CAACyO,SAAzB,EAAoC,CAApC,CAAd,CAAD,CAAwDsU,OAAxD,CAAgE,CAAhE,CAAP;AACD;AACF,OATH,EAUGze,IAVH,CAUQ,IAVR,EAUc,YAAW;AACrB,YAAItE,IAAI,CAACyO,SAAL,KAAmB,CAAnB,IAAyBzO,IAAI,CAAC2O,gBAAL,IAAyB3O,IAAI,CAACyR,UAAL,KAAoB,KAA1E,EAAkF;AAChF,iBAAO5O,YAAY,CAAC7C,IAAD,CAAnB;AACD,SAFD,MAEO;AACL,iBAAOA,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAActkB,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAc1C,KAAd,CAAoB5hB,IAAI,CAACyO,SAAzB,EAAoCse,MAApC,CAAd,EAA2DhK,OAA3D,CAAmE,CAAnE,CAAP;AACD;AACF,OAhBH,EAiBGze,IAjBH,CAiBQ,IAjBR,EAiBctE,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACoC,MAjBjC,EAkBGkC,IAlBH,CAkBQ,IAlBR,EAkBctE,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACoC,MAlBjC;AAmBD;AACF;;AAED,WAASyqB,wBAAT,CAAkC7sB,IAAlC,EAAwC2jB,CAAxC,EAA2C;AACzCA,IAAAA,CAAC,CAACngB,SAAF,CAAY,eAAZ,EACG1E,IADH,CACQkB,IAAI,CAACE,SAAL,CAAe4sB,OADvB,EACgCzoB,KADhC,GAEGX,MAFH,CAEU,MAFV,EAGGY,IAHH,CAGQ,IAHR,EAGc,UAASlF,CAAT,EAAY;AACtB,aAAOY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAd,EAAiB2jB,OAAjB,CAAyB,CAAzB,CAAP;AAAqC,KAJzC,EAKGze,IALH,CAKQ,IALR,EAKc,UAASlF,CAAT,EAAY;AACtB,aAAOY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAd,EAAiB2jB,OAAjB,CAAyB,CAAzB,CAAP;AAAqC,KANzC,EAOGze,IAPH,CAOQ,IAPR,EAOctE,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACoC,MAPjC,EAQGkC,IARH,CAQQ,IARR,EAQc,YAAW;AACrB,aAAQtE,IAAI,CAAC8O,gBAAN,GAA0B9O,IAAI,CAACwC,GAA/B,GAAqCxC,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACoC,MAAnB,GAA4BpC,IAAI,CAAC0O,eAA7E;AACD,KAVH,EAWGpK,IAXH,CAWQ,OAXR,EAWiB,YAAW;AACxB,UAAItE,IAAI,CAAC8O,gBAAT,EAA2B;AACzB,eAAO,uBAAP;AACD;AACF,KAfH,EAgBGnL,OAhBH,CAgBW,cAhBX,EAgB2B,IAhB3B;AAiBD;;AAED,WAAS2mB,oBAAT,CAA8B3G,CAA9B,EAAiC3jB,IAAjC,EAAuC;AACrCgtB,IAAAA,2BAA2B,CAAChtB,IAAD,EAAO2jB,CAAP,CAA3B;AACAsJ,IAAAA,6BAA6B,CAACjtB,IAAD,EAAO2jB,CAAP,CAA7B;AACD;;AAED,WAASqJ,2BAAT,CAAqChtB,IAArC,EAA2C2jB,CAA3C,EAA8C;AAC5C,QAAI9e,MAAM,GAAG8e,CAAC,CAACngB,SAAF,CAAY,gBAAZ,EACV1E,IADU,CACLkB,IAAI,CAACE,SAAL,CAAe4sB,OADV,EACmBzoB,KADnB,GAEVX,MAFU,CAEH,MAFG,EAGVY,IAHU,CAGL,GAHK,EAGA,UAASlF,CAAT,EAAY;AACrB,aAAOY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAd,EAAiB2jB,OAAjB,CAAyB,CAAzB,CAAP;AACD,KALU,EAMVze,IANU,CAML,GANK,EAMA,CAACtE,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACoC,MAAnB,GAA4BpC,IAAI,CAAC0O,eAAL,GAAuB,CAAvB,GAA2B,CAAxD,EAA2DqU,OAA3D,CAAmE,CAAnE,CANA,EAOVze,IAPU,CAOL,IAPK,EAOC,OAPD,EAQVA,IARU,CAQL,aARK,EAQU,QARV,CAAb;;AAUA,QAAItE,IAAI,CAAC4jB,WAAL,IAAoB5jB,IAAI,CAACmS,cAA7B,EAA6C;AAC3CtN,MAAAA,MAAM,CAACnB,MAAP,CAAc,OAAd,EAAuBC,OAAvB,CAA+B,mBAA/B,EAAoD,IAApD,EAA0DkC,IAA1D,CAA+D,UAASif,EAAT,EAAa3f,CAAb,EAAgB;AAC7E,YAAI/F,CAAC,GAAG,IAAIyK,IAAJ,CAASib,EAAT,CAAR;AACA,YAAI3f,CAAC,KAAK,CAAV,EAAa,OAAO3G,EAAE,CAACmB,UAAH,CAAc,IAAd,EAAoBP,CAApB,CAAP,CAAb,KACK,OAAO,EAAP;AACN,OAJD;AAKAyF,MAAAA,MAAM,CAACnB,MAAP,CAAc,OAAd,EAAuBC,OAAvB,CAA+B,6BAA/B,EAA8D,IAA9D,EAAoEkC,IAApE,CAAyE,UAASif,EAAT,EAAa3f,CAAb,EAAgB;AACvF,YAAI/F,CAAC,GAAG,IAAIyK,IAAJ,CAASib,EAAT,CAAR;AACA,eAAO,MAAM9kB,IAAI,CAACE,SAAL,CAAeqR,UAAf,CAA0BnS,CAA1B,CAAb;AACD,OAHD;AAID,KAVD,MAUO;AACLyF,MAAAA,MAAM,CAACgB,IAAP,CAAY,UAASzG,CAAT,EAAY;AACtB,eAAOY,IAAI,CAACmP,SAAL,GAAiBnP,IAAI,CAACE,SAAL,CAAeqR,UAAf,CAA0BnS,CAA1B,CAAxB;AACD,OAFD;AAGD,KAzB2C,CA2B5C;AACA;AACA;;;AACA,QAAI6F,2BAA2B,CAACJ,MAAD,CAA/B,EAAyC;AACvCA,MAAAA,MAAM,CAACsE,MAAP,CAAc,UAAS/J,CAAT,EAAY+F,CAAZ,EAAe;AAC3B,eAAO,CAACA,CAAC,GAAG,CAAL,IAAU,CAAV,KAAgB,CAAvB;AACD,OAFD,EAEG/B,MAFH;AAIA,UAAIE,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACAX,MAAAA,GAAG,CAACE,SAAJ,CAAc,eAAd,EACG2F,MADH,CACU,UAAS/J,CAAT,EAAY+F,CAAZ,EAAe;AACrB,eAAO,CAACA,CAAC,GAAG,CAAL,IAAU,CAAV,KAAgB,CAAvB;AACD,OAHH,EAIG/B,MAJH;AAKD;AACF;;AAED,WAAS6pB,6BAAT,CAAuCjtB,IAAvC,EAA6C2jB,CAA7C,EAAgD;AAC9C,QAAI3jB,IAAI,CAAC4jB,WAAL,KAAqB5jB,IAAI,CAACuN,UAAL,IAAmBvN,IAAI,CAACqS,sBAA7C,CAAJ,EAA0E;AACxE,UAAI+L,EAAE,GAAGyF,0CAA0C,CAAC7jB,IAAD,CAAnD;AACAktB,MAAAA,gCAAgC,CAACltB,IAAD,EAAO2jB,CAAP,EAAUvF,EAAE,CAAC2F,SAAb,EAAwB3F,EAAE,CAAC4F,OAA3B,EAAoC5F,EAAE,CAAC6F,SAAvC,CAAhC;AACD;AACF;;AAED,WAASJ,0CAAT,CAAoD7jB,IAApD,EAA0D;AACxD,QAAIoe,EAAE,GAAG,EAAT;AACAA,IAAAA,EAAE,CAAC2F,SAAH,GAAe/jB,IAAI,CAACE,SAAL,CAAeC,YAA9B;;AACA,YAAQie,EAAE,CAAC2F,SAAX;AACE,WAAK,QAAL;AACA,WAAK,SAAL;AACE3F,QAAAA,EAAE,CAAC6F,SAAH,GAAezlB,EAAE,CAAC2uB,QAAlB;AACA,YAAIntB,IAAI,CAACmS,cAAT,EAAyBiM,EAAE,CAAC4F,OAAH,GAAazlB,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,OAA9B,CAAb,CAAzB,KACKge,EAAE,CAAC4F,OAAH,GAAazlB,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,OAA9B,CAAb;AACL;;AACF,WAAK,iBAAL;AACEge,QAAAA,EAAE,CAAC6F,SAAH,GAAezlB,EAAE,CAAC2uB,QAAlB;AACA/O,QAAAA,EAAE,CAAC4F,OAAH,GAAazlB,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,OAA9B,CAAb;AACA;;AACF,WAAK,WAAL;AACEge,QAAAA,EAAE,CAAC6F,SAAH,GAAezlB,EAAE,CAAC2uB,QAAlB;AACA/O,QAAAA,EAAE,CAAC4F,OAAH,GAAazlB,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,OAA9B,CAAb;AACA;;AACF,WAAK,WAAL;AACEge,QAAAA,EAAE,CAAC6F,SAAH,GAAezlB,EAAE,CAAC4uB,SAAlB;AACAhP,QAAAA,EAAE,CAAC4F,OAAH,GAAazlB,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,IAA9B,CAAb;AACA;;AACF,WAAK,aAAL;AACEge,QAAAA,EAAE,CAAC6F,SAAH,GAAezlB,EAAE,CAAC4uB,SAAlB;AACAhP,QAAAA,EAAE,CAAC4F,OAAH,GAAazlB,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,IAA9B,CAAb;AACA;;AACF;AACEge,QAAAA,EAAE,CAAC6F,SAAH,GAAezlB,EAAE,CAAC4uB,SAAlB;AACAhP,QAAAA,EAAE,CAAC4F,OAAH,GAAazlB,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,IAA9B,CAAb;AAzBJ;;AA2BA,WAAOge,EAAP;AACD;;AAED,WAAS8O,gCAAT,CAA0CltB,IAA1C,EAAgD2jB,CAAhD,EAAmDO,UAAnD,EAA+DF,OAA/D,EAAwEG,kBAAxE,EAA4F;AAC1F,QAAIC,KAAK,GAAGD,kBAAkB,CAACnkB,IAAI,CAACE,SAAL,CAAeM,KAAhB,EAAuBR,IAAI,CAACE,SAAL,CAAeO,KAAtC,CAA9B;;AACA,QAAI2jB,KAAK,CAAC/iB,MAAN,KAAiB,CAArB,EAAwB;AACtB,UAAIgjB,UAAU,GAAGrkB,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAc1C,KAAd,CAAoB5hB,IAAI,CAACyO,SAAzB,EAAoC,CAApC,CAAjB;AACA2V,MAAAA,KAAK,GAAG,CAACC,UAAD,CAAR;AACD;;AAED,QAAIE,EAAE,GAAG9gB,QAAQ,CAACkgB,CAAD,EAAI,gBAAJ,CAAjB;;AACA,QAAIO,UAAU,KAAK,SAAf,IAA4BlkB,IAAI,CAACoS,iBAArC,EAAwD;AACtDib,MAAAA,uBAAuB,CAACrtB,IAAD,EAAOukB,EAAP,EAAWH,KAAX,EAAkBJ,OAAlB,CAAvB;AACD;;AACD,QAAIE,UAAU,IAAI,OAAlB,EAA2BoJ,uBAAuB,CAACttB,IAAD,EAAOukB,EAAP,EAAWH,KAAX,EAAkBJ,OAAlB,CAAvB;AAC5B;;AAED,WAASqJ,uBAAT,CAAiCrtB,IAAjC,EAAuC2jB,CAAvC,EAA0CS,KAA1C,EAAiDJ,OAAjD,EAA0D;AACxDL,IAAAA,CAAC,CAACngB,SAAF,CAAY,iBAAZ,EACG1E,IADH,CACQslB,KADR,EACe/f,KADf,GAEGX,MAFH,CAEU,MAFV,EAGGY,IAHH,CAGQ,IAHR,EAGc,UAASlF,CAAT,EAAY;AACtB,aAAOY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAd,EAAiB2jB,OAAjB,CAAyB,CAAzB,CAAP;AACD,KALH,EAMGze,IANH,CAMQ,IANR,EAMc,UAASlF,CAAT,EAAY;AACtB,aAAOY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAd,EAAiB2jB,OAAjB,CAAyB,CAAzB,CAAP;AACD,KARH,EASGze,IATH,CASQ,IATR,EASc/B,UAAU,CAACvC,IAAD,CATxB,EAUGsE,IAVH,CAUQ,IAVR,EAUcpC,aAAa,CAAClC,IAAD,CAV3B;AAWD;;AAED,WAASstB,uBAAT,CAAiCttB,IAAjC,EAAuC2jB,CAAvC,EAA0CS,KAA1C,EAAiDJ,OAAjD,EAA0D;AACxDL,IAAAA,CAAC,CAACngB,SAAF,CAAY,iBAAZ,EACG1E,IADH,CACQslB,KADR,EACe/f,KADf,GAEGX,MAFH,CAEU,MAFV,EAGGY,IAHH,CAGQ,GAHR,EAGa,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AACxB,aAAOnF,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAd,EAAiB2jB,OAAjB,CAAyB,CAAzB,CAAP;AACD,KALH,EAMGze,IANH,CAMQ,GANR,EAMa,YAAW;AACpB,UAAIqgB,gBAAgB,GAAGnmB,EAAE,CAACqF,MAAH,CAAU7D,IAAI,CAACiE,MAAf,EACpBJ,MADoB,CACb,iBADa,EACMqB,IADN,GACaiB,qBADb,EAAvB;AAEA,aAAQjE,aAAa,CAAClC,IAAD,CAAb,GAAsBA,IAAI,CAAC0O,eAAL,GAAuB,CAAvB,GAA2B,CAAlD,GAAwDiW,gBAAgB,CAACxiB,MAAjB,GAA0B,GAAzF;AACD,KAVH,EAWGmC,IAXH,CAWQ,IAXR,EAWc,OAXd,EAYGA,IAZH,CAYQ,aAZR,EAYuB,QAZvB,EAaGuB,IAbH,CAaQ,UAASzG,CAAT,EAAY;AAChB,aAAO4kB,OAAO,CAAC,IAAIna,IAAJ,CAASzK,CAAT,CAAD,CAAd;AACD,KAfH;AAgBD;;AAED,WAASmuB,wBAAT,CAAkCC,EAAlC,EAAsCxtB,IAAtC,EAA4ClB,IAA5C,EAAkD;AAChD,QAAI2uB,QAAQ,GAAGjvB,EAAE,CAACkiB,MAAH,CAAU5hB,IAAV,EAAgB,UAASM,CAAT,EAAY;AACzC,aAAOA,CAAC,CAACY,IAAI,CAACO,UAAN,CAAR;AACD,KAFc,CAAf;AAGAitB,IAAAA,EAAE,CAACvF,GAAH,GAASwF,QAAQ,CAAC,CAAD,CAAjB;AACAD,IAAAA,EAAE,CAAC3L,GAAH,GAAS4L,QAAQ,CAAC,CAAD,CAAjB;AACD;;AAED,WAASC,qBAAT,CAA+BF,EAA/B,EAAmCxtB,IAAnC,EAAyClB,IAAzC,EAA+C;AAC7C0uB,IAAAA,EAAE,CAACvF,GAAH,GAASzpB,EAAE,CAACypB,GAAH,CAAOnpB,IAAP,EAAa,UAASM,CAAT,EAAY;AAChC,UAAI8oB,IAAI,GAAG,CACT9oB,CAAC,CAACY,IAAI,CAACO,UAAN,CADQ,EAERnB,CAAC,CAACY,IAAI,CAACmoB,iBAAN,CAAF,GAA8B/oB,CAAC,CAACY,IAAI,CAACmoB,iBAAN,CAA/B,GAA0D,CAFjD,EAGR/oB,CAAC,CAACY,IAAI,CAACooB,kBAAN,CAAF,GAA+BhpB,CAAC,CAACY,IAAI,CAACooB,kBAAN,CAAhC,GAA4D,CAHnD,CAAX;AAKA,aAAOjP,IAAI,CAAC8O,GAAL,CAASrhB,KAAT,CAAe,IAAf,EAAqBshB,IAArB,CAAP;AACD,KAPQ,CAAT;AASA,QAAIsF,EAAE,CAACvF,GAAH,GAAS,CAAb,EAAgBuF,EAAE,CAACvF,GAAH,GAAS,CAAT;AAEhBuF,IAAAA,EAAE,CAAC3L,GAAH,GAASrjB,EAAE,CAACqjB,GAAH,CAAO/iB,IAAP,EAAa,UAASM,CAAT,EAAY;AAChC,UAAI8oB,IAAI,GAAG,CACT9oB,CAAC,CAACY,IAAI,CAACO,UAAN,CADQ,EAERnB,CAAC,CAACY,IAAI,CAACmoB,iBAAN,CAAF,GAA8B/oB,CAAC,CAACY,IAAI,CAACmoB,iBAAN,CAA/B,GAA0D,CAFjD,EAGR/oB,CAAC,CAACY,IAAI,CAACooB,kBAAN,CAAF,GAA+BhpB,CAAC,CAACY,IAAI,CAACooB,kBAAN,CAAhC,GAA4D,CAHnD,CAAX;AAKA,aAAOjP,IAAI,CAAC0I,GAAL,CAASjb,KAAT,CAAe,IAAf,EAAqBshB,IAArB,CAAP;AACD,KAPQ,CAAT;AAQA,WAAOsF,EAAP;AACD;;AAED,WAASG,sBAAT,CAAgCH,EAAhC,EAAoC;AAClC,QAAII,SAAS,GAAGrvB,EAAE,CAACoL,KAAH,CAAS6jB,EAAE,CAACvF,GAAZ,EAAiBpH,OAAjB,CAAyB2M,EAAE,CAACvF,GAAH,CAAOnH,OAAP,KAAmB,CAA5C,CAAhB;AACA,QAAI+M,QAAQ,GAAGtvB,EAAE,CAACoL,KAAH,CAAS6jB,EAAE,CAACvF,GAAZ,EAAiBpH,OAAjB,CAAyB2M,EAAE,CAACvF,GAAH,CAAOnH,OAAP,KAAmB,CAA5C,CAAf;AACA0M,IAAAA,EAAE,CAACvF,GAAH,GAAS2F,SAAT;AACAJ,IAAAA,EAAE,CAAC3L,GAAH,GAASgM,QAAT;AACD;;AAED,WAASC,wBAAT,CAAkCN,EAAlC,EAAsC;AACpC;AACAA,IAAAA,EAAE,CAACvF,GAAH,GAASuF,EAAE,CAACvF,GAAH,GAAS,CAAlB;AACAuF,IAAAA,EAAE,CAAC3L,GAAH,GAAS2L,EAAE,CAAC3L,GAAH,GAAS,CAAlB;AACD;;AAED,WAASkM,wBAAT,CAAkCP,EAAlC,EAAsC;AACpC;AACAA,IAAAA,EAAE,CAACvF,GAAH,GAAS1oB,MAAM,CAACiuB,EAAE,CAACvF,GAAJ,CAAN,GAAiB,CAA1B;AACAuF,IAAAA,EAAE,CAAC3L,GAAH,GAAStiB,MAAM,CAACiuB,EAAE,CAAC3L,GAAJ,CAAN,GAAiB,CAA1B;AACD;;AAED,WAASd,4BAAT,CAAsC/gB,IAAtC,EAA4C;AAC1CA,IAAAA,IAAI,CAACyO,SAAL,GAAiB,CAAjB;AACD;;AAED,WAASuf,uDAAT,CAAiER,EAAjE,EAAqExtB,IAArE,EAA2ElB,IAA3E,EAAiF;AAC/E,QAAIkB,IAAI,CAACyR,UAAL,KAAoB,MAApB,IAA8BzR,IAAI,CAACyR,UAAL,KAAoB,OAAlD,IAA6DzR,IAAI,CAACyR,UAAL,KAAoB,WAArF,EAAkG;AAChG8b,MAAAA,wBAAwB,CAACC,EAAD,EAAKxtB,IAAL,EAAWlB,IAAX,CAAxB;AAED,KAHD,MAGO,IAAIkB,IAAI,CAACyR,UAAL,KAAoB,KAAxB,EAA+B;AACpCic,MAAAA,qBAAqB,CAACF,EAAD,EAAKxtB,IAAL,EAAWlB,IAAX,CAArB;AACD,KAN8E,CAO/E;;;AACA,QAAI0uB,EAAE,CAACvF,GAAH,KAAWuF,EAAE,CAAC3L,GAAd,IAAqB,EAAE7hB,IAAI,CAACQ,KAAL,IAAcR,IAAI,CAACS,KAArB,CAAzB,EAAsD;AACpD,UAAI8I,UAAU,CAACikB,EAAE,CAACvF,GAAJ,CAAd,EAAwB;AACtB0F,QAAAA,sBAAsB,CAACH,EAAD,CAAtB;AACD,OAFD,MAEO,IAAI,OAAOhtB,KAAP,KAAiB,QAArB,EAA+B;AACpCstB,QAAAA,wBAAwB,CAACN,EAAD,CAAxB;AACD,OAFM,MAEA,IAAI,OAAOhtB,KAAP,KAAiB,QAArB,EAA+B;AACpCutB,QAAAA,wBAAwB,CAACP,EAAD,CAAxB;AACD,OAPmD,CAQpD;;;AACAzM,MAAAA,4BAA4B,CAAC/gB,IAAD,CAA5B;AACD;AACF;;AAED,WAASoqB,oBAAT,CAA8BpqB,IAA9B,EAAoC;AAClC,QAAIwjB,CAAC,GAAGxjB,IAAI,CAACyR,UAAb;;AACA,QAAI,CAACzR,IAAI,CAACE,SAAL,CAAeqR,UAApB,EAAgC;AAC9B,UAAIvR,IAAI,CAACuR,UAAT,EAAqB;AACnBvR,QAAAA,IAAI,CAACE,SAAL,CAAeqR,UAAf,GAA4BvR,IAAI,CAACuR,UAAjC;AACD,OAFD,MAEO;AACL,YAAIiS,CAAC,KAAK,MAAN,IAAgBA,CAAC,KAAK,OAAtB,IAAiCA,CAAC,KAAK,WAA3C,EAAwD;AACtDxjB,UAAAA,IAAI,CAACE,SAAL,CAAeqR,UAAf,GAA4B+R,qBAAqB,CAACtjB,IAAD,CAAjD;AACD,SAFD,MAEO,IAAIwjB,CAAC,KAAK,KAAV,EAAiB;AACtBxjB,UAAAA,IAAI,CAACE,SAAL,CAAeqR,UAAf,GAA4BkS,yBAAyB,CAACzjB,IAAD,CAArD;AACD;AACF;AACF;AACF;;AAED,WAASiuB,2BAAT,CAAqCjuB,IAArC,EAA2C;AACzC,QAAImM,QAAQ,GAAG;AACblI,MAAAA,MAAM,EAAE,IADK;AAEbkQ,MAAAA,KAAK,EAAE,IAFM;AAGbyI,MAAAA,WAAW,EAAE;AAHA,KAAf;;AAMA,QAAI,CAAC5c,IAAL,EAAW;AACTA,MAAAA,IAAI,GAAG,EAAP;AACD;;AAED,QAAI,CAACA,IAAI,CAACE,SAAV,EAAqB;AACnBF,MAAAA,IAAI,CAACE,SAAL,GAAiB,EAAjB;AACD;;AAEDF,IAAAA,IAAI,GAAG2I,mBAAmB,CAAC3I,IAAD,EAAOmM,QAAP,CAA1B;AACA,WAAOnM,IAAP;AACD;;AAED,WAASkuB,iBAAT,CAA2BluB,IAA3B,EAAiC;AAC/B,QAAImuB,UAAU,GAAGhqB,gBAAgB,CAACnE,IAAI,CAACE,SAAL,CAAeqsB,aAAf,IAAgCvsB,IAAI,CAAClB,IAAtC,CAAhB,CAA4D,CAA5D,CAAjB;AACAkB,IAAAA,IAAI,CAAC4jB,WAAL,GAAmBra,UAAU,CAAC4kB,UAAU,CAACnuB,IAAI,CAACE,SAAL,CAAewsB,mBAAf,IAAsC1sB,IAAI,CAACO,UAA5C,CAAX,CAA7B;AACD;;AAED,WAAS6tB,qBAAT,CAA+BpuB,IAA/B,EAAqC;AACnC,QAAIquB,SAAS,GAAGruB,IAAI,CAAC8C,KAArB;;AACA,QAAI9C,IAAI,CAACqO,UAAT,EAAqB;AACnBggB,MAAAA,SAAS,GAAGzmB,SAAS,CAAC5H,IAAI,CAACiE,MAAN,CAArB;AACD;;AACD,QAAIjE,IAAI,CAAC0P,WAAL,KAAqB,aAArB,IAAsC2e,SAAS,KAAK,IAAxD,EAA8D;AAC5DA,MAAAA,SAAS,GAAGC,+BAA+B,CAACtuB,IAAD,EAAO,GAAP,CAA3C;AACD;;AAEDA,IAAAA,IAAI,CAAC8C,KAAL,GAAaurB,SAAb;AACD;;AAED,WAASE,sBAAT,CAAgCvuB,IAAhC,EAAsC;AACpC,QAAIwuB,UAAU,GAAGxuB,IAAI,CAACmC,MAAtB;;AACA,QAAInC,IAAI,CAACsO,WAAT,EAAsB;AACpBkgB,MAAAA,UAAU,GAAG3mB,UAAU,CAAC7H,IAAI,CAACiE,MAAN,CAAvB;AACD;;AACD,QAAIjE,IAAI,CAAC2P,WAAL,KAAqB,aAArB,IAAsC6e,UAAU,KAAK,IAAzD,EAA+D;AAC7DA,MAAAA,UAAU,GAAGF,+BAA+B,CAACtuB,IAAD,EAAO,GAAP,CAA5C;AACD;;AAEDA,IAAAA,IAAI,CAACmC,MAAL,GAAcqsB,UAAd;AACD;;AAED,WAASC,uCAAT,CAAiDnrB,GAAjD,EAAsDtD,IAAtD,EAA4D;AAC1D,QAAK,CAACsD,GAAG,CAACE,SAAJ,CAAc,eAAd,EAA+BkrB,KAA/B,EAAD,IAA2C1uB,IAAI,CAACyR,UAAL,KAAoB,MAAhE,IACD,CAACnO,GAAG,CAACE,SAAJ,CAAc,YAAd,EAA4BkrB,KAA5B,EAAD,IAAwC1uB,IAAI,CAACyR,UAAL,KAAoB,OAD3D,IAED,CAACnO,GAAG,CAACE,SAAJ,CAAc,eAAd,EAA+BkrB,KAA/B,EAAD,IAA2C1uB,IAAI,CAACyR,UAAL,KAAoB,WAF9D,IAGD,CAACnO,GAAG,CAACE,SAAJ,CAAc,aAAd,EAA6BkrB,KAA7B,EAAD,IAAyC1uB,IAAI,CAACyR,UAAL,KAAoB,KAHhE,EAIE;AACAnO,MAAAA,GAAG,CAACF,MAAJ;AACD;AACF;;AAED,WAASurB,6BAAT,CAAuCrrB,GAAvC,EAA4CtD,IAA5C,EAAkD;AAChD,QAAIgE,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAAnB,CAAiCyqB,KAAjC,EAAJ,EAA8C;AAC5CprB,MAAAA,GAAG,GAAG9E,EAAE,CAACqF,MAAH,CAAU7D,IAAI,CAACiE,MAAf,EACHP,MADG,CACI,KADJ,EAEHC,OAFG,CAEK,QAFL,EAEe3D,IAAI,CAAC6R,MAFpB,EAGHvN,IAHG,CAGE,OAHF,EAGWtE,IAAI,CAAC8C,KAHhB,EAIHwB,IAJG,CAIE,QAJF,EAIYtE,IAAI,CAACmC,MAJjB,CAAN;AAKD;;AACD,WAAOmB,GAAP;AACD;;AAED,WAASsrB,8BAAT,CAAwCtrB,GAAxC,EAA6CtD,IAA7C,EAAmD;AACjDsD,IAAAA,GAAG,CAACE,SAAJ,CAAc,eAAd,EAA+BJ,MAA/B;AACAE,IAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,OADR,EACiB,cADjB,EAEGZ,MAFH,CAEU,UAFV,EAGGY,IAHH,CAGQ,IAHR,EAGc,oBAAoByC,aAAa,CAAC/G,IAAI,CAACiE,MAAN,CAH/C,EAIGP,MAJH,CAIU,UAJV,EAKGY,IALH,CAKQ,GALR,EAKa5B,WAAW,CAAC1C,IAAD,CALxB,EAMGsE,IANH,CAMQ,GANR,EAMa/B,UAAU,CAACvC,IAAD,CANvB,EAOGsE,IAPH,CAOQ,OAPR,EAOiBtE,IAAI,CAAC8C,KAAL,GAAa9C,IAAI,CAAC2C,IAAlB,GAAyB3C,IAAI,CAAC+C,KAA9B,GAAsC/C,IAAI,CAACsC,MAP5D,EAQGgC,IARH,CAQQ,QARR,EAQkBtE,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACwC,GAAnB,GAAyBxC,IAAI,CAACoC,MAA9B,GAAuCpC,IAAI,CAACsC,MAA5C,GAAqD,CARvE;AASD;;AAED,WAASusB,qCAAT,CAA+CvrB,GAA/C,EAAoDtD,IAApD,EAA0D;AACxD,QAAIA,IAAI,CAAC8C,KAAL,KAAevD,MAAM,CAAC+D,GAAG,CAACgB,IAAJ,CAAS,OAAT,CAAD,CAAzB,EAA8C;AAC5ChB,MAAAA,GAAG,CAACgB,IAAJ,CAAS,OAAT,EAAkBtE,IAAI,CAAC8C,KAAvB;AACD;;AACD,QAAI9C,IAAI,CAACmC,MAAL,KAAgB5C,MAAM,CAAC+D,GAAG,CAACgB,IAAJ,CAAS,QAAT,CAAD,CAA1B,EAAgD;AAC9ChB,MAAAA,GAAG,CAACgB,IAAJ,CAAS,QAAT,EAAmBtE,IAAI,CAACmC,MAAxB;AACD;AACF;;AAED,WAAS2sB,0BAAT,CAAoCxrB,GAApC,EAAyCtD,IAAzC,EAA+C;AAC7C;AACAsD,IAAAA,GAAG,CAACgB,IAAJ,CAAS,SAAT,EAAoB,SAAStE,IAAI,CAAC8C,KAAd,GAAsB,GAAtB,GAA4B9C,IAAI,CAACmC,MAArD;;AACA,QAAInC,IAAI,CAACqO,UAAL,IAAmBrO,IAAI,CAACsO,WAA5B,EAAyC;AACvChL,MAAAA,GAAG,CAACgB,IAAJ,CAAS,qBAAT,EAAgC,eAAhC;AACD;AACF;;AAED,WAASyqB,kCAAT,CAA4CzrB,GAA5C,EAAiD;AAC/C;AACAA,IAAAA,GAAG,CAACK,OAAJ,CAAY,YAAZ,EAA0B,KAA1B,EAF+C,CAI/C;;AACAL,IAAAA,GAAG,CAACE,SAAJ,CAAc,kBAAd,EAAkCJ,MAAlC;AACAE,IAAAA,GAAG,CAACE,SAAJ,CAAc,kBAAd,EAAkCJ,MAAlC;AACD;;AAED,WAAS4rB,wBAAT,CAAkC1rB,GAAlC,EAAuCtD,IAAvC,EAA6C;AAC3C;AACA;AACA;AAEA,QAAImF,CAAC,GAAG,CAAR;;AAEA,QAAI7B,GAAG,CAACE,SAAJ,CAAc,eAAd,EAA+ByrB,KAA/B,GAAuC5tB,MAAvC,IAAiDrB,IAAI,CAAClB,IAAL,CAAUuC,MAA/D,EAAuE;AACrE;AACA;AACA,UAAIrB,IAAI,CAACyS,qBAAL,CAA2BpR,MAA3B,GAAoC,CAAxC,EAA2C;AACzC,YAAI6tB,iBAAiB,GAAG,UAASllB,GAAT,EAAc;AACpC,cAAInI,GAAG,GAAG,IAAI2G,KAAJ,CAAUwB,GAAV,CAAV;;AACA,eAAK,IAAI7E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGtD,GAAG,CAACR,MAAxB,EAAgC8D,CAAC,EAAjC,EAAqC;AAAEtD,YAAAA,GAAG,CAACsD,CAAD,CAAH,GAASA,CAAC,GAAG,CAAb;AAAiB;;AACxD,iBAAOtD,GAAP;AACD,SAJD,CADyC,CAOzC;;;AACA,YAAIstB,eAAe,GAAGhlB,QAAQ,CAC5B+kB,iBAAiB,CAAClvB,IAAI,CAAC2S,aAAN,CADW,EAE5B3S,IAAI,CAACyS,qBAFuB,CAA9B;;AAIA,aAAKtN,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGgqB,eAAe,CAAC9tB,MAAhC,EAAwC8D,CAAC,EAAzC,EAA6C;AAC3C7B,UAAAA,GAAG,CAACE,SAAJ,CAAc,0BAA0B2rB,eAAe,CAAChqB,CAAD,CAAzC,GAA+C,QAA7D,EACG/B,MADH;AAED;AACF,OAhBD,MAgBO;AACL;AACA,YAAIgsB,UAAU,GAAGpvB,IAAI,CAAClB,IAAL,CAAUuC,MAA3B;AACA,YAAIguB,eAAe,GAAI/rB,GAAG,CAACE,SAAJ,CAAc,eAAd,EAA+ByrB,KAA/B,EAAD,GAA2C3rB,GAAG,CAACE,SAAJ,CAAc,eAAd,EAA+ByrB,KAA/B,GAAuC5tB,MAAlF,GAA2F,CAAjH;;AAEA,aAAK8D,CAAC,GAAGkqB,eAAT,EAA0BlqB,CAAC,GAAGiqB,UAA9B,EAA0CjqB,CAAC,EAA3C,EAA+C;AAC7C7B,UAAAA,GAAG,CAACE,SAAJ,CAAc,0BAA0B2B,CAA1B,GAA8B,QAA5C,EACG/B,MADH;AAED;AACF;AACF;AACF;;AAED,WAASksB,wBAAT,CAAkChb,SAAlC,EAA6CtU,IAA7C,EAAmD;AACjD,QAAIsU,SAAS,CAACoa,KAAV,EAAJ,EAAuB;AACrBrnB,MAAAA,OAAO,CAACC,IAAR,CAAa,mCAAmCtH,IAAI,CAACiE,MAAxC,GAAiD,mEAA9D;AACA;AACD;AACF;;AAED,WAASsrB,yBAAT,CAAmCvvB,IAAnC,EAAyCuG,EAAzC,EAA6C;AAC3C,QAAIipB,KAAK,GAAGjpB,EAAE,KAAK,GAAP,GAAavG,IAAI,CAAC8C,KAAlB,GAA0B9C,IAAI,CAACmC,MAA3C;AACAstB,IAAAA,qCAAqC,CAACzvB,IAAD,EAAOuG,EAAP,CAArC;AACAmpB,IAAAA,oCAAoC,CAAC1vB,IAAD,EAAOuG,EAAP,CAApC;AACAopB,IAAAA,qCAAqC,CAAC3vB,IAAD,EAAOuG,EAAP,EAAWipB,KAAX,CAArC;AACA,QAAIA,KAAJ,EAAWI,sCAAsC,CAAC5vB,IAAD,EAAOuG,EAAP,CAAtC;AACZ;;AAGD,WAASkpB,qCAAT,CAA+CzvB,IAA/C,EAAqDuG,EAArD,EAAyD;AACvD,QAAIspB,eAAe,GAAGtpB,EAAE,GAAG,gBAA3B;AACA,QAAIxH,QAAQ,GAAGiB,IAAI,CAAC6vB,eAAD,CAAnB;AACA7vB,IAAAA,IAAI,CAAC0oB,kBAAL,GAA0B,EAA1B;;AACA,QAAI3pB,QAAJ,EAAc;AACZ,UAAID,IAAI,GAAGkB,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAX;AACAkB,MAAAA,IAAI,CAAC0oB,kBAAL,GAA0BlqB,EAAE,CAAC6gB,GAAH,CAAOvgB,IAAI,CAACK,GAAL,CAAS,UAASC,CAAT,EAAY;AACpD,eAAOA,CAAC,CAACL,QAAD,CAAR;AAAoB,OADW,CAAP,EACDmK,MADC,EAA1B;AAED;AACF;;AAED,WAASwmB,oCAAT,CAA8C1vB,IAA9C,EAAoDuG,EAApD,EAAwD;AACtD,QAAIspB,eAAe,GAAGtpB,EAAE,GAAG,gBAA3B;AACA,QAAIsf,aAAa,GAAG7lB,IAAI,CAAC6vB,eAAD,CAAxB;AAEA7vB,IAAAA,IAAI,CAAC8vB,UAAL,GAAkB9vB,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAauC,MAA/B;;AACA,QAAIwkB,aAAJ,EAAmB;AACjB,UAAIkK,UAAU,GAAGjuB,oBAAoB,CAACF,KAAK,CAAC5B,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAD,EAAe+mB,aAAf,CAAN,CAArC;AACAkK,MAAAA,UAAU,GAAGvxB,EAAE,CAACqjB,GAAH,CAAO9gB,MAAM,CAACivB,IAAP,CAAYD,UAAZ,EAAwB5wB,GAAxB,CAA4B,UAASC,CAAT,EAAY;AAC1D,eAAO2wB,UAAU,CAAC3wB,CAAD,CAAjB;AAAsB,OADJ,CAAP,CAAb;AAEAY,MAAAA,IAAI,CAACiwB,cAAL,GAAsBF,UAAtB;AACD,KALD,MAKO;AACL/vB,MAAAA,IAAI,CAACiwB,cAAL,GAAsBjwB,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAauC,MAAnC;AACD;AACF;;AAED,WAASsuB,qCAAT,CAA+C3vB,IAA/C,EAAqDuG,EAArD,EAAyDipB,KAAzD,EAAgE;AAC9D,QAAIU,WAAW,GAAG3pB,EAAE,GAAG,cAAvB;;AACA,QAAIipB,KAAJ,EAAW;AACT,UAAIW,EAAE,GAAG5pB,EAAE,KAAK,GAAP,GACP,CAACvG,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACwC,GAAnB,GAAyBxC,IAAI,CAACoC,MAA9B,GAAuCpC,IAAI,CAACsC,MAAL,GAAc,CAAtD,KAA4DtC,IAAI,CAAC0oB,kBAAL,CAAwBrnB,MAAxB,IAAkC,CAA9F,CADO,GAEP,CAACrB,IAAI,CAAC8C,KAAL,GAAa9C,IAAI,CAAC2C,IAAlB,GAAyB3C,IAAI,CAAC+C,KAA9B,GAAsC/C,IAAI,CAACsC,MAAL,GAAc,CAArD,KAA2DtC,IAAI,CAAC0oB,kBAAL,CAAwBrnB,MAAxB,IAAkC,CAA7F,CAFF;AAIArB,MAAAA,IAAI,CAACkwB,WAAD,CAAJ,GAAoBC,EAApB;AACD,KAND,MAMO;AACL,UAAIC,IAAI,GAAG,CAAC,IAAIpwB,IAAI,CAACuG,EAAE,GAAG,qBAAN,CAAT,IAAyCvG,IAAI,CAACqwB,aAAzD;AACArwB,MAAAA,IAAI,CAACkwB,WAAD,CAAJ,GAAoBlwB,IAAI,CAACiwB,cAAL,GAAsBG,IAAtB,GAA6BpwB,IAAI,CAACuG,EAAE,GAAG,2BAAN,CAAJ,GAAyC,CAAzC,GAA6C6pB,IAA9F,CAFK,CAE+F;AACrG;AACF;;AAED,WAASR,sCAAT,CAAgD5vB,IAAhD,EAAsDuG,EAAtD,EAA0D;AACxD;AACA,QAAI6pB,IAAI,GAAIpwB,IAAI,CAACuG,EAAE,GAAG,cAAN,CAAL,IAA+BvG,IAAI,CAACiwB,cAAL,GAAsBjwB,IAAI,CAACuG,EAAE,GAAG,2BAAN,CAAzD,CAAX;AACAvG,IAAAA,IAAI,CAACqwB,aAAL,GAAqBD,IAAI,GAAIA,IAAI,GAAGpwB,IAAI,CAACuG,EAAE,GAAG,qBAAN,CAAxC;AACD;;AAED,WAAS+nB,+BAAT,CAAyCtuB,IAAzC,EAA+CuG,EAA/C,EAAmD;AACjD,QAAI+pB,iBAAiB,GAAItwB,IAAI,CAACuG,EAAE,GAAG,cAAN,CAAL,IAA+BvG,IAAI,CAAC0oB,kBAAL,CAAwBrnB,MAAxB,IAAkC,CAAjE,CAAxB;AAEA,QAAIkvB,kBAAkB,GAAGhqB,EAAE,KAAK,GAAP,GACrBvG,IAAI,CAACwC,GAAL,GAAWxC,IAAI,CAACoC,MAAhB,GAAyBpC,IAAI,CAACsC,MAAL,GAAc,CADlB,GAErBtC,IAAI,CAAC2C,IAAL,GAAY3C,IAAI,CAAC+C,KAAjB,GAAyB/C,IAAI,CAACsC,MAAL,GAAc,CAF3C;AAIA,WAAOguB,iBAAiB,GAAGC,kBAApB,GACJvwB,IAAI,CAAC0oB,kBAAL,CAAwBrnB,MAAxB,GAAiCrB,IAAI,CAACuG,EAAE,GAAG,cAAN,CAArC,IAA8DvG,IAAI,CAACuG,EAAE,GAAG,0BAAN,CAAJ,GAAwCvG,IAAI,CAACuG,EAAE,GAAG,gCAAN,CAA1G,CADH;AAED;;AAED,WAASiqB,uDAAT,CAAiExwB,IAAjE,EAAuE,CACrE;AACD;;AAED,WAAS0T,IAAT,CAAc1T,IAAd,EAAoB;AAClB;;AACAA,IAAAA,IAAI,GAAG6I,SAAS,CAAC,CAAD,CAAhB;AACA7I,IAAAA,IAAI,GAAGiuB,2BAA2B,CAACjuB,IAAD,CAAlC,CAHkB,CAIlB;AACA;;AACA,QAAIsU,SAAS,GAAG9V,EAAE,CAACqF,MAAH,CAAU7D,IAAI,CAACiE,MAAf,CAAhB;AACAqrB,IAAAA,wBAAwB,CAAChb,SAAD,EAAYtU,IAAZ,CAAxB;AAEA,QAAIsD,GAAG,GAAGgR,SAAS,CAAC9Q,SAAV,CAAoB,KAApB,CAAV,CATkB,CAWlB;;AACA,QAAIxD,IAAI,CAAC2P,WAAL,KAAqB,aAAzB,EAAwC;AAAE4f,MAAAA,yBAAyB,CAACvvB,IAAD,EAAO,GAAP,CAAzB;AAAuC;;AACjF,QAAIA,IAAI,CAAC0P,WAAL,KAAqB,aAAzB,EAAwC;AAAE6f,MAAAA,yBAAyB,CAACvvB,IAAD,EAAO,GAAP,CAAzB;AAAuC;;AAEjFkuB,IAAAA,iBAAiB,CAACluB,IAAD,CAAjB;AACAouB,IAAAA,qBAAqB,CAACpuB,IAAD,CAArB;AACAuuB,IAAAA,sBAAsB,CAACvuB,IAAD,CAAtB;AAEAyuB,IAAAA,uCAAuC,CAACnrB,GAAD,EAAMtD,IAAN,CAAvC;AACAsD,IAAAA,GAAG,GAAGqrB,6BAA6B,CAACrrB,GAAD,EAAMtD,IAAN,CAAnC;AAEA4uB,IAAAA,8BAA8B,CAACtrB,GAAD,EAAMtD,IAAN,CAA9B;AACA6uB,IAAAA,qCAAqC,CAACvrB,GAAD,EAAMtD,IAAN,CAArC;AACA8uB,IAAAA,0BAA0B,CAACxrB,GAAD,EAAMtD,IAAN,CAA1B;AACA+uB,IAAAA,kCAAkC,CAACzrB,GAAD,CAAlC;AACAmZ,IAAAA,WAAW,CAACzc,IAAD,CAAX;AACAgvB,IAAAA,wBAAwB,CAAC1rB,GAAD,EAAMtD,IAAN,CAAxB;AAEA,WAAO,IAAP;AACD;;AAEDzB,EAAAA,EAAE,CAACmV,IAAH,GAAUA,IAAV;;AAEA,WAAS+c,eAAT,CAAyBrxB,CAAzB,EAA4B;AAC1B,WAAOA,CAAC,CAACmoB,KAAT;AACD;;AAED,WAASmJ,0BAAT,CAAoCptB,GAApC,EAAyC;AACvCA,IAAAA,GAAG,CAACE,SAAJ,CAAc,aAAd,EAA6BJ,MAA7B;AACAE,IAAAA,GAAG,CAACE,SAAJ,CAAc,eAAd,EAA+BJ,MAA/B;AACD;;AAED,WAASutB,WAAT,CAAqB3wB,IAArB,EAA2B;AACzB,WAAO,UAASZ,CAAT,EAAY;AACjB,aAAQY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAC,CAACY,IAAI,CAACO,UAAN,CAAf,KAAqCqC,gBAAgB,CAAC5C,IAAD,CAAtD,IAAkEA,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAC,CAACY,IAAI,CAACO,UAAN,CAAf,KAAqCyC,iBAAiB,CAAChD,IAAD,CAA/H;AACD,KAFD;AAGD;;AAED,WAAS4wB,aAAT,CAAuB5wB,IAAvB,EAA6B;AAC3B,WAAO,UAASZ,CAAT,EAAY;AACjB,aAAOY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAC,CAACY,IAAI,CAACO,UAAN,CAAf,CAAP;AACD,KAFD;AAGD;;AAED,WAASswB,mBAAT,CAA6B7wB,IAA7B,EAAmC;AACjC,QAAI8wB,SAAS,GAAGF,aAAa,CAAC5wB,IAAD,CAA7B;;AACA,WAAO,UAASZ,CAAT,EAAY;AACjB,aAAO0xB,SAAS,CAAC1xB,CAAD,CAAT,CAAa2jB,OAAb,CAAqB,CAArB,CAAP;AACD,KAFD;AAGD;;AAED,WAASgO,mBAAT,CAA6B/wB,IAA7B,EAAmC;AACjC,QAAIgxB,SAAS,GAAGhxB,IAAI,CAACkS,MAAL,CAAYuW,CAA5B;AACA,WAAO,UAASrpB,CAAT,EAAY;AACjB,aAAO4xB,SAAS,CAAC5xB,CAAC,CAAC6J,KAAH,CAAT,CAAmB8Z,OAAnB,CAA2B,CAA3B,CAAP;AACD,KAFD;AAGD;;AAED,WAASkO,oBAAT,CAA8BC,OAA9B,EAAuCC,UAAvC,EAAmDnxB,IAAnD,EAAyDsD,GAAzD,EAA8D8tB,QAA9D,EAAwEC,QAAxE,EAAkF;AAChF,QAAI1N,CAAJ;;AACA,QAAIuN,OAAJ,EAAa;AACXvN,MAAAA,CAAC,GAAGrgB,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBY,IAAhB,CAAqB,OAArB,EAA8B6sB,UAA9B,CAAJ;AACAC,MAAAA,QAAQ,CAACzN,CAAD,EAAI3jB,IAAJ,CAAR;AACAqxB,MAAAA,QAAQ,CAAC1N,CAAD,EAAI3jB,IAAJ,CAAR;AACD;AACF;;AAED,WAASsxB,gBAAT,CAA0BtxB,IAA1B,EAAgCsD,GAAhC,EAAqC;AACnC2tB,IAAAA,oBAAoB,CAACjxB,IAAI,CAACiS,OAAN,EAAe,YAAf,EAA6BjS,IAA7B,EAAmCsD,GAAnC,EAAwCiuB,qBAAxC,EAA+DC,oBAA/D,CAApB;AACD;;AAED,WAASC,kBAAT,CAA4BzxB,IAA5B,EAAkCsD,GAAlC,EAAuC;AACrC2tB,IAAAA,oBAAoB,CAACjxB,IAAI,CAACgS,SAAN,EAAiB,cAAjB,EAAiChS,IAAjC,EAAuCsD,GAAvC,EAA4CouB,uBAA5C,EAAqEC,sBAArE,CAApB;AACD;;AAED,WAASJ,qBAAT,CAA+BK,EAA/B,EAAmC5xB,IAAnC,EAAyC;AACvC,QAAI6xB,WAAW,GAAGhB,mBAAmB,CAAC7wB,IAAD,CAArC;AACA4xB,IAAAA,EAAE,CAACpuB,SAAH,CAAa,aAAb,EACG1E,IADH,CACQkB,IAAI,CAACiS,OAAL,CAAa9I,MAAb,CAAoBwnB,WAAW,CAAC3wB,IAAD,CAA/B,CADR,EAEGqE,KAFH,GAGGX,MAHH,CAGU,MAHV,EAIGY,IAJH,CAIQ,IAJR,EAIcutB,WAJd,EAKGvtB,IALH,CAKQ,IALR,EAKcutB,WALd,EAMGvtB,IANH,CAMQ,IANR,EAMctE,IAAI,CAACwC,GANnB,EAOG8B,IAPH,CAOQ,IAPR,EAOcjC,kBAAkB,CAACrC,IAAD,CAPhC,EAQGsE,IARH,CAQQ,OARR,EAQiB,UAASlF,CAAT,EAAY;AACzB,aAAOA,CAAC,CAAC0yB,SAAT;AACD,KAVH,EAWGxtB,IAXH,CAWQ,kBAXR,EAW4B,KAX5B;AAYD;;AAED,WAASktB,oBAAT,CAA8BI,EAA9B,EAAkC5xB,IAAlC,EAAwC;AACtC4xB,IAAAA,EAAE,CAACpuB,SAAH,CAAa,aAAb,EACG1E,IADH,CACQkB,IAAI,CAACiS,OAAL,CAAa9I,MAAb,CAAoBwnB,WAAW,CAAC3wB,IAAD,CAA/B,CADR,EAEGqE,KAFH,GAGGX,MAHH,CAGU,MAHV,EAIKY,IAJL,CAIU,OAJV,EAImB,UAASlF,CAAT,EAAY;AACzB,aAAOA,CAAC,CAAC2yB,SAAF,IAAe,EAAtB;AAA2B,KALjC,EAMKpuB,OANL,CAMa,gBANb,EAM+B,IAN/B,EAOKW,IAPL,CAOU,GAPV,EAOessB,aAAa,CAAC5wB,IAAD,CAP5B,EAQKsE,IARL,CAQU,GARV,EAQetE,IAAI,CAACwP,eAAL,KAAyB,QAAzB,GAAoCjN,UAAU,CAACvC,IAAD,CAAV,GAAmB,IAAvD,GAA8DkC,aAAa,CAAClC,IAAD,CAAb,GAAsBA,IAAI,CAACsC,MARxG,EASKgC,IATL,CASU,aATV,EASyB,QATzB,EAUKuB,IAVL,CAUU4qB,eAVV,EAWKtoB,IAXL,CAWU,UAAS/I,CAAT,EAAY;AAChB,UAAIA,CAAC,CAACgS,KAAN,EAAa;AACX5S,QAAAA,EAAE,CAACqF,MAAH,CAAU,IAAV,EAAgB8D,KAAhB,CAAsB,QAAtB,EAAgC,SAAhC,EACGqN,EADH,CACM,OADN,EACe5V,CAAC,CAACgS,KADjB;AAED;AACF,KAhBL;AAkBA/L,IAAAA,6BAA6B,CAACusB,EAAE,CAACpuB,SAAH,CAAa,iBAAb,EAAgCyrB,KAAhC,EAAD,EAA0CjvB,IAA1C,CAA7B;AACD;;AAED,WAAS0xB,uBAAT,CAAiCM,EAAjC,EAAqChyB,IAArC,EAA2C;AACzC,QAAIiyB,KAAK,GAAGlB,mBAAmB,CAAC/wB,IAAD,CAA/B;AACAgyB,IAAAA,EAAE,CAACxuB,SAAH,CAAa,eAAb,EACG1E,IADH,CACQkB,IAAI,CAACgS,SADb,EAEG3N,KAFH,GAEWX,MAFX,CAEkB,MAFlB,EAGGY,IAHH,CAGQ,IAHR,EAGc1B,gBAAgB,CAAC5C,IAAD,CAH9B,EAIGsE,IAJH,CAIQ,IAJR,EAIctB,iBAAiB,CAAChD,IAAD,CAJ/B,EAKGsE,IALH,CAKQ,IALR,EAKc2tB,KALd,EAMG3tB,IANH,CAMQ,IANR,EAMc2tB,KANd;AAOD;;AAED,WAASN,sBAAT,CAAgCK,EAAhC,EAAoChyB,IAApC,EAA0C;AACxC,QAAIiyB,KAAK,GAAGlB,mBAAmB,CAAC/wB,IAAD,CAA/B;AACAgyB,IAAAA,EAAE,CAACxuB,SAAH,CAAa,eAAb,EACG1E,IADH,CACQkB,IAAI,CAACgS,SADb,EAEG3N,KAFH,GAEWX,MAFX,CAEkB,MAFlB,EAGGY,IAHH,CAGQ,GAHR,EAGatB,iBAAiB,CAAChD,IAAD,CAH9B,EAIGsE,IAJH,CAIQ,GAJR,EAIa2tB,KAJb,EAKG3tB,IALH,CAKQ,IALR,EAKc,CAAC,CALf,EAMGA,IANH,CAMQ,aANR,EAMuB,KANvB,EAOGuB,IAPH,CAOQ4qB,eAPR;AAQD;;AAED,WAASxe,OAAT,CAAiBjS,IAAjB,EAAuB;AACrB;;AAEA,QAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACAysB,IAAAA,0BAA0B,CAACptB,GAAD,CAA1B;AACAguB,IAAAA,gBAAgB,CAACtxB,IAAD,EAAOsD,GAAP,CAAhB;AACAmuB,IAAAA,kBAAkB,CAACzxB,IAAD,EAAOsD,GAAP,CAAlB;AACA,WAAO,IAAP;AACD;;AAED/E,EAAAA,EAAE,CAAC0T,OAAH,GAAaA,OAAb;;AAEA,WAASigB,4BAAT,CAAsC5uB,GAAtC,EAA2C;AACzCA,IAAAA,GAAG,CAACE,SAAJ,CAAc,gCAAd,EAAgDA,SAAhD,CAA0D,GAA1D,EAA+DJ,MAA/D;AACD;;AAED,WAAS+uB,4BAAT,CAAsC7uB,GAAtC,EAA2CtD,IAA3C,EAAiD;AAC/CsD,IAAAA,GAAG,CAACO,MAAJ,CAAW,sBAAX,EAAmCT,MAAnC;AACA,QAAIgvB,WAAW,GAAGpyB,IAAI,CAAC+Q,eAAL,KAAyB,OAAzB,GACd,KADc,GAEb/Q,IAAI,CAAC+Q,eAAL,KAAyB,MAAzB,GACC,OADD,GAEC,QAJN;AAMA,QAAIshB,WAAW,GAAIryB,IAAI,CAAC+Q,eAAL,KAAyB,OAA1B,GACd/N,iBAAiB,CAAChD,IAAD,CADH,GAEbA,IAAI,CAAC+Q,eAAL,KAAyB,MAAzB,GACCnO,gBAAgB,CAAC5C,IAAD,CADjB,GAEC,CAACA,IAAI,CAAC8C,KAAL,GAAa9C,IAAI,CAAC2C,IAAlB,GAAyB3C,IAAI,CAAC+C,KAA/B,IAAwC,CAAxC,GAA4C/C,IAAI,CAAC2C,IAJvD;AAMA,QAAI2vB,gBAAgB,GAAGhvB,GAAG,CAACO,MAAJ,CAAW,gCAAX,EACpBH,MADoB,CACb,MADa,EAEpBY,IAFoB,CAEf,OAFe,EAEN,qBAFM,EAGpBA,IAHoB,CAGf,WAHe,EAGF,UAHE,EAIpBA,IAJoB,CAIf,aAJe,EAIA8tB,WAJA,CAAvB,CAd+C,CAoB/C;AACA;;AACA,QAAIG,wBAAwB,GAAG,IAA/B;AAEA,QAAIC,UAAU,GAAIxyB,IAAI,CAACwP,eAAL,KAAyB,QAA1B,GACbjN,UAAU,CAACvC,IAAD,CAAV,GAAmBuyB,wBADN,GAEbrwB,aAAa,CAAClC,IAAD,CAAb,GAAsBA,IAAI,CAACsC,MAAL,GAAc,CAFxC;;AAIA,QAAItC,IAAI,CAACiS,OAAT,EAAkB;AAChB,UAAIwgB,IAAJ;AACAnvB,MAAAA,GAAG,CAACE,SAAJ,CAAc,iBAAd,EACG2E,IADH,CACQ,YAAW;AACf,YAAI,CAACsqB,IAAL,EAAW;AACTA,UAAAA,IAAI,GAAGj0B,EAAE,CAACqF,MAAH,CAAU,IAAV,EAAgBS,IAAhB,CAAqB,GAArB,CAAP;AACD,SAFD,MAEO,IAAImuB,IAAI,KAAKj0B,EAAE,CAACqF,MAAH,CAAU,IAAV,EAAgBS,IAAhB,CAAqB,GAArB,CAAb,EAAwC;AAC7CiuB,UAAAA,wBAAwB,GAAG,IAA3B;AACD;AACF,OAPH;AAQD;;AAEDD,IAAAA,gBAAgB,CACbhuB,IADH,CACQ,WADR,EACqB,eAAe+tB,WAAf,GAA6B,GAA7B,GAAoCG,UAApC,GAAkD,GADvE;AAED;;AAED,WAASE,kBAAT,CAA4BpvB,GAA5B,EAAiCuC,IAAjC,EAAuC;AACrC,QAAI+F,KAAK,GAAG,EAAZ;AACA,QAAIrI,EAAE,GAAG,IAAT;AACA,QAAIsF,SAAS,CAACxH,MAAV,KAAqB,CAAzB,EAA4BkC,EAAE,GAAGsF,SAAS,CAAC,CAAD,CAAd;AAC5B+C,IAAAA,KAAK,GAAGtI,GAAG,CAACI,MAAJ,CAAW,OAAX,EAAoBmC,IAApB,CAAyBA,IAAzB,CAAR;AACA,QAAItC,EAAE,KAAK,IAAX,EAAiBqI,KAAK,CAACjI,OAAN,CAAcJ,EAAd,EAAkB,IAAlB;AACjB,SAAKqI,KAAL,GAAaA,KAAb;;AAEA,SAAK+mB,IAAL,GAAY,YAAW;AACrB,WAAK/mB,KAAL,CAAWtH,IAAX,CAAgB,aAAhB,EAA+B,MAA/B;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,SAAKsuB,SAAL,GAAiB,UAASC,GAAT,EAAc;AAC7B,WAAKjnB,KAAL,CAAWtH,IAAX,CAAgB,WAAhB,EAA6BuuB,GAA7B;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,SAAK3P,CAAL,GAAS,UAASA,CAAT,EAAY;AACnB,WAAKtX,KAAL,CAAWtH,IAAX,CAAgB,GAAhB,EAAqB4e,CAArB;AACA,aAAO,IAAP;AACD,KAHD;;AAIA,SAAKvX,CAAL,GAAS,UAASA,CAAT,EAAY;AACnB,WAAKC,KAAL,CAAWtH,IAAX,CAAgB,GAAhB,EAAqBqH,CAArB;AACA,aAAO,IAAP;AACD,KAHD;;AAIA,SAAKzI,IAAL,GAAY,YAAW;AACrB,aAAO,KAAK0I,KAAZ;AACD,KAFD;;AAGA,WAAO,IAAP;AACD;;AAED,WAASknB,uBAAT,CAAiCxvB,GAAjC,EAAsC;AACpC,QAAIyvB,aAAa,GAAGzvB,GAAG,CAACO,MAAJ,CAAW,sBAAX,CAApB;AACAkvB,IAAAA,aAAa,CACVvvB,SADH,CACa,GADb,EAEGJ,MAFH;AAGA,WAAO2vB,aAAP;AACD;;AAED,WAASC,gBAAT,CAA0BC,UAA1B,EAAsC3e,SAAtC,EAAiD4e,KAAjD,EAAwD;AACtD,QAAIxnB,UAAU,GAAG,GAAjB;AACA,SAAKwnB,KAAL,GAAaA,KAAb;AAEA,QAAIC,GAAG,GAAG7e,SAAS,CAAC5Q,MAAV,CAAiB,OAAjB,EACPY,IADO,CACF,GADE,EACG,CADH,EAEPA,IAFO,CAEF,GAFE,EAEI2uB,UAAU,GAAGvnB,UAAd,GAA4B,IAF/B,CAAV;;AAIA,SAAK7F,IAAL,GAAY,UAASA,IAAT,EAAe;AACzB,aAAO6sB,kBAAkB,CAACS,GAAD,EAAMttB,IAAN,CAAzB;AACD,KAFD;;AAGA,WAAO,IAAP;AACD;;AAED,WAASutB,iBAAT,CAA2BpzB,IAA3B,EAAiCkzB,KAAjC,EAAwC;AACtC,QAAIxnB,UAAU,GAAG,GAAjB;AACA,SAAKunB,UAAL,GAAkB,CAAlB;AACA,SAAKC,KAAL,GAAaA,KAAb;AACAf,IAAAA,4BAA4B,CAACe,KAAK,CAAC5vB,GAAP,EAAYtD,IAAZ,CAA5B;AAEA,SAAKqzB,cAAL,GAAsBP,uBAAuB,CAACI,KAAK,CAAC5vB,GAAP,CAA7C;;AAEA,SAAKgwB,aAAL,GAAqB,UAASJ,KAAT,EAAgB;AACnC,UAAItc,IAAI,GAAG,IAAX;AACA,UAAIuc,GAAG,GAAGH,gBAAgB,CAACpc,IAAI,CAACqc,UAAN,EAAkBrc,IAAI,CAACyc,cAAvB,EAAuCH,KAAvC,CAA1B;AACAtc,MAAAA,IAAI,CAACqc,UAAL,IAAmB,CAAnB;AACA,aAAOE,GAAP;AACD,KALD;;AAOA,WAAO,IAAP;AACD;;AAED,WAASI,sBAAT,GAAkC;AAChC,QAAIC,OAAO,GAAG,EAAd;AAEA,QAAIC,QAAJ;;AACA,QAAI,OAAOC,gBAAP,KAA4B,WAAhC,EAA6C;AAC3CD,MAAAA,QAAQ,GAAGC,gBAAX;AACD,KAFD,MAEO,IAAI,OAAOC,sBAAP,KAAkC,WAAtC,EAAmD;AACxDF,MAAAA,QAAQ,GAAGE,sBAAX;AACD;;AAED,aAASC,eAAT,GAA2B;AACzBJ,MAAAA,OAAO,CAAC/qB,OAAR,CAAgB,UAASxE,MAAT,EAAiB;AAC/B,YAAIX,GAAG,GAAG9E,EAAE,CAACqF,MAAH,CAAUI,MAAV,EAAkBJ,MAAlB,CAAyB,KAAzB,CAAV,CAD+B,CAG/B;;AACA,YAAI,CAACP,GAAG,CAACorB,KAAJ,EAAD,KAAiBprB,GAAG,CAAC4B,IAAJ,GAAW2uB,UAAX,CAAsBhc,WAAtB,GAAoC,CAApC,IAAyCvU,GAAG,CAAC4B,IAAJ,GAAW2uB,UAAX,CAAsB9b,YAAtB,GAAqC,CAA/F,CAAJ,EAAuG;AACrG,cAAI+b,MAAM,GAAGxwB,GAAG,CAACgB,IAAJ,CAAS,OAAT,MAAsB,CAAtB,GAA2BhB,GAAG,CAACgB,IAAJ,CAAS,QAAT,IAAqBhB,GAAG,CAACgB,IAAJ,CAAS,OAAT,CAAhD,GAAqE,CAAlF;AAEA,cAAIyvB,QAAQ,GAAGnsB,SAAS,CAAC3D,MAAD,CAAxB;AAEAX,UAAAA,GAAG,CAACgB,IAAJ,CAAS,OAAT,EAAkByvB,QAAlB;AACAzwB,UAAAA,GAAG,CAACgB,IAAJ,CAAS,QAAT,EAAmBwvB,MAAM,GAAGC,QAA5B;AACD;AACF,OAZD;AAaD;;AAED,aAASC,aAAT,CAAuB/vB,MAAvB,EAA+B;AAC7B,UAAIgwB,KAAK,GAAGT,OAAO,CAACzJ,OAAR,CAAgB9lB,MAAhB,CAAZ;;AACA,UAAIgwB,KAAK,KAAK,CAAC,CAAf,EAAkB;AAChBT,QAAAA,OAAO,CAACU,MAAR,CAAeD,KAAf,EAAsB,CAAtB;AACD;;AAED,UAAIT,OAAO,CAACnyB,MAAR,KAAmB,CAAvB,EAA0B;AACxB5C,QAAAA,MAAM,CAAC01B,mBAAP,CAA2B,QAA3B,EAAqCP,eAArC,EAAsD,IAAtD;AACD;AACF;;AAED,WAAO;AACLQ,MAAAA,UAAU,EAAE,UAASnwB,MAAT,EAAiB;AAC3B,YAAIuvB,OAAO,CAACnyB,MAAR,KAAmB,CAAvB,EAA0B;AACxB5C,UAAAA,MAAM,CAAC41B,gBAAP,CAAwB,QAAxB,EAAkCT,eAAlC,EAAmD,IAAnD;AACD;;AAED,YAAIJ,OAAO,CAACzJ,OAAR,CAAgB9lB,MAAhB,MAA4B,CAAC,CAAjC,EAAoC;AAClCuvB,UAAAA,OAAO,CAAClpB,IAAR,CAAarG,MAAb;;AAEA,cAAIwvB,QAAJ,EAAc;AACZ,gBAAIa,QAAQ,GAAG,IAAIb,QAAJ,CAAa,UAASc,SAAT,EAAoB;AAC9C,kBAAIC,UAAU,GAAGh2B,EAAE,CAACqF,MAAH,CAAUI,MAAV,EAAkBiB,IAAlB,EAAjB;;AAEA,kBAAI,CAACsvB,UAAD,IAAeD,SAAS,CAACE,IAAV,CACf,UAASC,QAAT,EAAmB;AACjB,qBAAK,IAAIvvB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuvB,QAAQ,CAACC,YAAT,CAAsBtzB,MAA1C,EAAkD8D,CAAC,EAAnD,EAAuD;AACrD,sBAAIuvB,QAAQ,CAACC,YAAT,CAAsBxvB,CAAtB,MAA6BqvB,UAAjC,EAA6C;AAC3C,2BAAO,IAAP;AACD;AACF;AACF,eAPc,CAAnB,EAOQ;AACNF,gBAAAA,QAAQ,CAACM,UAAT;AACAZ,gBAAAA,aAAa,CAAC/vB,MAAD,CAAb;AACD;AACF,aAdc,CAAf;AAgBAqwB,YAAAA,QAAQ,CAACO,OAAT,CAAiBr2B,EAAE,CAACqF,MAAH,CAAUI,MAAV,EAAkBiB,IAAlB,GAAyB2uB,UAA1C,EAAsD;AAAEiB,cAAAA,SAAS,EAAE;AAAb,aAAtD;AACD;AACF;AACF;AA7BI,KAAP;AA+BD;;AAED,MAAIC,wBAAwB,GAAG,IAAIxB,sBAAJ,EAA/B;;AAEA,WAASyB,mBAAT,CAA6Bh1B,IAA7B,EAAmC;AACjCi1B,IAAAA,6BAA6B,CAACj1B,IAAD,CAA7B;AACD;;AAED,WAASi1B,6BAAT,CAAuCj1B,IAAvC,EAA6C;AAC3C;AACA,QAAIA,IAAI,CAACqO,UAAL,IAAmBrO,IAAI,CAACsO,WAA5B,EAAyC;AACvCymB,MAAAA,wBAAwB,CAACX,UAAzB,CAAoCp0B,IAAI,CAACiE,MAAzC;AACD;AACF;;AAED,MAAIrE,gBAAgB,EAApB,EAAwB;AACpB;AACJ;AACA;AACA;AACA;;AAEI;AACJ;AACA;AACA;;AAEI;AACJ;AACA;AACA;AACA;AACA;AACA;AAGI,KAAC,UAAUE,CAAV,EAAa;AACZ;;AAEA,UAAG,OAAOA,CAAC,GAAGo1B,QAAX,IAAuB,UAA1B,EACE,OAAO,IAAP,CAJU,CAMZ;AACA;;AAEA,UAAIC,QAAQ,GAAG,oBAAf;AACA,UAAIjgB,MAAM,GAAK,0BAAf;;AACA,UAAIkgB,QAAQ,GAAG,UAAUpvB,OAAV,EAAmB;AAChClG,QAAAA,CAAC,CAACkG,OAAD,CAAD,CAAWgP,EAAX,CAAc,mBAAd,EAAmC,KAAKE,MAAxC;AACD,OAFD;;AAIAkgB,MAAAA,QAAQ,CAACzhB,OAAT,GAAmB,OAAnB;;AAEAyhB,MAAAA,QAAQ,CAACp0B,SAAT,CAAmBkU,MAAnB,GAA4B,UAAUmB,CAAV,EAAa;AACvC,YAAIwF,KAAK,GAAG/b,CAAC,CAAC,IAAD,CAAb;AAEA,YAAI+b,KAAK,CAACwZ,EAAN,CAAS,sBAAT,CAAJ,EAAsC;AAEtC,YAAIC,OAAO,GAAIC,SAAS,CAAC1Z,KAAD,CAAxB;AACA,YAAI2Z,QAAQ,GAAGF,OAAO,CAACrf,QAAR,CAAiB,MAAjB,CAAf;AAEAwf,QAAAA,UAAU;;AAEV,YAAI,CAACD,QAAL,EAAe;AACb,cAAI,kBAAkB1gB,QAAQ,CAAC4B,eAA3B,IAA8C,CAAC4e,OAAO,CAACI,OAAR,CAAgB,aAAhB,EAA+Br0B,MAAlF,EAA0F;AACxF;AACAvB,YAAAA,CAAC,CAAC,kCAAD,CAAD,CAAsC2X,WAAtC,CAAkD3X,CAAC,CAAC,IAAD,CAAnD,EAA2DkV,EAA3D,CAA8D,OAA9D,EAAuEygB,UAAvE;AACD;;AAED,cAAIE,aAAa,GAAG;AAAEA,YAAAA,aAAa,EAAE;AAAjB,WAApB;AACAL,UAAAA,OAAO,CAACphB,OAAR,CAAgBmC,CAAC,GAAGvW,CAAC,CAACiW,KAAF,CAAQ,kBAAR,EAA4B4f,aAA5B,CAApB;AAEA,cAAItf,CAAC,CAACM,kBAAF,EAAJ,EAA4B;AAE5BkF,UAAAA,KAAK,CACF3H,OADH,CACW,OADX,EAEG5P,IAFH,CAEQ,eAFR,EAEyB,MAFzB;AAIAgxB,UAAAA,OAAO,CACJM,WADH,CACe,MADf,EAEG1hB,OAFH,CAEW,mBAFX,EAEgCyhB,aAFhC;AAGD;;AAED,eAAO,KAAP;AACD,OA/BD;;AAiCAP,MAAAA,QAAQ,CAACp0B,SAAT,CAAmB60B,OAAnB,GAA6B,UAAUxf,CAAV,EAAa;AACxC,YAAI,CAAC,gBAAgBe,IAAhB,CAAqBf,CAAC,CAACmZ,KAAvB,CAAD,IAAkC,kBAAkBpY,IAAlB,CAAuBf,CAAC,CAACpS,MAAF,CAASkW,OAAhC,CAAtC,EAAgF;AAEhF,YAAI0B,KAAK,GAAG/b,CAAC,CAAC,IAAD,CAAb;AAEAuW,QAAAA,CAAC,CAACyf,cAAF;AACAzf,QAAAA,CAAC,CAAC0f,eAAF;AAEA,YAAIla,KAAK,CAACwZ,EAAN,CAAS,sBAAT,CAAJ,EAAsC;AAEtC,YAAIC,OAAO,GAAIC,SAAS,CAAC1Z,KAAD,CAAxB;AACA,YAAI2Z,QAAQ,GAAGF,OAAO,CAACrf,QAAR,CAAiB,MAAjB,CAAf;;AAEA,YAAK,CAACuf,QAAD,IAAanf,CAAC,CAACmZ,KAAF,IAAW,EAAzB,IAAiCgG,QAAQ,IAAInf,CAAC,CAACmZ,KAAF,IAAW,EAA5D,EAAiE;AAC/D,cAAInZ,CAAC,CAACmZ,KAAF,IAAW,EAAf,EAAmB8F,OAAO,CAACzb,IAAR,CAAa3E,MAAb,EAAqBhB,OAArB,CAA6B,OAA7B;AACnB,iBAAO2H,KAAK,CAAC3H,OAAN,CAAc,OAAd,CAAP;AACD;;AAED,YAAI8hB,IAAI,GAAG,6BAAX;AACA,YAAIC,MAAM,GAAGX,OAAO,CAACzb,IAAR,CAAa,kBAAkBmc,IAAlB,GAAyB,oBAAzB,GAAgDA,IAA7D,CAAb;AAEA,YAAI,CAACC,MAAM,CAAC50B,MAAZ,EAAoB;AAEpB,YAAI4yB,KAAK,GAAGgC,MAAM,CAAChC,KAAP,CAAa5d,CAAC,CAACpS,MAAf,CAAZ;AAEA,YAAIoS,CAAC,CAACmZ,KAAF,IAAW,EAAX,IAAiByE,KAAK,GAAG,CAA7B,EAAgDA,KAAK,GAzBb,CAyBwC;;AAChF,YAAI5d,CAAC,CAACmZ,KAAF,IAAW,EAAX,IAAiByE,KAAK,GAAGgC,MAAM,CAAC50B,MAAP,GAAgB,CAA7C,EAAgD4yB,KAAK,GA1Bb,CA0BwC;;AAChF,YAAI,CAAC,CAACA,KAAN,EAAkDA,KAAK,GAAG,CAAR;AAElDgC,QAAAA,MAAM,CAACC,EAAP,CAAUjC,KAAV,EAAiB/f,OAAjB,CAAyB,OAAzB;AACD,OA9BD;;AAgCA,eAASuhB,UAAT,CAAoBpf,CAApB,EAAuB;AACrB,YAAIA,CAAC,IAAIA,CAAC,CAACmZ,KAAF,KAAY,CAArB,EAAwB;AACxB1vB,QAAAA,CAAC,CAACq1B,QAAD,CAAD,CAAY/xB,MAAZ;AACAtD,QAAAA,CAAC,CAACoV,MAAD,CAAD,CAAU/M,IAAV,CAAe,YAAY;AACzB,cAAI0T,KAAK,GAAW/b,CAAC,CAAC,IAAD,CAArB;AACA,cAAIw1B,OAAO,GAASC,SAAS,CAAC1Z,KAAD,CAA7B;AACA,cAAI8Z,aAAa,GAAG;AAAEA,YAAAA,aAAa,EAAE;AAAjB,WAApB;AAEA,cAAI,CAACL,OAAO,CAACrf,QAAR,CAAiB,MAAjB,CAAL,EAA+B;AAE/Bqf,UAAAA,OAAO,CAACphB,OAAR,CAAgBmC,CAAC,GAAGvW,CAAC,CAACiW,KAAF,CAAQ,kBAAR,EAA4B4f,aAA5B,CAApB;AAEA,cAAItf,CAAC,CAACM,kBAAF,EAAJ,EAA4B;AAE5BkF,UAAAA,KAAK,CAACvX,IAAN,CAAW,eAAX,EAA4B,OAA5B;AACAgxB,UAAAA,OAAO,CAACpd,WAAR,CAAoB,MAApB,EAA4BhE,OAA5B,CAAoC,oBAApC,EAA0DyhB,aAA1D;AACD,SAbD;AAcD;;AAED,eAASJ,SAAT,CAAmB1Z,KAAnB,EAA0B;AACxB,YAAI7H,QAAQ,GAAG6H,KAAK,CAACvX,IAAN,CAAW,aAAX,CAAf;;AAEA,YAAI,CAAC0P,QAAL,EAAe;AACbA,UAAAA,QAAQ,GAAG6H,KAAK,CAACvX,IAAN,CAAW,MAAX,CAAX;AACA0P,UAAAA,QAAQ,GAAGA,QAAQ,IAAI,YAAYoD,IAAZ,CAAiBpD,QAAjB,CAAZ,IAA0CA,QAAQ,CAACxM,OAAT,CAAiB,gBAAjB,EAAmC,EAAnC,CAArD,CAFa,CAEgF;AAC9F;;AAED,YAAI8tB,OAAO,GAAGthB,QAAQ,IAAIlU,CAAC,CAACkU,QAAD,CAA3B;AAEA,eAAOshB,OAAO,IAAIA,OAAO,CAACj0B,MAAnB,GAA4Bi0B,OAA5B,GAAsCzZ,KAAK,CAACsa,MAAN,EAA7C;AACD,OAhHW,CAmHZ;AACA;;;AAEA,eAASxa,MAAT,CAAgBC,MAAhB,EAAwB;AACtB,eAAO,KAAKzT,IAAL,CAAU,YAAY;AAC3B,cAAI0T,KAAK,GAAG/b,CAAC,CAAC,IAAD,CAAb;AACA,cAAIhB,IAAI,GAAI+c,KAAK,CAAC/c,IAAN,CAAW,aAAX,CAAZ;AAEA,cAAI,CAACA,IAAL,EAAW+c,KAAK,CAAC/c,IAAN,CAAW,aAAX,EAA2BA,IAAI,GAAG,IAAIs2B,QAAJ,CAAa,IAAb,CAAlC;AACX,cAAI,OAAOxZ,MAAP,IAAiB,QAArB,EAA+B9c,IAAI,CAAC8c,MAAD,CAAJ,CAAa1a,IAAb,CAAkB2a,KAAlB;AAChC,SANM,CAAP;AAOD;;AAED,UAAIC,GAAG,GAAGhc,CAAC,CAACic,EAAF,CAAKmZ,QAAf;AAEAp1B,MAAAA,CAAC,CAACic,EAAF,CAAKmZ,QAAL,GAA4BvZ,MAA5B;AACA7b,MAAAA,CAAC,CAACic,EAAF,CAAKmZ,QAAL,CAAcjZ,WAAd,GAA4BmZ,QAA5B,CAnIY,CAsIZ;AACA;;AAEAt1B,MAAAA,CAAC,CAACic,EAAF,CAAKmZ,QAAL,CAAchZ,UAAd,GAA2B,YAAY;AACrCpc,QAAAA,CAAC,CAACic,EAAF,CAAKmZ,QAAL,GAAgBpZ,GAAhB;AACA,eAAO,IAAP;AACD,OAHD,CAzIY,CA+IZ;AACA;;;AAEAhc,MAAAA,CAAC,CAACgV,QAAD,CAAD,CACGE,EADH,CACM,4BADN,EACoCygB,UADpC,EAEGzgB,EAFH,CAEM,4BAFN,EAEoC,gBAFpC,EAEsD,UAAUqB,CAAV,EAAa;AAAEA,QAAAA,CAAC,CAAC0f,eAAF;AAAsB,OAF3F,EAGG/gB,EAHH,CAGM,4BAHN,EAGoCE,MAHpC,EAG4CkgB,QAAQ,CAACp0B,SAAT,CAAmBkU,MAH/D,EAIGF,EAJH,CAIM,8BAJN,EAIsCE,MAJtC,EAI8CkgB,QAAQ,CAACp0B,SAAT,CAAmB60B,OAJjE,EAKG7gB,EALH,CAKM,8BALN,EAKsC,eALtC,EAKuDogB,QAAQ,CAACp0B,SAAT,CAAmB60B,OAL1E,EAMG7gB,EANH,CAMM,8BANN,EAMsC,kBANtC,EAM0DogB,QAAQ,CAACp0B,SAAT,CAAmB60B,OAN7E;AAQD,KA1JA,CA0JCh2B,MA1JD,CAAD;AA2JH;;AAEDtB,EAAAA,EAAE,CAAC63B,aAAH,GAAmB,UAASnyB,MAAT,EAAiB;AAClC;;AACA,SAAKA,MAAL,GAAcA,MAAd;AACA,SAAKoyB,WAAL,GAAmB,EAAnB;AACA,SAAKC,WAAL,GAAmB,EAAnB;AACA,SAAKC,OAAL,GAAe,EAAf;AACA,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,UAAL,GAAkB,EAAlB;AACA,SAAKC,eAAL,GAAuB,EAAvB;;AAEA,SAAKC,kBAAL,GAA0B,UAASC,CAAT,EAAY;AACpC,UAAIC,eAAe,GAAGD,CAAC,CAACpvB,OAAF,CAAU,kBAAV,EAA8B,EAA9B,CAAtB;AACA,UAAIsvB,WAAW,GAAGD,eAAe,CAACrvB,OAAhB,CAAwB,MAAxB,EAAgC,EAAhC,CAAlB;AACA,aAAOsvB,WAAP;AACD,KAJD;;AAMA,SAAKh4B,IAAL,GAAY,UAASA,IAAT,EAAe;AACzB,WAAKi4B,KAAL,GAAaj4B,IAAb;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,SAAKk4B,aAAL,GAAqB,UAASC,OAAT,EAAkBZ,WAAlB,EAA+Bvc,QAA/B,EAAyC;AAC5D,WAAKuc,WAAL,CAAiBY,OAAjB,IAA4BZ,WAA5B;AACA,WAAKI,UAAL,CAAgB,KAAKE,kBAAL,CAAwBM,OAAxB,CAAhB,IAAoDA,OAApD;AACA,WAAKP,eAAL,CAAqBO,OAArB,IAAgCnd,QAAhC,CAH4D,CAGlB;;AAC1C,aAAO,IAAP;AACD,KALD;;AAOA,SAAKod,MAAL,GAAc,UAASD,OAAT,EAAkB;AAC9B,UAAIpuB,SAAS,CAACxH,MAAV,GAAmB,CAAvB,EAA0B;AACxB,aAAKi1B,WAAL,CAAiBW,OAAjB,IAA4BpuB,SAAS,CAAC,CAAD,CAArC;AACD;;AAED,UAAIA,SAAS,CAACxH,MAAV,GAAmB,CAAvB,EAA0B;AACxB,aAAKk1B,OAAL,CAAaU,OAAb,IAAwBpuB,SAAS,CAAC,CAAD,CAAjC;AACD;;AAED,WAAKwtB,WAAL,CAAiBY,OAAjB,IAA4B,EAA5B;AACA,aAAO,IAAP;AACD,KAXD;;AAaA,SAAKnd,QAAL,GAAgB,UAASA,QAAT,EAAmB;AACjC,WAAKqd,SAAL,GAAiBrd,QAAjB;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,SAAKvC,OAAL,GAAe,YAAW;AACxB,UAAIuC,QAAQ,GAAG,KAAKqd,SAApB;AACA,UAAIT,eAAe,GAAG,KAAKA,eAA3B;AACA,UAAID,UAAU,GAAG,KAAKA,UAAtB;AAEA,UAAIr3B,CAAJ,EAAOg4B,CAAP,EAAUC,QAAV,EAAoBC,IAApB;AACAD,MAAAA,QAAQ,GAAGt2B,MAAM,CAACivB,IAAP,CAAY,KAAKqG,WAAjB,CAAX;;AAEA,UAAIkB,OAAO,GAAG,UAASH,CAAT,EAAY;AACxB,eAAOh4B,CAAC,CAACg4B,CAAD,CAAR;AAAc,OADhB;;AAGA,UAAIjyB,CAAJ,CAXwB,CAaxB;;AACA,WAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG,KAAK4xB,KAAL,CAAW11B,MAA3B,EAAmC8D,CAAC,EAApC,EAAwC;AACtC/F,QAAAA,CAAC,GAAG,KAAK23B,KAAL,CAAW5xB,CAAX,CAAJ;AACAiyB,QAAAA,CAAC,GAAGC,QAAQ,CAACl4B,GAAT,CAAao4B,OAAb,CAAJ;;AACA,aAAK,IAAIzxB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuxB,QAAQ,CAACh2B,MAA7B,EAAqCyE,CAAC,EAAtC,EAA0C;AACxCwxB,UAAAA,IAAI,GAAGD,QAAQ,CAACvxB,CAAD,CAAf;;AACA,cAAI,KAAKuwB,WAAL,CAAiBiB,IAAjB,EAAuBvN,OAAvB,CAA+BqN,CAAC,CAACtxB,CAAD,CAAhC,MAAyC,CAAC,CAA9C,EAAiD;AAC/C,iBAAKuwB,WAAL,CAAiBiB,IAAjB,EAAuBhtB,IAAvB,CAA4B8sB,CAAC,CAACtxB,CAAD,CAA7B;AACD;AACF;AACF;;AAED,WAAKwxB,IAAL,IAAa,KAAKjB,WAAlB,EAA+B;AAC7B,YAAI,KAAKE,OAAL,CAAatsB,cAAb,CAA4BqtB,IAA5B,CAAJ,EAAuC;AACrC,eAAKjB,WAAL,CAAiBiB,IAAjB,EAAuB9xB,IAAvB,CAA4B,KAAK+wB,OAAL,CAAae,IAAb,CAA5B;AACD;AACF;;AAEDx3B,MAAAA,CAAC,CAAC,KAAKmE,MAAN,CAAD,CAAeyqB,KAAf;AAEA5uB,MAAAA,CAAC,CAAC,KAAKmE,MAAN,CAAD,CAAeP,MAAf,CAAsB,oDAAtB;;AAEA,UAAI8zB,gBAAgB,GAAG,YAAW;AAChC,YAAI9uB,CAAC,GAAG5I,CAAC,CAAC,IAAD,CAAD,CAAQhB,IAAR,CAAa,KAAb,CAAR;AACA,YAAIm4B,OAAO,GAAGn3B,CAAC,CAAC,IAAD,CAAD,CAAQhB,IAAR,CAAa,SAAb,CAAd;AACA,YAAI24B,cAAJ;AACA33B,QAAAA,CAAC,CAAC,MAAMm3B,OAAN,GAAgB,6BAAjB,CAAD,CAAiD5iB,IAAjD,CAAsD3L,CAAtD;;AACA,YAAI,CAAC+tB,UAAU,CAACxsB,cAAX,CAA0BgtB,OAA1B,CAAL,EAAyC;AACvCnd,UAAAA,QAAQ,CAACmd,OAAD,EAAUvuB,CAAV,CAAR;AACD,SAFD,MAEO;AACL+uB,UAAAA,cAAc,GAAGhB,UAAU,CAACQ,OAAD,CAA3B;AACAP,UAAAA,eAAe,CAACe,cAAD,CAAf,CAAgC/uB,CAAhC;AACD;;AAED,eAAO,KAAP;AACD,OAbD;;AAeA,WAAK,IAAIuuB,OAAT,IAAoB,KAAKZ,WAAzB,EAAsC;AACpCgB,QAAAA,QAAQ,GAAG,KAAKhB,WAAL,CAAiBY,OAAjB,CAAX;AACAn3B,QAAAA,CAAC,CAAC,KAAKmE,MAAL,GAAc,eAAf,CAAD,CAAiCP,MAAjC,CACE,2BAA2B,KAAKizB,kBAAL,CAAwBM,OAAxB,CAA3B,GAA8D,mBAA9D,GAAoF;AACpF,sGADA,GAEA,6BAFA,IAEiC,KAAKX,WAAL,CAAiBrsB,cAAjB,CAAgCgtB,OAAhC,IAA2C,KAAKX,WAAL,CAAiBW,OAAjB,CAA3C,GAAuEA,OAFxG,IAEmH,SAFnH,GAGA,sBAHA,IAG0B,KAAKP,eAAL,CAAqBzsB,cAArB,CAAoCgtB,OAApC,IAA+C,KAAKZ,WAAL,CAAiBY,OAAjB,EAA0B,CAA1B,CAA/C,GAA8E,KAHxG,IAGiH,SAHjH,GAG6H;AAC7H,qCAJA,GAKA,WALA,GAMA,wCANA,IAOC,CAAC,KAAKP,eAAL,CAAqBzsB,cAArB,CAAoCgtB,OAApC,CAAD,GAAgD,mCAAmCA,OAAnC,GAA6C,+BAA7F,GAA+H,EAPhI,KAQC,CAAC,KAAKP,eAAL,CAAqBzsB,cAArB,CAAoCgtB,OAApC,CAAD,GAAgD,2BAAhD,GAA8E,EAR/E,IASA,OATA,GASU,QAVZ;;AAYA,aAAK9xB,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGkyB,QAAQ,CAACh2B,MAAzB,EAAiC8D,CAAC,EAAlC,EAAsC;AACpC,cAAIkyB,QAAQ,CAAClyB,CAAD,CAAR,KAAgB,KAAhB,IAAyBkyB,QAAQ,CAAClyB,CAAD,CAAR,KAAgBgY,SAA7C,EAAwD;AAAE;AACxDrd,YAAAA,CAAC,CAAC,KAAKmE,MAAL,GAAc,OAAd,GAAwB,KAAK0yB,kBAAL,CAAwBM,OAAxB,CAAxB,GAA2D,wBAA5D,CAAD,CAAuFvzB,MAAvF,CACE,mCAAmC,KAAKizB,kBAAL,CAAwBM,OAAxB,CAAnC,GAAsE,cAAtE,GAAuFI,QAAQ,CAAClyB,CAAD,CAA/F,GAAqG,IAArG,GAA4GkyB,QAAQ,CAAClyB,CAAD,CAApH,GAA0H,WAD5H;AAGD;AACF;;AAEDrF,QAAAA,CAAC,CAAC,MAAM,KAAK62B,kBAAL,CAAwBM,OAAxB,CAAN,GAAyC,2BAA1C,CAAD,CAAwEjiB,EAAxE,CAA2E,OAA3E,EAAoFwiB,gBAApF;AACD;;AAED,aAAO,IAAP;AACD,KA5ED;;AA8EA,WAAO,IAAP;AACD,GA7HD;;AA+HA,GAAC,YAAW;AACV;;AAEA,aAASE,kBAAT,CAA4Bx0B,IAA5B,EAAkC9D,CAAlC,EAAqCY,IAArC,EAA2C;AACzCkD,MAAAA,IAAI,CAACS,OAAL,CAAa,kBAAkBvE,CAAC,CAACu4B,OAApB,GAA8B,QAA3C,EAAqD33B,IAAI,CAAC0S,MAAL,KAAgB,IAArE,EACGpO,IADH,CACQ,MADR,EACgBtE,IAAI,CAAC0S,MAAL,KAAgB,IAAhB,GAAuB,EAAvB,GAA4B1S,IAAI,CAAC0S,MAAL,CAAYtT,CAAC,CAACu4B,OAAF,GAAY,CAAxB,CAD5C;AAED;;AAED,aAASC,wBAAT,CAAkC53B,IAAlC,EAAwC63B,IAAxC,EAA8Cv0B,GAA9C,EAAmD;AACjDw0B,MAAAA,qBAAqB,CAAC93B,IAAD,EAAO63B,IAAP,CAArB;AACAE,MAAAA,qBAAqB,CAAC/3B,IAAD,EAAO63B,IAAP,CAArB;AACAG,MAAAA,0BAA0B,CAACh4B,IAAD,EAAO63B,IAAP,CAA1B;AACAI,MAAAA,gCAAgC,CAACj4B,IAAD,EAAO63B,IAAP,EAAav0B,GAAb,CAAhC;AACD;;AAED,aAAS20B,gCAAT,CAA0Cj4B,IAA1C,EAAgD63B,IAAhD,EAAsDv0B,GAAtD,EAA2D;AACzDu0B,MAAAA,IAAI,CAACK,aAAL,GAAqB50B,GAAG,CAACE,SAAJ,CAAc,qBAAd,EAAqCyrB,KAArC,EAArB;;AACA,UAAIjvB,IAAI,CAACsR,oBAAT,EAA+B;AAC7BumB,QAAAA,IAAI,CAACM,eAAL,GAAuB35B,EAAE,CAACgT,IAAH,GACpB4mB,OADoB,CACZP,IAAI,CAACrsB,IAAL,CAAU4sB,OAAV,EADY,EAEpBlV,CAFoB,CAElBljB,IAAI,CAAC0E,QAAL,CAAcwlB,EAFI,EAGpBmO,EAHoB,CAGjB,UAASj5B,CAAT,EAAY;AACd,cAAIk5B,CAAC,GAAGt4B,IAAI,CAACsR,oBAAL,CAA0B,CAA1B,CAAR;;AACA,cAAIlS,CAAC,CAACk5B,CAAD,CAAD,IAAQnb,SAAZ,EAAuB;AACrB,mBAAOnd,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrpB,CAAC,CAACk5B,CAAD,CAAf,CAAP;AACD,WAFD,MAEO;AACL,mBAAOt4B,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrpB,CAAC,CAACY,IAAI,CAACU,UAAN,CAAf,CAAP;AACD;AACF,SAVoB,EAWpBiiB,EAXoB,CAWjB,UAASvjB,CAAT,EAAY;AACd,cAAIm5B,CAAC,GAAGv4B,IAAI,CAACsR,oBAAL,CAA0B,CAA1B,CAAR;;AACA,cAAIlS,CAAC,CAACm5B,CAAD,CAAD,IAAQpb,SAAZ,EAAuB;AACrB,mBAAOnd,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrpB,CAAC,CAACm5B,CAAD,CAAf,CAAP;AACD,WAFD,MAEO;AACL,mBAAOv4B,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrpB,CAAC,CAACY,IAAI,CAACU,UAAN,CAAf,CAAP;AACD;AACF,SAlBoB,EAmBpB83B,KAnBoB,CAmBdx4B,IAAI,CAACsS,WAnBS,CAAvB;AAoBD;AACF;;AAED,aAASylB,qBAAT,CAA+B/3B,IAA/B,EAAqC63B,IAArC,EAA2C;AACzCA,MAAAA,IAAI,CAACrmB,IAAL,GAAYhT,EAAE,CAACgT,IAAH,GACT4mB,OADS,CACDP,IAAI,CAACrsB,IAAL,CAAU4sB,OAAV,EADC,EAETlV,CAFS,CAEPljB,IAAI,CAAC0E,QAAL,CAAcwlB,EAFP,EAGTmO,EAHS,CAGNr4B,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcjJ,KAAd,GAAsB,CAAtB,CAHM,EAITmD,EAJS,CAIN3iB,IAAI,CAAC0E,QAAL,CAAcojB,EAJR,EAKT0Q,KALS,CAKHx4B,IAAI,CAACsS,WALF,CAAZ;AAMD;;AAED,aAAS0lB,0BAAT,CAAoCh4B,IAApC,EAA0C63B,IAA1C,EAAgD;AAC9CA,MAAAA,IAAI,CAACY,SAAL,GAAiBj6B,EAAE,CAACgN,IAAH,GACd4sB,OADc,CACN,UAASh5B,CAAT,EAAY;AACnB,eAAO,CAACA,CAAC,CAAC,UAAD,CAAD,KAAkB+d,SAAlB,IAA+B/d,CAAC,CAAC,UAAD,CAAD,KAAkB,IAAlD,KAA2DA,CAAC,CAACY,IAAI,CAACU,UAAN,CAAD,KAAuB,IAAzF;AACD,OAHc,EAIdwiB,CAJc,CAIZljB,IAAI,CAAC0E,QAAL,CAAcwlB,EAJF,EAKdve,CALc,CAKZ,YAAW;AACZ,eAAO3L,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcoP,IAAI,CAACa,WAAnB,CAAP;AAAyC,OAN5B,EAOdF,KAPc,CAORx4B,IAAI,CAACsS,WAPG,CAAjB;AAQD;;AAED,aAASwlB,qBAAT,CAA+B93B,IAA/B,EAAqC63B,IAArC,EAA2C;AACzCA,MAAAA,IAAI,CAACrsB,IAAL,GAAYhN,EAAE,CAACgN,IAAH,GACT0X,CADS,CACPljB,IAAI,CAAC0E,QAAL,CAAcwlB,EADP,EAETve,CAFS,CAEP3L,IAAI,CAAC0E,QAAL,CAAcojB,EAFP,EAGT0Q,KAHS,CAGHx4B,IAAI,CAACsS,WAHF,CAAZ,CADyC,CAMzC;AACA;AACA;;AACA,UAAI,CAACtS,IAAI,CAAC4N,eAAV,EAA2B;AACzB;AACA;AACAiqB,QAAAA,IAAI,CAACrsB,IAAL,GAAYqsB,IAAI,CAACrsB,IAAL,CAAU4sB,OAAV,CAAkB,UAASh5B,CAAT,EAAY;AACxC,iBAAO,CAACA,CAAC,CAAC,UAAD,CAAD,KAAkB+d,SAAlB,IAA+B/d,CAAC,CAAC,UAAD,CAAD,KAAkB,IAAlD,KAA2DA,CAAC,CAACY,IAAI,CAACU,UAAN,CAAD,KAAuB,IAAzF;AACD,SAFW,CAAZ;AAGD;AACF;;AAED,aAASi4B,sBAAT,CAAgC34B,IAAhC,EAAsC63B,IAAtC,EAA4Cv0B,GAA5C,EAAiDs1B,UAAjD,EAA6D;AAC3D,UAAI54B,IAAI,CAACsR,oBAAT,EAA+B;AAC7B,YAAIunB,cAAJ;;AACA,YAAIv1B,GAAG,CAACO,MAAJ,CAAW,yBAAyB+0B,UAApC,EAAgDlK,KAAhD,EAAJ,EAA6D;AAC3DprB,UAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,OADR,EACiB,2CAA2Cs0B,UAD5D;AAED,SAL4B,CAO7B;;;AACAC,QAAAA,cAAc,GAAGv1B,GAAG,CAACO,MAAJ,CAAW,yBAAyB+0B,UAApC,CAAjB;AAEAC,QAAAA,cAAc,CACXpgB,UADH,GAEGqgB,QAFH,CAEY,YAAW;AACnB,iBAAQ94B,IAAI,CAACkR,oBAAN,GAA8B,IAA9B,GAAqC,CAA5C;AACD,SAJH,EAKG5M,IALH,CAKQ,GALR,EAKauzB,IAAI,CAACM,eAAL,CAAqBn4B,IAAI,CAAClB,IAAL,CAAU85B,UAAU,GAAG,CAAvB,CAArB,CALb,EAMGt0B,IANH,CAMQ,WANR,EAMqB,yBAAyByC,aAAa,CAAC/G,IAAI,CAACiE,MAAN,CAAtC,GAAsD,GAN3E;AAOD;AACF;;AAED,aAAS80B,WAAT,CAAqB/4B,IAArB,EAA2B63B,IAA3B,EAAiCv0B,GAAjC,EAAsCs1B,UAAtC,EAAkDjB,OAAlD,EAA2D;AACzD,UAAIqB,KAAK,GAAG11B,GAAG,CAACE,SAAJ,CAAc,0BAA0Bm0B,OAAxC,CAAZ;;AACA,UAAIE,IAAI,CAACoB,YAAT,EAAuB;AACrB;AACA,YAAI,CAACD,KAAK,CAACtK,KAAN,EAAL,EAAoB;AAClBprB,UAAAA,GAAG,CAAC4B,IAAJ,GAAWg0B,WAAX,CAAuBF,KAAK,CAAC9zB,IAAN,EAAvB;AAEA8zB,UAAAA,KAAK,CAACvgB,UAAN,GACGqgB,QADH,CACYjB,IAAI,CAACsB,0BADjB,EAEG70B,IAFH,CAEQ,GAFR,EAEauzB,IAAI,CAACrmB,IAAL,CAAUxR,IAAI,CAAClB,IAAL,CAAU85B,UAAV,CAAV,CAFb,EAGGt0B,IAHH,CAGQ,WAHR,EAGqB,yBAAyByC,aAAa,CAAC/G,IAAI,CAACiE,MAAN,CAAtC,GAAsD,GAH3E;AAID,SAPD,MAOO;AAAE;AACPX,UAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGC,OADH,CACW,cADX,EAC2B,IAD3B,EAEGA,OAFH,CAEW,YAAYg0B,OAFvB,EAEgC,IAFhC,EAGGh0B,OAHH,CAGW,YAAYg0B,OAAZ,GAAsB,QAHjC,EAG2C33B,IAAI,CAAC0S,MAAL,KAAgB,IAH3D,EAIGpO,IAJH,CAIQ,GAJR,EAIauzB,IAAI,CAACrmB,IAAL,CAAUxR,IAAI,CAAClB,IAAL,CAAU85B,UAAV,CAAV,CAJb,EAKGt0B,IALH,CAKQ,MALR,EAKgBtE,IAAI,CAAC0S,MAAL,KAAgB,IAAhB,GAAuB,EAAvB,GAA4B1S,IAAI,CAAC0S,MAAL,CAAYilB,OAAO,GAAG,CAAtB,CAL5C,EAMGrzB,IANH,CAMQ,WANR,EAMqB,yBAAyByC,aAAa,CAAC/G,IAAI,CAACiE,MAAN,CAAtC,GAAsD,GAN3E;AAOD;AACF,OAlBD,MAkBO,IAAI,CAAC+0B,KAAK,CAACtK,KAAN,EAAL,EAAoB;AACzBsK,QAAAA,KAAK,CAAC51B,MAAN;AACD;AACF;;AAED,aAASg2B,yBAAT,CAAmCC,SAAnC,EAA8C1B,OAA9C,EAAuD;AACrD0B,MAAAA,SAAS,CAAC11B,OAAV,CAAkB,YAAag0B,OAAb,GAAwB,QAA1C,EAAoD,IAApD;AACD;;AAED,aAAS2B,aAAT,CAAuBt5B,IAAvB,EAA6Bq5B,SAA7B,EAAwCT,UAAxC,EAAoDjB,OAApD,EAA6D;AAC3D,UAAI33B,IAAI,CAAC0S,MAAT,EAAiB;AACf;AACA;AACA,YAAI1S,IAAI,CAAC0S,MAAL,CAAY3F,WAAZ,KAA4BvE,KAAhC,EAAuC;AACrC6wB,UAAAA,SAAS,CAAC/0B,IAAV,CAAe,QAAf,EAAyBtE,IAAI,CAAC0S,MAAL,CAAYkmB,UAAZ,CAAzB;;AACA,cAAI54B,IAAI,CAAC0S,MAAL,CAAYrR,MAAZ,GAAqBu3B,UAAU,GAAG,CAAtC,EAAyC;AACvC;AACA;AACAQ,YAAAA,yBAAyB,CAACC,SAAD,EAAY1B,OAAZ,CAAzB;AACD;AACF,SAPD,MAOO;AACL;AACAyB,UAAAA,yBAAyB,CAACC,SAAD,EAAY1B,OAAZ,CAAzB;AACD;AACF,OAdD,MAcO;AACL;AACA;AACAyB,QAAAA,yBAAyB,CAACC,SAAD,EAAY1B,OAAZ,CAAzB;AACD;AACF;;AAED,aAAS4B,mBAAT,CAA6Bv5B,IAA7B,EAAmC63B,IAAnC,EAAyCwB,SAAzC,EAAoDT,UAApD,EAAgE;AAC9D,UAAI54B,IAAI,CAACkO,eAAT,EAA0B;AACxB2pB,QAAAA,IAAI,CAACa,WAAL,GAAmBl6B,EAAE,CAACg7B,MAAH,CAAUx5B,IAAI,CAAClB,IAAL,CAAU85B,UAAV,CAAV,EAAiC,UAASx5B,CAAT,EAAY;AAC9D,iBAAOA,CAAC,CAACY,IAAI,CAACU,UAAN,CAAR;AAA4B,SADX,CAAnB;AAEA24B,QAAAA,SAAS,CAAC/0B,IAAV,CAAe,GAAf,EAAoBuzB,IAAI,CAACY,SAAL,CAAez4B,IAAI,CAAClB,IAAL,CAAU85B,UAAV,CAAf,CAApB,EACGngB,UADH,GAEGqgB,QAFH,CAEY,IAFZ,EAGGx0B,IAHH,CAGQ,GAHR,EAGauzB,IAAI,CAACrsB,IAAL,CAAUxL,IAAI,CAAClB,IAAL,CAAU85B,UAAV,CAAV,CAHb,EAIGt0B,IAJH,CAIQ,WAJR,EAIqB,yBAAyByC,aAAa,CAAC/G,IAAI,CAACiE,MAAN,CAAtC,GAAsD,GAJ3E;AAKD,OARD,MAQO;AAAE;AACPo1B,QAAAA,SAAS,CAAC/0B,IAAV,CAAe,GAAf,EAAoBuzB,IAAI,CAACrsB,IAAL,CAAUxL,IAAI,CAAClB,IAAL,CAAU85B,UAAV,CAAV,CAApB,EACGt0B,IADH,CACQ,WADR,EACqB,yBAAyByC,aAAa,CAAC/G,IAAI,CAACiE,MAAN,CAAtC,GAAsD,GAD3E;AAED;AACF;;AAED,aAASw1B,WAAT,CAAqBz5B,IAArB,EAA2B63B,IAA3B,EAAiCv0B,GAAjC,EAAsCo2B,aAAtC,EAAqDd,UAArD,EAAiEjB,OAAjE,EAA0E;AACxE,UAAI,CAAC+B,aAAa,CAAChL,KAAd,EAAL,EAA4B;AAC1BprB,QAAAA,GAAG,CAAC4B,IAAJ,GAAWg0B,WAAX,CAAuBQ,aAAa,CAACx0B,IAAd,EAAvB;AAEA,YAAIy0B,cAAc,GAAGD,aAAa,CAACjhB,UAAd,GAClBqgB,QADkB,CACTjB,IAAI,CAACsB,0BADI,CAArB;;AAGA,YAAI,CAACtB,IAAI,CAACoB,YAAN,IAAsBj5B,IAAI,CAACkR,oBAA3B,IAAmD,CAAClR,IAAI,CAAC6N,iBAA7D,EAAgF;AAC9E8rB,UAAAA,cAAc,CAACC,SAAf,CAAyB,GAAzB,EAA8BC,UAAU,CAAChC,IAAI,CAACrsB,IAAL,CAAUxL,IAAI,CAAClB,IAAL,CAAU85B,UAAV,CAAV,CAAD,EAAmC,CAAnC,CAAxC;AACD,SAFD,MAEO;AACLe,UAAAA,cAAc,CAACr1B,IAAf,CAAoB,GAApB,EAAyBuzB,IAAI,CAACrsB,IAAL,CAAUxL,IAAI,CAAClB,IAAL,CAAU85B,UAAV,CAAV,CAAzB;AACD;AACF,OAXD,MAWO;AAAE;AACP;AACA,YAAIS,SAAS,GAAG/1B,GAAG,CAACI,MAAJ,CAAW,MAAX,EACbY,IADa,CACR,OADQ,EACC,yBAAyBqzB,OAD1B,CAAhB;AAGA2B,QAAAA,aAAa,CAACt5B,IAAD,EAAOq5B,SAAP,EAAkBT,UAAlB,EAA8BjB,OAA9B,CAAb;AACA4B,QAAAA,mBAAmB,CAACv5B,IAAD,EAAO63B,IAAP,EAAawB,SAAb,EAAwBT,UAAxB,CAAnB;AACD;AACF;;AAED,aAASkB,qBAAT,CAA+B95B,IAA/B,EAAqC63B,IAArC,EAA2Ce,UAA3C,EAAuDjB,OAAvD,EAAgE;AAC9D,UAAIoC,WAAJ;;AACA,UAAI/5B,IAAI,CAAC+N,MAAT,EAAiB;AACf,YAAIlN,QAAQ,CAACb,IAAI,CAAC+N,MAAN,CAAZ,EAA2B;AACzBgsB,UAAAA,WAAW,GAAG/5B,IAAI,CAAC+N,MAAL,CAAY6qB,UAAZ,CAAd;AACD,SAFD,MAEO,IAAIz3B,WAAW,CAACnB,IAAI,CAAC+N,MAAN,CAAf,EAA8B;AACnCgsB,UAAAA,WAAW,GAAG/5B,IAAI,CAAC+N,MAAL,CAAY/N,IAAI,CAAClB,IAAL,CAAU85B,UAAV,CAAZ,CAAd;AACD;;AAED,YAAI54B,IAAI,CAACgO,aAAT,EAAwB;AACtB,cAAIhO,IAAI,CAAC0S,MAAL,IAAe1S,IAAI,CAAC0S,MAAL,CAAY3F,WAAZ,KAA4BvE,KAA/C,EAAsD;AACpDqvB,YAAAA,IAAI,CAACmC,WAAL,GAAmB,wBAAwBh6B,IAAI,CAAC0S,MAAL,CAAYkmB,UAAZ,CAAxB,GAAkD,YAAlD,GACjBmB,WADiB,GACH,gBADG,GACgBlC,IAAI,CAACmC,WADxC;AAED,WAHD,MAGO;AACLnC,YAAAA,IAAI,CAACmC,WAAL,GAAmB,yBAAyBrC,OAAzB,GAAmC,yBAAnC,GACjBoC,WADiB,GACH,gBADG,GACgBlC,IAAI,CAACmC,WADxC;AAED;AACF,SARD,MAQO;AACL,cAAIC,YAAJ,EAAkBC,kBAAlB,EAAsC/W,EAAtC;;AACA,cAAInjB,IAAI,CAACyP,eAAL,KAAyB,MAA7B,EAAqC;AACnCwqB,YAAAA,YAAY,GAAGj6B,IAAI,CAAClB,IAAL,CAAU85B,UAAV,EAAsB54B,IAAI,CAAClB,IAAL,CAAU85B,UAAV,EAAsBv3B,MAAtB,GAA+B,CAArD,CAAf;AACA64B,YAAAA,kBAAkB,GAAG,OAArB;AACA/W,YAAAA,EAAE,GAAGnjB,IAAI,CAACsC,MAAV;AACD,WAJD,MAIO;AACL23B,YAAAA,YAAY,GAAGj6B,IAAI,CAAClB,IAAL,CAAU85B,UAAV,EAAsB,CAAtB,CAAf;AACAsB,YAAAA,kBAAkB,GAAG,KAArB;AACA/W,YAAAA,EAAE,GAAG,CAACnjB,IAAI,CAACsC,MAAX;AACD;;AACD,cAAI03B,WAAW,GAAGnC,IAAI,CAACsC,YAAL,CAAkBz2B,MAAlB,CAAyB,UAAzB,EACfY,IADe,CACV,GADU,EACLtE,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,CAAiB+P,YAAjB,CADK,EAEf31B,IAFe,CAEV,IAFU,EAEJ6e,EAFI,EAGf7e,IAHe,CAGV,GAHU,EAGLtE,IAAI,CAAC0E,QAAL,CAAcojB,EAAd,CAAiBmS,YAAjB,CAHK,EAIf31B,IAJe,CAIV,IAJU,EAIJ,OAJI,EAKfA,IALe,CAKV,WALU,EAKG,EALH,EAMfA,IANe,CAMV,aANU,EAMK41B,kBANL,EAOf51B,IAPe,CAOV,aAPU,EAOK,KAPL,EAQfuB,IARe,CAQVk0B,WARU,CAAlB;;AAUA,cAAI/5B,IAAI,CAAC0S,MAAL,IAAe1S,IAAI,CAAC0S,MAAL,CAAY3F,WAAZ,KAA4BvE,KAA/C,EAAsD;AACpD,gBAAIxI,IAAI,CAAC0S,MAAL,CAAYrR,MAAZ,GAAqBu3B,UAAU,GAAG,CAAtC,EAAyC;AACvCoB,cAAAA,WAAW,CAACr2B,OAAZ,CAAoB,YAAag0B,OAAb,GAAwB,eAA5C,EAA6D,IAA7D;AACD,aAFD,MAEO;AACLqC,cAAAA,WAAW,CAAC11B,IAAZ,CAAiB,MAAjB,EAAyBtE,IAAI,CAAC0S,MAAL,CAAYkmB,UAAZ,CAAzB;AACD;AACF,WAND,MAMO;AACLoB,YAAAA,WAAW,CAACr2B,OAAZ,CAAoB,YAAag0B,OAAb,GAAwB,eAA5C,EAA6D,IAA7D;AACD;;AAEDpyB,UAAAA,2BAA2B,CAACsyB,IAAI,CAACsC,YAAL,CAAkB32B,SAAlB,CAA4B,sBAA5B,EAAoDyrB,KAApD,EAAD,EAA8DjvB,IAA9D,CAA3B;AACD;AACF;AACF;;AAED,aAASo6B,+BAAT,CAAyCn2B,MAAzC,EAAiD8J,MAAjD,EAAyD;AACvD,UAAI9J,MAAJ,EAAY;AACVzF,QAAAA,EAAE,CAACqF,MAAH,CAAUI,MAAV,EAAkBoQ,IAAlB,CAAuBtG,MAAvB;AACD;AACF;;AAED,aAASssB,mBAAT,CAA6Br6B,IAA7B,EAAmC63B,IAAnC,EAAyCv0B,GAAzC,EAA8C;AAC5C,UAAItD,IAAI,CAAC+N,MAAT,EAAiB8pB,IAAI,CAACsC,YAAL,GAAoB12B,QAAQ,CAACH,GAAD,EAAM,gBAAN,CAA5B;AAClB;;AAED,aAASg3B,yCAAT,CAAmDh3B,GAAnD,EAAwD;AACtD;AACAD,MAAAA,uBAAuB,CAACC,GAAD,EAAM,mBAAN,CAAvB;AACAD,MAAAA,uBAAuB,CAACC,GAAD,EAAM,aAAN,CAAvB,CAHsD,CAKtD;;AACAD,MAAAA,uBAAuB,CAACC,GAAD,EAAM,sBAAN,CAAvB;AACAD,MAAAA,uBAAuB,CAACC,GAAD,EAAM,0BAAN,CAAvB,CAPsD,CAQtD;AACD;;AAED,aAASi3B,sBAAT,CAAgCv6B,IAAhC,EAAsCsD,GAAtC,EAA2C;AACzC;AACA,UAAIk3B,MAAM,GAAGl3B,GAAG,CAACE,SAAJ,CAAc,0BAAd,EACV1E,IADU,CACLkB,IAAI,CAAClB,IADA,EAEVuF,KAFU,GAEFX,MAFE,CAEK,QAFL,EAGVY,IAHU,CAGL,IAHK,EAGC,CAHD,EAIVA,IAJU,CAIL,IAJK,EAIC,CAJD,EAKVA,IALU,CAKL,GALK,EAKA,CALA,CAAb;;AAOA,UAAItE,IAAI,CAAC0S,MAAL,IAAe1S,IAAI,CAAC0S,MAAL,CAAY3F,WAAZ,KAA4BvE,KAA/C,EAAsD;AACpDgyB,QAAAA,MAAM,CACHl2B,IADH,CACQ,OADR,EACiB,UAASlF,CAAT,EAAY;AACzB,iBAAO,YAAYA,CAAC,CAACu4B,OAArB;AACD,SAHH,EAIGrzB,IAJH,CAIQ,MAJR,EAIgB,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AAC3B,iBAAOnF,IAAI,CAAC0S,MAAL,CAAYvN,CAAZ,CAAP;AACD,SANH,EAOGb,IAPH,CAOQ,QAPR,EAOkB,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AAC7B,iBAAOnF,IAAI,CAAC0S,MAAL,CAAYvN,CAAZ,CAAP;AACD,SATH;AAUD,OAXD,MAWO;AACLq1B,QAAAA,MAAM,CAACl2B,IAAP,CAAY,OAAZ,EAAqB,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AAClC,iBAAO,CACL,YAAY/F,CAAC,CAACu4B,OADT,EAEL,YAAYv4B,CAAC,CAACu4B,OAAd,GAAwB,QAFnB,EAGL,YAAYv4B,CAAC,CAACu4B,OAAd,GAAwB,QAHnB,EAIL7rB,IAJK,CAIA,GAJA,CAAP;AAKD,SAND;AAOD;;AACD0uB,MAAAA,MAAM,CAAC72B,OAAP,CAAe,yBAAf,EAA0C,IAA1C;AACD;;AAED,aAAS82B,qCAAT,CAA+Cz6B,IAA/C,EAAqD;AACnD;AACA;AACA,UAAI23B,OAAO,GAAG,CAAd;;AACA,WAAK,IAAIxyB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnF,IAAI,CAAClB,IAAL,CAAUuC,MAA9B,EAAsC8D,CAAC,EAAvC,EAA2C;AACzC,aAAK,IAAIW,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG9F,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAa9D,MAAjC,EAAyCyE,CAAC,EAA1C,EAA8C;AAC5C;AACA,cAAI9F,IAAI,CAACyS,qBAAL,CAA2BpR,MAA3B,GAAoC,CAAxC,EAA2C;AACzCrB,YAAAA,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAaW,CAAb,EAAgB6xB,OAAhB,GAA0B33B,IAAI,CAACyS,qBAAL,CAA2BtN,CAA3B,CAA1B;AACD,WAFD,MAEO;AACLnF,YAAAA,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAaW,CAAb,EAAgB6xB,OAAhB,GAA0BA,OAA1B;AACD;AACF;;AACDA,QAAAA,OAAO;AACR;AACF;;AAED,aAAS+C,wBAAT,CAAkC16B,IAAlC,EAAwC;AACtC,aAAOxB,EAAE,CAACm8B,KAAH,CAAS36B,IAAI,CAAClB,IAAd,CAAP;AACD;;AAED,aAAS87B,oBAAT,CAA8B56B,IAA9B,EAAoC;AAClC,aAAO,UAASZ,CAAT,EAAY;AACjB,YAAIy7B,YAAJ;;AAEA,YAAI76B,IAAI,CAAC6R,MAAT,EAAiB;AACf,cAAIipB,CAAC,GAAG17B,CAAC,CAACY,IAAI,CAACO,UAAN,CAAT;AACA,cAAIw6B,SAAS,GAAGx8B,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8BJ,IAAI,CAAC8R,aAAnC,CAAhB,CAFe,CAIf;;AACA,cAAIkpB,EAAE,GAAI,OAAOF,CAAP,KAAa,QAAd,GAA2B17B,CAAC,CAACu4B,OAAF,GAAY,CAAvC,GAA4CoD,SAAS,CAACD,CAAD,CAA9D;AACAD,UAAAA,YAAY,GAAG,UAAUG,EAAV,GAAe,UAAf,GAA4B57B,CAAC,CAACu4B,OAA7C;;AAEA,cAAI33B,IAAI,CAACkhB,KAAL,KAAe,IAAnB,EAAyB;AACvB2Z,YAAAA,YAAY,IAAI,aAAaz7B,CAAC,CAACu4B,OAAf,GAAyB,QAAzC;AACD;;AACD,iBAAOkD,YAAP;AAED,SAbD,MAaO;AACLA,UAAAA,YAAY,GAAG,YAAYz7B,CAAC,CAACu4B,OAA7B;AACA,cAAI33B,IAAI,CAACkhB,KAAL,KAAe,IAAnB,EAAyB2Z,YAAY,IAAI,aAAaz7B,CAAC,CAACu4B,OAAf,GAAyB,QAAzC;AACzB,iBAAOkD,YAAP;AACD;AACF,OArBD;AAsBD;;AAED,aAASI,uBAAT,CAAiCj7B,IAAjC,EAAuCsD,GAAvC,EAA4C43B,WAA5C,EAAyDC,YAAzD,EAAuEC,aAAvE,EAAsF;AACpF,UAAIC,OAAO,GAAG78B,EAAE,CAAC68B,OAAH,GACXnY,CADW,CACT,UAAS9jB,CAAT,EAAY;AACb,eAAOY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAC,CAACY,IAAI,CAACO,UAAN,CAAf,EAAkCwiB,OAAlC,CAA0C,CAA1C,CAAP;AAAsD,OAF5C,EAGXpX,CAHW,CAGT,UAASvM,CAAT,EAAY;AACb,eAAOY,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrpB,CAAC,CAACY,IAAI,CAACU,UAAN,CAAf,EAAkCqiB,OAAlC,CAA0C,CAA1C,CAAP;AAAsD,OAJ5C,EAKXrC,MALW,CAKJ,CACN,CAAC1gB,IAAI,CAACsC,MAAN,EAActC,IAAI,CAACsC,MAAL,GAActC,IAAI,CAACmO,gBAAjC,CADM,EAEN,CAACnO,IAAI,CAAC8C,KAAL,GAAa9C,IAAI,CAACsC,MAAnB,EAA2BtC,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACsC,MAA9C,CAFM,CALI,CAAd;AAUA,UAAIqhB,CAAC,GAAGlgB,QAAQ,CAACH,GAAD,EAAM,YAAN,CAAhB;AACAqgB,MAAAA,CAAC,CAACngB,SAAF,CAAY,MAAZ,EACG1E,IADH,CACQu8B,OAAO,CAACC,QAAR,CAAiBZ,wBAAwB,CAAC16B,IAAD,CAAzC,CADR,EAEGqE,KAFH,GAGGX,MAHH,CAGU,MAHV,EAIGyF,MAJH,CAIU,UAAS/J,CAAT,EAAY;AAClB,eAAOA,CAAC,KAAK+d,SAAN,IAAmB/d,CAAC,CAACiC,MAAF,GAAW,CAArC;AAAyC,OAL7C,EAMGiD,IANH,CAMQ,GANR,EAMa,UAASlF,CAAT,EAAY;AACrB,eAAOA,CAAC,IAAI,IAAL,GAAY,IAAZ,GAAmB,MAAMA,CAAC,CAAC0M,IAAF,CAAO,GAAP,CAAN,GAAoB,GAA9C;AAAoD,OAPxD,EAQGxL,KARH,CAQS,UAASlB,CAAT,EAAY;AACjB,eAAOA,CAAC,IAAI,IAAL,GAAY,IAAZ,GAAmBA,CAAC,CAACN,IAA5B;AAAmC,OATvC,EASyC;AATzC,OAUGwF,IAVH,CAUQ,OAVR,EAUiBs2B,oBAAoB,CAAC56B,IAAD,CAVrC,EAWGgV,EAXH,CAWM,WAXN,EAWmBkmB,WAXnB,EAYGlmB,EAZH,CAYM,UAZN,EAYkBmmB,YAZlB,EAaGnmB,EAbH,CAaM,WAbN,EAamBomB,aAbnB;AAeAG,MAAAA,6BAA6B,CAACv7B,IAAD,EAAOsD,GAAP,CAA7B;AACD;;AAED,aAASk4B,gCAAT,CAA0Cx7B,IAA1C,EAAgD;AAC9C,UAAIy7B,WAAW,GAAGj9B,EAAE,CAACk9B,IAAH,GACf3oB,GADe,CACX,UAAS3T,CAAT,EAAY;AACf,eAAOA,CAAC,CAACY,IAAI,CAACO,UAAN,CAAR;AAA4B,OAFd,EAGfo7B,OAHe,CAGPn9B,EAAE,CAACm8B,KAAH,CAAS36B,IAAI,CAAClB,IAAd,CAHO,CAAlB;AAIA28B,MAAAA,WAAW,CAAChzB,OAAZ,CAAoB,UAASmzB,KAAT,EAAgB;AAClC,YAAIt7B,KAAK,GAAGs7B,KAAK,CAAC1yB,MAAN,CAAa,CAAb,CAAZ;AACA0yB,QAAAA,KAAK,CAAC7oB,GAAN,GAAYzS,KAAK,CAACN,IAAI,CAACO,UAAN,CAAjB;AACD,OAHD;;AAKA,UAAIP,IAAI,CAACqP,MAAT,EAAiB;AACf,eAAOosB,WAAW,CAACj2B,IAAZ,CAAiB,UAASxD,CAAT,EAAYC,CAAZ,EAAe;AACrC,iBAAO,IAAI4H,IAAJ,CAAS7H,CAAC,CAAC+Q,GAAX,IAAkB,IAAIlJ,IAAJ,CAAS5H,CAAC,CAAC8Q,GAAX,CAAzB;AAA2C,SADtC,CAAP;AAED,OAHD,MAGO;AACL,eAAO0oB,WAAP;AACD;AACF;;AAED,aAASI,yBAAT,CAAmC77B,IAAnC,EAAyCsD,GAAzC,EAA8C43B,WAA9C,EAA2DC,YAA3D,EAAyEC,aAAzE,EAAwF;AACtF;AACA;AACA,UAAIK,WAAW,GAAGD,gCAAgC,CAACx7B,IAAD,CAAlD;AAEA,UAAIkqB,EAAE,GAAGuR,WAAW,CAACt8B,GAAZ,CAAgB,UAAS+d,EAAT,EAAa;AACpC,eAAOld,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcpH,EAAE,CAACnK,GAAjB,CAAP;AACD,OAFQ,CAAT;AAIA,UAAI4Q,CAAC,GAAGrgB,GAAG,CAACI,MAAJ,CAAW,GAAX,EACLY,IADK,CACA,OADA,EACS,kBADT,CAAR;AAGAqf,MAAAA,CAAC,CAACngB,SAAF,CAAY,oBAAZ,EACG1E,IADH,CACQ28B,WADR,EACqBp3B,KADrB,GAEGX,MAFH,CAEU,MAFV,EAGGY,IAHH,CAGQ,GAHR,EAGa,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AACxB,YAAI+kB,EAAE,CAAC7oB,MAAH,KAAc,CAAlB,EAAqB,OAAOuB,gBAAgB,CAAC5C,IAAD,CAAvB,CAArB,KACK,IAAImF,CAAC,KAAK,CAAV,EAAa,OAAO+kB,EAAE,CAAC/kB,CAAD,CAAF,CAAM4d,OAAN,CAAc,CAAd,CAAP,CAAb,KACA,OAAO,CAAC,CAACmH,EAAE,CAAC/kB,CAAC,GAAG,CAAL,CAAF,GAAY+kB,EAAE,CAAC/kB,CAAD,CAAf,IAAsB,CAAvB,EAA0B4d,OAA1B,CAAkC,CAAlC,CAAP;AACN,OAPH,EAQGze,IARH,CAQQ,GARR,EAQatE,IAAI,CAACwC,GARlB,EASG8B,IATH,CASQ,OATR,EASiB,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AAC5B,YAAI+kB,EAAE,CAAC7oB,MAAH,KAAc,CAAlB,EAAqB,OAAO2B,iBAAiB,CAAChD,IAAD,CAAxB,CAArB,KACK,IAAImF,CAAC,KAAK,CAAV,EAAa,OAAO,CAAC,CAAC+kB,EAAE,CAAC/kB,CAAC,GAAG,CAAL,CAAF,GAAY+kB,EAAE,CAAC/kB,CAAD,CAAf,IAAsB,CAAvB,EAA0B4d,OAA1B,CAAkC,CAAlC,CAAP,CAAb,KACA,IAAI5d,CAAC,KAAK+kB,EAAE,CAAC7oB,MAAH,GAAY,CAAtB,EAAyB,OAAO,CAAC,CAAC6oB,EAAE,CAAC/kB,CAAD,CAAF,GAAQ+kB,EAAE,CAAC/kB,CAAC,GAAG,CAAL,CAAX,IAAsB,CAAvB,EAA0B4d,OAA1B,CAAkC,CAAlC,CAAP,CAAzB,KACA,OAAO,CAAC,CAACmH,EAAE,CAAC/kB,CAAC,GAAG,CAAL,CAAF,GAAY+kB,EAAE,CAAC/kB,CAAC,GAAG,CAAL,CAAf,IAA0B,CAA3B,EAA8B4d,OAA9B,CAAsC,CAAtC,CAAP;AACN,OAdH,EAeGze,IAfH,CAeQ,OAfR,EAeiB,UAASlF,CAAT,EAAY;AACzB,YAAI08B,YAAY,GAAG18B,CAAC,CAAC8J,MAAF,CAAS/J,GAAT,CAAa,UAASmB,KAAT,EAAgB;AAC9C,cAAIy7B,EAAE,GAAGC,aAAa,CAAC17B,KAAK,CAACq3B,OAAP,CAAtB;AACA,cAAI33B,IAAI,CAAC0S,MAAL,KAAgB,IAApB,EAA0BqpB,EAAE,IAAI,MAAME,mBAAmB,CAAC37B,KAAK,CAACq3B,OAAP,CAA/B;AAC1B,iBAAOoE,EAAP;AACD,SAJkB,EAIhBjwB,IAJgB,CAIX,GAJW,CAAnB;;AAKA,YAAI9L,IAAI,CAAC6R,MAAL,IAAezS,CAAC,CAAC8J,MAAF,CAAS7H,MAAT,GAAkB,CAArC,EAAwC;AACtCy6B,UAAAA,YAAY,IAAI,MAAMI,oBAAoB,CAACC,qBAAqB,CAAC/8B,CAAC,CAAC8J,MAAF,CAAS,CAAT,CAAD,EAAc,CAAd,EAAiBlJ,IAAjB,CAAtB,CAA1C;AACD;;AAED,eAAO87B,YAAP;AACD,OA1BH,EA2BGx3B,IA3BH,CA2BQ,QA3BR,EA2BkBtE,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACoC,MAAnB,GAA4BpC,IAAI,CAACwC,GAAjC,GAAuCxC,IAAI,CAACsC,MA3B9D,EA4BGgC,IA5BH,CA4BQ,SA5BR,EA4BmB,CA5BnB,EA6BG0Q,EA7BH,CA6BM,WA7BN,EA6BmBkmB,WA7BnB,EA8BGlmB,EA9BH,CA8BM,UA9BN,EA8BkBmmB,YA9BlB,EA+BGnmB,EA/BH,CA+BM,WA/BN,EA+BmBomB,aA/BnB;AAiCAgB,MAAAA,+BAA+B,CAACp8B,IAAD,EAAOsD,GAAP,CAA/B;AACD;;AAED,aAAS+4B,+BAAT,CAAyCr8B,IAAzC,EAA+CsD,GAA/C,EAAoD;AAClDA,MAAAA,GAAG,CAACO,MAAJ,CAAW,wBAAX,EACGmR,EADH,CACM,WADN,EACmBhV,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAa,CAAb,CADnB,EACoC,CADpC;AAED;;AAED,aAASy8B,6BAAT,CAAuCv7B,IAAvC,EAA6CsD,GAA7C,EAAkD;AAChD,WAAK,IAAI6B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnF,IAAI,CAAClB,IAAL,CAAUuC,MAA9B,EAAsC8D,CAAC,EAAvC,EAA2C;AACzC,YAAIW,CAAC,GAAGX,CAAC,GAAG,CAAZ;;AAEA,YAAInF,IAAI,CAACyS,qBAAL,CAA2BpR,MAA3B,GAAoC,CAApC,IACFrB,IAAI,CAACyS,qBAAL,CAA2BtN,CAA3B,MAAkCgY,SADpC,EAC+C;AAC7CrX,UAAAA,CAAC,GAAG9F,IAAI,CAACyS,qBAAL,CAA2BtN,CAA3B,CAAJ;AACD;;AAED,YAAInF,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAa9D,MAAb,KAAwB,CAAxB,IAA6B,CAACiC,GAAG,CAACE,SAAJ,CAAc,yBAAyBsC,CAAvC,EAA0C4oB,KAA1C,EAAlC,EAAqF;AACnFprB,UAAAA,GAAG,CAACE,SAAJ,CAAc,yBAAyBsC,CAAvC,EACGkP,EADH,CACM,WADN,EACmBhV,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAa,CAAb,CADnB,EACoC,CADpC;AAGA7B,UAAAA,GAAG,CAACE,SAAJ,CAAc,yBAAyBsC,CAAvC,EACGkP,EADH,CACM,UADN,EACkBhV,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAa,CAAb,CADlB,EACmC,CADnC;AAED;AACF;AACF;;AAED,aAAS62B,aAAT,CAAuBrE,OAAvB,EAAgC;AAC9B,aAAO,YAAYA,OAAnB;AACD;;AAED,aAASsE,mBAAT,CAA6BtE,OAA7B,EAAsC;AACpC,aAAO,YAAYA,OAAZ,GAAsB,QAA7B;AACD;;AAED,aAASuE,oBAAT,CAA8BlB,EAA9B,EAAkC;AAChC,aAAO,UAAUA,EAAjB;AACD;;AAED,aAASmB,qBAAT,CAA+B/8B,CAA/B,EAAkC+F,CAAlC,EAAqCnF,IAArC,EAA2C;AACzC,UAAI86B,CAAC,GAAG17B,CAAC,CAACY,IAAI,CAACO,UAAN,CAAT;AACA,UAAIw6B,SAAS,GAAGx8B,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8BJ,IAAI,CAAC8R,aAAnC,CAAhB,CAFyC,CAGzC;;AACA,UAAIkpB,EAAE,GAAI,OAAOF,CAAP,KAAa,QAAd,GAA0B31B,CAA1B,GAA8B41B,SAAS,CAACD,CAAD,CAAhD;AACA,aAAOE,EAAP;AACD;;AAED,aAASsB,2BAAT,CAAqCt8B,IAArC,EAA2CsD,GAA3C,EAAgD43B,WAAhD,EAA6DC,YAA7D,EAA2EC,aAA3E,EAA0F;AACxF;AACA,UAAIzD,OAAO,GAAG,CAAd;;AACA,UAAI33B,IAAI,CAACyS,qBAAL,CAA2BpR,MAA3B,GAAoC,CAAxC,EAA2C;AACzCs2B,QAAAA,OAAO,GAAG33B,IAAI,CAACyS,qBAAL,CAA2B,CAA3B,CAAV;AACD;;AAED,UAAIkR,CAAC,GAAGrgB,GAAG,CAACI,MAAJ,CAAW,GAAX,EACLY,IADK,CACA,OADA,EACS,kBADT,CAAR;AAGA,UAAI4lB,EAAE,GAAGlqB,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAaK,GAAb,CAAiBa,IAAI,CAAC0E,QAAL,CAAcwlB,EAA/B,CAAT;AAEAvG,MAAAA,CAAC,CAACngB,SAAF,CAAY,oBAAZ,EACG1E,IADH,CACQkB,IAAI,CAAClB,IAAL,CAAU,CAAV,CADR,EACsBuF,KADtB,GAEGX,MAFH,CAEU,MAFV,EAGGY,IAHH,CAGQ,OAHR,EAGiB,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AAC5B,YAAI5B,EAAE,GAAG04B,mBAAmB,CAACtE,OAAD,CAAnB,GAA+B,GAA/B,GAAqCqE,aAAa,CAAC58B,CAAC,CAACu4B,OAAH,CAA3D;AACA,YAAI33B,IAAI,CAAC6R,MAAT,EAAiBtO,EAAE,IAAIA,EAAE,GAAG,GAAL,GAAW24B,oBAAoB,CAACC,qBAAqB,CAAC/8B,CAAD,EAAI+F,CAAJ,EAAOnF,IAAP,CAAtB,CAArC;AACjB,eAAOuD,EAAP;AACD,OAPH,EAQGe,IARH,CAQQ,GARR,EAQa,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AACxB;AACA,YAAI+kB,EAAE,CAAC7oB,MAAH,KAAc,CAAlB,EAAqB,OAAOuB,gBAAgB,CAAC5C,IAAD,CAAvB,CAArB,KACK,IAAImF,CAAC,KAAK,CAAV,EAAa,OAAO+kB,EAAE,CAAC/kB,CAAD,CAAF,CAAM4d,OAAN,CAAc,CAAd,CAAP,CAAb,KACA,OAAO,CAAC,CAACmH,EAAE,CAAC/kB,CAAC,GAAG,CAAL,CAAF,GAAY+kB,EAAE,CAAC/kB,CAAD,CAAf,IAAsB,CAAvB,EAA0B4d,OAA1B,CAAkC,CAAlC,CAAP;AACN,OAbH,EAcGze,IAdH,CAcQ,GAdR,EAca,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AACxB,eAAQnF,IAAI,CAAClB,IAAL,CAAUuC,MAAV,GAAmB,CAApB,GAAyBrB,IAAI,CAAC0E,QAAL,CAAcojB,EAAd,CAAiB1oB,CAAjB,IAAsB,CAA/C,CAAiD;AAAjD,UACHY,IAAI,CAACwC,GADT;AAED,OAjBH,EAkBG8B,IAlBH,CAkBQ,OAlBR,EAkBiB,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AAC5B;AACA,YAAI+kB,EAAE,CAAC7oB,MAAH,KAAc,CAAlB,EAAqB,OAAO2B,iBAAiB,CAAChD,IAAD,CAAxB,CAArB,KACK,IAAImF,CAAC,KAAK,CAAV,EAAa,OAAO,CAAC,CAAC+kB,EAAE,CAAC/kB,CAAC,GAAG,CAAL,CAAF,GAAY+kB,EAAE,CAAC/kB,CAAD,CAAf,IAAsB,CAAvB,EAA0B4d,OAA1B,CAAkC,CAAlC,CAAP,CAAb,KACA,IAAI5d,CAAC,KAAK+kB,EAAE,CAAC7oB,MAAH,GAAY,CAAtB,EAAyB,OAAO,CAAC,CAAC6oB,EAAE,CAAC/kB,CAAD,CAAF,GAAQ+kB,EAAE,CAAC/kB,CAAC,GAAG,CAAL,CAAX,IAAsB,CAAvB,EAA0B4d,OAA1B,CAAkC,CAAlC,CAAP,CAAzB,KACA,OAAO,CAAC,CAACmH,EAAE,CAAC/kB,CAAC,GAAG,CAAL,CAAF,GAAY+kB,EAAE,CAAC/kB,CAAC,GAAG,CAAL,CAAf,IAA0B,CAA3B,EAA8B4d,OAA9B,CAAsC,CAAtC,CAAP;AACN,OAxBH,EAyBGze,IAzBH,CAyBQ,QAzBR,EAyBkB,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AAC7B,eAAQnF,IAAI,CAAClB,IAAL,CAAUuC,MAAV,GAAmB,CAApB,GAAyB,EAAzB,CAA4B;AAA5B,UACHrB,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACoC,MAAnB,GAA4BpC,IAAI,CAACwC,GAAjC,GAAuCxC,IAAI,CAACsC,MADhD;AAED,OA5BH,EA6BGgC,IA7BH,CA6BQ,SA7BR,EA6BmB,CA7BnB,EA8BG0Q,EA9BH,CA8BM,WA9BN,EA8BmBkmB,WA9BnB,EA+BGlmB,EA/BH,CA+BM,UA/BN,EA+BkBmmB,YA/BlB,EAgCGnmB,EAhCH,CAgCM,WAhCN,EAgCmBomB,aAhCnB;;AAkCA,UAAImB,eAAe,CAACv8B,IAAD,CAAnB,EAA2B;AACzBq8B,QAAAA,+BAA+B,CAACr8B,IAAD,EAAOsD,GAAP,CAA/B;AACD;AACF;;AAED,aAAS84B,+BAAT,CAAyCp8B,IAAzC,EAA+CsD,GAA/C,EAAoD;AAClD,UAAIk5B,IAAI,GAAGl5B,GAAG,CAACE,SAAJ,CAAc,wBAAd,CAAX;AACA,UAAIi5B,UAAU,GAAGD,IAAI,CAACvN,KAAL,GAAa,CAAb,EAAgB,CAAhB,KAAsBuN,IAAI,CAACvN,KAAL,GAAa,CAAb,CAAvC;;AACA,UAAIjvB,IAAI,CAAClB,IAAL,CAAUqK,MAAV,CAAiB,UAAS/J,CAAT,EAAY;AAAE,eAAOA,CAAC,CAACiC,MAAF,KAAa,CAApB;AAAwB,OAAvD,EAAyDA,MAAzD,GAAkE,CAAtE,EAAyE;AACvEm7B,QAAAA,IAAI,CAACxnB,EAAL,CAAQ,WAAR,EAAqBynB,UAAU,CAACC,QAAhC,EAA0C,CAA1C;AACD;AACF;;AAED,aAASC,wBAAT,CAAkC38B,IAAlC,EAAwC;AACtC,aAAOA,IAAI,CAAClB,IAAL,CAAUuC,MAAV,GAAmB,CAAnB,IAAwB,CAACrB,IAAI,CAAC4S,kBAArC;AACD;;AAED,aAASgqB,yBAAT,CAAmC58B,IAAnC,EAAyC;AACvC,aAAOA,IAAI,CAAClB,IAAL,CAAUuC,MAAV,GAAmB,CAAnB,IAAwBrB,IAAI,CAAC4S,kBAApC;AACD;;AAED,aAAS2pB,eAAT,CAAyBv8B,IAAzB,EAA+B;AAC7B,aAAOA,IAAI,CAAClB,IAAL,CAAUuC,MAAV,KAAqB,CAArB,IAA0BrB,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAauC,MAAb,KAAwB,CAAzD;AACD;;AAED,aAASw7B,yBAAT,CAAmC78B,IAAnC,EAAyC63B,IAAzC,EAA+Cv0B,GAA/C,EAAoD;AAClDw5B,MAAAA,wBAAwB,CAACjF,IAAD,EAAOv0B,GAAP,CAAxB;;AAEA,WAAK,IAAI6B,CAAC,GAAGnF,IAAI,CAAClB,IAAL,CAAUuC,MAAV,GAAmB,CAAhC,EAAmC8D,CAAC,IAAI,CAAxC,EAA2CA,CAAC,EAA5C,EAAgD;AAC9C,YAAI43B,SAAS,GAAG/8B,IAAI,CAAClB,IAAL,CAAUqG,CAAV,CAAhB,CAD8C,CAG9C;;AACA5G,QAAAA,EAAE,CAACqO,SAAH,CAAa,yBAAb,EAAwC,CAACmwB,SAAD,EAAY/8B,IAAZ,CAAxC,EAJ8C,CAM9C;;AACA,YAAI23B,OAAO,GAAGxyB,CAAC,GAAG,CAAlB;;AACA,YAAInF,IAAI,CAACyS,qBAAL,CAA2BpR,MAA3B,GAAoC,CAAxC,EAA2C;AACzCs2B,UAAAA,OAAO,GAAG33B,IAAI,CAACyS,qBAAL,CAA2BtN,CAA3B,CAAV;AACD;;AAEDnF,QAAAA,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAawyB,OAAb,GAAuBA,OAAvB;;AAEA,YAAIoF,SAAS,CAAC17B,MAAV,KAAqB,CAAzB,EAA4B;AAC1B;AACD;;AACD,YAAIq4B,aAAa,GAAGp2B,GAAG,CAACO,MAAJ,CAAW,8BAA+B8zB,OAA1C,CAApB;AAEAgB,QAAAA,sBAAsB,CAAC34B,IAAD,EAAO63B,IAAP,EAAav0B,GAAb,EAAkBq0B,OAAlB,CAAtB;AACAoB,QAAAA,WAAW,CAAC/4B,IAAD,EAAO63B,IAAP,EAAav0B,GAAb,EAAkB6B,CAAlB,EAAqBwyB,OAArB,CAAX;AACA8B,QAAAA,WAAW,CAACz5B,IAAD,EAAO63B,IAAP,EAAav0B,GAAb,EAAkBo2B,aAAlB,EAAiCv0B,CAAjC,EAAoCwyB,OAApC,CAAX;AACAmC,QAAAA,qBAAqB,CAAC95B,IAAD,EAAO63B,IAAP,EAAa1yB,CAAb,EAAgBwyB,OAAhB,CAArB,CAtB8C,CAwB9C;;AACAp5B,QAAAA,EAAE,CAACqO,SAAH,CAAa,wBAAb,EAAuC,CAACmwB,SAAD,EAAYrD,aAAZ,EAA2B15B,IAA3B,CAAvC;AACD;AACF;;AAED,aAAS88B,wBAAT,CAAkCjF,IAAlC,EAAwCv0B,GAAxC,EAA6C;AAC3C,UAAIu0B,IAAI,CAACK,aAAL,CAAmB,CAAnB,KAAyBL,IAAI,CAACK,aAAL,CAAmB,CAAnB,EAAsB72B,MAAtB,GAA+BiC,GAAG,CAACE,SAAJ,CAAc,eAAd,EAA+B0B,IAA/B,GAAsC7D,MAAlG,EAA0G;AACxGiC,QAAAA,GAAG,CAACE,SAAJ,CAAc,qBAAd,EAAqCJ,MAArC;AACD;AACF;;AAED,aAAS45B,iBAAT,CAA2Bh9B,IAA3B,EAAiC;AAC/B,UAAI63B,IAAI,GAAG,EAAX;AACA,UAAIv0B,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B,CAF+B,CAI/B;;AACAZ,MAAAA,uBAAuB,CAACC,GAAD,EAAM,iBAAN,CAAvB;AACA+2B,MAAAA,mBAAmB,CAACr6B,IAAD,EAAO63B,IAAP,EAAav0B,GAAb,CAAnB;AAEAu0B,MAAAA,IAAI,CAACa,WAAL,GAAmB,CAAnB;AACAb,MAAAA,IAAI,CAACsB,0BAAL,GAAmCn5B,IAAI,CAACkR,oBAAN,GAA8B,IAA9B,GAAqC,CAAvE;AACA2mB,MAAAA,IAAI,CAACoB,YAAL,GAAoBj5B,IAAI,CAACwR,IAAL,IAAa,CAACxR,IAAI,CAACi9B,cAAnB,IAAqCj9B,IAAI,CAAClB,IAAL,CAAUuC,MAAV,IAAoB,CAAzD,IAA8DrB,IAAI,CAAC4S,kBAAL,KAA4B,KAA9G;AACAilB,MAAAA,IAAI,CAACmC,WAAL,GAAmB,EAAnB;AACApC,MAAAA,wBAAwB,CAAC53B,IAAD,EAAO63B,IAAP,EAAav0B,GAAb,CAAxB;AACAu0B,MAAAA,IAAI,CAACK,aAAL,GAAqB50B,GAAG,CAACE,SAAJ,CAAc,qBAAd,EAAqCyrB,KAArC,EAArB,CAb+B,CAe/B;;AACA,UAAIiO,mBAAmB,GAAG3+B,EAAE,CAACqO,SAAH,CAAa,wBAAb,EAAuC,CAAC5M,IAAD,CAAvC,CAA1B;;AACA,UAAIk9B,mBAAmB,KAAK,KAA5B,EAAmC;AACjCL,QAAAA,yBAAyB,CAAC78B,IAAD,EAAO63B,IAAP,EAAav0B,GAAb,CAAzB;AACD;;AAED82B,MAAAA,+BAA+B,CAACp6B,IAAI,CAACgO,aAAN,EAAqB6pB,IAAI,CAACmC,WAA1B,CAA/B;AACD;;AAED,aAASmD,sBAAT,CAAgCn9B,IAAhC,EAAsCo9B,KAAtC,EAA6C;AAC3C,UAAI95B,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;;AAEA,UAAIX,GAAG,CAACE,SAAJ,CAAc,gCAAd,EAAgDyrB,KAAhD,GAAwD5tB,MAAxD,KAAmE,CAAvE,EAA0E;AACxEoC,QAAAA,QAAQ,CAACH,GAAD,EAAM,+BAAN,CAAR;AACD;;AAEDg3B,MAAAA,yCAAyC,CAACh3B,GAAD,CAAzC;AACAi3B,MAAAA,sBAAsB,CAACv6B,IAAD,EAAOsD,GAAP,CAAtB;AACAm3B,MAAAA,qCAAqC,CAACz6B,IAAD,CAArC;;AAEA,UAAI28B,wBAAwB,CAAC38B,IAAD,CAA5B,EAAoC;AAClCi7B,QAAAA,uBAAuB,CAACj7B,IAAD,EAAOsD,GAAP,EAAY85B,KAAK,CAACC,UAAN,CAAiBr9B,IAAjB,CAAZ,EAAoCo9B,KAAK,CAACE,WAAN,CAAkBt9B,IAAlB,CAApC,EAA6Do9B,KAAK,CAACG,YAAN,CAAmBv9B,IAAnB,CAA7D,CAAvB;AACD,OAFD,MAEO,IAAI48B,yBAAyB,CAAC58B,IAAD,CAA7B,EAAqC;AAC1C67B,QAAAA,yBAAyB,CAAC77B,IAAD,EAAOsD,GAAP,EAAY85B,KAAK,CAACC,UAAN,CAAiBr9B,IAAjB,CAAZ,EAAoCo9B,KAAK,CAACE,WAAN,CAAkBt9B,IAAlB,CAApC,EAA6Do9B,KAAK,CAACG,YAAN,CAAmBv9B,IAAnB,CAA7D,CAAzB;AACD,OAFM,MAEA;AACLs8B,QAAAA,2BAA2B,CAACt8B,IAAD,EAAOsD,GAAP,EAAY85B,KAAK,CAACC,UAAN,CAAiBr9B,IAAjB,CAAZ,EAAoCo9B,KAAK,CAACE,WAAN,CAAkBt9B,IAAlB,CAApC,EAA6Do9B,KAAK,CAACG,YAAN,CAAmBv9B,IAAnB,CAA7D,CAA3B;AACD;AACF;;AAED,aAASw9B,yBAAT,CAAmCx9B,IAAnC,EAAyCsD,GAAzC,EAA8ClE,CAA9C,EAAiD;AAC/C,UAAIY,IAAI,CAAC4S,kBAAL,IAA2B5S,IAAI,CAAClB,IAAL,CAAUuC,MAAV,GAAmB,CAAlD,EAAqD;AACnD;AACAiC,QAAAA,GAAG,CAACE,SAAJ,CAAc,gCAAd,EACGmE,KADH,CACS,SADT,EACoB,CADpB;AAGAvI,QAAAA,CAAC,CAAC8J,MAAF,CAAST,OAAT,CAAiB,UAASnI,KAAT,EAAgB;AAC/B,cAAID,sBAAsB,CAACC,KAAD,EAAQN,IAAR,CAA1B,EAAyCy9B,mCAAmC,CAACz9B,IAAD,EAAOsD,GAAP,EAAYhD,KAAZ,CAAnC;AAC1C,SAFD;AAGD,OARD,MAQO,IAAKN,IAAI,CAAC6N,iBAAL,IAA0BzO,CAAC,CAAC,UAAD,CAA5B,IAA6CA,CAAC,CAACY,IAAI,CAACU,UAAN,CAAD,KAAuB,IAAxE,EAA8E;AACnF;AACA;AACA;AACA;AACD,OALM,MAKA;AACL;AACA,YAAIL,sBAAsB,CAACjB,CAAD,EAAIY,IAAJ,CAA1B,EAAqC;AACnC09B,UAAAA,iCAAiC,CAAC19B,IAAD,EAAOsD,GAAP,EAAYlE,CAAZ,CAAjC;AACD;AACF;AACF;;AAED,aAASq+B,mCAAT,CAA6Cz9B,IAA7C,EAAmDsD,GAAnD,EAAwDhD,KAAxD,EAA+D;AAC7DgD,MAAAA,GAAG,CAACO,MAAJ,CAAW,2CAA2CvD,KAAK,CAACq3B,OAA5D,EACGrzB,IADH,CACQ,IADR,EACctE,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAchkB,KAAK,CAACN,IAAI,CAACO,UAAN,CAAnB,EAAsCwiB,OAAtC,CAA8C,CAA9C,CADd,EAEGze,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcnoB,KAAK,CAACN,IAAI,CAACU,UAAN,CAAnB,EAAsCqiB,OAAtC,CAA8C,CAA9C,CAFd,EAGGze,IAHH,CAGQ,GAHR,EAGatE,IAAI,CAACkP,UAHlB,EAIGvH,KAJH,CAIS,SAJT,EAIoB,CAJpB;AAKD;;AAED,aAAS+1B,iCAAT,CAA2C19B,IAA3C,EAAiDsD,GAAjD,EAAsDlE,CAAtD,EAAyD;AACvDkE,MAAAA,GAAG,CAACE,SAAJ,CAAc,2CAA2CpE,CAAC,CAACu4B,OAA3D,EACGh0B,OADH,CACW,yBADX,EACsC,IADtC,EAEGW,IAFH,CAEQ,IAFR,EAEc,YAAW;AACrB,eAAOtE,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAC,CAACY,IAAI,CAACO,UAAN,CAAf,EAAkCwiB,OAAlC,CAA0C,CAA1C,CAAP;AACD,OAJH,EAKGze,IALH,CAKQ,IALR,EAKc,YAAW;AACrB,eAAOtE,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrpB,CAAC,CAACY,IAAI,CAACU,UAAN,CAAf,EAAkCqiB,OAAlC,CAA0C,CAA1C,CAAP;AACD,OAPH,EAQGze,IARH,CAQQ,GARR,EAQatE,IAAI,CAACkP,UARlB,EASGvH,KATH,CASS,SATT,EASoB,CATpB;AAUD;;AAED,aAASg2B,4BAAT,CAAsC39B,IAAtC,EAA4CZ,CAA5C,EAA+C+F,CAA/C,EAAkD;AAChD,UAAInF,IAAI,CAAC6R,MAAL,IAAe,CAACtT,EAAE,CAACyO,OAAH,CAAWU,IAA/B,EAAqC;AACnCnP,QAAAA,EAAE,CAACyO,OAAH,CAAWU,IAAX,GAAkB,IAAlB;;AACA,YAAI,CAAC1N,IAAI,CAAC4S,kBAAN,IAA4BxT,CAAC,CAAC6J,KAAF,KAAYkU,SAAxC,IAAqD/d,CAAC,CAAC8J,MAAF,CAAS7H,MAAT,GAAkB,CAA3E,EAA8E;AAC5E,cAAIf,KAAK,GAAGlB,CAAC,CAAC8J,MAAF,GAAW9J,CAAC,CAAC8J,MAAF,CAAS,CAAT,CAAX,GAAyB9J,CAArC;AACA,cAAI47B,EAAE,GAAGmB,qBAAqB,CAAC77B,KAAD,EAAQ6E,CAAR,EAAWnF,IAAX,CAA9B,CAF4E,CAG5E;;AACAxB,UAAAA,EAAE,CAACgF,SAAH,CAAa,MAAMw4B,aAAa,CAAC17B,KAAK,CAACq3B,OAAP,CAAnB,GAAqC,GAArC,GAA2CuE,oBAAoB,CAAClB,EAAD,CAA5E,EACG7yB,IADH,CACQ,UAAS/I,CAAT,EAAY;AAChBZ,YAAAA,EAAE,CAACqF,MAAH,CAAU,IAAV,EACGmR,EADH,CACM,WADN,EACmB5V,CADnB,EACsB+F,CADtB;AAED,WAJH;AAKD;AACF;AACF;;AAED,aAASy4B,2BAAT,CAAqC59B,IAArC,EAA2CZ,CAA3C,EAA8C+F,CAA9C,EAAiD;AAC/C,UAAInF,IAAI,CAAC6R,MAAL,IAAetT,EAAE,CAACyO,OAAH,CAAWU,IAA9B,EAAoC;AAClCnP,QAAAA,EAAE,CAACyO,OAAH,CAAWU,IAAX,GAAkB,KAAlB;AAEA,YAAIqtB,SAAS,GAAGx8B,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8BJ,IAAI,CAAC8R,aAAnC,CAAhB;AACA,YAAI+rB,MAAM,GAAGz+B,CAAC,CAAC8J,MAAF,GAAW9J,CAAC,CAAC8J,MAAb,GAAsB,CAAC9J,CAAD,CAAnC;AACAy+B,QAAAA,MAAM,CAACp1B,OAAP,CAAe,UAASnI,KAAT,EAAgB;AAC7B,cAAIw6B,CAAC,GAAGx6B,KAAK,CAACN,IAAI,CAACO,UAAN,CAAb;AACA,cAAIy6B,EAAE,GAAI,OAAOF,CAAP,KAAa,QAAd,GAA0B31B,CAA1B,GAA8B41B,SAAS,CAACD,CAAD,CAAhD,CAF6B,CAI7B;;AACAt8B,UAAAA,EAAE,CAACgF,SAAH,CAAa,WAAWw3B,EAAxB,EACG7yB,IADH,CACQ,UAAS/I,CAAT,EAAY;AAChBZ,YAAAA,EAAE,CAACqF,MAAH,CAAU,IAAV,EACGmR,EADH,CACM,UADN,EACkB5V,CADlB;AAED,WAJH;AAKD,SAVD;AAWD;AACF;;AAED,aAAS0+B,mDAAT,CAA6D99B,IAA7D,EAAmEsD,GAAnE,EAAwE;AACtEA,MAAAA,GAAG,CAACE,SAAJ,CAAc,gCAAd,EAAgD2F,MAAhD,CAAuD,UAASqxB,MAAT,EAAiB;AACpE,eAAOA,MAAM,CAACn5B,MAAP,GAAgB,CAAvB;AACD,OAFH,EAGGsG,KAHH,CAGS,SAHT,EAGoB,CAHpB;AAID;;AAED,aAASo2B,iDAAT,CAA2D/9B,IAA3D,EAAiEsD,GAAjE,EAAsElE,CAAtE,EAAyE;AACvEkE,MAAAA,GAAG,CAACE,SAAJ,CAAc,2CAA2CpE,CAAC,CAACu4B,OAA3D,EACGhwB,KADH,CACS,SADT,EACoB,YAAW;AAC3B,YAAIqzB,EAAE,GAAG57B,CAAC,CAACu4B,OAAF,GAAY,CAArB;;AAEA,YAAI33B,IAAI,CAACyS,qBAAL,CAA2BpR,MAA3B,GAAoC,CAApC,IACFrB,IAAI,CAACyS,qBAAL,CAA2BsX,OAA3B,CAAmC3qB,CAAC,CAACu4B,OAArC,MAAkDxa,SADpD,EAEE;AACA6d,UAAAA,EAAE,GAAGh7B,IAAI,CAACyS,qBAAL,CAA2BsX,OAA3B,CAAmC3qB,CAAC,CAACu4B,OAArC,CAAL;AACD;;AAED,YAAI33B,IAAI,CAAClB,IAAL,CAAUk8B,EAAV,EAAc35B,MAAd,KAAyB,CAA7B,EAAgC;AAC9B,iBAAO,CAAP;AACD,SAFD,MAEO;AACL,iBAAO,CAAP;AACD;AACF,OAfH;AAgBD;;AAED,aAAS28B,qBAAT,CAA+B16B,GAA/B,EAAoC;AAClCA,MAAAA,GAAG,CAACO,MAAJ,CAAW,sBAAX,EAAmCgC,IAAnC,CAAwC,EAAxC;AACD;;AAED,aAASo4B,SAAT,CAAmBj+B,IAAnB,EAAyB;AACvB,WAAK0T,IAAL,GAAY,UAAS1T,IAAT,EAAe;AACzB,aAAKA,IAAL,GAAYA,IAAZ;;AAEA,YAAI,CAACA,IAAI,CAAClB,IAAN,IAAckB,IAAI,CAAClB,IAAL,CAAUuC,MAAV,KAAqB,CAAvC,EAA0C;AACxCrB,UAAAA,IAAI,CAACk+B,cAAL,GAAsB,sBAAtB;AACAA,UAAAA,cAAc,CAACl+B,IAAD,CAAd;AACA,iBAAO,IAAP;AACD,SAJD,MAIO;AACLA,UAAAA,IAAI,CAACk+B,cAAL,GAAsB/gB,SAAtB;AACD;;AAEDghB,QAAAA,uBAAuB,CAACn+B,IAAD,CAAvB;AACAo+B,QAAAA,YAAY,CAACp+B,IAAD,CAAZ;AAEAzB,QAAAA,EAAE,CAACqO,SAAH,CAAa,qBAAb,EAAoC,IAApC;AAEA8G,QAAAA,IAAI,CAAC1T,IAAD,CAAJ,CAhByB,CAkBzB;;AACA,YAAIzB,EAAE,CAAC+hB,aAAP,CAAqBtgB,IAArB,EACG4d,SADH,CACa,GADb,EAEGU,uBAFH,GAGGiB,cAHH,CAGkB,QAHlB;AAKA,YAAIvN,SAAS,GAAG,CAAChS,IAAI,CAACgS,SAAL,IAAkB,EAAnB,EAAuB7S,GAAvB,CAA2B,UAASC,CAAT,EAAY;AACrD,iBAAOA,CAAC,CAACY,IAAI,CAACU,UAAN,CAAR;AACD,SAFe,CAAhB;AAIA,YAAInC,EAAE,CAAC+hB,aAAP,CAAqBtgB,IAArB,EACG4d,SADH,CACa,GADb,EAEGS,UAFH,CAEc,IAFd,EAGGF,aAHH,CAGiB,IAHjB,EAIGG,uBAJH,CAI2BtM,SAJ3B,EAKGuN,cALH,CAKkB,MALlB;AAOA,YAAIjc,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;;AAEA,YAAIjE,IAAI,CAACsP,MAAT,EAAiB;AACf,cAAI/Q,EAAE,CAACspB,YAAP,CAAoB7nB,IAApB,EACG4d,SADH,CACa,GADb,EAEGxK,IAFH,CAEQ,WAFR,EAGGrI,QAHH,CAGY/K,IAAI,CAACwP,eAHjB,EAIGpL,GAJH,CAIOyM,KAAK,CAAC7Q,IAAD,CAJZ,EAKGunB,KALH,CAKSgD,cALT,EAMG3C,IANH;AAOD;;AAED,YAAI5nB,IAAI,CAACuP,MAAT,EAAiB;AACf,cAAIhR,EAAE,CAACspB,YAAP,CAAoB7nB,IAApB,EACG4d,SADH,CACa,GADb,EAEGxK,IAFH,CAEQ,WAFR,EAGGrI,QAHH,CAGY/K,IAAI,CAACyP,eAHjB,EAIGrL,GAJH,CAIO0M,KAAK,CAAC9Q,IAAD,CAJZ,EAKGunB,KALH,CAKS0B,cALT,EAMGrB,IANH;AAOD;;AAED,aAAK3V,OAAL;AACA,aAAKosB,QAAL;AACA,aAAKC,QAAL;AACA,aAAKC,eAAL;AAEAhgC,QAAAA,EAAE,CAACqO,SAAH,CAAa,iBAAb,EAAgC,IAAhC;AAEA,eAAO,IAAP;AACD,OAjED;;AAmEA,WAAKyxB,QAAL,GAAgB,YAAW;AACzBrB,QAAAA,iBAAiB,CAACh9B,IAAD,CAAjB;AACA,eAAO,IAAP;AACD,OAHD;;AAKA,WAAKiS,OAAL,GAAe,YAAW;AACxBA,QAAAA,OAAO,CAACjS,IAAD,CAAP;AACA,eAAO,IAAP;AACD,OAHD;;AAKA,WAAKs+B,QAAL,GAAgB,YAAW;AACzB,YAAI1nB,IAAI,GAAG,IAAX;AACAumB,QAAAA,sBAAsB,CAACn9B,IAAD,EAAO4W,IAAP,CAAtB;AACArY,QAAAA,EAAE,CAACqO,SAAH,CAAa,qBAAb,EAAoC5M,IAApC;AAEA,eAAO,IAAP;AACD,OAND;;AAQA,WAAKq9B,UAAL,GAAkB,UAASr9B,IAAT,EAAe;AAC/B,YAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,YAAIhE,GAAG,GAAGF,2BAA2B,CAACC,IAAD,CAArC;AAEA,eAAO,UAASZ,CAAT,EAAY+F,CAAZ,EAAe;AACpBq4B,UAAAA,yBAAyB,CAACx9B,IAAD,EAAOsD,GAAP,EAAYlE,CAAZ,CAAzB;AACAu+B,UAAAA,4BAA4B,CAAC39B,IAAD,EAAOZ,CAAP,EAAU+F,CAAV,CAA5B;AAEA7B,UAAAA,GAAG,CAACE,SAAJ,CAAc,MAAd,EACG2F,MADH,CACU,UAASwa,CAAT,EAAY7d,CAAZ,EAAe;AACrB,mBAAO1G,CAAC,KAAKukB,CAAb;AACD,WAHH,EAIGrf,IAJH,CAIQ,SAJR,EAImB,GAJnB,EAJoB,CAUpB;;AACA,cAAItE,IAAI,CAACqR,kBAAL,IACA,EAAGrR,IAAI,CAAC6N,iBAAL,IAA0BzO,CAAC,CAAC,UAAD,CAA5B,IAA6CA,CAAC,CAACY,IAAI,CAACU,UAAN,CAAD,KAAuB,IAAtE,CADJ,EAEI;AACF,gBAAIyQ,SAAS,GAAGiiB,iBAAiB,CAACpzB,IAAD,EAAO;AAAEsD,cAAAA,GAAG,EAAEA;AAAP,aAAP,CAAjC;AACA,gBAAIk7B,GAAG,GAAGrtB,SAAS,CAACmiB,aAAV,EAAV;;AACA,gBAAItzB,IAAI,CAAC4S,kBAAT,EAA6B;AAC3B4rB,cAAAA,GAAG,CAAC34B,IAAJ,CAAS,CAAC7F,IAAI,CAAC4S,kBAAL,IAA2B5S,IAAI,CAAClB,IAAL,CAAUuC,MAAV,GAAmB,CAA9C,GACNo9B,+BADM,GAENC,qBAFK,EAEkB1+B,IAFlB,EAEwBZ,CAFxB,CAAT;AAGD;;AAED,gBAAIyzB,GAAG,GAAG7yB,IAAI,CAAC4S,kBAAL,IAA2B5S,IAAI,CAAClB,IAAL,CAAUuC,MAAV,GAAmB,CAA9C,GACNjC,CAAC,CAAC8J,MADI,GAEN,CAAC9J,CAAD,CAFJ;AAIAyzB,YAAAA,GAAG,CAACpqB,OAAJ,CAAY,UAASyU,EAAT,EAAa;AACvB,kBAAIld,IAAI,CAAC4S,kBAAT,EAA6B;AAC3B4rB,gBAAAA,GAAG,GAAGrtB,SAAS,CAACmiB,aAAV,EAAN;AACD;;AAED,kBAAItzB,IAAI,CAAC+N,MAAT,EAAiB;AACf2pB,gBAAAA,kBAAkB,CAAC8G,GAAG,CAAC34B,IAAJ,CAAS7F,IAAI,CAAC+N,MAAL,CAAYmP,EAAE,CAACya,OAAH,GAAa,CAAzB,IAA8B,IAAvC,EAA6ChF,IAA7C,GAAoDzvB,IAApD,EAAD,EAA6Dga,EAA7D,EAAiEld,IAAjE,CAAlB;AACD;;AAED03B,cAAAA,kBAAkB,CAAC8G,GAAG,CAAC34B,IAAJ,CAAS,UAAT,EAAqB3C,IAArB,EAAD,EAA8Bga,EAA9B,EAAkCld,IAAlC,CAAlB;;AACA,kBAAI,CAACA,IAAI,CAAC4S,kBAAV,EAA8B;AAC5B4rB,gBAAAA,GAAG,CAAC34B,IAAJ,CAAS64B,qBAAqB,CAAC1+B,IAAD,EAAOkd,EAAP,CAA9B;AACD;;AAEDshB,cAAAA,GAAG,CAAC34B,IAAJ,CAAS84B,qBAAqB,CAAC3+B,IAAD,EAAOkd,EAAP,EAAWld,IAAI,CAAC4jB,WAAL,KAAqB,KAAhC,CAA9B;AACD,aAfD;AAgBD;;AAED,cAAI5jB,IAAI,CAACmR,SAAT,EAAoB;AAClBnR,YAAAA,IAAI,CAACmR,SAAL,CAAe/R,CAAf,EAAkB+F,CAAlB;AACD;AACF,SA/CD;AAgDD,OApDD;;AAsDA,WAAKm4B,WAAL,GAAmB,UAASt9B,IAAT,EAAe;AAChC,YAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AAEA,eAAO,UAAS7E,CAAT,EAAY+F,CAAZ,EAAe;AACpBy4B,UAAAA,2BAA2B,CAAC59B,IAAD,EAAOZ,CAAP,EAAU+F,CAAV,CAA3B;;AACA,cAAInF,IAAI,CAAC4S,kBAAT,EAA6B;AAC3BkrB,YAAAA,mDAAmD,CAAC99B,IAAD,EAAOsD,GAAP,CAAnD;AACD,WAFD,MAEO;AACLy6B,YAAAA,iDAAiD,CAAC/9B,IAAD,EAAOsD,GAAP,EAAYlE,CAAZ,CAAjD;AACD;;AAED,cAAIY,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAauC,MAAb,GAAsB,CAA1B,EAA6B;AAC3B6wB,YAAAA,4BAA4B,CAAC5uB,GAAD,CAA5B;AACD;;AAED,cAAItD,IAAI,CAAC4+B,QAAT,EAAmB;AACjB5+B,YAAAA,IAAI,CAAC4+B,QAAL,CAAcx/B,CAAd,EAAiB+F,CAAjB;AACD;AACF,SAfD;AAgBD,OAnBD;;AAqBA,WAAKo4B,YAAL,GAAoB,UAASv9B,IAAT,EAAe;AACjC,eAAO,UAASZ,CAAT,EAAY+F,CAAZ,EAAe;AACpB,cAAInF,IAAI,CAAC6+B,SAAT,EAAoB;AAClB7+B,YAAAA,IAAI,CAAC6+B,SAAL,CAAez/B,CAAf,EAAkB+F,CAAlB;AACD;AACF,SAJD;AAKD,OAND;;AAQA,WAAKo5B,eAAL,GAAuB,YAAW;AAChCvJ,QAAAA,mBAAmB,CAAC,KAAKh1B,IAAN,CAAnB;AACA,eAAO,IAAP;AACD,OAHD;;AAKA,WAAK0T,IAAL,CAAU1T,IAAV;AACD;;AAEDzB,IAAAA,EAAE,CAACyN,QAAH,CAAY,MAAZ,EAAoBiyB,SAApB;AACD,GAx5BD,EAw5BG/8B,IAx5BH,CAw5BQ,IAx5BR;AA05BA,GAAC,YAAW;AACV;;AAEA,aAAS49B,SAAT,CAAmB9+B,IAAnB,EAAyB;AACvB,WAAK0T,IAAL,GAAY,UAAS1T,IAAT,EAAe;AACzB,aAAKA,IAAL,GAAYA,IAAZ;AAEAm+B,QAAAA,uBAAuB,CAACn+B,IAAD,CAAvB;AACA++B,QAAAA,iBAAiB,CAAC/+B,IAAD,CAAjB;AACA0T,QAAAA,IAAI,CAAC1T,IAAD,CAAJ;AAEA,YAAIzB,EAAE,CAAC+hB,aAAP,CAAqBtgB,IAArB,EACG4d,SADH,CACa,GADb,EAEGU,uBAFH,GAGGiB,cAHH,CAGkB,QAHlB;AAKA,YAAIvN,SAAS,GAAG,CAAChS,IAAI,CAACgS,SAAL,IAAkB,EAAnB,EAAuB7S,GAAvB,CAA2B,UAASC,CAAT,EAAY;AACrD,iBAAOA,CAAC,CAACY,IAAI,CAACU,UAAN,CAAR;AACD,SAFe,CAAhB;AAIA,YAAInC,EAAE,CAAC+hB,aAAP,CAAqBtgB,IAArB,EACG4d,SADH,CACa,GADb,EAEGS,UAFH,CAEc,IAFd,EAGGF,aAHH,CAGiB,IAHjB,EAIGG,uBAJH,CAI2BtM,SAJ3B,EAKGuN,cALH,CAKkB,MALlB;AAOAjQ,QAAAA,MAAM,CAACtP,IAAD,CAAN;AACAuP,QAAAA,MAAM,CAACvP,IAAD,CAAN;AAEA,aAAKq+B,QAAL;AACA,aAAKpsB,OAAL;AACA,aAAKqsB,QAAL;AACA,aAAKC,eAAL;AAEA,eAAO,IAAP;AACD,OAhCD;;AAkCA,WAAKF,QAAL,GAAgB,YAAW;AACzB,YAAI/6B,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B,CADyB,CAGzB;;AACAX,QAAAA,GAAG,CAACE,SAAJ,CAAc,eAAd,EAA+BJ,MAA/B;AAEA,YAAIugB,CAAC,GAAGrgB,GAAG,CAACI,MAAJ,CAAW,GAAX,EACLY,IADK,CACA,OADA,EACS,cADT,CAAR;AAGA,YAAI06B,GAAG,GAAGrb,CAAC,CAACngB,SAAF,CAAY,SAAZ,EACP1E,IADO,CACFkB,IAAI,CAAClB,IAAL,CAAU,CAAV,CADE,EAEPuF,KAFO,GAECX,MAFD,CAEQ,GAFR,EAGPY,IAHO,CAGF,OAHE,EAGO,QAHP,EAIPA,IAJO,CAIF,WAJE,EAIW,UAASlF,CAAT,EAAY;AAC7B,iBAAO,eAAeY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAC,CAACY,IAAI,CAACO,UAAN,CAAf,EAAkCwiB,OAAlC,CAA0C,CAA1C,CAAf,GAA8D,GAA9D,GAAoE/iB,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrpB,CAAC,CAACY,IAAI,CAACU,UAAN,CAAf,EAAkCqiB,OAAlC,CAA0C,CAA1C,CAApE,GAAmH,GAA1H;AACD,SANO,CAAV,CATyB,CAiBzB;;AACAic,QAAAA,GAAG,CAACt7B,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,GADR,EACa,CADb,EAEGA,IAFH,CAEQ,OAFR,EAEiB,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AAC5B,cAAInF,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAauC,MAAb,KAAwB,CAA5B,EAA+B;AAC7B,mBAAO,CAACrB,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,CAAiBlqB,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAa,CAAb,CAAjB,IAAoCkB,IAAI,CAACi/B,UAA1C,EAAsDlc,OAAtD,CAA8D,CAA9D,CAAP;AACD,WAFD,MAEO,IAAI5d,CAAC,KAAKnF,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAauC,MAAb,GAAsB,CAAhC,EAAmC;AACxC,mBAAO,CAACrB,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,CAAiBlqB,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAaqG,CAAC,GAAG,CAAjB,CAAjB,IAAwCnF,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,CAAiB9qB,CAAjB,CAAzC,EAA8D2jB,OAA9D,CAAsE,CAAtE,CAAP;AACD,WAFM,MAEA;AACL,mBAAO,CAAC/iB,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,CAAiBlqB,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAa,CAAb,CAAjB,IAAoCkB,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,CAAiBlqB,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAa,CAAb,CAAjB,CAArC,EAAwEikB,OAAxE,CAAgF,CAAhF,CAAP;AACD;AACF,SAVH,EAWGze,IAXH,CAWQ,QAXR,EAWkB,UAASlF,CAAT,EAAY;AAC1B,cAAIA,CAAC,CAACY,IAAI,CAACU,UAAN,CAAD,KAAuB,CAA3B,EAA8B;AAC5B,mBAAO,CAAP;AACD;;AAED,iBAAO,CAACV,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACoC,MAAnB,GAA4BpC,IAAI,CAACsC,MAAjC,GAA0CtC,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrpB,CAAC,CAACY,IAAI,CAACU,UAAN,CAAf,CAA3C,EAA8EqiB,OAA9E,CAAsF,CAAtF,CAAP;AACD,SAjBH;AAmBA,eAAO,IAAP;AACD,OAtCD;;AAwCA,WAAK9Q,OAAL,GAAe,YAAW;AACxBA,QAAAA,OAAO,CAACjS,IAAD,CAAP;AACA,eAAO,IAAP;AACD,OAHD;;AAKA,WAAKs+B,QAAL,GAAgB,YAAW;AACzB,YAAIh7B,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;;AAEA,YAAIX,GAAG,CAACE,SAAJ,CAAc,gCAAd,EAAgDyrB,KAAhD,GAAwD5tB,MAAxD,KAAmE,CAAvE,EAA0E;AACxEoC,UAAAA,QAAQ,CAACH,GAAD,EAAM,+BAAN,CAAR;AACD,SALwB,CAOzB;;;AACAA,QAAAA,GAAG,CAACE,SAAJ,CAAc,mBAAd,EAAmCJ,MAAnC;AACAE,QAAAA,GAAG,CAACE,SAAJ,CAAc,sBAAd,EAAsCJ,MAAtC;AAEA,YAAIugB,CAAC,GAAGrgB,GAAG,CAACI,MAAJ,CAAW,GAAX,EACLY,IADK,CACA,OADA,EACS,kBADT,CAAR,CAXyB,CAczB;;AACA,YAAI06B,GAAG,GAAGrb,CAAC,CAACngB,SAAF,CAAY,SAAZ,EACP1E,IADO,CACFkB,IAAI,CAAClB,IAAL,CAAU,CAAV,CADE,EAEPuF,KAFO,GAECX,MAFD,CAEQ,GAFR,EAGPY,IAHO,CAGF,OAHE,EAGO,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AAC5B,cAAInF,IAAI,CAAC6R,MAAT,EAAiB;AACf,mBAAO,4BAA4B1M,CAAnC;AACD,WAFD,MAEO;AACL,mBAAO,mBAAP;AACD;AACF,SATO,EAUPb,IAVO,CAUF,WAVE,EAUW,UAASlF,CAAT,EAAY;AAC7B,iBAAO,eAAgBY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAC,CAACY,IAAI,CAACO,UAAN,CAAf,CAAhB,GAAqD,GAArD,GAA2D,CAA3D,GAA+D,GAAtE;AACD,SAZO,CAAV;AAcAy+B,QAAAA,GAAG,CAACt7B,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,GADR,EACa,CADb,EAEGA,IAFH,CAEQ,GAFR,EAEatE,IAAI,CAACsC,MAAL,GAActC,IAAI,CAACmO,gBAFhC,EAGG7J,IAHH,CAGQ,OAHR,EAGiB,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AAC5B;AACA,cAAInF,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAauC,MAAb,KAAwB,CAA5B,EAA+B;AAC7B,mBAAO,CAACrB,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,CAAiBlqB,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAa,CAAb,CAAjB,IAAoCkB,IAAI,CAACi/B,UAA1C,EAAsDlc,OAAtD,CAA8D,CAA9D,CAAP;AACD,WAFD,MAEO,IAAI5d,CAAC,KAAKnF,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAauC,MAAb,GAAsB,CAAhC,EAAmC;AACxC,mBAAO,CAACrB,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,CAAiBlqB,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAaqG,CAAC,GAAG,CAAjB,CAAjB,IAAwCnF,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,CAAiB9qB,CAAjB,CAAzC,EAA8D2jB,OAA9D,CAAsE,CAAtE,CAAP;AACD,WAFM,MAEA;AACL,mBAAO,CAAC/iB,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,CAAiBlqB,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAa,CAAb,CAAjB,IAAoCkB,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,CAAiBlqB,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAa,CAAb,CAAjB,CAArC,EAAwEikB,OAAxE,CAAgF,CAAhF,CAAP;AACD;AACF,SAZH,EAaGze,IAbH,CAaQ,QAbR,EAakB,UAASlF,CAAT,EAAY;AAC1B,iBAAOY,IAAI,CAACmC,MAAZ;AACD,SAfH,EAgBGmC,IAhBH,CAgBQ,SAhBR,EAgBmB,CAhBnB,EAiBG0Q,EAjBH,CAiBM,WAjBN,EAiBmB,KAAKqoB,UAAL,CAAgBr9B,IAAhB,CAjBnB,EAkBGgV,EAlBH,CAkBM,UAlBN,EAkBkB,KAAKsoB,WAAL,CAAiBt9B,IAAjB,CAlBlB,EAmBGgV,EAnBH,CAmBM,WAnBN,EAmBmB,KAAKuoB,YAAL,CAAkBv9B,IAAlB,CAnBnB;AAqBA,eAAO,IAAP;AACD,OAnDD;;AAqDA,WAAKq9B,UAAL,GAAkB,UAASr9B,IAAT,EAAe;AAC/B,YAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AAEA,eAAO,UAAS7E,CAAT,EAAY+F,CAAZ,EAAe;AACpB7B,UAAAA,GAAG,CAACE,SAAJ,CAAc,MAAd,EACG2F,MADH,CACU,UAASwa,CAAT,EAAY7d,CAAZ,EAAe;AACrB,mBAAO1G,CAAC,KAAKukB,CAAb;AACD,WAHH,EAIGrf,IAJH,CAIQ,SAJR,EAImB,GAJnB;AAMA,cAAIrE,GAAG,GAAGD,IAAI,CAACE,SAAL,CAAeqR,UAAf,IAA6BhT,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,WAA9B,CAAvC;AACA,cAAI8+B,GAAG,GAAGC,sBAAsB,CAACn/B,IAAD,CAAhC;AAEAsD,UAAAA,GAAG,CAACE,SAAJ,CAAc,cAAd,EACG2F,MADH,CACU,UAAS/J,CAAT,EAAY0G,CAAZ,EAAe;AACrB,mBAAOA,CAAC,KAAKX,CAAb;AACD,WAHH,EAIGxB,OAJH,CAIW,QAJX,EAIqB,IAJrB,EAVoB,CAgBpB;;AACA,cAAI3D,IAAI,CAAC6R,MAAL,IAAe,CAACtT,EAAE,CAACyO,OAAH,CAAWU,IAA/B,EAAqC;AACnCnP,YAAAA,EAAE,CAACyO,OAAH,CAAWU,IAAX,GAAkB,IAAlB,CADmC,CAGnC;;AACAlP,YAAAA,EAAE,CAACgF,SAAH,CAAa,6BAA6B2B,CAA7B,GAAiC,OAA9C,EACGgD,IADH,CACQ,UAAS/I,CAAT,EAAY;AAAE;AAClBZ,cAAAA,EAAE,CAACqF,MAAH,CAAU,IAAV,EAAgBmR,EAAhB,CAAmB,WAAnB,EAAgC5V,CAAhC,EAAmC+F,CAAnC;AACD,aAHH;AAID,WAzBmB,CA2BpB;;;AACA,cAAInF,IAAI,CAACqR,kBAAT,EAA6B;AAC3B,gBAAI+tB,EAAE,GAAGhM,iBAAiB,CAACpzB,IAAD,EAAO;AAAEsD,cAAAA,GAAG,EAAEA;AAAP,aAAP,CAA1B;AACA,gBAAIk7B,GAAG,GAAGY,EAAE,CAAC9L,aAAH,EAAV;AACAkL,YAAAA,GAAG,CAAC34B,IAAJ,CAAS,UAAT,EAAqB3C,IAArB,GACGS,OADH,CACW,aADX,EAC0B,IAD1B;AAGA66B,YAAAA,GAAG,CAAC34B,IAAJ,CAAS64B,qBAAqB,CAAC1+B,IAAD,EAAOZ,CAAP,CAA9B,EAN2B,CAMe;;AAC1Co/B,YAAAA,GAAG,CAAC34B,IAAJ,CAAS84B,qBAAqB,CAAC3+B,IAAD,EAAOZ,CAAP,EAAUY,IAAI,CAAC4jB,WAAL,KAAqB,KAA/B,CAA9B;AACD;;AAED,cAAI5jB,IAAI,CAACmR,SAAT,EAAoB;AAClBghB,YAAAA,4BAA4B,CAAC7uB,GAAD,EAAMtD,IAAN,CAA5B;AACAA,YAAAA,IAAI,CAACmR,SAAL,CAAe/R,CAAf,EAAkB+F,CAAlB;AACD;AACF,SA1CD;AA2CD,OA9CD;;AAgDA,WAAKm4B,WAAL,GAAmB,UAASt9B,IAAT,EAAe;AAChC,YAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AAEA,eAAO,UAAS7E,CAAT,EAAY+F,CAAZ,EAAe;AACpB,cAAInF,IAAI,CAAC6R,MAAL,IAAetT,EAAE,CAACyO,OAAH,CAAWU,IAA9B,EAAoC;AAClCnP,YAAAA,EAAE,CAACyO,OAAH,CAAWU,IAAX,GAAkB,KAAlB,CADkC,CAGlC;;AACAlP,YAAAA,EAAE,CAACgF,SAAH,CAAa,6BAA6B2B,CAA7B,GAAiC,OAA9C,EACGgD,IADH,CACQ,UAAS/I,CAAT,EAAY;AAAE;AAClBZ,cAAAA,EAAE,CAACqF,MAAH,CAAU,IAAV,EAAgBmR,EAAhB,CAAmB,UAAnB,EAA+B5V,CAA/B,EAAkC+F,CAAlC;AACD,aAHH;AAID,WATmB,CAWpB;;;AACA7B,UAAAA,GAAG,CAACE,SAAJ,CAAc,cAAd,EACGG,OADH,CACW,QADX,EACqB,KADrB,EAZoB,CAepB;;AACAuuB,UAAAA,4BAA4B,CAAC5uB,GAAD,CAA5B;;AAEA,cAAItD,IAAI,CAAC4+B,QAAT,EAAmB;AACjB5+B,YAAAA,IAAI,CAAC4+B,QAAL,CAAcx/B,CAAd,EAAiB+F,CAAjB;AACD;AACF,SArBD;AAsBD,OAzBD;;AA2BA,WAAKo4B,YAAL,GAAoB,UAASv9B,IAAT,EAAe;AACjC,eAAO,UAASZ,CAAT,EAAY+F,CAAZ,EAAe;AACpB,cAAInF,IAAI,CAAC6+B,SAAT,EAAoB;AAClB7+B,YAAAA,IAAI,CAAC6+B,SAAL,CAAez/B,CAAf,EAAkB+F,CAAlB;AACD;AACF,SAJD;AAKD,OAND;;AAQA,WAAKo5B,eAAL,GAAuB,YAAW;AAChCvJ,QAAAA,mBAAmB,CAAC,KAAKh1B,IAAN,CAAnB;AACA,eAAO,IAAP;AACD,OAHD;;AAKA,WAAK0T,IAAL,CAAU1T,IAAV;AACD;;AAED,QAAImM,QAAQ,GAAG;AACbkzB,MAAAA,MAAM,EAAE,KADK;AAEbC,MAAAA,IAAI,EAAE,IAFO;AAGbC,MAAAA,oBAAoB,EAAE,GAHT;AAIbC,MAAAA,oBAAoB,EAAE,GAJT;AAKbC,MAAAA,qBAAqB,EAAE,IALV;AAMbR,MAAAA,UAAU,EAAE;AANC,KAAf;AASA1gC,IAAAA,EAAE,CAACyN,QAAH,CAAY,WAAZ,EAAyB8yB,SAAzB,EAAoC3yB,QAApC;AACD,GA7OD,EA6OGjL,IA7OH,CA6OQ,IA7OR;;AA+OA,WAASw+B,eAAT,CAAyB1/B,IAAzB,EAA+BsD,GAA/B,EAAoClE,CAApC,EAAuC;AACrC,QAAI+R,SAAS,GAAGiiB,iBAAiB,CAACpzB,IAAD,EAAO;AAAEsD,MAAAA,GAAG,EAAEA;AAAP,KAAP,CAAjC;AACA,QAAIk7B,GAAG,GAAGrtB,SAAS,CAACmiB,aAAV,EAAV;;AAEA,QAAItzB,IAAI,CAACyE,cAAL,KAAwB,IAAxB,IAAgCzE,IAAI,CAACshB,UAAL,KAAoB,UAAxD,EAAoE;AAClE,UAAIiG,KAAK,GAAGnoB,CAAC,CAACY,IAAI,CAACyE,cAAN,CAAb;AACA+5B,MAAAA,GAAG,CAAC34B,IAAJ,CAAS0hB,KAAK,GAAG,IAAjB,EAAuBoL,IAAvB,GAA8BzvB,IAA9B,GAAqCoB,IAArC,CAA0C,MAA1C,EAAkDtE,IAAI,CAAC0E,QAAL,CAAcC,MAAd,CAAqBvF,CAArB,CAAlD;AACD;;AAEDugC,IAAAA,wBAAwB,CAAC3/B,IAAD,EAAOw+B,GAAG,CAAC34B,IAAJ,CAAS,WAAT,EAAsB3C,IAAtB,EAAP,EAAqC9D,CAArC,CAAxB,CATqC,CAS4B;;AAEjEo/B,IAAAA,GAAG,CAAC34B,IAAJ,CAAS64B,qBAAqB,CAAC1+B,IAAD,EAAOZ,CAAP,CAA9B,EAXqC,CAWK;;AAC1Co/B,IAAAA,GAAG,CAAC34B,IAAJ,CAAS84B,qBAAqB,CAAC3+B,IAAD,EAAOZ,CAAP,EAAUY,IAAI,CAAC4jB,WAAL,KAAqB,KAA/B,CAA9B;AACD;;AAED,WAAS+b,wBAAT,CAAkC3/B,IAAlC,EAAwCkD,IAAxC,EAA8C9D,CAA9C,EAAiD;AAC/C,QAAIY,IAAI,CAACyE,cAAL,KAAwB,IAA5B,EAAkC;AAChCvB,MAAAA,IAAI,CAACoB,IAAL,CAAU,MAAV,EAAkBtE,IAAI,CAAC0E,QAAL,CAAcC,MAAd,CAAqBvF,CAArB,CAAlB;AACA8D,MAAAA,IAAI,CAACoB,IAAL,CAAU,QAAV,EAAoBtE,IAAI,CAAC0E,QAAL,CAAcC,MAAd,CAAqBvF,CAArB,CAApB;AACD,KAHD,MAGO;AACL8D,MAAAA,IAAI,CAACS,OAAL,CAAa,gBAAb,EAA+B,IAA/B;AACD;AACF;;AAGD,GAAC,YAAW;AACV;;AAEA,aAASi8B,yBAAT,CAAmC9gC,IAAnC,EAAyCkB,IAAzC,EAA+C;AAC7C;AACA,UAAIkjB,CAAC,GAAGljB,IAAI,CAACO,UAAb;AACA,UAAIoL,CAAC,GAAG3L,IAAI,CAACU,UAAb;AACA,UAAIm/B,QAAQ,GAAG/gC,IAAI,CAACqK,MAAL,CAAY,UAAS/J,CAAT,EAAY;AACrC,eAAO,CAACY,IAAI,CAACQ,KAAL,KAAe,IAAf,IAAuBpB,CAAC,CAAC8jB,CAAD,CAAD,IAAQljB,IAAI,CAACQ,KAArC,MACJR,IAAI,CAACS,KAAL,KAAe,IAAf,IAAuBrB,CAAC,CAAC8jB,CAAD,CAAD,IAAQljB,IAAI,CAACS,KADhC,MAEJT,IAAI,CAACW,KAAL,KAAe,IAAf,IAAuBvB,CAAC,CAACuM,CAAD,CAAD,IAAQ3L,IAAI,CAACW,KAFhC,MAGJX,IAAI,CAACY,KAAL,KAAe,IAAf,IAAuBxB,CAAC,CAACuM,CAAD,CAAD,IAAQ3L,IAAI,CAACY,KAHhC,CAAP;AAID,OALc,CAAf;AAMA,aAAOi/B,QAAP;AACD;;AAED,aAASC,UAAT,CAAoB9/B,IAApB,EAA0B;AACxB,WAAK0T,IAAL,GAAY,UAAS1T,IAAT,EAAe;AACzB,aAAKA,IAAL,GAAYA,IAAZ,CADyB,CAGzB;;AACAA,QAAAA,IAAI,CAAC0P,WAAL,GAAmBpJ,aAAa,CAACtG,IAAD,EAAO,GAAP,CAAhC;AACAA,QAAAA,IAAI,CAAC2P,WAAL,GAAmBrJ,aAAa,CAACtG,IAAD,EAAO,GAAP,CAAhC;AAEAm+B,QAAAA,uBAAuB,CAACn+B,IAAD,CAAvB;AAEA+/B,QAAAA,aAAa,CAAC//B,IAAD,CAAb;AACA0T,QAAAA,IAAI,CAAC1T,IAAD,CAAJ;AAEA,YAAIggC,MAAJ,EAAYC,MAAZ;;AAEA,YAAIjgC,IAAI,CAAC0P,WAAL,KAAqB,aAAzB,EAAwC;AACtCswB,UAAAA,MAAM,GAAGzhC,EAAE,CAAC+hB,aAAH,CAAiBtgB,IAAjB,EACN4d,SADM,CACI,GADJ,EAENuB,yBAFM,GAGNM,qBAHM,CAGgB,CAAC,CAAD,EAAIzf,IAAI,CAACkgC,aAAT,CAHhB,EAGyClgC,IAAI,CAAC6P,eAAL,KAAyB,IAHlE,CAAT;;AAKA,cAAI7P,IAAI,CAAC6P,eAAT,EAA0B;AACxB,gBAAItR,EAAE,CAAC+hB,aAAP,CAAqBtgB,IAArB,EACG4d,SADH,CACa,QADb,EAEGuB,yBAFH,GAGGM,qBAHH,CAGyB,QAHzB;AAKD,WAND,MAMO;AACLzf,YAAAA,IAAI,CAACkS,MAAL,CAAYiuB,MAAZ,GAAqB,UAAS/gC,CAAT,EAAY;AAC/B,qBAAOwD,gBAAgB,CAAC5C,IAAD,CAAvB;AAA+B,aADjC;;AAEAA,YAAAA,IAAI,CAAC0E,QAAL,CAAc07B,OAAd,GAAwB,UAAShhC,CAAT,EAAY;AAClC,qBAAOwD,gBAAgB,CAAC5C,IAAD,CAAvB;AAA+B,aADjC;AAED;;AAEDA,UAAAA,IAAI,CAAC0E,QAAL,CAAc27B,KAAd,GAAsB,UAASjhC,CAAT,EAAY;AAChC,mBAAOY,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,CAAiB9qB,CAAjB,IAAsBY,IAAI,CAAC0E,QAAL,CAAc07B,OAAd,CAAsBhhC,CAAtB,CAA7B;AACD,WAFD;AAGD,SAtBD,MAsBO;AACL4gC,UAAAA,MAAM,GAAGzhC,EAAE,CAAC+hB,aAAH,CAAiBtgB,IAAjB,EACN4d,SADM,CACI,GADJ,EAENO,aAFM,CAEQ,IAFR,EAGNE,UAHM,CAGKre,IAAI,CAAC2P,WAAL,KAAqB,aAH1B,EAIN2O,uBAJM,CAIkB,CAACte,IAAI,CAACgS,SAAL,IAAkB,EAAnB,EAAuB7S,GAAvB,CAA2B,UAASC,CAAT,EAAY;AAC9D,mBAAOA,CAAC,CAACY,IAAI,CAACO,UAAN,CAAR;AAA2B,WADJ,CAJlB,EAMNgf,cANM,CAMS,QANT,CAAT;AAQAvf,UAAAA,IAAI,CAAC0E,QAAL,CAAc27B,KAAd,GAAsBrgC,IAAI,CAAC0E,QAAL,CAAcwlB,EAApC;AACD,SA9CwB,CAgDzB;;;AACA,YAAIlqB,IAAI,CAAC2P,WAAL,KAAqB,aAAzB,EAAwC;AACtCswB,UAAAA,MAAM,GAAG1hC,EAAE,CAAC+hB,aAAH,CAAiBtgB,IAAjB,EACN4d,SADM,CACI,GADJ,EAENS,UAFM,CAEK,IAFL,EAGNc,yBAHM,GAINM,qBAJM,CAIgB,CAAC,CAAD,EAAIzf,IAAI,CAAC6pB,aAAT,CAJhB,EAIyC,IAJzC,CAAT;;AAMA,cAAI7pB,IAAI,CAAC4P,eAAT,EAA0B;AAExB,gBAAIrR,EAAE,CAAC+hB,aAAP,CAAqBtgB,IAArB,EACG4d,SADH,CACa,QADb,EAEGuB,yBAFH,GAGGM,qBAHH,CAGyB,MAHzB;AAKD,WAPD,MAOO;AACLzf,YAAAA,IAAI,CAACkS,MAAL,CAAYyW,MAAZ,GAAqB,YAAW;AAC9B,qBAAOlmB,eAAe,CAACzC,IAAD,CAAtB;AAA8B,aADhC;;AAEAA,YAAAA,IAAI,CAAC0E,QAAL,CAAcslB,OAAd,GAAwB,UAAS5qB,CAAT,EAAY;AAClC,qBAAOqD,eAAe,CAACzC,IAAD,CAAtB;AAA8B,aADhC;AAGD;;AACDA,UAAAA,IAAI,CAAC0E,QAAL,CAAc47B,KAAd,GAAsB,UAASlhC,CAAT,EAAY;AAChC,mBAAOY,IAAI,CAAC0E,QAAL,CAAcojB,EAAd,CAAiB1oB,CAAjB,IAAsBY,IAAI,CAAC0E,QAAL,CAAcslB,OAAd,CAAsB5qB,CAAtB,CAA7B;AAAuD,WADzD;AAGD,SAxBD,MAwBO;AACL,cAAI4S,SAAS,GAAG,CAAChS,IAAI,CAACgS,SAAL,IAAkB,EAAnB,EAAuB7S,GAAvB,CAA2B,UAASC,CAAT,EAAY;AACrD,mBAAOA,CAAC,CAACY,IAAI,CAACU,UAAN,CAAR;AAA2B,WADb,CAAhB;AAEAu/B,UAAAA,MAAM,GAAG1hC,EAAE,CAAC+hB,aAAH,CAAiBtgB,IAAjB,EACN4d,SADM,CACI,GADJ,EAENO,aAFM,CAEQ,IAFR,EAGNE,UAHM,CAGKre,IAAI,CAAC0P,WAAL,KAAqB,aAH1B,EAIN4O,uBAJM,CAIkBtM,SAJlB,EAKNuN,cALM,CAKS,MALT,CAAT;;AAOAvf,UAAAA,IAAI,CAAC0E,QAAL,CAAc47B,KAAd,GAAsB,UAASlhC,CAAT,EAAY;AAChC,mBAAOY,IAAI,CAAC0E,QAAL,CAAcojB,EAAd,CAAiB1oB,CAAjB,CAAP;AAA4B,WAD9B;AAED,SArFwB,CAuFzB;;;AACA,YAAIY,IAAI,CAACyE,cAAL,KAAwB,IAA5B,EAAkC;AAChC,cAAI87B,UAAU,GAAGhiC,EAAE,CAAC+hB,aAAH,CAAiBtgB,IAAjB,EAAuB4d,SAAvB,CAAiC,OAAjC,CAAjB;;AACA,cAAI5d,IAAI,CAACshB,UAAL,KAAoB,QAAxB,EAAkC;AAChC;AACA;AACAif,YAAAA,UAAU,CACPjiB,uBADH,CAC2B8C,mBAAmB,CAACphB,IAAD,CAD9C,EAEGuf,cAFH,CAEkBgC,kBAAkB,CAACvhB,IAAD,CAFpC,EAGGogB,KAHH,CAGS,IAHT;AAID,WAPD,MAOO;AACL,gBAAIpgB,IAAI,CAACqhB,YAAT,EAAuB;AACrBkf,cAAAA,UAAU,CACPthB,iBADH,CACqBjf,IAAI,CAACqhB,YAD1B,EAEGrB,gBAFH,CAEoBhgB,IAAI,CAACwhB,WAFzB;AAGD,aAJD,MAIO;AACL+e,cAAAA,UAAU,CACPphB,yBADH,GAEGc,qBAFH;AAGD;AACF;AACF;;AAED,YAAIjgB,IAAI,CAACsrB,aAAT,EAAwB;AACtB,cAAI/sB,EAAE,CAAC+hB,aAAP,CAAqBtgB,IAArB,EAA2B4d,SAA3B,CAAqC,MAArC,EACGU,uBADH,GAEGiB,cAFH,CAEkBiM,iBAAiB,CAACxrB,IAAD,CAFnC,EAGGogB,KAHH,CAGS,IAHT;AAID;;AAED,YAAI7hB,EAAE,CAACspB,YAAP,CAAoB7nB,IAApB,EACG4d,SADH,CACa,GADb,EAEGxK,IAFH,CAEQpT,IAAI,CAAC0P,WAFb,EAGGuX,QAHH,CAGYjnB,IAAI,CAAC2P,WAAL,KAAqB,aAHjC,EAIG5E,QAJH,CAIY/K,IAAI,CAACwP,eAJjB,EAKGpL,GALH,CAKOyM,KAAK,CAAC7Q,IAAD,CALZ,EAMGunB,KANH,CAMSgD,cANT,EAOG3C,IAPH;AASA,YAAIrpB,EAAE,CAACspB,YAAP,CAAoB7nB,IAApB,EACG4d,SADH,CACa,GADb,EAEGxK,IAFH,CAEQpT,IAAI,CAAC2P,WAFb,EAGGsX,QAHH,CAGYjnB,IAAI,CAAC0P,WAAL,KAAqB,aAHjC,EAIG3E,QAJH,CAIY/K,IAAI,CAACyP,eAJjB,EAKGrL,GALH,CAKO0M,KAAK,CAAC9Q,IAAD,CALZ,EAMGunB,KANH,CAMS0B,cANT,EAOGrB,IAPH;AASA,aAAKyW,QAAL;AACA,aAAKpsB,OAAL;AACA,aAAKqsB,QAAL;AACA,aAAKC,eAAL;AAEA,eAAO,IAAP;AACD,OA7ID;;AA+IA,WAAKtsB,OAAL,GAAe,YAAW;AACxBA,QAAAA,OAAO,CAACjS,IAAD,CAAP;;AACA,YAAIA,IAAI,CAACwgC,aAAT,EAAwB;AACtBC,UAAAA,MAAM,CAACzgC,IAAD,CAAN;AACD;;AAED,eAAO,IAAP;AACD,OAPD;;AASA,WAAKq+B,QAAL,GAAgB,YAAW;AACzB,YAAI/6B,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,YAAI0f,CAAJ;AAEA,YAAI7kB,IAAI,GAAG8gC,yBAAyB,CAAC5/B,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAD,EAAekB,IAAf,CAApC,CAJyB,CAKzB;;AACAsD,QAAAA,GAAG,CAACE,SAAJ,CAAc,YAAd,EAA4BJ,MAA5B;AAEAugB,QAAAA,CAAC,GAAGrgB,GAAG,CAACI,MAAJ,CAAW,GAAX,EACDC,OADC,CACO,WADP,EACoB,IADpB,CAAJ;AAIA,YAAIkvB,GAAG,GAAGlP,CAAC,CAACngB,SAAF,CAAY,QAAZ,EACP1E,IADO,CACFA,IADE,EAEPuF,KAFO,GAECX,MAFD,CAEQ,QAFR,EAGPY,IAHO,CAGF,OAHE,EAGO,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AAC5B,iBAAO,UAAUA,CAAjB;AACD,SALO,EAMPb,IANO,CAMF,IANE,EAMItE,IAAI,CAAC0E,QAAL,CAAc27B,KANlB,EAOP/7B,IAPO,CAOF,IAPE,EAOI,UAASlF,CAAT,EAAY;AACtB,iBAAOY,IAAI,CAAC0E,QAAL,CAAc47B,KAAd,CAAoBlhC,CAApB,CAAP;AACD,SATO,CAAV,CAZyB,CAuBzB;;AACA,YAAIY,IAAI,CAACyE,cAAL,KAAwB,IAA5B,EAAkC;AAChCouB,UAAAA,GAAG,CAACvuB,IAAJ,CAAS,MAAT,EAAiBtE,IAAI,CAAC0E,QAAL,CAAcC,MAA/B;AACAkuB,UAAAA,GAAG,CAACvuB,IAAJ,CAAS,QAAT,EAAmBtE,IAAI,CAAC0E,QAAL,CAAcC,MAAjC;AACD,SAHD,MAGO;AACLkuB,UAAAA,GAAG,CAAClvB,OAAJ,CAAY,gBAAZ,EAA8B,IAA9B;AACD;;AAED,YAAI3D,IAAI,CAACsrB,aAAL,KAAuB,IAA3B,EAAiC;AAC/BuH,UAAAA,GAAG,CAACvuB,IAAJ,CAAS,GAAT,EAActE,IAAI,CAAC0E,QAAL,CAAcg8B,KAA5B;AACD,SAFD,MAEO;AACL7N,UAAAA,GAAG,CAACvuB,IAAJ,CAAS,GAAT,EAActE,IAAI,CAACkP,UAAnB;AACD;;AAED,eAAO,IAAP;AACD,OAtCD;;AAwCA,WAAKovB,QAAL,GAAgB,YAAW;AACzB,YAAIh7B,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;;AAEA,YAAIX,GAAG,CAACE,SAAJ,CAAc,gCAAd,EAAgDyrB,KAAhD,GAAwD5tB,MAAxD,KAAmE,CAAvE,EAA0E;AACxEoC,UAAAA,QAAQ,CAACH,GAAD,EAAM,+BAAN,CAAR;AACD,SALwB,CAOzB;;;AACAA,QAAAA,GAAG,CAACE,SAAJ,CAAc,aAAd,EAA6BJ,MAA7B,GARyB,CAUzB;;AACA,YAAIi4B,OAAO,GAAG78B,EAAE,CAAC68B,OAAH,GACXnY,CADW,CACTljB,IAAI,CAAC0E,QAAL,CAAc27B,KADL,EAEX10B,CAFW,CAET3L,IAAI,CAAC0E,QAAL,CAAc47B,KAFL,EAGX5f,MAHW,CAGJ,CACN,CAAC1gB,IAAI,CAACsC,MAAN,EAActC,IAAI,CAACsC,MAAL,GAActC,IAAI,CAACmO,gBAAjC,CADM,EAEN,CAACnO,IAAI,CAAC8C,KAAL,GAAa9C,IAAI,CAACsC,MAAnB,EAA2BtC,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACsC,MAA9C,CAFM,CAHI,CAAd;AAQA,YAAIq+B,KAAK,GAAGr9B,GAAG,CAACI,MAAJ,CAAW,GAAX,EACTY,IADS,CACJ,OADI,EACK,YADL,CAAZ;AAGAq8B,QAAAA,KAAK,CAACn9B,SAAN,CAAgB,MAAhB,EACG1E,IADH,CACQu8B,OAAO,CAACC,QAAR,CAAiBsE,yBAAyB,CAAC5/B,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAD,EAAekB,IAAf,CAA1C,CADR,EAEGqE,KAFH,GAEWX,MAFX,CAEkB,MAFlB,EAGGY,IAHH,CAGQ,GAHR,EAGa,UAASlF,CAAT,EAAY;AACrB,iBAAOA,CAAC,IAAI,IAAL,GAAY,IAAZ,GAAmB,MAAMA,CAAC,CAAC0M,IAAF,CAAO,GAAP,CAAN,GAAoB,GAA9C;AAAoD,SAJxD,EAKGxH,IALH,CAKQ,OALR,EAKiB,UAASlF,CAAT,EAAY+F,CAAZ,EAAe;AAC5B,iBAAO,UAAUA,CAAjB;AACD,SAPH,EAQGwC,KARH,CAQS,cART,EAQyB,CARzB,EASGqN,EATH,CASM,WATN,EASmB,KAAKqoB,UAAL,CAAgBr9B,IAAhB,CATnB,EAUGgV,EAVH,CAUM,UAVN,EAUkB,KAAKsoB,WAAL,CAAiBt9B,IAAjB,CAVlB,EAWGgV,EAXH,CAWM,WAXN,EAWmB,KAAKuoB,YAAL,CAAkBv9B,IAAlB,CAXnB;;AAaA,YAAIA,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAauC,MAAb,KAAwB,CAA5B,EAA+B;AAC7Bq+B,UAAAA,eAAe,CAAC1/B,IAAD,EAAOsD,GAAP,EAAYtD,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAa,CAAb,CAAZ,CAAf;AACD;;AAED,eAAO,IAAP;AACD,OAxCD;;AA0CA,WAAKu+B,UAAL,GAAkB,UAASr9B,IAAT,EAAe;AAC/B,YAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AAEA,eAAO,UAAS7E,CAAT,EAAY+F,CAAZ,EAAe;AACpB7B,UAAAA,GAAG,CAACE,SAAJ,CAAc,mBAAd,EACGG,OADH,CACW,UADX,EACuB,KADvB,EADoB,CAIpB;;AACA,cAAIkvB,GAAG,GAAGvvB,GAAG,CAACE,SAAJ,CAAc,4BAA4B2B,CAA1C,EACPxB,OADO,CACC,UADD,EACa,IADb,CAAV;;AAGA,cAAI3D,IAAI,CAACsrB,aAAT,EAAwB;AACtBuH,YAAAA,GAAG,CAACvuB,IAAJ,CAAS,GAAT,EAAc,UAAS4Y,EAAT,EAAa;AACzB,qBAAOld,IAAI,CAAC0E,QAAL,CAAcg8B,KAAd,CAAoBxjB,EAApB,IAA0Bld,IAAI,CAAC4gC,0BAAtC;AACD,aAFD;AAGD,WAJD,MAIO;AACL/N,YAAAA,GAAG,CAACvuB,IAAJ,CAAS,GAAT,EAActE,IAAI,CAACkP,UAAL,GAAkBlP,IAAI,CAAC4gC,0BAArC;AACD,WAdmB,CAgBpB;;;AACA,cAAI5gC,IAAI,CAAC6R,MAAL,IAAe,CAACtT,EAAE,CAACyO,OAAH,CAAWU,IAA/B,EAAqC;AACnCnP,YAAAA,EAAE,CAACyO,OAAH,CAAWU,IAAX,GAAkB,IAAlB,CADmC,CAGnC;;AACAlP,YAAAA,EAAE,CAACgF,SAAH,CAAa,uBAAuB2B,CAApC,EACGgD,IADH,CACQ,YAAW;AACf3J,cAAAA,EAAE,CAACqF,MAAH,CAAU,IAAV,EAAgBmR,EAAhB,CAAmB,WAAnB,EAAgC5V,CAAhC,EAAmC+F,CAAnC;AACD,aAHH;AAID;;AAED,cAAInF,IAAI,CAACqR,kBAAT,EAA6B;AAC3BquB,YAAAA,eAAe,CAAC1/B,IAAD,EAAOsD,GAAP,EAAYlE,CAAC,CAACN,IAAd,CAAf;AACD;;AAED,cAAIkB,IAAI,CAACmR,SAAT,EAAoB;AAClBnR,YAAAA,IAAI,CAACmR,SAAL,CAAe/R,CAAf,EAAkB+F,CAAlB;AACD;AACF,SAlCD;AAmCD,OAtCD;;AAwCA,WAAKm4B,WAAL,GAAmB,UAASt9B,IAAT,EAAe;AAChC,YAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AAEA,eAAO,UAAS7E,CAAT,EAAY+F,CAAZ,EAAe;AACpB,cAAInF,IAAI,CAAC6R,MAAL,IAAetT,EAAE,CAACyO,OAAH,CAAWU,IAA9B,EAAoC;AAClCnP,YAAAA,EAAE,CAACyO,OAAH,CAAWU,IAAX,GAAkB,KAAlB;AAEAlP,YAAAA,EAAE,CAACgF,SAAH,CAAa,uBAAuB2B,CAApC,EACGgD,IADH,CACQ,YAAW;AACf3J,cAAAA,EAAE,CAACqF,MAAH,CAAU,IAAV,EAAgBmR,EAAhB,CAAmB,UAAnB,EAA+B5V,CAA/B,EAAkC+F,CAAlC;AACD,aAHH;AAID,WARmB,CAUpB;;;AACA,cAAI0tB,GAAG,GAAGvvB,GAAG,CAACE,SAAJ,CAAc,mBAAd,EACPG,OADO,CACC,YADD,EACe,KADf,EAEPA,OAFO,CAEC,UAFD,EAEa,KAFb,CAAV;;AAIA,cAAI3D,IAAI,CAACsrB,aAAT,EAAwB;AACtBuH,YAAAA,GAAG,CAACvuB,IAAJ,CAAS,GAAT,EAActE,IAAI,CAAC0E,QAAL,CAAcg8B,KAA5B;AACD,WAFD,MAEO;AACL7N,YAAAA,GAAG,CAACvuB,IAAJ,CAAS,GAAT,EAActE,IAAI,CAACkP,UAAnB;AACD,WAnBmB,CAqBpB;;;AACA,cAAIlP,IAAI,CAAClB,IAAL,CAAU,CAAV,EAAauC,MAAb,GAAsB,CAA1B,EAA6B6wB,4BAA4B,CAAC5uB,GAAD,CAA5B;;AAE7B,cAAItD,IAAI,CAAC4+B,QAAT,EAAmB;AACjB5+B,YAAAA,IAAI,CAAC4+B,QAAL,CAAcx/B,CAAd,EAAiB+F,CAAjB;AACD;AACF,SA3BD;AA4BD,OA/BD;;AAiCA,WAAKo4B,YAAL,GAAoB,UAASv9B,IAAT,EAAe;AACjC,eAAO,UAASZ,CAAT,EAAY+F,CAAZ,EAAe;AACpB,cAAInF,IAAI,CAAC6+B,SAAT,EAAoB;AAClB7+B,YAAAA,IAAI,CAAC6+B,SAAL,CAAez/B,CAAf,EAAkB+F,CAAlB;AACD;AACF,SAJD;AAKD,OAND;;AAQA,WAAK07B,MAAL,GAAc,UAAS7gC,IAAT,EAAe;AAC3B,eAAO,IAAP;AACD,OAFD;;AAIA,WAAKu+B,eAAL,GAAuB,YAAW;AAChCvJ,QAAAA,mBAAmB,CAAC,KAAKh1B,IAAN,CAAnB;AACA,eAAO,IAAP;AACD,OAHD;;AAKA,WAAK0T,IAAL,CAAU1T,IAAV;AACD;;AAED,QAAImM,QAAQ,GAAG;AACb2D,MAAAA,oBAAoB,EAAE,IADT;AACe;AAC5BC,MAAAA,0BAA0B,EAAE,EAFf;AAEmB;AAChCC,MAAAA,yBAAyB,EAAE,CAHd;AAGiB;AAC9BC,MAAAA,+BAA+B,EAAE,CAJpB;AAIuB;AACpCC,MAAAA,oBAAoB,EAAE,IALT;AAKe;AAC5BC,MAAAA,0BAA0B,EAAE,EANf;AAMmB;AAChCC,MAAAA,yBAAyB,EAAE,CAPd;AAOiB;AAC9BC,MAAAA,+BAA+B,EAAE,CARpB;AAQuB;AACpCC,MAAAA,yBAAyB,EAAE,IATd;AAUbwwB,MAAAA,yBAAyB,EAAE,IAVd;AAWbx+B,MAAAA,MAAM,EAAE,EAXK;AAYby+B,MAAAA,EAAE,EAAE,KAZS;AAabC,MAAAA,MAAM,EAAE,KAbK;AAcb9xB,MAAAA,UAAU,EAAE,GAdC;AAeb+xB,MAAAA,cAAc,EAAE,IAfH;AAgBb3V,MAAAA,aAAa,EAAE,IAhBF;AAiBb7mB,MAAAA,cAAc,EAAE,IAjBH;AAkBb4mB,MAAAA,UAAU,EAAE,IAlBC;AAkBK;AAClB7J,MAAAA,WAAW,EAAE,IAnBA;AAmBM;AACnB4J,MAAAA,WAAW,EAAE,IApBA;AAqBb/J,MAAAA,YAAY,EAAE,IArBD;AAsBbuf,MAAAA,0BAA0B,EAAE,CAtBf;AAuBbtf,MAAAA,UAAU,EAAE,QAvBC,CAuBQ;;AAvBR,KAAf;AA0BA/iB,IAAAA,EAAE,CAACyN,QAAH,CAAY,OAAZ,EAAqB8zB,UAArB,EAAiC3zB,QAAjC;AACD,GAnXD,EAmXGjL,IAnXH,CAmXQ,IAnXR;AAqXA,GAAC,YAAW;AACV,iBADU,CAGV;;AACA,aAASggC,QAAT,CAAkBlhC,IAAlB,EAAwB;AACtB,UAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B,CADsB,CAEtB;;AACAX,MAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,IADR,EACc,CADd,EAEGA,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAAC8C,KAFnB,EAGGwB,IAHH,CAGQ,IAHR,EAGctE,IAAI,CAACwC,GAHnB,EAIG8B,IAJH,CAIQ,IAJR,EAIctE,IAAI,CAACwC,GAJnB,EAKG8B,IALH,CAKQ,QALR,EAKkB,OALlB;AAMAhB,MAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,IADR,EACc,CADd,EAEGA,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAAC8C,KAFnB,EAGGwB,IAHH,CAGQ,IAHR,EAGctE,IAAI,CAACmC,MAAL,GAAYnC,IAAI,CAACoC,MAH/B,EAIGkC,IAJH,CAIQ,IAJR,EAIctE,IAAI,CAACmC,MAAL,GAAYnC,IAAI,CAACoC,MAJ/B,EAKGkC,IALH,CAKQ,QALR,EAKkB,OALlB;AAOAhB,MAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,IADR,EACctE,IAAI,CAAC2C,IADnB,EAEG2B,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAAC2C,IAFnB,EAGG2B,IAHH,CAGQ,IAHR,EAGc,CAHd,EAIGA,IAJH,CAIQ,IAJR,EAIctE,IAAI,CAACmC,MAJnB,EAKGmC,IALH,CAKQ,QALR,EAKkB,OALlB;AAOAhB,MAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,IADR,EACctE,IAAI,CAAC8C,KAAL,GAAW9C,IAAI,CAAC+C,KAD9B,EAEGuB,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAAC8C,KAAL,GAAW9C,IAAI,CAAC+C,KAF9B,EAGGuB,IAHH,CAGQ,IAHR,EAGc,CAHd,EAIGA,IAJH,CAIQ,IAJR,EAIctE,IAAI,CAACmC,MAJnB,EAKGmC,IALH,CAKQ,QALR,EAKkB,OALlB,EAvBsB,CA8BtB;;AACAhB,MAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,IADR,EACc,CADd,EAEGA,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAAC8C,KAFnB,EAGGwB,IAHH,CAGQ,IAHR,EAGctE,IAAI,CAACmC,MAAL,GAAYnC,IAAI,CAACoC,MAAjB,GAAwBpC,IAAI,CAACsC,MAH3C,EAIGgC,IAJH,CAIQ,IAJR,EAIctE,IAAI,CAACmC,MAAL,GAAYnC,IAAI,CAACoC,MAAjB,GAAwBpC,IAAI,CAACsC,MAJ3C,EAKGgC,IALH,CAKQ,QALR,EAKkB,MALlB;AAOAhB,MAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,IADR,EACc,CADd,EAEGA,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAAC8C,KAFnB,EAGGwB,IAHH,CAGQ,IAHR,EAGctE,IAAI,CAACwC,GAAL,GAASxC,IAAI,CAACsC,MAH5B,EAIGgC,IAJH,CAIQ,IAJR,EAIctE,IAAI,CAACwC,GAAL,GAASxC,IAAI,CAACsC,MAJ5B,EAKGgC,IALH,CAKQ,QALR,EAKkB,MALlB;AAOAhB,MAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,IADR,EACctE,IAAI,CAAC2C,IAAL,GAAY3C,IAAI,CAACsC,MAD/B,EAEGgC,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAAC2C,IAAL,GAAY3C,IAAI,CAACsC,MAF/B,EAGGgC,IAHH,CAGQ,IAHR,EAGc,CAHd,EAIGA,IAJH,CAIQ,IAJR,EAIctE,IAAI,CAACmC,MAJnB,EAKGmC,IALH,CAKQ,QALR,EAKkB,MALlB;AAMAhB,MAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,IADR,EACctE,IAAI,CAAC8C,KAAL,GAAY9C,IAAI,CAAC+C,KAAjB,GAAyB/C,IAAI,CAACsC,MAD5C,EAEGgC,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAAC8C,KAAL,GAAY9C,IAAI,CAAC+C,KAAjB,GAAyB/C,IAAI,CAACsC,MAF5C,EAGGgC,IAHH,CAGQ,IAHR,EAGc,CAHd,EAIGA,IAJH,CAIQ,IAJR,EAIctE,IAAI,CAACmC,MAJnB,EAKGmC,IALH,CAKQ,QALR,EAKkB,MALlB;AAMD,KA7DS,CA+DV;;;AACA,aAAS68B,kBAAT,CAA4BnhC,IAA5B,EAAkC;AAChC,UAAI6E,MAAJ;AACA,UAAIgzB,IAAI,GAAG,EAAX;;AACA,UAAI73B,IAAI,CAACgO,aAAT,EAAwB;AAEtB,YAAIozB,GAAG,GAAG5iC,EAAE,CAACqF,MAAH,CAAU7D,IAAI,CAACgO,aAAf,EAA8BtK,MAA9B,CAAqC,KAArC,EAA4CC,OAA5C,CAAoD,sBAApD,EAA4E,IAA5E,CAAV;AAEA,YAAI3D,IAAI,CAACqhC,WAAL,IAAoB,YAAxB,EAAsCx8B,MAAM,GAAG7E,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAczJ,MAAd,EAAT,CAAtC,KACKna,MAAM,GAAG7E,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAActF,MAAd,EAAT;AAELna,QAAAA,MAAM,CAAC4D,OAAP,CAAe,UAAS8e,KAAT,EAAgB;AAC7B,cAAI+Z,UAAU,GAAGF,GAAG,CAAC19B,MAAJ,CAAW,MAAX,EAAmBC,OAAnB,CAA2B,uBAA3B,EAAoD,IAApD,CAAjB;AACA29B,UAAAA,UAAU,CAAC59B,MAAX,CAAkB,MAAlB,EACGC,OADH,CACW,4BADX,EACyC,IADzC,EAEGgE,KAFH,CAES,OAFT,EAEkB3H,IAAI,CAACkS,MAAL,CAAYqvB,KAAZ,CAAkBha,KAAlB,CAFlB,EAGG1hB,IAHH,CAGQ,SAHR;AAIAy7B,UAAAA,UAAU,CAAC59B,MAAX,CAAkB,MAAlB,EACGC,OADH,CACW,2BADX,EACwC,IADxC,EAEGkC,IAFH,CAEQ0hB,KAFR;AAID,SAVD;AAWD;AACF;;AAED,aAASia,eAAT,CAAyBl+B,GAAzB,EAA8BtD,IAA9B,EAAoC;AAClC;AACA;AAEA,UAAI6E,MAAJ;AACA,UAAI7E,IAAI,CAACqhC,WAAL,IAAkB,YAAtB,EAAoCx8B,MAAM,GAAG7E,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAczJ,MAAd,EAAT,CAApC,KACKna,MAAM,GAAG7E,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAActF,MAAd,EAAT;AAEL,UAAIyiB,SAAS,GAAG,CAAhB;AACA,UAAI/1B,UAAU,GAAG,GAAjB;AACA,UAAIiY,CAAC,GAAGrgB,GAAG,CAACI,MAAJ,CAAW,GAAX,EAAgBC,OAAhB,CAAwB,eAAxB,EAAyC,IAAzC,CAAR;AACA,UAAIovB,aAAa,GAAGpP,CAAC,CAACjgB,MAAF,CAAS,MAAT,CAApB,CAXkC,CAalC;;AAEAqvB,MAAAA,aAAa,CACVvvB,SADH,CACa,GADb,EAEGJ,MAFH;AAGA2vB,MAAAA,aAAa,CACVzuB,IADH,CACQ,OADR,EACiBtE,IAAI,CAAC+C,KADtB,EAEGuB,IAFH,CAEQ,QAFR,EAEkB,GAFlB,EAGGA,IAHH,CAGQ,aAHR,EAGuB,OAHvB;AAKAO,MAAAA,MAAM,CAAC4D,OAAP,CAAe,UAAS8e,KAAT,EAAgB;AAC7B,YAAIma,aAAa,GAAG3O,aAAa,CAACrvB,MAAd,CAAqB,OAArB,EACjBY,IADiB,CACZ,GADY,EACPtB,iBAAiB,CAAChD,IAAD,CADV,EAEjBsE,IAFiB,CAEZ,GAFY,EAEPtE,IAAI,CAACmC,MAAL,GAAc,CAFP,EAGjBmC,IAHiB,CAGZ,IAHY,EAGLm9B,SAAS,GAAG/1B,UAAb,GAA2B,IAHrB,CAApB;AAIAg2B,QAAAA,aAAa,CAACh+B,MAAd,CAAqB,OAArB,EACGmC,IADH,CACQ,SADR,EAEGvB,IAFH,CAEQ,MAFR,EAEgBtE,IAAI,CAACkS,MAAL,CAAYqvB,KAAZ,CAAkBha,KAAlB,CAFhB,EAGGjjB,IAHH,CAGQ,WAHR,EAGqB,EAHrB;AAIAo9B,QAAAA,aAAa,CAACh+B,MAAd,CAAqB,OAArB,EACGmC,IADH,CACQ0hB,KADR,EAEGjjB,IAFH,CAEQ,aAFR,EAEuB,GAFvB,EAGGA,IAHH,CAGQ,WAHR,EAGqB,EAHrB;AAIAm9B,QAAAA,SAAS;AACV,OAdD,EAvBkC,CAuClC;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACD;;AAED,aAASE,QAAT,CAAkB3hC,IAAlB,EAAwB;AACtB,WAAKA,IAAL,GAAYA,IAAZ;;AAEA,WAAK0T,IAAL,GAAY,UAAS1T,IAAT,EAAe;AACzB,aAAKA,IAAL,GAAYA,IAAZ;AACAA,QAAAA,IAAI,CAAC0P,WAAL,GAAmBpJ,aAAa,CAACtG,IAAD,EAAO,GAAP,CAAhC;AACAA,QAAAA,IAAI,CAAC2P,WAAL,GAAmBrJ,aAAa,CAACtG,IAAD,EAAO,GAAP,CAAhC,CAHyB,CAKzB;AACA;;AACA,YAAIA,IAAI,CAAC0P,WAAL,IAAoB,aAAxB,EAAuC;AACrC1P,UAAAA,IAAI,CAACqhC,WAAL,GAAmB,UAAnB;AACD,SAFD,MAEO,IAAIrhC,IAAI,CAAC2P,WAAL,IAAoB,aAAxB,EAAuC;AAC5C3P,UAAAA,IAAI,CAACqhC,WAAL,GAAmB,YAAnB;AACD,SAFM,MAEA,IAAIrhC,IAAI,CAAC0P,WAAL,IAAoB,aAApB,IAAqC1P,IAAI,CAAC2P,WAAL,IAAoB,aAA7D,EAA4E;AACjF;AACA3P,UAAAA,IAAI,CAACqhC,WAAL,GAAmB,UAAnB;AACD;;AAEDlD,QAAAA,uBAAuB,CAACn+B,IAAD,CAAvB;AAEA+/B,QAAAA,aAAa,CAAC//B,IAAD,CAAb;AACA0T,QAAAA,IAAI,CAAC1T,IAAD,CAAJ;AAEA,YAAIggC,MAAJ,EAAYC,MAAZ;;AAEA,YAAIjgC,IAAI,CAAC0P,WAAL,KAAqB,aAAzB,EAAwC;AACtCswB,UAAAA,MAAM,GAAGzhC,EAAE,CAAC+hB,aAAH,CAAiBtgB,IAAjB,EACN4d,SADM,CACI,GADJ,EAENuB,yBAFM,GAGNM,qBAHM,CAGgB,CAAC,CAAD,EAAIzf,IAAI,CAACkgC,aAAT,CAHhB,EAGyClgC,IAAI,CAAC6P,eAAL,KAAyB,IAHlE,CAAT;;AAKA,cAAI7P,IAAI,CAAC6P,eAAT,EAA0B;AACxB,gBAAItR,EAAE,CAAC+hB,aAAP,CAAqBtgB,IAArB,EACG4d,SADH,CACa,QADb,EAEGuB,yBAFH,GAGGM,qBAHH,CAGyB,QAHzB;AAKD,WAND,MAMO;AACLzf,YAAAA,IAAI,CAACkS,MAAL,CAAYiuB,MAAZ,GAAqB,UAAS/gC,CAAT,EAAY;AAC/B,qBAAOwD,gBAAgB,CAAC5C,IAAD,CAAvB;AAA+B,aADjC;;AAEAA,YAAAA,IAAI,CAAC0E,QAAL,CAAc07B,OAAd,GAAwB,UAAShhC,CAAT,EAAY;AAClC,qBAAOwD,gBAAgB,CAAC5C,IAAD,CAAvB;AAA+B,aADjC;AAED;;AAEDA,UAAAA,IAAI,CAAC0E,QAAL,CAAc27B,KAAd,GAAsB,UAASjhC,CAAT,EAAY;AAChC,mBAAOY,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,CAAiB9qB,CAAjB,IAAsBY,IAAI,CAAC0E,QAAL,CAAc07B,OAAd,CAAsBhhC,CAAtB,CAA7B;AACD,WAFD;AAGD,SAtBD,MAsBO;AACL4gC,UAAAA,MAAM,GAAGzhC,EAAE,CAAC+hB,aAAH,CAAiBtgB,IAAjB,EACN4d,SADM,CACI,GADJ,EAENO,aAFM,CAEQ,IAFR,EAGNE,UAHM,CAGKre,IAAI,CAAC2P,WAAL,KAAqB,aAH1B,EAIN2O,uBAJM,CAIkB,CAACte,IAAI,CAACgS,SAAL,IAAkB,EAAnB,EAAuB7S,GAAvB,CAA2B,UAASC,CAAT,EAAY;AAC9D,mBAAOA,CAAC,CAACY,IAAI,CAACO,UAAN,CAAR;AAA2B,WADJ,CAJlB,EAMNgf,cANM,CAMS,QANT,CAAT;AAQAvf,UAAAA,IAAI,CAAC0E,QAAL,CAAc27B,KAAd,GAAsBrgC,IAAI,CAAC0E,QAAL,CAAcwlB,EAApC;AACD,SAvDwB,CAyDzB;;;AACA,YAAIlqB,IAAI,CAAC2P,WAAL,KAAqB,aAAzB,EAAwC;AACtCswB,UAAAA,MAAM,GAAG1hC,EAAE,CAAC+hB,aAAH,CAAiBtgB,IAAjB,EACN4d,SADM,CACI,GADJ,EAENS,UAFM,CAEK,IAFL,EAGNc,yBAHM,GAINM,qBAJM,CAIgB,CAAC,CAAD,EAAIzf,IAAI,CAAC6pB,aAAT,CAJhB,EAIyC,IAJzC,CAAT;;AAMA,cAAI7pB,IAAI,CAAC4P,eAAT,EAA0B;AAExB,gBAAIrR,EAAE,CAAC+hB,aAAP,CAAqBtgB,IAArB,EACG4d,SADH,CACa,QADb,EAEGuB,yBAFH,GAGGM,qBAHH,CAGyB,MAHzB;AAKD,WAPD,MAOO;AACLzf,YAAAA,IAAI,CAACkS,MAAL,CAAYyW,MAAZ,GAAqB,YAAW;AAC9B,qBAAOlmB,eAAe,CAACzC,IAAD,CAAtB;AAA8B,aADhC;;AAEAA,YAAAA,IAAI,CAAC0E,QAAL,CAAcslB,OAAd,GAAwB,UAAS5qB,CAAT,EAAY;AAClC,qBAAOqD,eAAe,CAACzC,IAAD,CAAtB;AAA8B,aADhC;AAGD;;AACDA,UAAAA,IAAI,CAAC0E,QAAL,CAAc47B,KAAd,GAAsB,UAASlhC,CAAT,EAAY;AAChC,mBAAOY,IAAI,CAAC0E,QAAL,CAAcojB,EAAd,CAAiB1oB,CAAjB,IAAsBY,IAAI,CAAC0E,QAAL,CAAcslB,OAAd,CAAsB5qB,CAAtB,CAA7B;AAAuD,WADzD;AAGD,SAxBD,MAwBO;AACL,cAAI4S,SAAS,GAAG,CAAChS,IAAI,CAACgS,SAAL,IAAkB,EAAnB,EAAuB7S,GAAvB,CAA2B,UAASC,CAAT,EAAY;AACrD,mBAAOA,CAAC,CAACY,IAAI,CAACU,UAAN,CAAR;AAA2B,WADb,CAAhB;AAGAu/B,UAAAA,MAAM,GAAG1hC,EAAE,CAAC+hB,aAAH,CAAiBtgB,IAAjB,EACN4d,SADM,CACI,GADJ,EAENO,aAFM,CAEQ,IAFR,EAGNE,UAHM,CAGKre,IAAI,CAAC0P,WAAL,KAAqB,aAH1B,EAIN4O,uBAJM,CAIkBtM,SAJlB,EAKNuN,cALM,CAKS,MALT,CAAT;;AAOAvf,UAAAA,IAAI,CAAC0E,QAAL,CAAc47B,KAAd,GAAsB,UAASlhC,CAAT,EAAY;AAChC,mBAAOY,IAAI,CAAC0E,QAAL,CAAcojB,EAAd,CAAiB1oB,CAAjB,CAAP;AAA4B,WAD9B;AAED;;AAED,YAAIY,IAAI,CAAC4P,eAAL,KAAyB,IAA7B,EAAmC;AACjC5P,UAAAA,IAAI,CAAC4hC,eAAL,GAAuB5hC,IAAI,CAACU,UAA5B;AACAnC,UAAAA,EAAE,CAAC+hB,aAAH,CAAiBtgB,IAAjB,EACG4d,SADH,CACa,QADb,EAEGM,SAFH,CAEa,OAFb,EAGGiB,yBAHH,GAIGc,qBAJH;AAKD;;AAED,YAAIjgB,IAAI,CAAC6P,eAAL,KAAyB,IAA7B,EAAmC;AACjC7P,UAAAA,IAAI,CAAC6hC,eAAL,GAAuB7hC,IAAI,CAACO,UAA5B;AACAhC,UAAAA,EAAE,CAAC+hB,aAAH,CAAiBtgB,IAAjB,EACG4d,SADH,CACa,QADb,EAEGM,SAFH,CAEa,OAFb,EAGGiB,yBAHH,GAIGc,qBAJH;AAKD,SAjHwB,CAmHzB;AACA;AACA;AACA;AACA;AACA;;;AAEA,YAAI1hB,EAAE,CAACspB,YAAP,CAAoB7nB,IAApB,EACG4d,SADH,CACa,GADb,EAEGxK,IAFH,CAEQpT,IAAI,CAAC0P,WAFb,EAGGuX,QAHH,CAGYjnB,IAAI,CAAC2P,WAAL,KAAqB,aAHjC,EAIG5E,QAJH,CAIY/K,IAAI,CAACwP,eAJjB,EAKGoY,IALH;AAOA,YAAIrpB,EAAE,CAACspB,YAAP,CAAoB7nB,IAApB,EACG4d,SADH,CACa,GADb,EAEGxK,IAFH,CAEQpT,IAAI,CAAC2P,WAFb,EAGGsX,QAHH,CAGYjnB,IAAI,CAAC0P,WAAL,KAAqB,aAHjC,EAIG3E,QAJH,CAIY/K,IAAI,CAACyP,eAJjB,EAKGmY,IALH,GAjIyB,CAwIzB;;AAEA,aAAKyW,QAAL;AACA,aAAKpsB,OAAL;AACA,aAAKqsB,QAAL;AACA,aAAKC,eAAL,GA7IyB,CA8IzB;;AAEA,eAAO,IAAP;AACD,OAjJD;;AAmJA,WAAKF,QAAL,GAAgB,YAAW;AACzB,YAAI/6B,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,YAAInF,IAAI,GAAGkB,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAX;AACA,YAAIgjC,OAAO,GAAGx+B,GAAG,CAACO,MAAJ,CAAW,cAAX,CAAd;AACA,YAAIk+B,YAAY,GAAGD,OAAO,CAACpT,KAAR,EAAnB;AAEA,YAAIsT,IAAJ;AACA,YAAIC,cAAJ;AACA,YAAIC,EAAJ,EAAQC,GAAR;AACA,YAAIC,cAAJ;AAEA,YAAIC,sBAAsB,GAAGN,YAAY,IAAI/hC,IAAI,CAACkO,eAAlD;AACA,YAAIo0B,iBAAiB,GAAGD,sBAAsB,IAAIriC,IAAI,CAACkR,oBAAvD;AACA,YAAIqxB,mBAAmB,GAAGviC,IAAI,CAACuiC,mBAAL,IAA4B,IAAtD,CAbyB,CAezB;;AACA,YAAIR,YAAJ,EAAkB;AAChBD,UAAAA,OAAO,GAAGx+B,GAAG,CAACI,MAAJ,CAAW,GAAX,EACPC,OADO,CACC,YADD,EACe,IADf,CAAV;AAED;;AAEDq+B,QAAAA,IAAI,GAAGF,OAAO,CAACt+B,SAAR,CAAkB,SAAlB,EACJ1E,IADI,CACCA,IADD,EAEJuF,KAFI,GAGJX,MAHI,CAGG,MAHH,EAIFC,OAJE,CAIM,QAJN,EAIgB,IAJhB,EAKFA,OALE,CAKM,aALN,EAKqB3D,IAAI,CAACkS,MAAL,CAAYjI,cAAZ,CAA2B,OAA3B,IAAsC,KAAtC,GAA8C,IALnE,CAAP,CArByB,CA4BzB;AAEA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;;AAEA,YAAIu4B,gBAAJ,CAtDyB,CAwDzB;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;;AACA,YAAInhC,MAAJ,EAAYyB,KAAZ,EAAmB2/B,WAAnB,EAAgCC,UAAhC,EAA4CC,YAA5C,EAA0DC,WAA1D,EACIC,cADJ,EACoBC,aADpB,EACmCC,YADnC,EACiDC,WADjD,EAEIC,eAFJ,EAEqBC,cAFrB,EAEqCC,gBAFrC,EAEuDC,eAFvD,EAGIC,UAHJ,EAGgBC,SAHhB;AAKA,YAAIC,oBAAJ,EAA0BC,yBAA1B;;AAEA,YAAIxjC,IAAI,CAACqhC,WAAL,IAAoB,UAAxB,EAAoC;AAClChgC,UAAAA,MAAM,GAAG,QAAT;AACAyB,UAAAA,KAAK,GAAG,OAAR;AACA2/B,UAAAA,WAAW,GAAGziC,IAAI,CAAC2P,WAAnB;AACA+yB,UAAAA,UAAU,GAAG1iC,IAAI,CAAC0P,WAAlB;AACAizB,UAAAA,YAAY,GAAG,GAAf;AACAC,UAAAA,WAAW,GAAG,GAAd;AACAC,UAAAA,cAAc,GAAGJ,WAAW,IAAI,aAAf,GAA+BziC,IAAI,CAAC0E,QAAL,CAAc47B,KAA7C,GAAqDtgC,IAAI,CAAC0E,QAAL,CAAcojB,EAApF;AACAgb,UAAAA,aAAa,GAAIJ,UAAU,IAAI,aAAd,GAA8B1iC,IAAI,CAAC0E,QAAL,CAAc27B,KAA5C,GAAoDrgC,IAAI,CAAC0E,QAAL,CAAcwlB,EAAnF;AACA6Y,UAAAA,YAAY,GAAK/iC,IAAI,CAACkS,MAAL,CAAYuW,CAA7B;AACAua,UAAAA,WAAW,GAAOhjC,IAAI,CAACkS,MAAL,CAAYoS,CAA9B;AACA2e,UAAAA,eAAe,GAAGjjC,IAAI,CAACU,UAAvB;AACAwiC,UAAAA,cAAc,GAAGljC,IAAI,CAACO,UAAtB;;AAEA4iC,UAAAA,gBAAgB,GAAG,UAAS/jC,CAAT,EAAY;AAC7B,gBAAIk5B,CAAJ;AACAA,YAAAA,CAAC,GAAGuK,cAAc,CAACzjC,CAAD,CAAlB;;AACA,gBAAIA,CAAC,CAAC6jC,eAAD,CAAD,GAAqB,CAAzB,EAA4B;AAC1B3K,cAAAA,CAAC,GAAGyK,YAAY,CAAC,CAAD,CAAhB;AACD;;AACD,mBAAOzK,CAAP;AACD,WAPD;;AASA+K,UAAAA,UAAU,GAAG,UAASjkC,CAAT,EAAY;AACvB,mBAAO+Z,IAAI,CAAC+I,GAAL,CAAS2gB,cAAc,CAACzjC,CAAD,CAAd,GAAoB2jC,YAAY,CAAC,CAAD,CAAzC,CAAP;AACD,WAFD;;AAIAQ,UAAAA,oBAAoB,GAAG,UAASnkC,CAAT,EAAY;AACjC,mBAAO+Z,IAAI,CAAC+I,GAAL,CAAS6gB,YAAY,CAAC3jC,CAAC,CAACY,IAAI,CAACyjC,kBAAN,CAAF,CAAZ,GAA2CV,YAAY,CAAC,CAAD,CAAhE,CAAP;AACD,WAFD;;AAIAS,UAAAA,yBAAyB,GAAG,UAASpkC,CAAT,EAAW;AACrC,mBAAO2jC,YAAY,CAAC3jC,CAAC,CAACY,IAAI,CAACyjC,kBAAN,CAAF,CAAnB;AACD,WAFD;AAGD;;AAED,YAAIzjC,IAAI,CAACqhC,WAAL,IAAoB,YAAxB,EAAsC;AACpChgC,UAAAA,MAAM,GAAG,OAAT;AACAyB,UAAAA,KAAK,GAAG,QAAR;AACA2/B,UAAAA,WAAW,GAAGziC,IAAI,CAAC0P,WAAnB;AACAgzB,UAAAA,UAAU,GAAG1iC,IAAI,CAAC2P,WAAlB;AACAgzB,UAAAA,YAAY,GAAG,GAAf;AACAC,UAAAA,WAAW,GAAG,GAAd;AACAC,UAAAA,cAAc,GAAGJ,WAAW,IAAI,aAAf,GAA+BziC,IAAI,CAAC0E,QAAL,CAAc27B,KAA7C,GAAqDrgC,IAAI,CAAC0E,QAAL,CAAcwlB,EAApF;AACA4Y,UAAAA,aAAa,GAAGJ,UAAU,IAAI,aAAd,GAA8B1iC,IAAI,CAAC0E,QAAL,CAAc47B,KAA5C,GAAoDtgC,IAAI,CAAC0E,QAAL,CAAcojB,EAAlF;AACAib,UAAAA,YAAY,GAAG/iC,IAAI,CAACkS,MAAL,CAAYoS,CAA3B;AACA0e,UAAAA,WAAW,GAAGhjC,IAAI,CAACkS,MAAL,CAAYuW,CAA1B;AACAwa,UAAAA,eAAe,GAAGjjC,IAAI,CAACO,UAAvB;AACA2iC,UAAAA,cAAc,GAAGljC,IAAI,CAACU,UAAtB;;AAEAyiC,UAAAA,gBAAgB,GAAG,UAAS/jC,CAAT,EAAY;AAC7B,gBAAIk5B,CAAJ;AACAA,YAAAA,CAAC,GAAGyK,YAAY,CAAC,CAAD,CAAhB;AACA,mBAAOzK,CAAP;AACD,WAJD;;AAMA+K,UAAAA,UAAU,GAAG,UAASjkC,CAAT,EAAY;AACvB,mBAAO+Z,IAAI,CAAC+I,GAAL,CAAS2gB,cAAc,CAACzjC,CAAD,CAAd,GAAoB2jC,YAAY,CAAC,CAAD,CAAzC,CAAP;AACD,WAFD;;AAIAQ,UAAAA,oBAAoB,GAAG,UAASnkC,CAAT,EAAY;AACjC,mBAAO+Z,IAAI,CAAC+I,GAAL,CAAS6gB,YAAY,CAAC3jC,CAAC,CAACY,IAAI,CAACyjC,kBAAN,CAAF,CAAZ,GAA2CV,YAAY,CAAC,CAAD,CAAhE,CAAP;AACD,WAFD;;AAIAS,UAAAA,yBAAyB,GAAG,UAASpkC,CAAT,EAAW;AACrC,mBAAO2jC,YAAY,CAAC,CAAD,CAAnB;AACD,WAFD;AAGD,SAnJwB,CAqJzB;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEAf,QAAAA,IAAI,CAAC19B,IAAL,CAAUq+B,YAAV,EAAwBQ,gBAAxB,EApKyB,CAsKzB;AACA;;AAIAnB,QAAAA,IAAI,CAAC19B,IAAL,CAAUs+B,WAAV,EAAuB,UAASxjC,CAAT,EAAY;AACjC,cAAIskC,CAAJ;;AACA,cAAIhB,UAAU,IAAI,aAAlB,EAAiC;AAC/BgB,YAAAA,CAAC,GAAGZ,aAAa,CAAC1jC,CAAD,CAAjB;AACD,WAFD,MAEO;AACLskC,YAAAA,CAAC,GAAGV,WAAW,CAAC,CAAD,CAAf;;AACA,gBAAI5jC,CAAC,CAAC8jC,cAAD,CAAD,GAAoB,CAAxB,EAA2B;AACzBQ,cAAAA,CAAC,GAAGZ,aAAa,CAAC1jC,CAAD,CAAjB;AACD;AACF;;AACDskC,UAAAA,CAAC,GAAGA,CAAC,GAAG1jC,IAAI,CAACqwB,aAAL,GAAmB,CAA3B;AACA,iBAAOqT,CAAP;AACD,SAZD;;AAcA,YAAI1jC,IAAI,CAACkS,MAAL,CAAYqvB,KAAhB,EAAuB;AACrBS,UAAAA,IAAI,CAAC19B,IAAL,CAAU,MAAV,EAAkBtE,IAAI,CAAC0E,QAAL,CAAcC,MAAhC;AACD;;AAEDq9B,QAAAA,IAAI,CACD19B,IADH,CACQjD,MADR,EACgBgiC,UADhB,EAEG/+B,IAFH,CAEQxB,KAFR,EAEe,UAAS1D,CAAT,EAAY;AACvB,iBAAOY,IAAI,CAACqwB,aAAZ;AACH,SAJD;;AASA,YAAIrwB,IAAI,CAACyjC,kBAAL,KAA4B,IAAhC,EAAsC;AACpC,cAAIE,cAAc,GAAG7kC,IAAI,CAACqK,MAAL,CAAY,UAAS/J,CAAT,EAAW;AAC1C,mBAAOA,CAAC,CAAC6K,cAAF,CAAiBjK,IAAI,CAACyjC,kBAAtB,CAAP;AACD,WAFoB,CAArB;AAGA,cAAIG,cAAc,GAAG9B,OAAO,CAACt+B,SAAR,CAAkB,2BAAlB,EAClB1E,IADkB,CACb6kC,cADa,EAElBt/B,KAFkB,GAGlBX,MAHkB,CAGX,MAHW,CAArB;AAKAkgC,UAAAA,cAAc,CACXt/B,IADH,CACQq+B,YADR,EACsBa,yBADtB,EAEGl/B,IAFH,CAEQs+B,WAFR,EAEqB,UAASxjC,CAAT,EAAY;AAC7B,mBAAO0jC,aAAa,CAAC1jC,CAAD,CAAb,GAAmBY,IAAI,CAAC6jC,mBAAL,GAAyB,CAAnD;AACD,WAJH,EAKGv/B,IALH,CAKQjD,MALR,EAKgBkiC,oBALhB,EAMGj/B,IANH,CAMQxB,KANR,EAMe9C,IAAI,CAAC6jC,mBANpB;AAOD;;AAED,YAAI7jC,IAAI,CAAC8jC,mBAAL,KAA6B,IAAjC,EAAuC;AACrC,cAAIC,oBAAoB,GAAG,IAA3B;;AACA,cAAI/jC,IAAI,CAAC+jC,oBAAL,KAA8B,IAAlC,EAAwC;AACtCA,YAAAA,oBAAoB,GAAG/jC,IAAI,CAACqwB,aAAL,GAAmB,CAA1C;AACD,WAFD,MAEO;AACL0T,YAAAA,oBAAoB,GAAG/jC,IAAI,CAAC+jC,oBAA5B;AACD;;AAGD,cAAIC,eAAe,GAAGllC,IAAI,CAACqK,MAAL,CAAY,UAAS/J,CAAT,EAAY;AAC5C,mBAAOA,CAAC,CAAC6K,cAAF,CAAiBjK,IAAI,CAAC8jC,mBAAtB,CAAP;AACD,WAFqB,CAAtB;AAGA,cAAIG,gBAAgB,GAAGnC,OAAO,CAACt+B,SAAR,CAAkB,4BAAlB,EACpB1E,IADoB,CACfklC,eADe,EAEpB3/B,KAFoB,GAGpBX,MAHoB,CAGb,MAHa,CAAvB;AAKAugC,UAAAA,gBAAgB,CACb3/B,IADH,CACQq+B,YAAY,GAAG,GADvB,EAC4B,UAASvjC,CAAT,EAAW;AAAC,mBAAO2jC,YAAY,CAAC3jC,CAAC,CAACY,IAAI,CAAC8jC,mBAAN,CAAF,CAAnB;AAAiD,WADzF,EAEGx/B,IAFH,CAEQq+B,YAAY,GAAG,GAFvB,EAE4B,UAASvjC,CAAT,EAAW;AAAC,mBAAO2jC,YAAY,CAAC3jC,CAAC,CAACY,IAAI,CAAC8jC,mBAAN,CAAF,CAAnB;AAAiD,WAFzF,EAGGx/B,IAHH,CAGQs+B,WAAW,GAAG,GAHtB,EAG4B,UAASxjC,CAAT,EAAW;AACnC,mBAAO0jC,aAAa,CAAC1jC,CAAD,CAAb,GAAmB2kC,oBAAoB,GAAC,CAA/C;AACD,WALH,EAMGz/B,IANH,CAMQs+B,WAAW,GAAG,GANtB,EAM2B,UAASxjC,CAAT,EAAY;AACnC,mBAAO0jC,aAAa,CAAC1jC,CAAD,CAAb,GAAmB2kC,oBAAoB,GAAC,CAA/C;AACD,WARH,EASGz/B,IATH,CASQ,QATR,EASkB,OATlB,EAUGA,IAVH,CAUQ,cAVR,EAUwBtE,IAAI,CAACkkC,gBAV7B;AAWD,SApPwB,CAsPvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEF;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACE,YAAIlkC,IAAI,CAAC+N,MAAL,IAAgB/N,IAAI,CAACyE,cAAL,KAAwB,IAAxB,IAAgCzE,IAAI,CAAC4P,eAAL,KAAyB5P,IAAI,CAACyE,cAAlF,EAAmG;AACnG,cAAI,CAACzE,IAAI,CAACgO,aAAV,EAAyBwzB,eAAe,CAACl+B,GAAD,EAAMtD,IAAN,CAAf,CAAzB,KACKmhC,kBAAkB,CAACnhC,IAAD,CAAlB;AACN;;AACD,eAAO,IAAP;AACD,OApTD;;AAsTA,WAAKiS,OAAL,GAAe,YAAW;AACxBA,QAAAA,OAAO,CAACjS,IAAD,CAAP;AACA,eAAO,IAAP;AACD,OAHD;;AAKA,WAAKs+B,QAAL,GAAgB,YAAW;AACzB,YAAIh7B,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,YAAI0f,CAAJ;;AAEA,YAAIrgB,GAAG,CAACE,SAAJ,CAAc,gCAAd,EAAgDyrB,KAAhD,GAAwD5tB,MAAxD,KAAmE,CAAvE,EAA0E;AACxEoC,UAAAA,QAAQ,CAACH,GAAD,EAAM,+BAAN,CAAR;AACD,SANwB,CAQzB;;;AACAA,QAAAA,GAAG,CAACE,SAAJ,CAAc,mBAAd,EAAmCJ,MAAnC;AACAE,QAAAA,GAAG,CAACE,SAAJ,CAAc,sBAAd,EAAsCJ,MAAtC,GAVyB,CAYzB;;AACA,YAAI/B,MAAJ,EAAYyB,KAAZ,EAAmB2/B,WAAnB,EAAgCC,UAAhC,EAA4CC,YAA5C,EAA0DC,WAA1D,EACEC,cADF,EACkBC,aADlB,EACiCC,YADjC,EAC+CC,WAD/C,EAEEC,eAFF,EAEmBC,cAFnB;AAIA,YAAIC,gBAAJ,EAAsBC,eAAtB,EAAuCC,UAAvC,EAAmDC,SAAnD;;AAEA,YAAItjC,IAAI,CAACqhC,WAAL,IAAoB,UAAxB,EAAoC;AAClChgC,UAAAA,MAAM,GAAG,QAAT;AACAyB,UAAAA,KAAK,GAAG,OAAR;AACA2/B,UAAAA,WAAW,GAAGziC,IAAI,CAAC2P,WAAnB;AACA+yB,UAAAA,UAAU,GAAG1iC,IAAI,CAAC0P,WAAlB;AACAizB,UAAAA,YAAY,GAAG,GAAf;AACAC,UAAAA,WAAW,GAAG,GAAd;AACAC,UAAAA,cAAc,GAAGJ,WAAW,IAAI,aAAf,GAA+BziC,IAAI,CAAC0E,QAAL,CAAc47B,KAA7C,GAAqDtgC,IAAI,CAAC0E,QAAL,CAAcojB,EAApF;AACAgb,UAAAA,aAAa,GAAIJ,UAAU,IAAI,aAAd,GAA8B1iC,IAAI,CAAC0E,QAAL,CAAc27B,KAA5C,GAAoDrgC,IAAI,CAAC0E,QAAL,CAAcwlB,EAAnF;AACA6Y,UAAAA,YAAY,GAAK/iC,IAAI,CAACkS,MAAL,CAAYuW,CAA7B;AACAua,UAAAA,WAAW,GAAOhjC,IAAI,CAACkS,MAAL,CAAYoS,CAA9B;AACA2e,UAAAA,eAAe,GAAGjjC,IAAI,CAACU,UAAvB;AACAwiC,UAAAA,cAAc,GAAGljC,IAAI,CAACO,UAAtB;;AAEA4iC,UAAAA,gBAAgB,GAAG,UAAS/jC,CAAT,EAAW;AAC5B,mBAAOqD,eAAe,CAACzC,IAAD,CAAtB;AACD,WAFD;;AAIAqjC,UAAAA,UAAU,GAAG,UAASjkC,CAAT,EAAY;AACvB,mBAAOY,IAAI,CAACmC,MAAL,GAAanC,IAAI,CAACwC,GAAlB,GAAsBxC,IAAI,CAACoC,MAA3B,GAAkCpC,IAAI,CAACsC,MAAL,GAAY,CAArD;AACD,WAFD;AAGD;;AAED,YAAItC,IAAI,CAACqhC,WAAL,IAAoB,YAAxB,EAAsC;AACpChgC,UAAAA,MAAM,GAAG,OAAT;AACAyB,UAAAA,KAAK,GAAG,QAAR;AACA2/B,UAAAA,WAAW,GAAGziC,IAAI,CAAC0P,WAAnB;AACAgzB,UAAAA,UAAU,GAAG1iC,IAAI,CAAC2P,WAAlB;AACAgzB,UAAAA,YAAY,GAAG,GAAf;AACAC,UAAAA,WAAW,GAAG,GAAd;AACAC,UAAAA,cAAc,GAAGJ,WAAW,IAAI,aAAf,GAA+BziC,IAAI,CAAC0E,QAAL,CAAc27B,KAA7C,GAAqDrgC,IAAI,CAAC0E,QAAL,CAAcwlB,EAApF;AACA4Y,UAAAA,aAAa,GAAGJ,UAAU,IAAI,aAAd,GAA8B1iC,IAAI,CAAC0E,QAAL,CAAc47B,KAA5C,GAAoDtgC,IAAI,CAAC0E,QAAL,CAAcojB,EAAlF;AACAib,UAAAA,YAAY,GAAG/iC,IAAI,CAACkS,MAAL,CAAYoS,CAA3B;AACA0e,UAAAA,WAAW,GAAGhjC,IAAI,CAACkS,MAAL,CAAYuW,CAA1B;AACAwa,UAAAA,eAAe,GAAGjjC,IAAI,CAACO,UAAvB;AACA2iC,UAAAA,cAAc,GAAGljC,IAAI,CAACU,UAAtB;;AAEAyiC,UAAAA,gBAAgB,GAAG,UAAS/jC,CAAT,EAAW;AAC5B,gBAAIk5B,CAAJ;AACAA,YAAAA,CAAC,GAAGyK,YAAY,CAAC,CAAD,CAAhB;AACA,mBAAOzK,CAAP;AACD,WAJD;;AAMA+K,UAAAA,UAAU,GAAG,UAASjkC,CAAT,EAAY;AACvB,mBAAOY,IAAI,CAAC8C,KAAL,GAAY9C,IAAI,CAAC2C,IAAjB,GAAsB3C,IAAI,CAAC+C,KAA3B,GAAiC/C,IAAI,CAACsC,MAAL,GAAY,CAApD;AACD,WAFD;AAGD,SAjEwB,CAmEzB;;;AACA,YAAI6hC,UAAJ,EAAgBC,eAAhB;;AACA,YAAIpkC,IAAI,CAACqkC,cAAL,KAAwB,OAA5B,EAAqC;AACnCF,UAAAA,UAAU,GAAGnkC,IAAI,CAAC8C,KAAL,GAAa9C,IAAI,CAAC+C,KAA/B;AACAqhC,UAAAA,eAAe,GAAG,KAAlB;AACD,SAHD,MAGO,IAAIpkC,IAAI,CAACqkC,cAAL,KAAwB,MAA5B,EAAoC;AACzCF,UAAAA,UAAU,GAAGnkC,IAAI,CAAC2C,IAAlB;AACAyhC,UAAAA,eAAe,GAAG,OAAlB;AACD,SAHM,MAGA;AACLD,UAAAA,UAAU,GAAG,CAACnkC,IAAI,CAAC8C,KAAL,GAAa9C,IAAI,CAAC2C,IAAlB,GAAyB3C,IAAI,CAAC+C,KAA/B,IAAwC,CAAxC,GAA4C/C,IAAI,CAAC2C,IAA9D;AACAyhC,UAAAA,eAAe,GAAG,QAAlB;AACD;;AAED9gC,QAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,OADR,EACiB,qBADjB,EAEGA,IAFH,CAEQ,WAFR,EAEqB,UAFrB,EAGGA,IAHH,CAGQ,GAHR,EAGa6/B,UAHb,EAIG7/B,IAJH,CAIQ,GAJR,EAIatE,IAAI,CAACwC,GAAL,GAAW,IAJxB,EAKG8B,IALH,CAKQ,IALR,EAKc,OALd,EAMGA,IANH,CAMQ,aANR,EAMuB8/B,eANvB;AAQAzgB,QAAAA,CAAC,GAAGrgB,GAAG,CAACI,MAAJ,CAAW,GAAX,EACDY,IADC,CACI,OADJ,EACa,kBADb,CAAJ,CAxFyB,CA2FzB;;AACA,YAAI09B,IAAI,GAAGre,CAAC,CAACngB,SAAF,CAAY,kBAAZ,EACR1E,IADQ,CACHkB,IAAI,CAAClB,IAAL,CAAU,CAAV,CADG,EACWuF,KADX,GAERX,MAFQ,CAED,MAFC,EAGRY,IAHQ,CAGH,OAHG,EAGM,iBAHN,CAAX;AAKA09B,QAAAA,IAAI,CAAC19B,IAAL,CAAU,SAAV,EAAqB,CAArB,EACGA,IADH,CACQq+B,YADR,EACsBQ,gBADtB,EAEG7+B,IAFH,CAEQs+B,WAFR,EAEqB,UAASxjC,CAAT,EAAY;AAC7B,cAAIskC,CAAJ;;AACA,cAAIhB,UAAU,IAAI,aAAlB,EAAiC;AAC/BgB,YAAAA,CAAC,GAAGZ,aAAa,CAAC1jC,CAAD,CAAjB;AACD,WAFD,MAEO;AACLskC,YAAAA,CAAC,GAAGV,WAAW,CAAC,CAAD,CAAf;;AACA,gBAAI5jC,CAAC,CAAC8jC,cAAD,CAAD,GAAoB,CAAxB,EAA2B;AACzBQ,cAAAA,CAAC,GAAGZ,aAAa,CAAC1jC,CAAD,CAAjB;AACD;AACF;;AACDskC,UAAAA,CAAC,GAAGA,CAAC,GAAG1jC,IAAI,CAACqwB,aAAL,GAAmB,CAA3B;AACA,iBAAOqT,CAAP;AACD,SAdH;AAgBA1B,QAAAA,IAAI,CAAC19B,IAAL,CAAUjD,MAAV,EAAkBgiC,UAAlB;AACArB,QAAAA,IAAI,CAAC19B,IAAL,CAAUxB,KAAV,EAAiB,UAAS1D,CAAT,EAAY;AAC3B,iBAAOY,IAAI,CAACqwB,aAAZ;AACD,SAFD;AAIA2R,QAAAA,IAAI,CACDhtB,EADH,CACM,WADN,EACmB,KAAKqoB,UAAL,CAAgBr9B,IAAhB,CADnB,EAEGgV,EAFH,CAEM,UAFN,EAEkB,KAAKsoB,WAAL,CAAiBt9B,IAAjB,CAFlB,EAGGgV,EAHH,CAGM,WAHN,EAGmB,KAAKuoB,YAAL,CAAkBv9B,IAAlB,CAHnB;AAKA,eAAO,IAAP;AACD,OA5HD;;AA8HA,WAAKq9B,UAAL,GAAkB,UAASr9B,IAAT,EAAe;AAC/B,YAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,YAAIg9B,cAAc,GAAG,KAAKqD,WAAL,GAAmBtkC,IAAI,CAACO,UAAxB,GAAqCP,IAAI,CAACU,UAA/D;AACA,YAAI6jC,aAAa,GAAG,KAAKD,WAAL,GAAmBtkC,IAAI,CAACU,UAAxB,GAAqCV,IAAI,CAACO,UAA9D;AACA,YAAIikC,WAAW,GAAG,KAAKF,WAAL,GAAmBtkC,IAAI,CAAC2Q,SAAxB,GAAoC3Q,IAAI,CAACmP,SAA3D;AAEA,eAAO,UAAS/P,CAAT,EAAY+F,CAAZ,EAAe;AAEpB,cAAIlF,GAAG,GAAG1B,EAAE,CAACS,WAAH,CAAegB,IAAI,CAACI,QAApB,EAA8B,WAA9B,CAAV;AACA,cAAI8+B,GAAG,GAAGC,sBAAsB,CAACn/B,IAAD,CAAhC,CAHoB,CAKpB;;AACA,cAAIg/B,GAAG,GAAG17B,GAAG,CAACE,SAAJ,CAAc,sBAAd,EACP2F,MADO,CACA,UAAS/J,CAAT,EAAY0G,CAAZ,EAAe;AACrB,mBAAOA,CAAC,KAAKX,CAAb;AACD,WAHO,EAGLxB,OAHK,CAGG,QAHH,EAGa,IAHb,CAAV;;AAKA,cAAI3D,IAAI,CAACkS,MAAL,CAAYjI,cAAZ,CAA2B,OAA3B,CAAJ,EAAyC;AACvC+0B,YAAAA,GAAG,CAAC16B,IAAJ,CAAS,MAAT,EAAiB9F,EAAE,CAACimC,GAAH,CAAOzkC,IAAI,CAAC0E,QAAL,CAAcC,MAAd,CAAqBvF,CAArB,CAAP,EAAgCslC,MAAhC,EAAjB;AACD,WAFD,MAEO;AACL1F,YAAAA,GAAG,CAACr7B,OAAJ,CAAY,gBAAZ,EAA8B,IAA9B;AACD,WAfmB,CAiBpB;;;AACA,cAAI3D,IAAI,CAACqR,kBAAT,EAA6B;AAC3B,gBAAIF,SAAS,GAAGiiB,iBAAiB,CAACpzB,IAAD,EAAO;AAAEsD,cAAAA,GAAG,EAAEA;AAAP,aAAP,CAAjC;AACA,gBAAIk7B,GAAG,GAAGrtB,SAAS,CAACmiB,aAAV,EAAV;AAEA,gBAAItzB,IAAI,CAAC4P,eAAT,EAA0B4uB,GAAG,CAAC34B,IAAJ,CAASzG,CAAC,CAACY,IAAI,CAAC4P,eAAN,CAAD,GAA0B,KAAnC,EAA0C+iB,IAA1C;AAE1B6L,YAAAA,GAAG,CAAC34B,IAAJ,CAAS64B,qBAAqB,CAAC1+B,IAAD,EAAOZ,CAAP,CAA9B;AACAo/B,YAAAA,GAAG,CAAC34B,IAAJ,CAAS7F,IAAI,CAACU,UAAL,GAAkB,IAAlB,GAAyBtB,CAAC,CAACY,IAAI,CAACU,UAAN,CAAnC;;AACA,gBAAIV,IAAI,CAACooB,kBAAL,IAA2BpoB,IAAI,CAACmoB,iBAApC,EAAuD;AACrDqW,cAAAA,GAAG,GAAGrtB,SAAS,CAACmiB,aAAV,EAAN;AAEA,kBAAItzB,IAAI,CAACooB,kBAAT,EAA6BoW,GAAG,CAAC34B,IAAJ,CAAS8+B,4BAA4B,CAAC3kC,IAAD,EAAOZ,CAAP,EAAU,IAAV,EAAgBY,IAAI,CAACooB,kBAArB,EAAyC,KAAzC,CAArC;AAC7B,kBAAIpoB,IAAI,CAACmoB,iBAAT,EAA4BqW,GAAG,CAAC34B,IAAJ,CAAS8+B,4BAA4B,CAAC3kC,IAAD,EAAOZ,CAAP,EAAU,IAAV,EAAgBY,IAAI,CAACmoB,iBAArB,EAAwC,KAAxC,CAArC;AAC7B;AACF;;AACD,cAAInoB,IAAI,CAACmR,SAAT,EAAoB;AAClBnR,YAAAA,IAAI,CAACmR,SAAL,CAAe/R,CAAf,EAAkB+F,CAAlB;AACD;AACF,SApCD;AAqCD,OA3CD;;AA6CA,WAAKm4B,WAAL,GAAmB,UAASt9B,IAAT,EAAe;AAChC,YAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AAEA,eAAO,UAAS7E,CAAT,EAAY+F,CAAZ,EAAe;AACpB;AACA,cAAI65B,GAAG,GAAG17B,GAAG,CAACE,SAAJ,CAAc,6BAAd,EAA6CG,OAA7C,CAAqD,QAArD,EAA+D,KAA/D,CAAV;;AAEA,cAAI3D,IAAI,CAACkS,MAAL,CAAYjI,cAAZ,CAA2B,OAA3B,CAAJ,EAAyC;AACvC+0B,YAAAA,GAAG,CAAC16B,IAAJ,CAAS,MAAT,EAAiBtE,IAAI,CAAC0E,QAAL,CAAcC,MAAd,CAAqBvF,CAArB,CAAjB;AACD,WAFD,MAEO;AACL4/B,YAAAA,GAAG,CAACr7B,OAAJ,CAAY,gBAAZ,EAA8B,KAA9B;AACD,WARmB,CAUpB;;;AACAL,UAAAA,GAAG,CAACO,MAAJ,CAAW,sBAAX,EACGgC,IADH,CACQ,EADR;AAGAqsB,UAAAA,4BAA4B,CAAC5uB,GAAD,CAA5B;;AAEA,cAAItD,IAAI,CAAC4+B,QAAT,EAAmB;AACjB5+B,YAAAA,IAAI,CAAC4+B,QAAL,CAAcx/B,CAAd,EAAiB+F,CAAjB;AACD;AACF,SAnBD;AAoBD,OAvBD;;AAyBA,WAAKo4B,YAAL,GAAoB,UAASv9B,IAAT,EAAe;AACjC,eAAO,UAASZ,CAAT,EAAY+F,CAAZ,EAAe;AACpB,cAAInF,IAAI,CAAC6+B,SAAT,EAAoB;AAClB7+B,YAAAA,IAAI,CAAC6+B,SAAL,CAAez/B,CAAf,EAAkB+F,CAAlB;AACD;AACF,SAJD;AAKD,OAND;;AAQA,WAAKo5B,eAAL,GAAuB,YAAW;AAChCvJ,QAAAA,mBAAmB,CAAC,KAAKh1B,IAAN,CAAnB;AACA,eAAO,IAAP;AACD,OAHD;;AAKA,WAAK0T,IAAL,CAAU1T,IAAV;AACD;;AAED,QAAImM,QAAQ,GAAG;AACb2D,MAAAA,oBAAoB,EAAE,IADT;AACe;AAC5BC,MAAAA,0BAA0B,EAAE,EAFf;AAEmB;AAChCC,MAAAA,yBAAyB,EAAE,CAHd;AAGiB;AAC9BC,MAAAA,+BAA+B,EAAE,CAJpB;AAIuB;AACpCC,MAAAA,oBAAoB,EAAE,IALT;AAKe;AAC5BC,MAAAA,0BAA0B,EAAE,EANf;AAMmB;AAChCC,MAAAA,yBAAyB,EAAE,CAPd;AAOiB;AAC9BC,MAAAA,+BAA+B,EAAE,CARpB;AAQuB;AACpC/N,MAAAA,MAAM,EAAE,EATK;AAUb5B,MAAAA,UAAU,EAAE,QAVC;AAWbH,MAAAA,UAAU,EAAE,OAXC;AAYbkjC,MAAAA,kBAAkB,EAAE,IAZP;AAabK,MAAAA,mBAAmB,EAAE,IAbR;AAcbc,MAAAA,wBAAwB,EAAE,IAdb;AAebngC,MAAAA,cAAc,EAAE,IAfH;AAgBb6c,MAAAA,UAAU,EAAE,UAhBC;AAiBbD,MAAAA,YAAY,EAAE,IAjBD;AAkBbwiB,MAAAA,mBAAmB,EAAE,CAlBR;AAmBbK,MAAAA,gBAAgB,EAAE,CAnBL;AAoBbH,MAAAA,oBAAoB,EAAE,IApBT;AAqBbh2B,MAAAA,MAAM,EAAE,KArBK;AAsBbC,MAAAA,aAAa,EAAE,IAtBF;AAuBb+C,MAAAA,eAAe,EAAE,OAvBJ;AAwBboX,MAAAA,iBAAiB,EAAE,IAxBN;AAyBbC,MAAAA,kBAAkB,EAAE,IAzBP;AA0Bbyc,MAAAA,oBAAoB,EAAE,CA1BT;AA2Bbrd,MAAAA,aAAa,EAAE,IA3BF;AA4Bb6X,MAAAA,MAAM,EAAE,IA5BK;AA6BbvU,MAAAA,iBAAiB,EAAE,IA7BN;AA8Bbga,MAAAA,iBAAiB,EAAE;AA9BN,KAAf;AAiCAvmC,IAAAA,EAAE,CAACyN,QAAH,CAAY,KAAZ,EAAmB21B,QAAnB,EAA6Bx1B,QAA7B;AAED,GA11BD,EA01BGjL,IA11BH,CA01BQ,IA11BR;AA41BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA3C,EAAAA,EAAE,CAACwmC,UAAH,GAAgB,UAAS/kC,IAAT,EAAe;AAC7B;;AACA,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAKA,IAAL,CAAUglC,YAAV,GAAyB;AAAEliC,MAAAA,KAAK,EAAE,GAAT;AAAc8vB,MAAAA,SAAS,EAAE,EAAzB;AAA6BqS,MAAAA,WAAW,EAAE;AAA1C,KAAzB;AACA,SAAKjlC,IAAL,CAAUklC,OAAV,GAAoB,EAApB;AACA,SAAKC,kBAAL,GAA0B,CACxB,CAAC,OAAD,EAAU,OAAV,CADwB,EAExB,CAAC,aAAD,EAAgB,aAAhB,CAFwB,EAGxB,CAAC,YAAD,EAAe,YAAf,CAHwB,EAIxB,CAAC,WAAD,EAAc,WAAd,CAJwB,CAA1B;;AAOA,SAAKxO,kBAAL,GAA0B,UAASC,CAAT,EAAY;AACpC,UAAIC,eAAe,GAAGD,CAAC,CAACpvB,OAAF,CAAU,kBAAV,EAA8B,EAA9B,CAAtB;AACA,UAAIsvB,WAAW,GAAGD,eAAe,CAACrvB,OAAhB,CAAwB,MAAxB,EAAgC,EAAhC,CAAlB;AACA,aAAOsvB,WAAP;AACD,KAJD;;AAMA,SAAKsO,eAAL,GAAuB,UAASp/B,OAAT,EAAkBiD,KAAlB,EAAyBjJ,IAAzB,EAA+B;AACpD,WAAKmlC,kBAAL,CAAwB18B,OAAxB,CAAgC,UAAS48B,EAAT,EAAa;AAC3C,YAAI/gC,IAAI,GAAG+gC,EAAE,CAAC,CAAD,CAAb;AACA,YAAItyB,GAAG,GAAGsyB,EAAE,CAAC,CAAD,CAAZ;AACA,YAAIrlC,IAAI,CAAC+S,GAAD,CAAR,EAAe/M,OAAO,CAAC2B,KAAR,CAAcrD,IAAd,EACb,OAAOtE,IAAI,CAAC+S,GAAD,CAAX,KAAqB,QAArB,IACA,OAAO/S,IAAI,CAAC+S,GAAD,CAAX,KAAqB,QADrB,GAEA/S,IAAI,CAAC+S,GAAD,CAFJ,GAEY/S,IAAI,CAAC+S,GAAD,CAAJ,CAAU9J,KAAV,CAHC;AAIhB,OAPD;AAQD,KATD;;AAWA,SAAKq8B,WAAL,GAAmB,UAASC,KAAT,EAAgBC,QAAhB,EAA0B;AAC3C,UAAIC,eAAe,GAAG,KAAKzlC,IAAL,CAAUglC,YAAhC;AACA,UAAIhlC,IAAI,GAAG2I,mBAAmB,CAACpK,EAAE,CAACoL,KAAH,CAAS47B,KAAT,CAAD,EAAkBhnC,EAAE,CAACoL,KAAH,CAAS87B,eAAT,CAAlB,CAA9B;AACAzlC,MAAAA,IAAI,CAACoT,IAAL,GAAYoyB,QAAZ;AACA,WAAKxlC,IAAL,CAAUklC,OAAV,CAAkB56B,IAAlB,CAAuBtK,IAAvB;AACD,KALD;;AAOA,SAAKiE,MAAL,GAAc,YAAW;AACvB,UAAIA,MAAM,GAAG4E,SAAS,CAAC,CAAD,CAAtB;AACA,WAAK7I,IAAL,CAAUiE,MAAV,GAAmBA,MAAnB;AACA,aAAO,IAAP;AACD,KAJD;;AAMA,SAAKkQ,KAAL,GAAa,YAAW;AACtB,WAAKmxB,WAAL,CAAiBz8B,SAAS,CAAC,CAAD,CAA1B,EAA+B,OAA/B;;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,SAAKhD,IAAL,GAAY,YAAW;AACrB,WAAKy/B,WAAL,CAAiBz8B,SAAS,CAAC,CAAD,CAA1B,EAA+B,MAA/B;;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,SAAK68B,MAAL,GAAc,YAAW;AACvB;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEI,aAAO,IAAP;AACD,KAdD;;AAgBA,SAAKC,SAAL,GAAiB,YAAW;AAC1B,aAAO,IAAP;AACD,KAFD;;AAIA,SAAKrmC,MAAL,GAAc,YAAW;AACvB,WAAKgmC,WAAL,CAAiBz8B,SAAS,CAAC,CAAD,CAA1B,EAA+B,QAA/B;;AACA,aAAO,IAAP;AACD,KAHD;;AAKA,SAAK0O,OAAL,GAAe,YAAW;AACxB,UAAIvX,IAAI,GAAG,KAAKA,IAAhB;AAEAyc,MAAAA,WAAW,CAACzc,IAAD,CAAX;AAEA,UAAIiE,MAAM,GAAGjE,IAAI,CAACiE,MAAlB;AACA,UAAI2hC,KAAK,GAAGpnC,EAAE,CAACqF,MAAH,CAAUI,MAAV,EAAkBP,MAAlB,CAAyB,OAAzB,EAAkCC,OAAlC,CAA0C,eAA1C,EAA2D,IAA3D,CAAZ;AACA,UAAIkiC,QAAQ,GAAGD,KAAK,CAACliC,MAAN,CAAa,UAAb,CAAf;AACA,UAAIoiC,KAAK,GAAGF,KAAK,CAACliC,MAAN,CAAa,OAAb,CAAZ;AACA,UAAIqiC,KAAK,GAAGH,KAAK,CAACliC,MAAN,CAAa,OAAb,CAAZ;AACA,UAAIsiC,WAAJ;AACA,UAAIC,UAAJ;AAEA,UAAIC,EAAJ,EAAQC,EAAR,EAAYC,WAAZ,EAAyBC,OAAzB,EAAkCC,QAAlC,EAA4CC,OAA5C,EAAqDC,OAArD,EAA8DC,EAA9D;AACA,UAAIC,GAAJ;AACA,UAAIC,CAAJ;AAEAT,MAAAA,EAAE,GAAGJ,KAAK,CAACpiC,MAAN,CAAa,IAAb,CAAL;;AAEA,WAAKijC,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG3mC,IAAI,CAACklC,OAAL,CAAa7jC,MAA7B,EAAqCslC,CAAC,EAAtC,EAA0C;AACxC,YAAIC,QAAQ,GAAG5mC,IAAI,CAACklC,OAAL,CAAayB,CAAb,CAAf;AACAN,QAAAA,OAAO,GAAGO,QAAQ,CAACxzB,IAAnB;AACAmzB,QAAAA,OAAO,GAAGK,QAAQ,CAACrf,KAAnB;AACAgf,QAAAA,OAAO,GAAGA,OAAO,KAAKppB,SAAZ,GAAwB,EAAxB,GAA6BopB,OAAvC;AACAJ,QAAAA,EAAE,GAAGD,EAAE,CAACxiC,MAAH,CAAU,IAAV,EACFiE,KADE,CACI,OADJ,EACai/B,QAAQ,CAAC9jC,KADtB,EAEF6E,KAFE,CAEI,YAFJ,EAEkB0+B,OAAO,KAAK,OAAZ,GAAsB,MAAtB,GAA+B,OAFjD,EAGFxgC,IAHE,CAGG0gC,OAHH,CAAL;;AAKA,YAAIvmC,IAAI,CAAC6S,aAAL,IAAsB+zB,QAAQ,CAAChqB,WAA/B,IAA8Chd,gBAAgB,EAAlE,EAAsE;AACpEumC,UAAAA,EAAE,CAACziC,MAAH,CAAU,GAAV,EACGC,OADH,CACW,IADX,EACiB,IADjB,EAEGA,OAFH,CAEW,oBAFX,EAEiC,IAFjC,EAGGA,OAHH,CAGW,YAHX,EAGyB,IAHzB;AAKA7D,UAAAA,CAAC,CAACqmC,EAAE,CAACjhC,IAAH,EAAD,CAAD,CAAasX,OAAb,CAAqB;AACnBnI,YAAAA,IAAI,EAAE,IADa;AAEnBP,YAAAA,SAAS,EAAE,KAFQ;AAGnBsI,YAAAA,OAAO,EAAEwqB,QAAQ,CAAChqB,WAHC;AAInB1I,YAAAA,OAAO,EAAE,OAJU;AAKnBH,YAAAA,SAAS,EAAE,KALQ;AAMnBO,YAAAA,SAAS,EAAExU,CAAC,CAACqmC,EAAE,CAACjhC,IAAH,EAAD;AANO,WAArB;AAQD;AACF;;AAED,WAAKyhC,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG3mC,IAAI,CAACklC,OAAL,CAAa7jC,MAA7B,EAAqCslC,CAAC,EAAtC,EAA0C;AACxCD,QAAAA,GAAG,GAAGb,QAAQ,CAACniC,MAAT,CAAgB,KAAhB,CAAN;;AACA,YAAI1D,IAAI,CAACklC,OAAL,CAAayB,CAAb,EAAgBvzB,IAAhB,KAAyB,QAA7B,EAAuC;AACrCszB,UAAAA,GAAG,CAACpiC,IAAJ,CAAS,OAAT,EAAkB,MAAlB,EAA0BA,IAA1B,CAA+B,MAA/B,EAAuC,GAAvC;AACD;AACF;;AAED,WAAK,IAAIa,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnF,IAAI,CAAClB,IAAL,CAAUuC,MAA9B,EAAsC8D,CAAC,EAAvC,EAA2C;AACzC+gC,QAAAA,EAAE,GAAGH,KAAK,CAACriC,MAAN,CAAa,IAAb,CAAL;;AACA,aAAK,IAAIoC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG9F,IAAI,CAACklC,OAAL,CAAa7jC,MAAjC,EAAyCyE,CAAC,EAA1C,EAA8C;AAC5CkgC,UAAAA,WAAW,GAAGhmC,IAAI,CAACklC,OAAL,CAAap/B,CAAb,CAAd;AACAsgC,UAAAA,WAAW,GAAGJ,WAAW,CAACjnC,QAA1B;AACAunC,UAAAA,QAAQ,GAAGE,OAAO,GAAGxmC,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAaihC,WAAb,CAArB;AACAC,UAAAA,OAAO,GAAGL,WAAW,CAAC5yB,IAAtB;;AAEA,cAAIizB,OAAO,KAAK,QAAhB,EAA0B;AACxB;AACA,gBAAIL,WAAW,CAAC/7B,cAAZ,CAA2B,OAA3B,KAAuC,CAAC+7B,WAAW,CAAC/7B,cAAZ,CAA2B,QAA3B,CAA5C,EAAkF;AAChF;AACAu8B,cAAAA,OAAO,GAAGhoC,EAAE,CAACmT,MAAH,CAAU,QAAQq0B,WAAW,CAAC5sB,KAApB,GAA4B,GAAtC,EAA2CotB,OAA3C,CAAV;AACD;;AAED,gBAAIR,WAAW,CAAC/7B,cAAZ,CAA2B,iBAA3B,CAAJ,EAAmD;AACjD;AACAu8B,cAAAA,OAAO,GAAGR,WAAW,CAACa,eAAZ,CAA4BL,OAA5B,CAAV;AACD;;AAED,gBAAIR,WAAW,CAAC/7B,cAAZ,CAA2B,QAA3B,CAAJ,EAA0C;AACxC;AACA;AAEA,kBAAI+7B,WAAW,CAAC5sB,KAAhB,EAAuB;AACrBotB,gBAAAA,OAAO,GAAGrtB,IAAI,CAACC,KAAL,CAAWotB,OAAX,EAAoBR,WAAW,CAAC5sB,KAAhC,CAAV;AACD;;AAED,kBAAI0tB,WAAW,GAAGd,WAAW,CAACr0B,MAA9B;AACA,kBAAIopB,SAAJ;AAEA,kBAAI+L,WAAW,KAAK,YAApB,EAAkC/L,SAAS,GAAGv8B,EAAE,CAACmT,MAAH,CAAU,KAAV,CAAZ;AAClC,kBAAIm1B,WAAW,KAAK,OAApB,EAA6B/L,SAAS,GAAGv8B,EAAE,CAACmT,MAAH,CAAU,MAAV,CAAZ;AAC7B,kBAAIm1B,WAAW,KAAK,aAApB,EAAmC/L,SAAS,GAAG,UAASpT,CAAT,EAAY;AACzD,uBAAOA,CAAC,GAAG,GAAX;AAAiB,eADgB;AAGnC6e,cAAAA,OAAO,GAAGzL,SAAS,CAACyL,OAAD,CAAnB;AACD;;AAED,gBAAIR,WAAW,CAAC/7B,cAAZ,CAA2B,UAA3B,CAAJ,EAA4C;AAC1C;AACAu8B,cAAAA,OAAO,GAAGR,WAAW,CAACe,QAAZ,GAAuBP,OAAjC;AACD;AACF;;AAEDC,UAAAA,EAAE,GAAGP,EAAE,CAACxiC,MAAH,CAAU,IAAV,EACFC,OADE,CACM,WAAW0iC,OADjB,EAC0B,IAD1B,EAEF1iC,OAFE,CAEM,WAAW0iC,OAAX,GAAqB,GAArB,GAA2B,KAAK1P,kBAAL,CAAwByP,WAAxB,CAFjC,EAEuE,IAFvE,EAGF9hC,IAHE,CAGG,YAHH,EAGiBgiC,QAHjB,EAIF3+B,KAJE,CAII,OAJJ,EAIaq+B,WAAW,CAACljC,KAJzB,EAKF6E,KALE,CAKI,YALJ,EAKkB0+B,OAAO,KAAK,OAAZ,IAAuBA,OAAO,KAAK,MAAnC,GAA4C,MAA5C,GAAqD,OALvE,CAAL;;AAOA,eAAKjB,eAAL,CAAqBqB,EAArB,EAAyBH,QAAzB,EAAmCN,WAAnC;;AAEA,cAAIK,OAAO,KAAK,OAAhB,EAAyB;AACvBJ,YAAAA,UAAU,GAAGQ,EAAE,CAAC/iC,MAAH,CAAU,KAAV,EAAiBmC,IAAjB,CAAsB2gC,OAAtB,CAAb;;AACA,iBAAKpB,eAAL,CAAqBa,UAArB,EAAiCO,OAAjC,EAA0CR,WAA1C;;AAEA,gBAAIhmC,IAAI,CAACklC,OAAL,CAAap/B,CAAb,EAAgBmE,cAAhB,CAA+B,oBAA/B,CAAJ,EAA0D;AACxDw8B,cAAAA,EAAE,CAAC/iC,MAAH,CAAU,KAAV,EACGmC,IADH,CACQ7F,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAanF,IAAI,CAACklC,OAAL,CAAap/B,CAAb,EAAgBkhC,kBAA7B,CADR,EAEGrjC,OAFH,CAEW,iBAFX,EAE8B,IAF9B;AAGD;AACF,WATD,MASO;AACL8iC,YAAAA,EAAE,CAAC5gC,IAAH,CAAQ2gC,OAAR;AACD;AACF;AACF;;AAED,aAAO,IAAP;AACD,KA3HD;;AA6HA,WAAO,IAAP;AACD,GA3MD;;AA6MA,GAAC,YAAW;AACV;;AAEA,aAASS,mBAAT,CAA6B3jC,GAA7B,EAAkCtD,IAAlC,EAAwC;AACtCsD,MAAAA,GAAG,CAACE,SAAJ,CAAc,kBAAd,EAAkC1E,IAAlC,CAAuC,CAACkB,IAAI,CAACknC,YAAN,CAAvC,EACG7iC,KADH,GACWX,MADX,CACkB,MADlB,EAEGY,IAFH,CAEQ,OAFR,EAEiB,iBAFjB,EAGGA,IAHH,CAGQ,GAHR,EAGatE,IAAI,CAAC8C,KAAL,GAAa,CAH1B,EAIGwB,IAJH,CAIQ,GAJR,EAIatE,IAAI,CAACmC,MAAL,GAAc,CAJ3B,EAKGmC,IALH,CAKQ,IALR,EAKc,OALd,EAMGA,IANH,CAMQ,aANR,EAMuB,QANvB,EAOGuB,IAPH,CAOQ7F,IAAI,CAACknC,YAPb;AAQD;;AAED,aAASC,kBAAT,CAA4BnnC,IAA5B,EAAkC;AAChCA,MAAAA,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,GAAgB9lB,EAAE,CAACugB,WAAH,GACbC,MADa,CACN,CAAC,CAAD,EAAIhf,IAAI,CAAClB,IAAL,CAAUuC,MAAd,CADM,EAEbme,KAFa,CAEP,CAAC5c,gBAAgB,CAAC5C,IAAD,CAAjB,EAAyBgD,iBAAiB,CAAChD,IAAD,CAA1C,CAFO,CAAhB;;AAGAA,MAAAA,IAAI,CAAC0E,QAAL,CAAcojB,EAAd,GAAmB,UAAS5K,EAAT,EAAa;AAC9B,eAAOld,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcvL,EAAE,CAACvR,CAAjB,CAAP;AAA6B,OAD/B;AAED;;AAED,aAASy7B,kBAAT,CAA4BpnC,IAA5B,EAAkC;AAChCA,MAAAA,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,GAAgBjqB,EAAE,CAACugB,WAAH,GACbC,MADa,CACN,CAAC,CAAC,CAAF,EAAK,CAAL,CADM,EAEbQ,KAFa,CAEP,CAACxf,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACoC,MAAnB,GAA4BpC,IAAI,CAACsC,MAAL,GAAc,CAA3C,EAA8CtC,IAAI,CAACwC,GAAnD,CAFO,CAAhB;;AAGAxC,MAAAA,IAAI,CAAC0E,QAAL,CAAcwlB,EAAd,GAAmB,UAAShN,EAAT,EAAa;AAC9B,eAAOld,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcpH,EAAE,CAACgG,CAAjB,CAAP;AAA6B,OAD/B;AAED;;AAED,aAASmkB,iBAAT,CAA2BrnC,IAA3B,EAAiC;AAC/B,UAAIlB,IAAI,GAAG,EAAX;;AACA,WAAK,IAAIokB,CAAC,GAAG,CAAb,EAAgBA,CAAC,IAAI,EAArB,EAAyBA,CAAC,EAA1B,EAA8B;AAC5BpkB,QAAAA,IAAI,CAACwL,IAAL,CAAU;AAAE,eAAK4Y,CAAP;AAAU,eAAK/J,IAAI,CAAC+B,MAAL,KAAiBgI,CAAC,GAAG;AAApC,SAAV;AACD;;AACDljB,MAAAA,IAAI,CAAClB,IAAL,GAAYA,IAAZ;AACD;;AAED,aAASwoC,8BAAT,CAAwC3jB,CAAxC,EAA2C3jB,IAA3C,EAAiD;AAC/C2jB,MAAAA,CAAC,CAACjgB,MAAF,CAAS,UAAT,EACGC,OADH,CACW,uBADX,EACoC,IADpC,EAEGW,IAFH,CAEQ,GAFR,EAEatE,IAAI,CAACsC,MAFlB,EAGGgC,IAHH,CAGQ,GAHR,EAGatE,IAAI,CAACsC,MAAL,GAActC,IAAI,CAACmO,gBAAL,GAAwB,CAHnD,EAIG7J,IAJH,CAIQ,OAJR,EAIiBtE,IAAI,CAAC8C,KAAL,GAAa9C,IAAI,CAACsC,MAAL,GAAc,CAJ5C,EAKGgC,IALH,CAKQ,QALR,EAKkBtE,IAAI,CAACmC,MAAL,GAAcnC,IAAI,CAACsC,MAAL,GAAc,CAA5B,GAAgCtC,IAAI,CAACmO,gBAAL,GAAwB,CAL1E,EAMG7J,IANH,CAMQ,IANR,EAMc,EANd,EAOGA,IAPH,CAOQ,IAPR,EAOc,EAPd;AAQD;;AAED,aAASijC,mBAAT,CAA6B5jB,CAA7B,EAAgC3jB,IAAhC,EAAsC;AACpC,UAAIwL,IAAI,GAAGhN,EAAE,CAACgN,IAAH,GACR0X,CADQ,CACNljB,IAAI,CAAC0E,QAAL,CAAcwlB,EADR,EAERve,CAFQ,CAEN3L,IAAI,CAAC0E,QAAL,CAAcojB,EAFR,EAGR0Q,KAHQ,CAGFx4B,IAAI,CAACsS,WAHH,CAAX;AAKAqR,MAAAA,CAAC,CAACjgB,MAAF,CAAS,MAAT,EACGY,IADH,CACQ,OADR,EACiB,6BADjB,EAEGA,IAFH,CAEQ,GAFR,EAEakH,IAAI,CAACxL,IAAI,CAAClB,IAAN,CAFjB;AAGD;;AAED,aAAS0oC,mBAAT,CAA6B7jB,CAA7B,EAAgC3jB,IAAhC,EAAsC;AACpC,UAAIwR,IAAI,GAAGhT,EAAE,CAACgT,IAAH,GACR0R,CADQ,CACNljB,IAAI,CAAC0E,QAAL,CAAcwlB,EADR,EAERmO,EAFQ,CAELr4B,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcjJ,KAAd,GAAsB,CAAtB,CAFK,EAGRmD,EAHQ,CAGL3iB,IAAI,CAAC0E,QAAL,CAAcojB,EAHT,EAIR0Q,KAJQ,CAIFx4B,IAAI,CAACsS,WAJH,CAAX;AAMAqR,MAAAA,CAAC,CAACjgB,MAAF,CAAS,MAAT,EACGY,IADH,CACQ,OADR,EACiB,6BADjB,EAEGA,IAFH,CAEQ,GAFR,EAEakN,IAAI,CAACxR,IAAI,CAAClB,IAAN,CAFjB;AAGD;;AAED,aAAS2oC,sBAAT,CAAgCznC,IAAhC,EAAsC;AACpCxB,MAAAA,EAAE,CAACqF,MAAH,CAAU7D,IAAI,CAACiE,MAAf,EAAuBT,SAAvB,CAAiC,OAAjC,EAA0CJ,MAA1C;AACD;;AAED,aAASskC,wBAAT,CAAkC1nC,IAAlC,EAAwC;AACtC,UAAIA,IAAI,CAACgO,aAAT,EAAwB;AACtBxP,QAAAA,EAAE,CAACqF,MAAH,CAAU7D,IAAI,CAACgO,aAAf,EAA8BqG,IAA9B,CAAmC,EAAnC;AACD;AACF;;AAED,aAASszB,WAAT,CAAqB3nC,IAArB,EAA2B;AACzB,WAAK0T,IAAL,GAAY,UAAS1T,IAAT,EAAe;AACzB,aAAKA,IAAL,GAAYA,IAAZ;AAEAouB,QAAAA,qBAAqB,CAACpuB,IAAD,CAArB;AACAuuB,QAAAA,sBAAsB,CAACvuB,IAAD,CAAtB,CAJyB,CAMzB;;AAEA,YAAIsU,SAAS,GAAG9V,EAAE,CAACqF,MAAH,CAAU7D,IAAI,CAACiE,MAAf,CAAhB;AACAqrB,QAAAA,wBAAwB,CAAChb,SAAD,EAAYtU,IAAZ,CAAxB;AACA,YAAIsD,GAAG,GAAGgR,SAAS,CAAC9Q,SAAV,CAAoB,KAApB,CAAV;AACAirB,QAAAA,uCAAuC,CAACnrB,GAAD,EAAMtD,IAAN,CAAvC;AACAsD,QAAAA,GAAG,GAAGqrB,6BAA6B,CAACrrB,GAAD,EAAMtD,IAAN,CAAnC;AACA6uB,QAAAA,qCAAqC,CAACvrB,GAAD,EAAMtD,IAAN,CAArC;AACA8uB,QAAAA,0BAA0B,CAACxrB,GAAD,EAAMtD,IAAN,CAA1B;AACAynC,QAAAA,sBAAsB,CAACznC,IAAD,CAAtB;AAEAsD,QAAAA,GAAG,CAACK,OAAJ,CAAY,YAAZ,EAA0B,IAA1B;AACA+jC,QAAAA,wBAAwB,CAAC1nC,IAAD,CAAxB;AAEAyc,QAAAA,WAAW,CAACzc,IAAD,CAAX,CApByB,CAsBzB;;AACA,YAAIA,IAAI,CAAC4nC,uBAAT,EAAkC;AAChCP,UAAAA,iBAAiB,CAACrnC,IAAD,CAAjB;AACAmnC,UAAAA,kBAAkB,CAACnnC,IAAD,CAAlB;AACAonC,UAAAA,kBAAkB,CAACpnC,IAAD,CAAlB;AACA,cAAI2jB,CAAC,GAAGlgB,QAAQ,CAACH,GAAD,EAAM,iBAAN,CAAhB;AAEAgkC,UAAAA,8BAA8B,CAAC3jB,CAAD,EAAI3jB,IAAJ,CAA9B;AACAunC,UAAAA,mBAAmB,CAAC5jB,CAAD,EAAI3jB,IAAJ,CAAnB;AACAwnC,UAAAA,mBAAmB,CAAC7jB,CAAD,EAAI3jB,IAAJ,CAAnB;AACD;;AAEDinC,QAAAA,mBAAmB,CAAC3jC,GAAD,EAAMtD,IAAN,CAAnB;AAEA,aAAKu+B,eAAL;AAEA,eAAO,IAAP;AACD,OAvCD;;AAyCA,WAAKA,eAAL,GAAuB,YAAW;AAChCvJ,QAAAA,mBAAmB,CAAC,KAAKh1B,IAAN,CAAnB;AACA,eAAO,IAAP;AACD,OAHD;;AAKA,WAAK0T,IAAL,CAAU1T,IAAV;AACD;;AAED,QAAImM,QAAQ,GAAG;AACb3J,MAAAA,GAAG,EAAE,EADQ;AACJ;AACTJ,MAAAA,MAAM,EAAE,EAFK;AAED;AACZW,MAAAA,KAAK,EAAE,EAHM;AAGF;AACXJ,MAAAA,IAAI,EAAE,CAJO;AAIJ;AACTL,MAAAA,MAAM,EAAE,CALK;AAKF;AACX0L,MAAAA,aAAa,EAAE,EANF;AAOblL,MAAAA,KAAK,EAAE,GAPM;AAQbX,MAAAA,MAAM,EAAE,GARK;AASb+kC,MAAAA,YAAY,EAAE,uCATD;AAUbxiC,MAAAA,QAAQ,EAAE,EAVG;AAWbwN,MAAAA,MAAM,EAAE,EAXK;AAYbW,MAAAA,aAAa,EAAE,IAZF;AAab+0B,MAAAA,uBAAuB,EAAE;AAbZ,KAAf;AAgBArpC,IAAAA,EAAE,CAACyN,QAAH,CAAY,cAAZ,EAA4B27B,WAA5B,EAAyCx7B,QAAzC;AACD,GArJD,EAqJGjL,IArJH,CAqJQ,IArJR;;AAuJA,WAASsoB,sBAAT,CAAgCxpB,IAAhC,EAAsC0hB,IAAtC,EAA4C;AAC1C,QAAI3iB,QAAJ;AACA,QAAI4iB,WAAJ;AACA,QAAIE,GAAJ;;AAEA,QAAIH,IAAI,KAAK,GAAb,EAAkB;AAChB3iB,MAAAA,QAAQ,GAAGiB,IAAI,CAACO,UAAhB;AACAohB,MAAAA,WAAW,GAAG3hB,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAc1C,KAAd,CAAoB5hB,IAAI,CAACyO,SAAzB,CAAd;AACAoT,MAAAA,GAAG,GAAG7hB,IAAI,CAACE,SAAL,CAAeO,KAArB;AACD,KAJD,MAIO,IAAIihB,IAAI,KAAK,GAAb,EAAkB;AACvB3iB,MAAAA,QAAQ,GAAGiB,IAAI,CAACU,UAAhB;AACAihB,MAAAA,WAAW,GAAG3hB,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAc7G,KAAd,CAAoB5hB,IAAI,CAAC4O,SAAzB,CAAd;AACAiT,MAAAA,GAAG,GAAG7hB,IAAI,CAACE,SAAL,CAAeU,KAArB;AACD;;AAED,aAASkhB,KAAT,CAAeC,GAAf,EAAoB;AAClB,UAAIA,GAAG,KAAK,IAAZ,EAAkB;AAChB,eAAO,CAAP;AACD;;AACD,UAAIA,GAAG,KAAK,OAAZ,EAAqB;AACnB,eAAO,CAAP;AACD;;AACD,aAAO5I,IAAI,CAAC6I,GAAL,CAASD,GAAT,IAAgB5I,IAAI,CAAC8I,IAA5B;AACD;;AAED,QAAKP,IAAI,KAAK,GAAT,IAAgB1hB,IAAI,CAAC6nC,YAAL,KAAsB,KAAvC,IAAkDnmB,IAAI,KAAK,GAAT,IAAgB1hB,IAAI,CAACgP,YAAL,KAAsB,KAA5F,EAAoG;AAClG;AACA2S,MAAAA,WAAW,GAAGA,WAAW,CAACxY,MAAZ,CAAmB,UAAS/J,CAAT,EAAY;AAC3C,eAAO+Z,IAAI,CAAC+I,GAAL,CAASJ,KAAK,CAAC1iB,CAAD,CAAd,IAAqB,CAArB,GAAyB,IAAzB,IAAiC+Z,IAAI,CAAC+I,GAAL,CAASJ,KAAK,CAAC1iB,CAAD,CAAd,IAAqB,CAArB,GAAyB,IAAI,IAArE;AACD,OAFa,CAAd;AAGD,KA9ByC,CAgC1C;;;AACA,QAAI+iB,eAAe,GAAGR,WAAW,CAACtgB,MAAlC,CAjC0C,CAmC1C;;AACA,QAAI+gB,WAAW,GAAG,IAAlB;AACApiB,IAAAA,IAAI,CAAClB,IAAL,CAAU2J,OAAV,CAAkB,UAASrJ,CAAT,EAAY+F,CAAZ,EAAe;AAC/B/F,MAAAA,CAAC,CAACqJ,OAAF,CAAU,UAASrJ,CAAT,EAAY+F,CAAZ,EAAe;AACvB,YAAI/F,CAAC,CAACL,QAAD,CAAD,GAAc,CAAd,KAAoB,CAAxB,EAA2B;AACzBqjB,UAAAA,WAAW,GAAG,KAAd;AACA,iBAAO,KAAP;AACD;AACF,OALD;AAMD,KAPD;;AASA,QAAIA,WAAW,IAAID,eAAe,GAAGN,GAAjC,IAAwC7hB,IAAI,CAAC2R,MAAL,KAAgB,OAA5D,EAAqE;AACnE;AACAgQ,MAAAA,WAAW,GAAGA,WAAW,CAACxY,MAAZ,CAAmB,UAAS/J,CAAT,EAAY;AAC3C,eAAOA,CAAC,GAAG,CAAJ,KAAU,CAAjB;AACD,OAFa,CAAd;AAGD;;AAED,QAAIsiB,IAAI,KAAK,GAAb,EAAkB;AAChB1hB,MAAAA,IAAI,CAACE,SAAL,CAAe4sB,OAAf,GAAyBnL,WAAzB;AACD,KAFD,MAEO,IAAID,IAAI,KAAK,GAAb,EAAkB;AACvB1hB,MAAAA,IAAI,CAACE,SAAL,CAAeipB,OAAf,GAAyBxH,WAAzB;AACD;AACF;;AAED,WAASwc,uBAAT,CAAiCn+B,IAAjC,EAAuC;AACrC,iBADqC,CAGrC;;AACAA,IAAAA,IAAI,CAAClB,IAAL,GAAYP,EAAE,CAACoL,KAAH,CAAS3J,IAAI,CAAClB,IAAd,CAAZ,CAJqC,CAMrC;AACA;AACA;AACA;AACA;AACA;;AACAkB,IAAAA,IAAI,CAAC8nC,aAAL,GAAqB,KAArB,CAZqC,CAYT;;AAC5B9nC,IAAAA,IAAI,CAAC+nC,gBAAL,GAAwB,KAAxB;AACA/nC,IAAAA,IAAI,CAACgoC,eAAL,GAAuB,KAAvB;AACAhoC,IAAAA,IAAI,CAACioC,sBAAL,GAA8B,KAA9B;AACAjoC,IAAAA,IAAI,CAACkoC,uBAAL,GAA+B,KAA/B,CAhBqC,CAkBrC;;AAEA,QAAI3mC,kBAAkB,CAACvB,IAAI,CAAClB,IAAN,CAAtB,EAAmC;AACjCkB,MAAAA,IAAI,CAACkoC,uBAAL,GAA+BloC,IAAI,CAAClB,IAAL,CAAUK,GAAV,CAAc,UAASC,CAAT,EAAY;AACvD,eAAOuC,4BAA4B,CAACvC,CAAD,CAAnC;AACD,OAF8B,CAA/B,CADiC,CAG7B;;AACJY,MAAAA,IAAI,CAACioC,sBAAL,GAA8BjoC,IAAI,CAAClB,IAAL,CAAUK,GAAV,CAAc,UAASC,CAAT,EAAY;AACtD,eAAOmC,kBAAkB,CAACnC,CAAD,CAAzB;AACD,OAF6B,CAA9B,CAJiC,CAM7B;AACL,KAPD,MAOO;AACLY,MAAAA,IAAI,CAAC+nC,gBAAL,GAAwBrmC,mBAAmB,CAAC1B,IAAI,CAAClB,IAAN,CAA3C,CADK,CACmD;;AACxDkB,MAAAA,IAAI,CAACgoC,eAAL,GAAuBzmC,kBAAkB,CAACvB,IAAI,CAAClB,IAAN,CAAzC,CAFK,CAEiD;AACvD;;AAED,QAAIkB,IAAI,CAACyR,UAAL,KAAoB,MAAxB,EAAgC;AAC9B,UAAIzR,IAAI,CAAC+nC,gBAAL,IAAyB/nC,IAAI,CAACgoC,eAAlC,EAAmD;AACjDhoC,QAAAA,IAAI,CAAClB,IAAL,GAAY,CAACkB,IAAI,CAAClB,IAAN,CAAZ;AACD;AACF,KAJD,MAIO;AACL,UAAI,CAAE2K,WAAW,CAACzJ,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAD,CAAjB,EAAkC;AAChCkB,QAAAA,IAAI,CAAClB,IAAL,GAAY,CAACkB,IAAI,CAAClB,IAAN,CAAZ;AACD;AACF,KAxCoC,CAyCrC;;;AACAqpC,IAAAA,+BAA+B,CAACnoC,IAAD,CAA/B;AACAooC,IAAAA,+BAA+B,CAACpoC,IAAD,CAA/B,CA3CqC,CA6CrC;AACA;;AACA,QAAIA,IAAI,CAACkhB,KAAL,KAAe/D,SAAnB,EAA8B;AAC5Bnd,MAAAA,IAAI,CAAC0S,MAAL,GAAc1S,IAAI,CAACkhB,KAAnB;AACD,KAjDoC,CAmDrC;;;AACA,QAAIlhB,IAAI,CAAC0S,MAAL,KAAgB,IAAhB,IAAwB,OAAO1S,IAAI,CAAC0S,MAAZ,KAAuB,QAAnD,EAA6D;AAC3D1S,MAAAA,IAAI,CAAC0S,MAAL,GAAc,CAAC1S,IAAI,CAAC0S,MAAN,CAAd;AACD,KAtDoC,CAwDrC;;;AACA,QAAI1S,IAAI,CAACyR,UAAL,KAAoB,MAApB,IAA8BzR,IAAI,CAACqP,MAAL,KAAgB,IAAlD,EAAwD;AACtD,WAAK,IAAIlK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnF,IAAI,CAAClB,IAAL,CAAUuC,MAA9B,EAAsC8D,CAAC,EAAvC,EAA2C;AACzCnF,QAAAA,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAaK,IAAb,CAAkB,UAASxD,CAAT,EAAYC,CAAZ,EAAe;AAC/B,iBAAOD,CAAC,CAAChC,IAAI,CAACO,UAAN,CAAD,GAAqB0B,CAAC,CAACjC,IAAI,CAACO,UAAN,CAA7B;AACD,SAFD;AAGD;AACF;;AAED,WAAO,IAAP;AACD;;AAED,WAAS8nC,6BAAT,CAAuCroC,IAAvC,EAA6CsoC,cAA7C,EAA6D;AAC3D;AACA,QAAI7+B,WAAW,CAACzJ,IAAI,CAACsoC,cAAD,CAAL,CAAf,EAAuC;AACrCtoC,MAAAA,IAAI,CAAClB,IAAL,GAAYkB,IAAI,CAAClB,IAAL,CAAUK,GAAV,CAAc,UAAS2lB,EAAT,EAAa;AACrC,eAAO9kB,IAAI,CAACsoC,cAAD,CAAJ,CAAqBnpC,GAArB,CAAyB,UAASopC,EAAT,EAAa;AAC3C,iBAAOzjB,EAAE,CAAC3lB,GAAH,CAAO,UAAS+d,EAAT,EAAa;AACzBA,YAAAA,EAAE,GAAG3e,EAAE,CAACoL,KAAH,CAASuT,EAAT,CAAL;;AAEA,gBAAIA,EAAE,CAACqrB,EAAD,CAAF,KAAWprB,SAAf,EAA0B;AACxB,qBAAOA,SAAP;AACD;;AAEDD,YAAAA,EAAE,CAAC,eAAeorB,cAAhB,CAAF,GAAoCprB,EAAE,CAACqrB,EAAD,CAAtC;AACA,mBAAOrrB,EAAP;AACD,WATM,EASJ/T,MATI,CASG,UAAS+T,EAAT,EAAa;AACrB,mBAAOA,EAAE,KAAKC,SAAd;AACD,WAXM,CAAP;AAYD,SAbM,CAAP;AAcD,OAfW,EAeT,CAfS,CAAZ;AAgBAnd,MAAAA,IAAI,CAACsoC,cAAD,CAAJ,GAAuB,eAAeA,cAAtC;AACD;AACF;;AAED,WAASH,+BAAT,CAAyCnoC,IAAzC,EAA+C;AAC7CqoC,IAAAA,6BAA6B,CAACroC,IAAD,EAAO,YAAP,CAA7B;AACD;;AAED,WAASooC,+BAAT,CAAyCpoC,IAAzC,EAA+C;AAC7CqoC,IAAAA,6BAA6B,CAACroC,IAAD,EAAO,YAAP,CAA7B;AACD;;AAEDzB,EAAAA,EAAE,CAAC4/B,uBAAH,GAA6BA,uBAA7B;;AAEA,WAASC,YAAT,CAAsBp+B,IAAtB,EAA4B;AAC1B;;AAEA,QAAIkkB,UAAJ,CAH0B,CAK1B;;AACA,QAAIzF,cAAc,GAAGjgB,EAAE,CAACiD,GAAH,CAAOzB,IAAI,CAAClB,IAAL,CAAUK,GAAV,CAAc,UAASqpC,MAAT,EAAiB;AACzD,aAAOA,MAAM,CAACnnC,MAAP,GAAgB,CAAhB,IAAqBkI,UAAU,CAACi/B,MAAM,CAAC,CAAD,CAAN,CAAUxoC,IAAI,CAACO,UAAf,CAAD,CAAtC;AACD,KAF2B,CAAP,IAEf,CAFN,CAN0B,CAU1B;;AACA,QAAI,CAACP,IAAI,CAAC4N,eAAL,IAAwB5N,IAAI,CAAC6N,iBAA9B,KAAoD7N,IAAI,CAACyR,UAAL,KAAoB,MAAxE,IAAkFgN,cAAtF,EAAsG;AACpG,WAAK,IAAItZ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnF,IAAI,CAAClB,IAAL,CAAUuC,MAA9B,EAAsC8D,CAAC,EAAvC,EAA2C;AACzC;AACA,YAAInF,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAa9D,MAAb,IAAuB,CAA3B,EAA8B;AAC5B;AACD;;AAED,YAAIklB,KAAK,GAAGvmB,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAa,CAAb,CAAZ;AACA,YAAIqhB,IAAI,GAAGxmB,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAanF,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAa9D,MAAb,GAAsB,CAAnC,CAAX,CAPyC,CASzC;;AACA,YAAIonC,cAAc,GAAG,EAArB,CAVyC,CAYzC;;AACA,YAAIC,UAAU,GAAGnqC,EAAE,CAACoL,KAAH,CAAS4c,KAAK,CAACvmB,IAAI,CAACO,UAAN,CAAd,EAAiCsgB,OAAjC,CAAyC0F,KAAK,CAACvmB,IAAI,CAACO,UAAN,CAAL,CAAuBugB,OAAvB,KAAmC,CAA5E,CAAjB,CAbyC,CAezC;;AACA,YAAI6nB,IAAI,GAAI3oC,IAAI,CAACQ,KAAN,GAAeR,IAAI,CAACQ,KAApB,GAA4BkoC,UAAvC;AACA,YAAIE,IAAI,GAAI5oC,IAAI,CAACS,KAAN,GAAeT,IAAI,CAACS,KAApB,GAA4B+lB,IAAI,CAACxmB,IAAI,CAACO,UAAN,CAA3C;AAEA2jB,QAAAA,UAAU,GAAGyH,iBAAiB,CAAC,CAACid,IAAI,GAAGD,IAAR,IAAgB,IAAjB,CAA9B;;AAEA,YAAI,CAAC,WAAD,EAAc,WAAd,EAA2B,aAA3B,EAA0C,OAA1C,EAAmD,SAAnD,EAA8D5e,OAA9D,CAAsE7F,UAAtE,MAAsF,CAAC,CAAvF,IAA4FlkB,IAAI,CAAC8N,0BAAL,KAAoC,IAApI,EAA0I;AACxI,eAAK,IAAI1O,CAAC,GAAG,IAAIyK,IAAJ,CAAS8+B,IAAT,CAAb,EAA6BvpC,CAAC,IAAIwpC,IAAlC,EAAwCxpC,CAAC,CAACyhB,OAAF,CAAUzhB,CAAC,CAAC0hB,OAAF,KAAc,CAAxB,CAAxC,EAAoE;AAClE,gBAAI9F,CAAC,GAAG,EAAR;AACA5b,YAAAA,CAAC,CAACypC,QAAF,CAAW,CAAX,EAAc,CAAd,EAAiB,CAAjB,EAAoB,CAApB,EAFkE,CAIlE;;AACA,gBAAIh/B,IAAI,CAACi/B,KAAL,CAAW1pC,CAAX,MAAkByK,IAAI,CAACi/B,KAAL,CAAW,IAAIj/B,IAAJ,CAAS6+B,UAAT,CAAX,CAAtB,EAAwD;AACtDD,cAAAA,cAAc,CAACn+B,IAAf,CAAoB/L,EAAE,CAACoL,KAAH,CAAS3J,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAa,CAAb,CAAT,CAApB;AACD,aAPiE,CASlE;;;AACA,gBAAI4jC,UAAU,GAAG,IAAjB;AACA/oC,YAAAA,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAasD,OAAb,CAAqB,UAASsZ,GAAT,EAAc5c,CAAd,EAAiB;AACpC,kBAAI0E,IAAI,CAACi/B,KAAL,CAAW/mB,GAAG,CAAC/hB,IAAI,CAACO,UAAN,CAAd,MAAqCsJ,IAAI,CAACi/B,KAAL,CAAW,IAAIj/B,IAAJ,CAASzK,CAAT,CAAX,CAAzC,EAAkE;AAChE2pC,gBAAAA,UAAU,GAAGhnB,GAAb;AAEA,uBAAO,KAAP;AACD;AACF,aAND,EAXkE,CAmBlE;;AACA,gBAAI,CAACgnB,UAAL,EAAiB;AACf/tB,cAAAA,CAAC,CAAChb,IAAI,CAACO,UAAN,CAAD,GAAqB,IAAIsJ,IAAJ,CAASzK,CAAT,CAArB;AACA4b,cAAAA,CAAC,CAAChb,IAAI,CAACU,UAAN,CAAD,GAAqB,CAArB;AACAsa,cAAAA,CAAC,CAAC,UAAD,CAAD,GAAgB,IAAhB,CAHe,CAGO;;AACtBytB,cAAAA,cAAc,CAACn+B,IAAf,CAAoB0Q,CAApB;AACD,aALD,CAOA;AACA;AARA,iBASK,IAAI+tB,UAAU,CAAC/oC,IAAI,CAAC8N,0BAAN,CAAV,IAA+Ci7B,UAAU,CAAC/oC,IAAI,CAACU,UAAN,CAAV,KAAgC,IAAnF,EAAyF;AAC5FqoC,gBAAAA,UAAU,CAAC,UAAD,CAAV,GAAyB,IAAzB;AACAN,gBAAAA,cAAc,CAACn+B,IAAf,CAAoBy+B,UAApB;AACD,eAHI,CAKL;AALK,mBAMA;AACHN,kBAAAA,cAAc,CAACn+B,IAAf,CAAoBy+B,UAApB;AACD;AACF;AACF,SAxCD,MAwCO;AACL,eAAK,IAAIjjC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG9F,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAa9D,MAAjC,EAAyCyE,CAAC,IAAI,CAA9C,EAAiD;AAC/C,gBAAIsC,GAAG,GAAG7J,EAAE,CAACoL,KAAH,CAAS3J,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAaW,CAAb,CAAT,CAAV;AACAsC,YAAAA,GAAG,CAAC,UAAD,CAAH,GAAkBpI,IAAI,CAAClB,IAAL,CAAUqG,CAAV,EAAaW,CAAb,EAAgB9F,IAAI,CAAC8N,0BAArB,CAAlB;AACA26B,YAAAA,cAAc,CAACn+B,IAAf,CAAoBlC,GAApB;AACD;AACF,SAnEwC,CAqEzC;;;AACApI,QAAAA,IAAI,CAAClB,IAAL,CAAUqG,CAAV,IAAesjC,cAAf;AACD;AACF;;AAED,WAAO,IAAP;AACD;;AAEDlqC,EAAAA,EAAE,CAAC6/B,YAAH,GAAkBA,YAAlB;;AAEA,WAASW,iBAAT,CAA2B/+B,IAA3B,EAAiC;AAC/B,iBAD+B,CAG/B;AACA;AACA;AACA;AAEA;AACA;AAEA;;AACA,QAAIgpC,QAAQ,GAAGhpC,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAf;AAEA,QAAImqC,cAAJ;;AACA,QAAIjpC,IAAI,CAACq/B,MAAL,KAAgB,KAApB,EAA2B;AACzB;AAEA,UAAI,OAAO2J,QAAQ,CAAC,CAAD,CAAf,KAAwB,QAA5B,EAAsC;AACpC;AACAC,QAAAA,cAAc,GAAGD,QAAQ,CACtB7pC,GADc,CACV,UAASC,CAAT,EAAY;AACf,iBAAOA,CAAC,CAACY,IAAI,CAACO,UAAN,CAAR;AACD,SAHc,CAAjB;AAID,OAND,MAMO,IAAI,OAAOyoC,QAAQ,CAAC,CAAD,CAAf,KAAwB,QAA5B,EAAsC;AAC3C;AACAC,QAAAA,cAAc,GAAGD,QAAjB;AACD,OAHM,MAGA;AACL3hC,QAAAA,OAAO,CAAC2a,GAAR,CAAY,oDAAoD,OAAOgnB,QAAQ,CAAC,CAAD,CAA/E;AACA;AACD;;AAED,UAAIE,IAAI,GAAG1qC,EAAE,CAACsgC,SAAH,EAAX;;AACA,UAAI9+B,IAAI,CAACs/B,IAAT,EAAe;AACb4J,QAAAA,IAAI,CAACC,UAAL,CAAgBnpC,IAAI,CAACs/B,IAArB;AACD;;AAED,UAAIA,IAAI,GAAG4J,IAAI,CAACD,cAAD,CAAf;AACAjpC,MAAAA,IAAI,CAACyoC,cAAL,GAAsBnJ,IAAI,CAACngC,GAAL,CAAS,UAASC,CAAT,EAAY;AACzC,eAAO;AAAE,eAAKA,CAAC,CAACgqC,EAAT;AAAa,eAAKhqC,CAAC,CAACiC;AAApB,SAAP;AACD,OAFqB,CAAtB;AAGD,KA1BD,MA0BO;AACL;AACA;AACA;AAEArB,MAAAA,IAAI,CAACyoC,cAAL,GAAsBO,QAAQ,CAAC7pC,GAAT,CAAa,UAASC,CAAT,EAAY;AAC7C,eAAO;AAAE,eAAKA,CAAC,CAACY,IAAI,CAACO,UAAN,CAAR;AAA2B,eAAKnB,CAAC,CAACY,IAAI,CAACU,UAAN;AAAjC,SAAP;AACD,OAFqB,CAAtB;AAIA,UAAI2oC,OAAJ;AACA,UAAIC,OAAJ,CAVK,CAYL;;AACA,WAAK,IAAInkC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnF,IAAI,CAACyoC,cAAL,CAAoBpnC,MAAxC,EAAgD8D,CAAC,EAAjD,EAAqD;AACnDkkC,QAAAA,OAAO,GAAGrpC,IAAI,CAACyoC,cAAL,CAAoBtjC,CAApB,CAAV;;AACA,YAAIA,CAAC,KAAKnF,IAAI,CAACyoC,cAAL,CAAoBpnC,MAApB,GAA6B,CAAvC,EAA0C;AACxCgoC,UAAAA,OAAO,CAAClmB,EAAR,GAAanjB,IAAI,CAACyoC,cAAL,CAAoBtjC,CAAC,GAAG,CAAxB,EAA2Bge,EAAxC;AACD,SAFD,MAEO;AACLmmB,UAAAA,OAAO,GAAGtpC,IAAI,CAACyoC,cAAL,CAAoBtjC,CAAC,GAAG,CAAxB,CAAV;AACAkkC,UAAAA,OAAO,CAAClmB,EAAR,GAAammB,OAAO,CAACpmB,CAAR,GAAYmmB,OAAO,CAACnmB,CAAjC;AACD;AACF;AACF,KA/D8B,CAiE/B;;;AACA,QAAI,CAACljB,IAAI,CAACE,SAAV,EAAqB;AACnBF,MAAAA,IAAI,CAACE,SAAL,GAAiB,EAAjB;AACD;;AACDF,IAAAA,IAAI,CAACE,SAAL,CAAeqsB,aAAf,GAA+BvsB,IAAI,CAAClB,IAApC;AACAkB,IAAAA,IAAI,CAACE,SAAL,CAAewsB,mBAAf,GAAqC1sB,IAAI,CAACO,UAA1C;AACAP,IAAAA,IAAI,CAACE,SAAL,CAAeqpC,mBAAf,GAAqCvpC,IAAI,CAACU,UAA1C;AAEAV,IAAAA,IAAI,CAAClB,IAAL,GAAY,CAACkB,IAAI,CAACyoC,cAAN,CAAZ;AACAzoC,IAAAA,IAAI,CAACO,UAAL,GAAkBP,IAAI,CAACu/B,oBAAvB;AACAv/B,IAAAA,IAAI,CAACU,UAAL,GAAkBV,IAAI,CAACw/B,oBAAvB;AAEA,WAAO,IAAP;AACD;;AAEDjhC,EAAAA,EAAE,CAACwgC,iBAAH,GAAuBA,iBAAvB,CA/8OqB,CAi9OrB;;AACA,WAASyK,6BAAT,CAAuCxpC,IAAvC,EAA6C;AAC3C;;AAEA,QAAIipC,cAAJ;AAAA,QAAoBR,cAAc,GAAG,EAArC;AAAA,QACEgB,EAAE,GAAG,EADP,CAH2C,CAK3C;;AACA,QAAIxI,cAAc,GAAGjhC,IAAI,CAAC0pC,eAAL,KAAyB,UAAzB,GAAsC1pC,IAAI,CAACO,UAA3C,GAAwDP,IAAI,CAACU,UAAlF;AACA,QAAI6jC,aAAa,GAAGvkC,IAAI,CAAC0pC,eAAL,KAAyB,UAAzB,GAAsC1pC,IAAI,CAACU,UAA3C,GAAwDV,IAAI,CAACO,UAAjF;AAEA,WAAO,IAAP;AACD;;AAEDhC,EAAAA,EAAE,CAACirC,6BAAH,GAAmCA,6BAAnC;;AAEA,WAASzJ,aAAT,CAAuB//B,IAAvB,EAA6B;AAC3B;;AAEA,QAAIlB,IAAI,GAAGkB,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAX;AACA,QAAIokB,CAAC,GAAGpkB,IAAI,CAACK,GAAL,CAAS,UAASC,CAAT,EAAY;AAC3B,aAAOA,CAAC,CAACY,IAAI,CAACO,UAAN,CAAR;AACD,KAFO,CAAR;AAGA,QAAIoL,CAAC,GAAG7M,IAAI,CAACK,GAAL,CAAS,UAASC,CAAT,EAAY;AAC3B,aAAOA,CAAC,CAACY,IAAI,CAACU,UAAN,CAAR;AACD,KAFO,CAAR;;AAIA,QAAIV,IAAI,CAACwgC,aAAT,EAAwB;AACtBxgC,MAAAA,IAAI,CAAC2pC,OAAL,GAAenJ,aAAa,CAACtd,CAAD,EAAIvX,CAAJ,CAA5B;AACD;;AAED,WAAO,IAAP;AACD;;AAEDpN,EAAAA,EAAE,CAACwhC,aAAH,GAAmBA,aAAnB;;AAEA,WAASU,MAAT,CAAgBzgC,IAAhB,EAAsB;AACpB,QAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,QAAInF,IAAI,GAAGkB,IAAI,CAAClB,IAAL,CAAU,CAAV,CAAX;AACA,QAAI0B,KAAK,GAAGhC,EAAE,CAACypB,GAAH,CAAOnpB,IAAP,EAAa,UAASM,CAAT,EAAY;AACnC,aAAOA,CAAC,CAACY,IAAI,CAACO,UAAN,CAAR;AAA4B,KADlB,CAAZ;AAEA,QAAIE,KAAK,GAAGjC,EAAE,CAACqjB,GAAH,CAAO/iB,IAAP,EAAa,UAASM,CAAT,EAAY;AACnC,aAAOA,CAAC,CAACY,IAAI,CAACO,UAAN,CAAR;AAA4B,KADlB,CAAZ;AAGA/B,IAAAA,EAAE,CAACqF,MAAH,CAAU7D,IAAI,CAACiE,MAAf,EAAuBT,SAAvB,CAAiC,wBAAjC,EAA2DJ,MAA3D;AAEAE,IAAAA,GAAG,CAACI,MAAJ,CAAW,UAAX,EACGY,IADH,CACQ,IADR,EACctE,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAc9jB,KAAd,CADd,EAEG8D,IAFH,CAEQ,IAFR,EAEctE,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAc7jB,KAAd,CAFd,EAGG6D,IAHH,CAGQ,IAHR,EAGctE,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAczoB,IAAI,CAAC2pC,OAAL,CAAaC,GAAb,CAAiBppC,KAAjB,CAAd,CAHd,EAIG8D,IAJH,CAIQ,IAJR,EAIctE,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAczoB,IAAI,CAAC2pC,OAAL,CAAaC,GAAb,CAAiBnpC,KAAjB,CAAd,CAJd,EAKG6D,IALH,CAKQ,OALR,EAKiB,uBALjB;AAMD;;AAED/F,EAAAA,EAAE,CAACkiC,MAAH,GAAYA,MAAZ;;AAEA,WAASoJ,UAAT,CAAoB7pC,IAApB,EAA0B;AACxB,QAAIsD,GAAG,GAAGU,mBAAmB,CAAChE,IAAI,CAACiE,MAAN,CAA7B;AACA,QAAI+8B,MAAM,GAAGhhC,IAAI,CAAC8pC,WAAlB;AAEA,QAAIt+B,IAAI,GAAGhN,EAAE,CAAC8E,GAAH,CAAOkI,IAAP,GACR0X,CADQ,CACN,UAAS9jB,CAAT,EAAY;AACb,aAAOY,IAAI,CAACkS,MAAL,CAAYoS,CAAZ,CAAcllB,CAAC,CAAC8jB,CAAhB,CAAP;AAA4B,KAFrB,EAGRvX,CAHQ,CAGN,UAASvM,CAAT,EAAY;AACb,aAAOY,IAAI,CAACkS,MAAL,CAAYuW,CAAZ,CAAcrpB,CAAC,CAACuM,CAAhB,CAAP;AAA4B,KAJrB,EAKR2G,WALQ,CAKItS,IAAI,CAACsS,WALT,CAAX;AAOAhP,IAAAA,GAAG,CAACI,MAAJ,CAAW,MAAX,EACGY,IADH,CACQ,GADR,EACakH,IAAI,CAACw1B,MAAD,CADjB,EAEG18B,IAFH,CAEQ,OAFR,EAEiB,gBAFjB;AAGD;;AAED/F,EAAAA,EAAE,CAACsrC,UAAH,GAAgBA,UAAhB;;AAEA,WAASE,aAAT,CAAuB7mB,CAAvB,EAA0BvX,CAA1B,EAA6B6G,KAA7B,EAAoCw3B,GAApC,EAAyC;AACvC;AACA;AAEA;AACA,QAAIC,EAAJ;;AACA,QAAIzhB,CAAC,GAAG,EAAR;AACA,QAAI0hB,IAAI,GAAG1rC,EAAE,CAAC2rC,IAAH,CAAQx+B,CAAR,CAAX;AACA,QAAIxG,CAAJ;;AACA,SAAKA,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG+d,CAAC,CAAC7hB,MAAlB,EAA0B8D,CAAC,IAAI,CAA/B,EAAkC;AAAEqjB,MAAAA,CAAC,CAACle,IAAF,CAAO,CAAP;AAAY;;AAChD2/B,IAAAA,EAAE,GAAGG,qBAAqB,CAAClnB,CAAD,EAAIvX,CAAJ,EAAO6G,KAAP,EAAcw3B,GAAd,EAAmBxhB,CAAnB,CAA1B;AACA,QAAI6hB,OAAO,GAAGJ,EAAE,CAAC/mB,CAAjB;AACA,QAAIonB,OAAO,GAAGL,EAAE,CAACt+B,CAAjB,CAZuC,CAcvC;;AAEA,SAAKxG,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG,GAAhB,EAAqBA,CAAC,IAAI,CAA1B,EAA6B;AAC3BqjB,MAAAA,CAAC,GAAGhqB,EAAE,CAAC+rC,GAAH,CAAOD,OAAP,EAAgB3+B,CAAhB,EAAmBxM,GAAnB,CAAuB,UAASqrC,EAAT,EAAa;AACtC,eAAOrxB,IAAI,CAAC+I,GAAL,CAASsoB,EAAE,CAAC,CAAD,CAAF,GAAQA,EAAE,CAAC,CAAD,CAAnB,CAAP;AACD,OAFG,CAAJ;AAIA,UAAIC,CAAC,GAAGjsC,EAAE,CAACksC,QAAH,CAAYliB,CAAC,CAAChjB,IAAF,EAAZ,EAAsB,GAAtB,CAAR;AAEAgjB,MAAAA,CAAC,GAAGA,CAAC,CAACrpB,GAAF,CAAM,UAASwrC,EAAT,EAAa;AACrB,eAAOC,gBAAgB,CAACD,EAAE,IAAI,IAAIF,CAAR,CAAH,CAAvB;AACD,OAFG,CAAJ;AAIAR,MAAAA,EAAE,GAAGG,qBAAqB,CAAClnB,CAAD,EAAIvX,CAAJ,EAAO6G,KAAP,EAAcw3B,GAAd,EAAmBxhB,CAAnB,CAA1B;AACA6hB,MAAAA,OAAO,GAAGJ,EAAE,CAAC/mB,CAAb;AACAonB,MAAAA,OAAO,GAAGL,EAAE,CAACt+B,CAAb;AACD;;AAED,WAAOnN,EAAE,CAAC+rC,GAAH,CAAOF,OAAP,EAAgBC,OAAhB,EAAyBnrC,GAAzB,CAA6B,UAASC,CAAT,EAAY;AAC9C,UAAIyrC,CAAC,GAAG,EAAR;AACAA,MAAAA,CAAC,CAAC3nB,CAAF,GAAM9jB,CAAC,CAAC,CAAD,CAAP;AACAyrC,MAAAA,CAAC,CAACl/B,CAAF,GAAMvM,CAAC,CAAC,CAAD,CAAP;AACA,aAAOyrC,CAAP;AACD,KALM,CAAP;AAMD;;AAEDtsC,EAAAA,EAAE,CAACwrC,aAAH,GAAmBA,aAAnB;;AAEA,WAAS/I,MAAT,CAAgB9d,CAAhB,EAAmBvX,CAAnB,EAAsB6G,KAAtB,EAA6Bw3B,GAA7B,EAAkC;AAChC,QAAIxhB,CAAC,GAAG,EAAR;;AACA,SAAK,IAAIrjB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+d,CAAC,CAAC7hB,MAAtB,EAA8B8D,CAAC,IAAI,CAAnC,EAAsC;AAAEqjB,MAAAA,CAAC,CAACle,IAAF,CAAO,CAAP;AAAY;;AACpD,QAAI2/B,EAAE,GAAGG,qBAAqB,CAAClnB,CAAD,EAAIvX,CAAJ,EAAO6G,KAAP,EAAcw3B,GAAd,EAAmBxhB,CAAnB,CAA9B;AACD;;AAEDjqB,EAAAA,EAAE,CAACyiC,MAAH,GAAYA,MAAZ;;AAEA,WAASR,aAAT,CAAuBsK,EAAvB,EAA2BC,EAA3B,EAA+B;AAC7B,QAAI7nB,CAAJ;AAAA,QAAOvX,CAAP;AAAA,QAAUq/B,EAAV;AAAA,QAAcR,EAAd;AAAA,QACES,EAAE,GAAG,CADP;AAAA,QAEEC,EAAE,GAAG,CAFP;AAAA,QAGEC,GAAG,GAAG,CAHR;AAAA,QAIEC,GAAG,GAAG,CAJR;AAMA,QAAIrjC,CAAC,GAAG+iC,EAAE,CAACzpC,MAAX;;AACA,QAAIkI,UAAU,CAACuhC,EAAE,CAAC,CAAD,CAAH,CAAd,EAAuB;AACrB5nB,MAAAA,CAAC,GAAG4nB,EAAE,CAAC3rC,GAAH,CAAO,UAASC,CAAT,EAAY;AACrB,eAAOA,CAAC,CAAC2K,OAAF,EAAP;AACD,OAFG,CAAJ;AAGD,KAJD,MAIO;AACLmZ,MAAAA,CAAC,GAAG4nB,EAAJ;AACD;;AAED,QAAIvhC,UAAU,CAACwhC,EAAE,CAAC,CAAD,CAAH,CAAd,EAAuB;AACrBp/B,MAAAA,CAAC,GAAGo/B,EAAE,CAAC5rC,GAAH,CAAO,UAASC,CAAT,EAAY;AACrB,eAAOA,CAAC,CAAC2K,OAAF,EAAP;AACD,OAFG,CAAJ;AAGD,KAJD,MAIO;AACL4B,MAAAA,CAAC,GAAGo/B,EAAJ;AACD;;AAED,QAAIM,IAAI,GAAG7sC,EAAE,CAAC2rC,IAAH,CAAQjnB,CAAR,CAAX;AACA,QAAIgnB,IAAI,GAAG1rC,EAAE,CAAC2rC,IAAH,CAAQx+B,CAAR,CAAX;AACA,QAAI2/B,SAAS,GAAG,CAAhB;AAAA,QACEC,WAAW,GAAG,CADhB;;AAGA,SAAK,IAAIpmC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+d,CAAC,CAAC7hB,MAAtB,EAA8B8D,CAAC,EAA/B,EAAmC;AACjC6lC,MAAAA,EAAE,GAAG9nB,CAAC,CAAC/d,CAAD,CAAN;AACAqlC,MAAAA,EAAE,GAAG7+B,CAAC,CAACxG,CAAD,CAAN;AACAmmC,MAAAA,SAAS,IAAI,CAACN,EAAE,GAAGK,IAAN,KAAeb,EAAE,GAAGN,IAApB,CAAb;AACAqB,MAAAA,WAAW,IAAI,CAACP,EAAE,GAAGK,IAAN,KAAeL,EAAE,GAAGK,IAApB,CAAf;AACD;;AAED,QAAIG,IAAI,GAAGF,SAAS,GAAGC,WAAvB;AACA,QAAInC,EAAE,GAAGc,IAAI,GAAGsB,IAAI,GAAGH,IAAvB;AAEA,WAAO;AACLjC,MAAAA,EAAE,EAAEA,EADC;AAELoC,MAAAA,IAAI,EAAEA,IAFD;AAGL5B,MAAAA,GAAG,EAAE,UAAS1mB,CAAT,EAAY;AACf,eAAOkmB,EAAE,GAAGlmB,CAAC,GAAGsoB,IAAhB;AACD;AALI,KAAP;AAOD;;AAEDjtC,EAAAA,EAAE,CAACiiC,aAAH,GAAmBA,aAAnB;;AAEA,WAASiL,WAAT,CAAqBlT,CAArB,EAAwBmL,CAAxB,EAA2B;AACzB,QAAInL,CAAC,IAAI,CAAL,IAAUA,CAAC,IAAI,CAAnB,EAAsB;AACpB,aAAOpf,IAAI,CAACuyB,GAAL,CAAS,IAAIvyB,IAAI,CAACuyB,GAAL,CAASnT,CAAT,EAAYmL,CAAZ,CAAb,EAA6BA,CAA7B,CAAP;AACD,KAFD,MAEO;AACL,aAAO,CAAP;AACD;AACF;;AAED,WAASkH,gBAAT,CAA0BrS,CAA1B,EAA6B;AAC3B,WAAOkT,WAAW,CAAClT,CAAD,EAAI,CAAJ,CAAlB;AACD;;AAED,WAASoT,eAAT,CAAyBpT,CAAzB,EAA4B;AAC1B,WAAOkT,WAAW,CAAClT,CAAD,EAAI,CAAJ,CAAlB;AACD;;AAED,WAASqT,mBAAT,CAA6BxC,EAA7B,EAAiCyC,GAAjC,EAAsC;AACpC,WAAOrjC,KAAK,CAACqZ,GAAN,CAAUgqB,GAAG,CAAC1sC,GAAJ,CAAQ,UAAS6rC,EAAT,EAAa;AACpC,aAAO7xB,IAAI,CAAC+I,GAAL,CAASknB,EAAE,GAAG4B,EAAd,CAAP;AACD,KAFgB,CAAV,CAAP;AAGD;;AAED,WAASc,UAAT,CAAoBtpB,EAApB,EAAwBC,EAAxB,EAA4B;AAC1B,WAAOtJ,IAAI,CAAC+I,GAAL,CAASM,EAAE,GAAGC,EAAd,CAAP;AACD;;AAED,WAASspB,eAAT,CAAyBC,GAAzB,EAA8B;AAC5B,QAAIC,IAAI,GAAGztC,EAAE,CAACiD,GAAH,CAAOuqC,GAAG,CAAC7sC,GAAJ,CAAQ,UAAS+sC,IAAT,EAAe;AACvC,aAAOA,IAAI,CAACxI,CAAZ;AAAgB,KADA,CAAP,CAAX;AAGA,WAAO;AACLyI,MAAAA,IAAI,EAAE3tC,EAAE,CAACiD,GAAH,CAAOuqC,GAAG,CAAC7sC,GAAJ,CAAQ,UAAS+sC,IAAT,EAAe;AAClC,eAAOA,IAAI,CAACxI,CAAL,GAASwI,IAAI,CAAChpB,CAArB;AACD,OAFY,CAAP,IAEA+oB,IAHD;AAILG,MAAAA,IAAI,EAAE5tC,EAAE,CAACiD,GAAH,CAAOuqC,GAAG,CAAC7sC,GAAJ,CAAQ,UAAS+sC,IAAT,EAAe;AAClC,eAAOA,IAAI,CAACxI,CAAL,GAASwI,IAAI,CAACvgC,CAArB;AACD,OAFY,CAAP,IAEAsgC;AAND,KAAP;AAQD;;AAED,WAASI,cAAT,CAAwBL,GAAxB,EAA6BG,IAA7B,EAAmCC,IAAnC,EAAyC;AACvC,QAAIlN,GAAG,GAAG1gC,EAAE,CAACiD,GAAH,CAAOuqC,GAAG,CAAC7sC,GAAJ,CAAQ,UAAS+sC,IAAT,EAAe;AACtC,aAAO/yB,IAAI,CAACuyB,GAAL,CAASQ,IAAI,CAACxI,CAAd,EAAiB,CAAjB,KAAuBwI,IAAI,CAAChpB,CAAL,GAASipB,IAAhC,KAAyCD,IAAI,CAACvgC,CAAL,GAASygC,IAAlD,CAAP;AACD,KAFgB,CAAP,CAAV;AAIA,QAAIE,KAAK,GAAG9tC,EAAE,CAACiD,GAAH,CAAOuqC,GAAG,CAAC7sC,GAAJ,CAAQ,UAAS+sC,IAAT,EAAe;AACxC,aAAO/yB,IAAI,CAACuyB,GAAL,CAASQ,IAAI,CAACxI,CAAd,EAAiB,CAAjB,IAAsBvqB,IAAI,CAACuyB,GAAL,CAASQ,IAAI,CAAChpB,CAAL,GAASipB,IAAlB,EAAwB,CAAxB,CAA7B;AACD,KAFkB,CAAP,CAAZ;AAIA,WAAOjN,GAAG,GAAGoN,KAAb;AACD;;AAED,WAASC,uBAAT,CAAiCP,GAAjC,EAAsC;AACpC,QAAII,IAAJ,EAAUD,IAAV,EAAgBK,MAAhB,EAAwBpD,EAAxB;;AAEA,QAAIqD,GAAG,GAAGV,eAAe,CAACC,GAAD,CAAzB;;AAEAG,IAAAA,IAAI,GAAGM,GAAG,CAACN,IAAX;AACAC,IAAAA,IAAI,GAAGK,GAAG,CAACL,IAAX;;AAEA,QAAIZ,IAAI,GAAGa,cAAc,CAACL,GAAD,EAAMG,IAAN,EAAYC,IAAZ,CAAzB;;AAEA,WAAO;AACLZ,MAAAA,IAAI,EAAEA,IADD;AAELW,MAAAA,IAAI,EAAEA,IAFD;AAGLC,MAAAA,IAAI,EAAEA,IAHD;AAILhD,MAAAA,EAAE,EAAEgD,IAAI,GAAGZ,IAAI,GAAGW;AAJb,KAAP;AAOD;;AAED,WAAS/B,qBAAT,CAA+BlnB,CAA/B,EAAkCvX,CAAlC,EAAqC6G,KAArC,EAA4Cw3B,GAA5C,EAAiD0C,SAAjD,EAA4D;AAC1D;AACA;AACA;AACA,QAAIhkC,CAAC,GAAGyQ,IAAI,CAACwzB,KAAL,CAAWzpB,CAAC,CAAC7hB,MAAF,GAAWmR,KAAtB,CAAR;AAEA,QAAIo6B,QAAQ,GAAG1pB,CAAC,CAACta,KAAF,EAAf;AAEAgkC,IAAAA,QAAQ,CAACpnC,IAAT,CAAc,UAASxD,CAAT,EAAYC,CAAZ,EAAe;AAC3B,UAAID,CAAC,GAAGC,CAAR,EAAW;AACT,eAAO,CAAC,CAAR;AAAY,OADd,MACoB,IAAID,CAAC,GAAGC,CAAR,EAAW;AAC7B,eAAO,CAAP;AAAW;;AAEb,aAAO,CAAP;AACD,KAND;AAQA,QAAI4qC,KAAK,GAAGruC,EAAE,CAACksC,QAAH,CAAYkC,QAAZ,EAAsB,IAAtB,CAAZ;AACA,QAAIE,KAAK,GAAGtuC,EAAE,CAACksC,QAAH,CAAYkC,QAAZ,EAAsB,IAAtB,CAAZ;AAEA,QAAIG,EAAE,GAAGvuC,EAAE,CAAC+rC,GAAH,CAAOrnB,CAAP,EAAUvX,CAAV,EAAa+gC,SAAb,EAAwBlnC,IAAxB,EAAT;AAEA,QAAIimB,IAAI,GAAGtS,IAAI,CAAC+I,GAAL,CAAS2qB,KAAK,GAAGC,KAAjB,IAA0B9C,GAArC;AAEA,QAAIgD,QAAQ,GAAGF,KAAf;AACA,QAAIG,OAAO,GAAGJ,KAAd;AACA,QAAIxC,OAAO,GAAG7rC,EAAE,CAACghB,KAAH,CAASwtB,QAAT,EAAmBC,OAAnB,EAA4BxhB,IAA5B,CAAd;AAEA,QAAIyhB,YAAJ;AACA,QAAIC,GAAJ,EAASX,MAAT,EAAiBY,IAAjB,EAAuBC,OAAvB,EAAgClB,IAAhC,EAAsCC,IAAtC,CA5B0D,CA8B1D;;AACA,QAAI9B,OAAO,GAAG,EAAd;;AAEA,SAAK,IAAInlC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGklC,OAAO,CAAChpC,MAA5B,EAAoC8D,CAAC,IAAI,CAAzC,EAA4C;AAC1CgoC,MAAAA,GAAG,GAAG9C,OAAO,CAACllC,CAAD,CAAb,CAD0C,CAG1C;;AACA+nC,MAAAA,YAAY,GAAGH,EAAE,CAAC5tC,GAAH,CAAO,UAASmuC,GAAT,EAAc;AAClC,eAAO,CACLn0B,IAAI,CAAC+I,GAAL,CAASorB,GAAG,CAAC,CAAD,CAAH,GAASH,GAAlB,CADK,EAELG,GAAG,CAAC,CAAD,CAFE,EAGLA,GAAG,CAAC,CAAD,CAHE,EAILA,GAAG,CAAC,CAAD,CAJE,CAAP;AAMD,OAPc,EAOZ9nC,IAPY,GAOLoD,KAPK,CAOC,CAPD,EAOIF,CAPJ,CAAf,CAJ0C,CAa1C;;AACA2kC,MAAAA,OAAO,GAAG7uC,EAAE,CAACqjB,GAAH,CAAOqrB,YAAP,EAAqB,CAArB,CAAV,CAd0C,CAgB1C;;AAEAA,MAAAA,YAAY,GAAGA,YAAY,CAAC/tC,GAAb,CAAiB,UAAS6sC,GAAT,EAAc;AAC5C,eAAO;AACLtI,UAAAA,CAAC,EAAEiI,eAAe,CAACK,GAAG,CAAC,CAAD,CAAH,GAASqB,OAAV,CAAf,GAAoCrB,GAAG,CAAC,CAAD,CADrC;AAEL9oB,UAAAA,CAAC,EAAE8oB,GAAG,CAAC,CAAD,CAFD;AAGLrgC,UAAAA,CAAC,EAAEqgC,GAAG,CAAC,CAAD;AAHD,SAAP;AAKD,OANc,CAAf,CAlB0C,CA0B1C;;AACA,UAAIuB,OAAO,GAAGhB,uBAAuB,CAACW,YAAD,CAArC;;AAEAE,MAAAA,IAAI,GAAGG,OAAO,CAACnE,EAAf;AACAoD,MAAAA,MAAM,GAAGe,OAAO,CAAC/B,IAAjB,CA9B0C,CAgC1C;;AACAlB,MAAAA,OAAO,CAAChgC,IAAR,CAAa8iC,IAAI,GAAGZ,MAAM,GAAGW,GAA7B;AACD;;AAED,WAAO;AAAEjqB,MAAAA,CAAC,EAAEmnB,OAAL;AAAc1+B,MAAAA,CAAC,EAAE2+B;AAAjB,KAAP;AACD;;AAED,WAASnL,sBAAT,CAAgCn/B,IAAhC,EAAsC;AACpC,QAAIk/B,GAAJ;;AACA,QAAIl/B,IAAI,CAAC2R,MAAL,KAAgB,OAApB,EAA6B;AAC3ButB,MAAAA,GAAG,GAAG,UAAS9/B,CAAT,EAAY;AAChB,YAAIutB,QAAQ,GAAGvtB,CAAC,GAAG,CAAJ,KAAU,CAAzB;AACA,YAAIkpB,EAAJ;;AAEA,YAAIqE,QAAJ,EAAc;AACZrE,UAAAA,EAAE,GAAG9pB,EAAE,CAACmT,MAAH,CAAU,OAAO3R,IAAI,CAAC0R,QAAZ,GAAuB,GAAjC,CAAL;AACD,SAFD,MAEO;AACL4W,UAAAA,EAAE,GAAG9pB,EAAE,CAACmT,MAAH,CAAU,MAAV,CAAL;AACD,SARe,CAUhB;;;AACA,YAAI3R,IAAI,CAAC4Q,gBAAT,EAA2B;AACzB,iBAAO0X,EAAE,CAAClpB,CAAD,CAAF,GAAQY,IAAI,CAAC2Q,SAApB;AACD,SAFD,MAEO;AACL,iBAAO3Q,IAAI,CAAC2Q,SAAL,GAAiB2X,EAAE,CAAClpB,CAAD,CAA1B;AACD;AACF,OAhBD;AAiBD,KAlBD,MAkBO;AACL8/B,MAAAA,GAAG,GAAG,UAAS3W,EAAT,EAAa;AACjB,YAAIilB,UAAU,GAAG,CAACxtC,IAAI,CAAC0R,QAAL,GAAgB,MAAM1R,IAAI,CAAC0R,QAA3B,GAAsC,EAAvC,IAA6C,GAA9D;AACA,YAAI4W,EAAE,GAAG9pB,EAAE,CAACmT,MAAH,CAAU67B,UAAV,CAAT;AACA,eAAOllB,EAAE,CAACC,EAAD,CAAT;AACD,OAJD;AAKD;;AACD,WAAO2W,GAAP;AACD;;AAED,MAAIuO,oBAAoB,GAAG,UAASrW,CAAT,EAAYh4B,CAAZ,EAAeL,QAAf,EAAyBS,GAAzB,EAA8B;AACvD,QAAIkuC,EAAJ;;AACA,QAAI,OAAOtW,CAAP,KAAa,QAAjB,EAA2B;AACzBsW,MAAAA,EAAE,GAAGnvC,EAAE,CAACS,WAAH,CAAeQ,GAAf,EAAoB43B,CAApB,EAAuBh4B,CAAC,CAACL,QAAD,CAAxB,CAAL;AACD,KAFD,MAEO,IAAI,OAAOq4B,CAAP,KAAa,UAAjB,EAA6B;AAClCsW,MAAAA,EAAE,GAAGtW,CAAC,CAACh4B,CAAD,CAAN;AACD,KAFM,MAEA;AACLsuC,MAAAA,EAAE,GAAGtuC,CAAC,CAACL,QAAD,CAAN;AACD;;AACD,WAAO2uC,EAAP;AACD,GAVD,CA3yPqB,CAuzPrB;;;AACA,MAAIC,sBAAsB,GAAG,UAASvW,CAAT,EAAYh4B,CAAZ,EAAeL,QAAf,EAAyB;AACpD,QAAI2uC,EAAJ;;AACA,QAAI,OAAOtW,CAAP,KAAa,QAAjB,EAA2B;AACzBsW,MAAAA,EAAE,GAAGlvC,EAAE,CAACmT,MAAH,CAAU,GAAV,EAAevS,CAAC,CAACL,QAAD,CAAhB,CAAL;AACD,KAFD,MAEO,IAAI,OAAOq4B,CAAP,KAAa,UAAjB,EAA6B;AAClCsW,MAAAA,EAAE,GAAGtW,CAAC,CAACh4B,CAAD,CAAN;AACD,KAFM,MAEA;AACLsuC,MAAAA,EAAE,GAAGtuC,CAAC,CAACL,QAAD,CAAN;AACD;;AACD,WAAO2uC,EAAP;AACD,GAVD;;AAYA,WAASE,oBAAT,CAA8B5tC,IAA9B,EAAoCk/B,GAApC,EAAyC9/B,CAAzC,EAA4C;AAC1C,QAAIyuC,WAAJ;;AACA,QAAI7tC,IAAI,CAACiR,WAAL,KAAqB,IAAzB,EAA+B;AAC7B,UAAIjR,IAAI,CAAC4S,kBAAT,EAA6B;AAC3Bi7B,QAAAA,WAAW,GAAGF,sBAAsB,CAAC3tC,IAAI,CAACiR,WAAN,EAAmB7R,CAAnB,EAAsBY,IAAI,CAACU,UAA3B,CAApC;AACD,OAFD,MAEO;AACLmtC,QAAAA,WAAW,GAAGF,sBAAsB,CAAC3tC,IAAI,CAACiR,WAAN,EAAmB7R,CAAnB,EAAsBY,IAAI,CAACU,UAA3B,CAApC;AACD;AACF,KAND,MAMO;AACL,UAAIV,IAAI,CAAC4jB,WAAT,EAAsB;AACpB,YAAI5jB,IAAI,CAAC4S,kBAAT,EAA6B;AAC3Bi7B,UAAAA,WAAW,GAAG3O,GAAG,CAAC9/B,CAAC,CAACY,IAAI,CAACU,UAAN,CAAF,CAAjB;AACD,SAFD,MAEO;AACLmtC,UAAAA,WAAW,GAAG7tC,IAAI,CAAC2Q,SAAL,GAAiBuuB,GAAG,CAAC9/B,CAAC,CAACY,IAAI,CAACU,UAAN,CAAF,CAAlC;AACD;AACF,OAND,MAMO;AACLmtC,QAAAA,WAAW,GAAG7tC,IAAI,CAACU,UAAL,GAAkB,IAAlB,GAAyBV,IAAI,CAAC2Q,SAA9B,GAA0CuuB,GAAG,CAAC9/B,CAAC,CAACY,IAAI,CAACU,UAAN,CAAF,CAA3D;AACD;AACF;;AACD,WAAOmtC,WAAP;AACD;;AAED,WAASC,oBAAT,CAA8B9tC,IAA9B,EAAoCC,GAApC,EAAyCb,CAAzC,EAA4C;AAC1C,QAAI2uC,WAAJ;;AACA,QAAI/tC,IAAI,CAACgR,WAAL,KAAqB,IAAzB,EAA+B;AAC7B,UAAIhR,IAAI,CAAC4jB,WAAT,EAAsB;AACpB,YAAI5jB,IAAI,CAAC4S,kBAAT,EAA6B;AAC3Bm7B,UAAAA,WAAW,GAAGN,oBAAoB,CAACztC,IAAI,CAACgR,WAAN,EAAmB5R,CAAnB,EAAsB,KAAtB,EAA6BY,IAAI,CAACR,GAAlC,CAAlC;AACD,SAFD,MAEO;AACLuuC,UAAAA,WAAW,GAAGN,oBAAoB,CAACztC,IAAI,CAACgR,WAAN,EAAmB5R,CAAnB,EAAsBY,IAAI,CAACO,UAA3B,EAAuCP,IAAI,CAACR,GAA5C,CAAlC;AACD;AACF,OAND,MAMO;AACLuuC,QAAAA,WAAW,GAAGJ,sBAAsB,CAAC3tC,IAAI,CAACgR,WAAN,EAAmB5R,CAAnB,EAAsBY,IAAI,CAACO,UAA3B,CAApC;AACD;AACF,KAVD,MAUO;AACL,UAAIP,IAAI,CAAC4jB,WAAT,EAAsB;AACpB,YAAI/kB,IAAJ;;AAEA,YAAImB,IAAI,CAAC4S,kBAAL,IAA2B5S,IAAI,CAAClB,IAAL,CAAUuC,MAAV,GAAmB,CAAlD,EAAqD;AACnDxC,UAAAA,IAAI,GAAG,IAAIgL,IAAJ,CAASzK,CAAC,CAAC2T,GAAX,CAAP;AACD,SAFD,MAEO;AACLlU,UAAAA,IAAI,GAAG,IAAIgL,IAAJ,CAAS,CAACzK,CAAC,CAACY,IAAI,CAACO,UAAN,CAAX,CAAP;AACA1B,UAAAA,IAAI,CAACgiB,OAAL,CAAahiB,IAAI,CAACiiB,OAAL,EAAb;AACD;;AAEDitB,QAAAA,WAAW,GAAG9tC,GAAG,CAACpB,IAAD,CAAH,GAAY,IAA1B;AACD,OAXD,MAWO;AACLkvC,QAAAA,WAAW,GAAG/tC,IAAI,CAACO,UAAL,GAAkB,IAAlB,GAAyBnB,CAAC,CAACY,IAAI,CAACO,UAAN,CAA1B,GAA8C,KAA5D;AACD;AACF;;AACD,WAAOwtC,WAAP;AACD;;AAED,WAASpJ,4BAAT,CAAsC3kC,IAAtC,EAA4CZ,CAA5C,EAA+C4uC,aAA/C,EAA8DjvC,QAA9D,EAAwEkvC,UAAxE,EAAoF;AAClF,QAAIC,cAAJ,EAAoBnT,SAApB;AACA,QAAIoT,QAAQ,GAAGpuC,2BAA2B,CAACC,IAAD,CAA1C;;AACA,QAAI,OAAOZ,CAAC,CAACL,QAAD,CAAR,KAAuB,QAA3B,EAAqC;AACnCg8B,MAAAA,SAAS,GAAG,UAAS37B,CAAT,EAAY;AACtB,eAAOA,CAAP;AACD,OAFD;AAGD,KAJD,MAIO;AACL27B,MAAAA,SAAS,GAAGoE,sBAAsB,CAACn/B,IAAD,CAAlC;AACD;;AAED,QAAIguC,aAAa,KAAK,IAAtB,EAA4B;AAC1B,UAAIC,UAAJ,EAAgBC,cAAc,GAAGT,oBAAoB,CAACO,aAAD,EAAgB5uC,CAAhB,EAAmBL,QAAnB,EAA6BiB,IAAI,CAACR,GAAlC,CAArC,CAAhB,KACK0uC,cAAc,GAAGP,sBAAsB,CAACK,aAAD,EAAgB5uC,CAAhB,EAAmBL,QAAnB,CAAvC;AAEN,KAJD,MAIO;AACL,UAAIkvC,UAAJ,EAAgBC,cAAc,GAAGC,QAAQ,CAAC,IAAItkC,IAAJ,CAAS,CAACzK,CAAC,CAACL,QAAD,CAAX,CAAD,CAAR,GAAmC,IAApD,CAAhB,KACKmvC,cAAc,GAAG,CAACluC,IAAI,CAAC4jB,WAAL,GAAmB,EAAnB,GAAwB7kB,QAAQ,GAAG,IAApC,IAA4Cg8B,SAAS,CAAC37B,CAAC,CAACL,QAAD,CAAF,CAArD,GAAqE,KAAtF;AACN;;AACD,WAAOmvC,cAAP;AACD;;AAED,WAASE,0BAAT,CAAoCpuC,IAApC,EAA0CZ,CAA1C,EAA6C;AAC3C,WAAOulC,4BAA4B,CAAC3kC,IAAD,EAAOZ,CAAP,EAAUY,IAAI,CAACgR,WAAf,EAA4BhR,IAAI,CAACO,UAAjC,EAA6C,KAA7C,CAAnC;AACD;;AAED,WAASm+B,qBAAT,CAA+B1+B,IAA/B,EAAqCZ,CAArC,EAAwC;AACtC,WAAOulC,4BAA4B,CAAC3kC,IAAD,EAAOZ,CAAP,EAAUY,IAAI,CAACgR,WAAf,EAA4BhR,IAAI,CAACO,UAAjC,EAA6CP,IAAI,CAAC4jB,WAAlD,CAAnC;AACD;;AAED,WAAS+a,qBAAT,CAA+B3+B,IAA/B,EAAqCZ,CAArC,EAAwC;AACtC,WAAOulC,4BAA4B,CAAC3kC,IAAD,EAAOZ,CAAP,EAAUY,IAAI,CAACiR,WAAf,EAA4BjR,IAAI,CAACU,UAAjC,EAA6C,KAA7C,CAAnC;AACD;;AAED,WAAS+9B,+BAAT,CAAyCz+B,IAAzC,EAA+CZ,CAA/C,EAAkD;AAChD,WAAOulC,4BAA4B,CAAC3kC,IAAD,EAAOZ,CAAP,EAAUY,IAAI,CAACgR,WAAf,EAA4B,KAA5B,EAAmChR,IAAI,CAAC4jB,WAAxC,CAAnC;AACD;;AAEDrlB,EAAAA,EAAE,CAAC4gC,sBAAH,GAA4BA,sBAA5B,CA/5PqB,CAi6PrB;;AACA,WAAStF,UAAT,CAAoBwU,EAApB,EAAwBC,SAAxB,EAAmC;AACjC,WAAO,YAAW;AAChB,UAAIC,KAAK,GAAG,IAAZ;AAAA,UACEC,KAAK,GAAGD,KAAK,CAACE,SAAN,EADV;AAAA,UAEEC,EAAE,GAAGH,KAAK,CAACI,cAAN,MAA0B,CAFjC;AAAA,UAGEC,EAAE,GAAG,CAACJ,KAAK,CAACpnC,YAAN,CAAmB,GAAnB,EAAwBinC,EAAxB,GAA6BG,KAA9B,EAAqCG,cAArC,MAAyD,CAHhE,CADgB,CAMhB;;AACA,UAAIE,SAAS,GAAG,CAAC,CAAD,CAAhB;AAAA,UACE1pC,CAAC,GAAG,CADN;AAAA,UAEE2pC,EAAE,GAAGR,SAAS,GAAGn1B,IAAI,CAAC0I,GAAL,CAAS6sB,EAAT,EAAaE,EAAb,CAFnB;;AAGA,aAAO,CAACzpC,CAAC,IAAI2pC,EAAN,IAAY,CAAnB,EAAsBD,SAAS,CAACvkC,IAAV,CAAenF,CAAf;;AACtB0pC,MAAAA,SAAS,CAACvkC,IAAV,CAAe,CAAf,EAXgB,CAahB;;AACA,UAAIykC,MAAM,GAAGF,SAAS,CAAC1vC,GAAV,CAAc,UAASwoB,CAAT,EAAY;AACrC,YAAIqnB,EAAE,GAAGT,KAAK,CAACU,gBAAN,CAAuBtnB,CAAC,GAAG+mB,EAA3B,CAAT;AAAA,YACEQ,EAAE,GAAGV,KAAK,CAACS,gBAAN,CAAuBtnB,CAAC,GAAGinB,EAA3B,CADP;AAEA,eAAOpwC,EAAE,CAAC8T,WAAH,CAAe,CAAC08B,EAAE,CAAC9rB,CAAJ,EAAO8rB,EAAE,CAACrjC,CAAV,CAAf,EAA6B,CAACujC,EAAE,CAAChsB,CAAJ,EAAOgsB,EAAE,CAACvjC,CAAV,CAA7B,CAAP;AACD,OAJY,CAAb;AAMA,aAAO,UAASgc,CAAT,EAAY;AACjB,eAAOA,CAAC,GAAG,CAAJ,GAAQ,MAAMonB,MAAM,CAAC5vC,GAAP,CAAW,UAAS0rC,CAAT,EAAY;AAC1C,iBAAOA,CAAC,CAACljB,CAAD,CAAR;AACD,SAFoB,EAElB7b,IAFkB,CAEb,GAFa,CAAd,GAEQuiC,EAFf;AAGD,OAJD;AAKD,KAzBD;AA0BD;;AAED9vC,EAAAA,EAAE,CAACs7B,UAAH,GAAgBA,UAAhB,CA/7PqB,CAi8PrB;;AAEA,WAASsV,wBAAT,CAAkCr1B,QAAlC,EAA4C;AAC1C,QAAIs1B,cAAc,GAAG7wC,EAAE,CAAC6wC,cAAxB;AACA,QAAIC,UAAU,GAAG7wC,EAAE,CAACqF,MAAH,CAAUurC,cAAc,CAACt6B,QAAzB,CAAjB;AACA,QAAI7Q,MAAM,GAAGmrC,cAAc,CAACt6B,QAAf,CAAwBw6B,aAAxB,CAAsC,KAAtC,CAAb;AAEA,QAAIC,WAAW,GAAG7wC,MAAM,CAACF,EAAzB;AACA,QAAIgxC,eAAe,GAAG9wC,MAAM,CAACD,MAA7B;AACA,QAAIgxC,iBAAiB,GAAG/wC,MAAM,CAACoW,QAA/B;AACApW,IAAAA,MAAM,CAACF,EAAP,GAAY6wC,UAAZ;AACA3wC,IAAAA,MAAM,CAACD,MAAP,GAAgB2wC,cAAhB;AACA1wC,IAAAA,MAAM,CAACoW,QAAP,GAAkBs6B,cAAc,CAACt6B,QAAjC;AAEA,QAAI7G,KAAJ;;AACA,QAAI;AACF6L,MAAAA,QAAQ,CAAC7V,MAAD,CAAR;AACD,KAFD,CAEE,OAAMoS,CAAN,EAAS;AACTpI,MAAAA,KAAK,GAAGoI,CAAR;AACD;;AAED3X,IAAAA,MAAM,CAACF,EAAP,GAAY+wC,WAAZ;AACA7wC,IAAAA,MAAM,CAACD,MAAP,GAAgB+wC,eAAhB;AACA9wC,IAAAA,MAAM,CAACoW,QAAP,GAAkB26B,iBAAlB;;AAEA,QAAIxhC,KAAJ,EAAW;AACT,YAAMA,KAAN;AACD;AAED;AACF;AACA;;;AACE,WAAOohC,UAAU,CAACxrC,MAAX,CAAkB,SAAS6rC,QAAT,GAAoB;AAC3C,aAAOzrC,MAAP;AACD,KAFM,EAEJoQ,IAFI,EAAP;AAGD;;AAED,WAASs7B,wBAAT,CAAkC71B,QAAlC,EAA4C;AAC1C,QAAI7V,MAAM,GAAG6Q,QAAQ,CAACw6B,aAAT,CAAuB,KAAvB,CAAb;AACAx1B,IAAAA,QAAQ,CAAC7V,MAAD,CAAR;AACA,WAAOzF,EAAE,CAACqF,MAAH,CAAUI,MAAV,EAAkBoQ,IAAlB,EAAP;AACD;;AAED,WAASu7B,aAAT,CAAuB91B,QAAvB,EAAiC;AAC/B,YAAO,OAAOrb,MAAd;AACE,WAAK,WAAL;AACE,eAAO0wC,wBAAwB,CAACr1B,QAAD,CAA/B;;AACF;AACE,eAAO61B,wBAAwB,CAAC71B,QAAD,CAA/B;AAJJ;AAMD;;AAED,WAAS+1B,mBAAT,CAA6BC,KAA7B,EAAoCC,KAApC,EAA2C;AACzC,QAAIxxC,EAAE,CAAC6wC,cAAH,IAAqB,CAACW,KAA1B,EAAiC;AAC/B;AACD;;AAED,QAAIC,GAAG,GAAGF,KAAK,CAACA,KAAN,CAAY;AACpBz7B,MAAAA,IAAI,EAAE,EADc;AAEpBgjB,MAAAA,QAAQ,EAAE;AAAE4Y,QAAAA,aAAa,EAAE;AAAjB;AAFU,KAAZ,CAAV;AAIA1xC,IAAAA,EAAE,CAAC6wC,cAAH,GAAoBY,GAAG,CAACE,WAAxB;AACD;;AAED3xC,EAAAA,EAAE,CAACqxC,aAAH,GAAmBA,aAAnB;AACArxC,EAAAA,EAAE,CAACsxC,mBAAH,GAAyBA,mBAAzB,CAlgQqB,CAogQrB;;AACA,WAAS5hC,KAAT,CAAejO,IAAf,EAAqB;AACnBqH,IAAAA,OAAO,CAAC4G,KAAR,CAAc,UAAd,EAA0BjO,IAAI,CAACiE,MAA/B,EAAuC,KAAvC,EAA8CjE,IAAI,CAACiO,KAAnD;AAEAzP,IAAAA,EAAE,CAACqF,MAAH,CAAU7D,IAAI,CAACiE,MAAf,EAAuBJ,MAAvB,CAA8B,iBAA9B,EACGH,MADH,CACU,OADV,EAEKY,IAFL,CAEU,OAFV,EAEmB,0CAFnB,EAGKA,IAHL,CAGU,IAHV,EAGgB,OAHhB,EAIKuB,IAJL,CAIU,QAJV;AAKD;;AAED,WAASq4B,cAAT,CAAwBl+B,IAAxB,EAA8B;AAC5BqH,IAAAA,OAAO,CAAC4G,KAAR,CAAc,mBAAd,EAAmCjO,IAAI,CAACiE,MAAxC,EAAgD,KAAhD,EAAuDjE,IAAI,CAACk+B,cAA5D;AACD;;AAED3/B,EAAAA,EAAE,CAAC0P,KAAH,GAAWA,KAAX;AAEA,SAAO1P,EAAP;AACC,CA9hQA,CAAD","sourcesContent":["(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['d3'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('d3'));\n  } else {\n    root.MG = factory(root.d3);\n  }\n}(this, function(d3) {\n(typeof window === 'undefined' ? global : window).MG = {version: '2.11'};\n\n//a set of helper functions, some that we've written, others that we've borrowed\n\nMG.convert = {};\n\nMG.convert.date = function(data, accessor, time_format) {\n  time_format = (typeof time_format === \"undefined\") ? '%Y-%m-%d' : time_format;\n  var parse_time = d3.timeParse(time_format);\n  data = data.map(function(d) {\n    d[accessor] = parse_time(d[accessor].trim());\n    return d;\n  });\n\n  return data;\n}\n\nMG.convert.number = function(data, accessor) {\n  data = data.map(function(d) {\n    d[accessor] = Number(d[accessor]);\n    return d;\n  });\n\n  return data;\n}\n\nMG.time_format = function(utc, specifier) {\n  return utc ? d3.utcFormat(specifier) : d3.timeFormat(specifier);\n}\n\nfunction mg_jquery_exists() {\n  if (typeof jQuery !== 'undefined' || typeof $ !== 'undefined') {\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction mg_get_rollover_time_format(args) {\n  var fmt;\n  switch (args.processed.x_time_frame) {\n    case 'millis':\n      fmt = MG.time_format(args.utc_time, '%b %e, %Y  %H:%M:%S.%L');\n      break;\n    case 'seconds':\n      fmt = MG.time_format(args.utc_time, '%b %e, %Y  %H:%M:%S');\n      break;\n    case 'less-than-a-day':\n      fmt = MG.time_format(args.utc_time, '%b %e, %Y  %I:%M%p');\n      break;\n    case 'four-days':\n      fmt = MG.time_format(args.utc_time, '%b %e, %Y  %I:%M%p');\n      break;\n    default:\n      fmt = MG.time_format(args.utc_time, '%b %e, %Y');\n  }\n  return fmt;\n}\n\nfunction mg_data_in_plot_bounds(datum, args) {\n  return datum[args.x_accessor] >= args.processed.min_x &&\n    datum[args.x_accessor] <= args.processed.max_x &&\n    datum[args.y_accessor] >= args.processed.min_y &&\n    datum[args.y_accessor] <= args.processed.max_y;\n}\n\nfunction is_array(thing) {\n  return Object.prototype.toString.call(thing) === '[object Array]';\n}\n\nfunction is_function(thing) {\n  return Object.prototype.toString.call(thing) === '[object Function]';\n}\n\nfunction is_empty_array(thing) {\n  return is_array(thing) && thing.length === 0;\n}\n\nfunction is_object(thing) {\n  return Object.prototype.toString.call(thing) === '[object Object]';\n}\n\nfunction is_array_of_arrays(data) {\n  var all_elements = data.map(function(d) {\n    return is_array(d) === true && d.length > 0;\n  });\n\n  return d3.sum(all_elements) === data.length;\n}\n\nfunction is_array_of_objects(data) {\n  // is every element of data an object?\n  var all_elements = data.map(function(d) {\n    return is_object(d) === true;\n  });\n\n  return d3.sum(all_elements) === data.length;\n}\n\nfunction is_array_of_objects_or_empty(data) {\n  return is_empty_array(data) || is_array_of_objects(data);\n}\n\nfunction pluck(arr, accessor) {\n  return arr.map(function(d) {\n    return d[accessor] });\n}\n\nfunction count_array_elements(arr) {\n  return arr.reduce(function(a, b) { a[b] = a[b] + 1 || 1;\n    return a; }, {});\n}\n\nfunction mg_get_bottom(args) {\n  return args.height - args.bottom;\n}\n\nfunction mg_get_plot_bottom(args) {\n  // returns the pixel location of the bottom side of the plot area.\n  return mg_get_bottom(args) - args.buffer;\n}\n\nfunction mg_get_top(args) {\n  return args.top;\n}\n\nfunction mg_get_plot_top(args) {\n  // returns the pixel location of the top side of the plot area.\n  return mg_get_top(args) + args.buffer;\n}\n\nfunction mg_get_left(args) {\n  return args.left;\n}\n\nfunction mg_get_plot_left(args) {\n  // returns the pixel location of the left side of the plot area.\n  return mg_get_left(args) + args.buffer;\n}\n\nfunction mg_get_right(args) {\n  return args.width - args.right;\n}\n\nfunction mg_get_plot_right(args) {\n  // returns the pixel location of the right side of the plot area.\n  return mg_get_right(args) - args.buffer;\n}\n\n//////// adding elements, removing elements /////////////\n\nfunction mg_exit_and_remove(elem) {\n  elem.exit().remove();\n}\n\nfunction mg_selectAll_and_remove(svg, cl) {\n  svg.selectAll(cl).remove();\n}\n\nfunction mg_add_g(svg, cl) {\n  return svg.append('g').classed(cl, true);\n}\n\nfunction mg_remove_element(svg, elem) {\n  svg.select(elem).remove();\n}\n\n//////// axis helper functions ////////////\n\nfunction mg_make_rug(args, rug_class) {\n  var svg = mg_get_svg_child_of(args.target);\n  var all_data = mg_flatten_array(args.data);\n  var rug = svg.selectAll('line.' + rug_class).data(all_data);\n\n  rug.enter()\n    .append('line')\n      .attr('class', rug_class)\n      .attr('opacity', 0.3);\n\n  //remove rug elements that are no longer in use\n  mg_exit_and_remove(rug);\n\n  //set coordinates of new rug elements\n  mg_exit_and_remove(rug);\n  return rug;\n}\n\nfunction mg_add_color_accessor_to_rug(rug, args, rug_mono_class) {\n  if (args.color_accessor) {\n    rug.attr('stroke', args.scalefns.colorf);\n    rug.classed(rug_mono_class, false);\n  } else {\n    rug.attr('stroke', null);\n    rug.classed(rug_mono_class, true);\n  }\n}\n\nfunction mg_rotate_labels(labels, rotation_degree) {\n  if (rotation_degree) {\n    labels.attr({\n      dy: 0,\n      transform: function() {\n        var elem = d3.select(this);\n        return 'rotate(' + rotation_degree + ' ' + elem.attr('x') + ',' + elem.attr('y') + ')';\n      }\n    });\n  }\n}\n\n//////////////////////////////////////////////////\n\nfunction mg_elements_are_overlapping(labels) {\n  labels = labels.node();\n  if (!labels) {\n    return false;\n  }\n\n  for (var i = 0; i < labels.length; i++) {\n    if (mg_is_horizontally_overlapping(labels[i], labels)) return true;\n  }\n\n  return false;\n}\n\nfunction mg_prevent_horizontal_overlap(labels, args) {\n  if (!labels || labels.length == 1) {\n    return;\n  }\n\n  //see if each of our labels overlaps any of the other labels\n  for (var i = 0; i < labels.length; i++) {\n    //if so, nudge it up a bit, if the label it intersects hasn't already been nudged\n    if (mg_is_horizontally_overlapping(labels[i], labels)) {\n      var node = d3.select(labels[i]);\n      var newY = +node.attr('y');\n      if (newY + 8 >= args.top) {\n        newY = args.top - 16;\n      }\n      node.attr('y', newY);\n    }\n  }\n}\n\nfunction mg_prevent_vertical_overlap(labels, args) {\n  if (!labels || labels.length == 1) {\n    return;\n  }\n\n  labels.sort(function(b, a) {\n    return d3.select(a).attr('y') - d3.select(b).attr('y');\n  });\n\n  labels.reverse();\n\n  var overlap_amount, label_i, label_j;\n\n  //see if each of our labels overlaps any of the other labels\n  for (var i = 0; i < labels.length; i++) {\n    //if so, nudge it up a bit, if the label it intersects hasn't already been nudged\n    label_i = d3.select(labels[i]).text();\n\n    for (var j = 0; j < labels.length; j++) {\n      label_j = d3.select(labels[j]).text();\n      overlap_amount = mg_is_vertically_overlapping(labels[i], labels[j]);\n\n      if (overlap_amount !== false && label_i !== label_j) {\n        var node = d3.select(labels[i]);\n        var newY = +node.attr('y');\n        newY = newY + overlap_amount;\n        node.attr('y', newY);\n      }\n    }\n  }\n}\n\nfunction mg_is_vertically_overlapping(element, sibling) {\n  var element_bbox = element.getBoundingClientRect();\n  var sibling_bbox = sibling.getBoundingClientRect();\n\n  if (element_bbox.top <= sibling_bbox.bottom && element_bbox.top >= sibling_bbox.top) {\n    return sibling_bbox.bottom - element_bbox.top;\n  }\n\n  return false;\n}\n\nfunction mg_is_horiz_overlap(element, sibling) {\n  var element_bbox = element.getBoundingClientRect();\n  var sibling_bbox = sibling.getBoundingClientRect();\n\n  if (element_bbox.right >= sibling_bbox.left || element_bbox.top >= sibling_bbox.top) {\n    return sibling_bbox.bottom - element_bbox.top;\n  }\n  return false;\n}\n\nfunction mg_is_horizontally_overlapping(element, labels) {\n  var element_bbox = element.getBoundingClientRect();\n\n  for (var i = 0; i < labels.length; i++) {\n    if (labels[i] == element) {\n      continue;\n    }\n\n    //check to see if this label overlaps with any of the other labels\n    var sibling_bbox = labels[i].getBoundingClientRect();\n    if (element_bbox.top === sibling_bbox.top &&\n      !(sibling_bbox.left > element_bbox.right || sibling_bbox.right < element_bbox.left)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction mg_infer_type(args, ns) {\n    // must return categorical or numerical.\n    var testPoint = mg_flatten_array(args.data);\n\n    testPoint = testPoint[0][args[ns + '_accessor']];\n    return typeof testPoint === 'string' ? 'categorical' : 'numerical';\n  }\n\nfunction mg_get_svg_child_of(selector_or_node) {\n  return d3.select(selector_or_node).select('svg');\n}\n\nfunction mg_flatten_array(arr) {\n  var flat_data = [];\n  return flat_data.concat.apply(flat_data, arr);\n}\n\nfunction mg_next_id() {\n  if (typeof MG._next_elem_id === 'undefined') {\n    MG._next_elem_id = 0;\n  }\n\n  return 'mg-' + (MG._next_elem_id++);\n}\n\nfunction mg_target_ref(target) {\n  if (typeof target === 'string') {\n    return mg_normalize(target);\n\n  } else if (target instanceof window.HTMLElement) {\n    var target_ref = target.getAttribute('data-mg-uid');\n    if (!target_ref) {\n      target_ref = mg_next_id();\n      target.setAttribute('data-mg-uid', target_ref);\n    }\n\n    return target_ref;\n\n  } else {\n    console.warn('The specified target should be a string or an HTMLElement.', target);\n    return mg_normalize(target);\n  }\n}\n\nfunction mg_normalize(string) {\n  return string\n    .replace(/[^a-zA-Z0-9 _-]+/g, '')\n    .replace(/ +?/g, '');\n}\n\nfunction get_pixel_dimension(target, dimension) {\n  return Number(d3.select(target).style(dimension).replace(/px/g, ''));\n}\n\nfunction get_width(target) {\n  return get_pixel_dimension(target, 'width');\n}\n\nfunction get_height(target) {\n  return get_pixel_dimension(target, 'height');\n}\n\nfunction isNumeric(n) {\n  return !isNaN(parseFloat(n)) && isFinite(n);\n}\n\nvar each = function(obj, iterator, context) {\n  // yanked out of underscore\n  var breaker = {};\n  if (obj === null) return obj;\n  if (Array.prototype.forEach && obj.forEach === Array.prototype.forEach) {\n    obj.forEach(iterator, context);\n  } else if (obj.length === +obj.length) {\n    for (var i = 0, length = obj.length; i < length; i++) {\n      if (iterator.call(context, obj[i], i, obj) === breaker) return;\n    }\n  } else {\n    for (var k in obj) {\n      if (iterator.call(context, obj[k], k, obj) === breaker) return;\n    }\n  }\n\n  return obj;\n};\n\nfunction merge_with_defaults(obj) {\n  // taken from underscore\n  each(Array.prototype.slice.call(arguments, 1), function(source) {\n    if (source) {\n      for (var prop in source) {\n        if (obj[prop] === void 0) obj[prop] = source[prop];\n      }\n    }\n  });\n\n  return obj;\n}\n\nMG.merge_with_defaults = merge_with_defaults;\n\nfunction number_of_values(data, accessor, value) {\n  var values = data.filter(function(d) {\n    return d[accessor] === value;\n  });\n\n  return values.length;\n}\n\nfunction has_values_below(data, accessor, value) {\n  var values = data.filter(function(d) {\n    return d[accessor] <= value;\n  });\n\n  return values.length > 0;\n}\n\nfunction has_too_many_zeros(data, accessor, zero_count) {\n  return number_of_values(data, accessor, 0) >= zero_count;\n}\n\nfunction mg_is_date(obj) {\n  return Object.prototype.toString.call(obj) === '[object Date]';\n}\n\nfunction mg_is_object(obj) {\n  return Object.prototype.toString.call(obj) === '[object Object]';\n}\n\nfunction mg_is_array(obj) {\n  if (Array.isArray) {\n    return Array.isArray(obj);\n  }\n\n  return Object.prototype.toString.call(obj) === '[object Array]';\n}\n\n// deep copy\n// http://stackoverflow.com/questions/728360/most-elegant-way-to-clone-a-javascript-object\nMG.clone = function(obj) {\n  var copy;\n\n  // Handle the 3 simple types, and null or undefined\n  if (null === obj || \"object\" !== typeof obj) return obj;\n\n  // Handle Date\n  if (mg_is_date(obj)) {\n    copy = new Date();\n    copy.setTime(obj.getTime());\n    return copy;\n  }\n\n  // Handle Array\n  if (mg_is_array(obj)) {\n    copy = [];\n    for (var i = 0, len = obj.length; i < len; i++) {\n      copy[i] = MG.clone(obj[i]);\n    }\n    return copy;\n  }\n\n  // Handle Object\n  if (mg_is_object(obj)) {\n    copy = {};\n    for (var attr in obj) {\n      if (obj.hasOwnProperty(attr)) copy[attr] = MG.clone(obj[attr]);\n    }\n    return copy;\n  }\n\n  throw new Error(\"Unable to copy obj! Its type isn't supported.\");\n};\n\n// give us the difference of two int arrays\n// http://radu.cotescu.com/javascript-diff-function/\nfunction arr_diff(a, b) {\n  var seen = [],\n    diff = [],\n    i;\n  for (i = 0; i < b.length; i++)\n    seen[b[i]] = true;\n  for (i = 0; i < a.length; i++)\n    if (!seen[a[i]])\n      diff.push(a[i]);\n  return diff;\n}\n\nMG.arr_diff = arr_diff;\n\n/**\n  Print warning message to the console when a feature has been scheduled for removal\n\n  @author Dan de Havilland (github.com/dandehavilland)\n  @date 2014-12\n*/\nfunction warn_deprecation(message, untilVersion) {\n  console.warn('Deprecation: ' + message + (untilVersion ? '. This feature will be removed in ' + untilVersion + '.' : ' the near future.'));\n  console.trace();\n}\n\nMG.warn_deprecation = warn_deprecation;\n\n/**\n  Truncate a string to fit within an SVG text node\n  CSS text-overlow doesn't apply to SVG <= 1.2\n\n  @author Dan de Havilland (github.com/dandehavilland)\n  @date 2014-12-02\n*/\nfunction truncate_text(textObj, textString, width) {\n  var bbox,\n    position = 0;\n\n  textObj.textContent = textString;\n  bbox = textObj.getBBox();\n\n  while (bbox.width > width) {\n    textObj.textContent = textString.slice(0, --position) + '...';\n    bbox = textObj.getBBox();\n\n    if (textObj.textContent === '...') {\n      break;\n    }\n  }\n}\n\nMG.truncate_text = truncate_text;\n\n/**\n  Wrap the contents of a text node to a specific width\n\n  Adapted from bl.ocks.org/mbostock/7555321\n\n  @author Mike Bostock\n  @author Dan de Havilland\n  @date 2015-01-14\n*/\nfunction wrap_text(text, width, token, tspanAttrs) {\n  text.each(function() {\n    var text = d3.select(this),\n      words = text.text().split(token || /\\s+/).reverse(),\n      word,\n      line = [],\n      lineNumber = 0,\n      lineHeight = 1.1, // ems\n      y = text.attr(\"y\"),\n      dy = 0,\n      tspan = text.text(null)\n      .append(\"tspan\")\n      .attr(\"x\", 0)\n      .attr(\"y\", dy + \"em\")\n      .attr(tspanAttrs || {});\n\n    while (!!(word = words.pop())) {\n      line.push(word);\n      tspan.text(line.join(\" \"));\n      if (width === null || tspan.node().getComputedTextLength() > width) {\n        line.pop();\n        tspan.text(line.join(\" \"));\n        line = [word];\n        tspan = text\n          .append(\"tspan\")\n          .attr(\"x\", 0)\n          .attr(\"y\", ++lineNumber * lineHeight + dy + \"em\")\n          .attr(tspanAttrs || {})\n          .text(word);\n      }\n    }\n  });\n}\n\nMG.wrap_text = wrap_text;\n\nfunction register(chartType, descriptor, defaults) {\n  MG.charts[chartType] = {\n    descriptor: descriptor,\n    defaults: defaults || {}\n  };\n}\n\nMG.register = register;\n\n/**\n  Record of all registered hooks.\n  For internal use only.\n*/\nMG._hooks = {};\n\n/**\n  Add a hook callthrough to the stack.\n\n  Hooks are executed in the order that they were registered.\n*/\nMG.add_hook = function(name, func, context) {\n  var hooks;\n\n  if (!MG._hooks[name]) {\n    MG._hooks[name] = [];\n  }\n\n  hooks = MG._hooks[name];\n\n  var already_registered =\n    hooks.filter(function(hook) {\n      return hook.func === func;\n    })\n    .length > 0;\n\n  if (already_registered) {\n    throw 'That function is already registered.';\n  }\n\n  hooks.push({\n    func: func,\n    context: context\n  });\n};\n\n/**\n  Execute registered hooks.\n\n  Optional arguments\n*/\nMG.call_hook = function(name) {\n  var hooks = MG._hooks[name],\n    result = [].slice.apply(arguments, [1]),\n    processed;\n\n  if (hooks) {\n    hooks.forEach(function(hook) {\n      if (hook.func) {\n        var params = processed || result;\n\n        if (params && params.constructor !== Array) {\n          params = [params];\n        }\n\n        params = [].concat.apply([], params);\n        processed = hook.func.apply(hook.context, params);\n      }\n    });\n  }\n\n  return processed || result;\n};\n\nMG.globals = {};\nMG.deprecations = {\n  rollover_callback: { replacement: 'mouseover', version: '2.0' },\n  rollout_callback: { replacement: 'mouseout', version: '2.0' },\n  x_rollover_format: { replacement: 'x_mouseover', version: '2.10' },\n  y_rollover_format: { replacement: 'y_mouseover', version: '2.10' },\n  show_years: { replacement: 'show_secondary_x_label', version: '2.1' },\n  xax_start_at_min: { replacement: 'axes_not_compact', version: '2.7' },\n  interpolate_tension: { replacement: 'interpolate', version: '2.10' }\n};\nMG.globals.link = false;\nMG.globals.version = \"1.1\";\n\nMG.charts = {};\n\nMG.data_graphic = function(args) {\n  'use strict';\n  var defaults = {\n    missing_is_zero: false,                     // if true, missing values will be treated as zeros\n    missing_is_hidden: false,                   // if true, missing values will appear as broken segments\n    missing_is_hidden_accessor: null,           // the accessor that determines the boolean value for missing data points\n    legend: '' ,                                // an array identifying the labels for a chart's lines\n    legend_target: '',                          // if set, the specified element is populated with a legend\n    error: '',                                  // if set, a graph will show an error icon and log the error to the console\n    animate_on_load: false,                     // animate lines on load\n    top: 65,                                    // the size of the top margin\n    title_y_position: 10,                       // how many pixels from the top edge (0) should we show the title at\n    center_title_full_width: false,             // center the title over the full graph (i.e. ignore left and right margins)\n    bottom: 45,                                 // the size of the bottom margin\n    right: 10,                                  // size of the right margin\n    left: 50,                                   // size of the left margin\n    buffer: 8,                                  // the buffer between the actual chart area and the margins\n    width: 350,                                 // the width of the entire graphic\n    height: 220,                                // the height of the entire graphic\n    full_width: false,                          // sets the graphic width to be the width of the parent element and resizes dynamically\n    full_height: false,                         // sets the graphic width to be the width of the parent element and resizes dynamically\n    small_height_threshold: 120,                // the height threshold for when smaller text appears\n    small_width_threshold: 160,                 // the width  threshold for when smaller text appears\n    xax_count: 6,                               // number of x axis ticks\n    xax_tick_length: 5,                         // x axis tick length\n    axes_not_compact: true,\n    yax_count: 3,                               // number of y axis ticks\n    yax_tick_length: 5,                         // y axis tick length\n    x_extended_ticks: false,                    // extends x axis ticks across chart - useful for tall charts\n    y_extended_ticks: false,                    // extends y axis ticks across chart - useful for long charts\n    y_scale_type: 'linear',\n    max_x: null,\n    max_y: null,\n    min_x: null,\n    min_y: null,                                // if set, y axis starts at an arbitrary value\n    min_y_from_data: false,                     // if set, y axis will start at minimum value rather than at 0\n    point_size: 2.5,                            // the size of the dot that appears on a line on mouse-over\n    x_accessor: 'date',\n    xax_units: '',\n    x_label: '',\n    x_sort: true,\n    x_axis: true,\n    y_axis: true,\n    x_axis_position: 'bottom',\n    y_axis_position: 'left',\n    x_axis_type: null,                          // TO BE INTRODUCED IN 2.10\n    y_axis_type: null,                          // TO BE INTRODUCED IN 2.10\n    ygroup_accessor: null,\n    xgroup_accessor:null,\n    y_padding_percentage: 0.05,                 // for categorical scales\n    y_outer_padding_percentage: .1,             // for categorical scales\n    ygroup_padding_percentage:.25,              // for categorical scales\n    ygroup_outer_padding_percentage: 0,         // for categorical scales\n    x_padding_percentage: 0.05,                 // for categorical scales\n    x_outer_padding_percentage: .1,             // for categorical scales\n    xgroup_padding_percentage:.25,              // for categorical scales\n    xgroup_outer_padding_percentage: 0,         // for categorical scales\n    y_categorical_show_guides: false,\n    x_categorical_show_guide: false,\n    rotate_x_labels: 0,\n    rotate_y_labels: 0,\n    y_accessor: 'value',\n    y_label: '',\n    yax_units: '',\n    yax_units_append: false,\n    x_rug: false,\n    y_rug: false,\n    mouseover_align: 'right',                   // implemented in point.js\n    x_mouseover: null,\n    y_mouseover: null,\n    transition_on_update: true,\n    mouseover: null,\n    click: null,\n    show_rollover_text: true,\n    show_confidence_band: null,                 // given [l, u] shows a confidence at each point from l to u\n    xax_format: null,                           // xax_format is a function that formats the labels for the x axis.\n    area: true,\n    chart_type: 'line',\n    data: [],\n    decimals: 2,                                // the number of decimals in any rollover\n    format: 'count',                            // format = {count, percentage}\n    inflator: 10/9,                             // for setting y axis max\n    linked: false,                              // links together all other graphs with linked:true, so rollovers in one trigger rollovers in the others\n    linked_format: '%Y-%m-%d',                  // What granularity to link on for graphs. Default is at day\n    list: false,\n    baselines: null,                            // sets the baseline lines\n    markers: null,                              // sets the marker lines\n    scalefns: {},\n    scales: {},\n    utc_time: false,\n    european_clock: false,\n    show_year_markers: false,\n    show_secondary_x_label: true,\n    target: '#viz',\n    interpolate: d3.curveCatmullRom.alpha(0),   // interpolation method to use when rendering lines; increase tension if your data is irregular and you notice artifacts\n    custom_line_color_map: [],                  // allows arbitrary mapping of lines to colors, e.g. [2,3] will map line 1 to color 2 and line 2 to color 3\n    colors: null,                               // UNIMPLEMENTED - allows direct color mapping to line colors. Will eventually require\n    max_data_size: null,                        // explicitly specify the the max number of line series, for use with custom_line_color_map\n    aggregate_rollover: false,                  // links the lines in a multi-line chart\n    show_tooltips: true                         // if enabled, a chart's description will appear in a tooltip (requires jquery)\n  };\n\n  MG.call_hook('global.defaults', defaults);\n\n  if (!args) { args = {}; }\n\n  var selected_chart = MG.charts[args.chart_type || defaults.chart_type];\n  merge_with_defaults(args, selected_chart.defaults, defaults);\n\n  if (args.list) {\n    args.x_accessor = 0;\n    args.y_accessor = 1;\n  }\n\n  // check for deprecated parameters\n  for (var key in MG.deprecations) {\n    if (args.hasOwnProperty(key)) {\n      var deprecation = MG.deprecations[key],\n        message = 'Use of `args.' + key + '` has been deprecated',\n        replacement = deprecation.replacement,\n        version;\n\n      // transparently alias the deprecated\n      if (replacement) {\n        if (args[replacement]) {\n          message += '. The replacement - `args.' + replacement + '` - has already been defined. This definition will be discarded.';\n        } else {\n          args[replacement] = args[key];\n        }\n      }\n\n      if (deprecation.warned) {\n        continue;\n      }\n\n      deprecation.warned = true;\n\n      if (replacement) {\n        message += ' in favor of `args.' + replacement + '`';\n      }\n\n      warn_deprecation(message, deprecation.version);\n    }\n  }\n\n  MG.call_hook('global.before_init', args);\n\n  new selected_chart.descriptor(args);\n\n  return args.data;\n};\n\nif (mg_jquery_exists()) {\n    /* ========================================================================\n     * Bootstrap: tooltip.js v3.3.5\n     * http://getbootstrap.com/javascript/#tooltip\n     * Inspired by the original jQuery.tipsy by Jason Frame\n     * ========================================================================\n     * Copyright 2011-2015 Twitter, Inc.\n     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n     * ======================================================================== */\n\n\n    +function ($) {\n      'use strict';\n\n      // TOOLTIP PUBLIC CLASS DEFINITION\n      // ===============================\n\n      var Tooltip = function (element, options) {\n        this.type       = null\n        this.options    = null\n        this.enabled    = null\n        this.timeout    = null\n        this.hoverState = null\n        this.$element   = null\n        this.inState    = null\n\n        this.init('tooltip', element, options)\n      }\n\n      Tooltip.VERSION  = '3.3.5'\n\n      Tooltip.TRANSITION_DURATION = 150\n\n      Tooltip.DEFAULTS = {\n        animation: true,\n        placement: 'top',\n        selector: false,\n        template: '<div class=\"tooltip\" role=\"tooltip\"><div class=\"tooltip-arrow\"></div><div class=\"tooltip-inner\"></div></div>',\n        trigger: 'hover focus',\n        title: '',\n        delay: 0,\n        html: false,\n        container: false,\n        viewport: {\n          selector: 'body',\n          padding: 0\n        }\n      }\n\n      Tooltip.prototype.init = function (type, element, options) {\n        this.enabled   = true\n        this.type      = type\n        this.$element  = $(element)\n        this.options   = this.getOptions(options)\n        this.$viewport = this.options.viewport && $($.isFunction(this.options.viewport) ? this.options.viewport.call(this, this.$element) : (this.options.viewport.selector || this.options.viewport))\n        this.inState   = { click: false, hover: false, focus: false }\n\n        if (this.$element[0] instanceof document.constructor && !this.options.selector) {\n          throw new Error('`selector` option must be specified when initializing ' + this.type + ' on the window.document object!')\n        }\n\n        var triggers = this.options.trigger.split(' ')\n\n        for (var i = triggers.length; i--;) {\n          var trigger = triggers[i]\n\n          if (trigger == 'click') {\n            this.$element.on('click.' + this.type, this.options.selector, $.proxy(this.toggle, this))\n          } else if (trigger != 'manual') {\n            var eventIn  = trigger == 'hover' ? 'mouseenter' : 'focusin'\n            var eventOut = trigger == 'hover' ? 'mouseleave' : 'focusout'\n\n            this.$element.on(eventIn  + '.' + this.type, this.options.selector, $.proxy(this.enter, this))\n            this.$element.on(eventOut + '.' + this.type, this.options.selector, $.proxy(this.leave, this))\n          }\n        }\n\n        this.options.selector ?\n          (this._options = $.extend({}, this.options, { trigger: 'manual', selector: '' })) :\n          this.fixTitle()\n      }\n\n      Tooltip.prototype.getDefaults = function () {\n        return Tooltip.DEFAULTS\n      }\n\n      Tooltip.prototype.getOptions = function (options) {\n        options = $.extend({}, this.getDefaults(), this.$element.data(), options)\n\n        if (options.delay && typeof options.delay == 'number') {\n          options.delay = {\n            show: options.delay,\n            hide: options.delay\n          }\n        }\n\n        return options\n      }\n\n      Tooltip.prototype.getDelegateOptions = function () {\n        var options  = {}\n        var defaults = this.getDefaults()\n\n        this._options && $.each(this._options, function (key, value) {\n          if (defaults[key] != value) options[key] = value\n        })\n\n        return options\n      }\n\n      Tooltip.prototype.enter = function (obj) {\n        var self = obj instanceof this.constructor ?\n          obj : $(obj.currentTarget).data('bs.' + this.type)\n\n        if (!self) {\n          self = new this.constructor(obj.currentTarget, this.getDelegateOptions())\n          $(obj.currentTarget).data('bs.' + this.type, self)\n        }\n\n        if (obj instanceof $.Event) {\n          self.inState[obj.type == 'focusin' ? 'focus' : 'hover'] = true\n        }\n\n        if (self.tip().hasClass('in') || self.hoverState == 'in') {\n          self.hoverState = 'in'\n          return\n        }\n\n        clearTimeout(self.timeout)\n\n        self.hoverState = 'in'\n\n        if (!self.options.delay || !self.options.delay.show) return self.show()\n\n        self.timeout = setTimeout(function () {\n          if (self.hoverState == 'in') self.show()\n        }, self.options.delay.show)\n      }\n\n      Tooltip.prototype.isInStateTrue = function () {\n        for (var key in this.inState) {\n          if (this.inState[key]) return true\n        }\n\n        return false\n      }\n\n      Tooltip.prototype.leave = function (obj) {\n        var self = obj instanceof this.constructor ?\n          obj : $(obj.currentTarget).data('bs.' + this.type)\n\n        if (!self) {\n          self = new this.constructor(obj.currentTarget, this.getDelegateOptions())\n          $(obj.currentTarget).data('bs.' + this.type, self)\n        }\n\n        if (obj instanceof $.Event) {\n          self.inState[obj.type == 'focusout' ? 'focus' : 'hover'] = false\n        }\n\n        if (self.isInStateTrue()) return\n\n        clearTimeout(self.timeout)\n\n        self.hoverState = 'out'\n\n        if (!self.options.delay || !self.options.delay.hide) return self.hide()\n\n        self.timeout = setTimeout(function () {\n          if (self.hoverState == 'out') self.hide()\n        }, self.options.delay.hide)\n      }\n\n      Tooltip.prototype.show = function () {\n        var e = $.Event('show.bs.' + this.type)\n\n        if (this.hasContent() && this.enabled) {\n          this.$element.trigger(e)\n\n          var inDom = $.contains(this.$element[0].ownerDocument.documentElement, this.$element[0])\n          if (e.isDefaultPrevented() || !inDom) return\n          var that = this\n\n          var $tip = this.tip()\n\n          var tipId = this.getUID(this.type)\n\n          this.setContent()\n          $tip.attr('id', tipId)\n          this.$element.attr('aria-describedby', tipId)\n\n          if (this.options.animation) $tip.addClass('fade')\n\n          var placement = typeof this.options.placement == 'function' ?\n            this.options.placement.call(this, $tip[0], this.$element[0]) :\n            this.options.placement\n\n          var autoToken = /\\s?auto?\\s?/i\n          var autoPlace = autoToken.test(placement)\n          if (autoPlace) placement = placement.replace(autoToken, '') || 'top'\n\n          $tip\n            .detach()\n            .css({ top: 0, left: 0, display: 'block' })\n            .addClass(placement)\n            .data('bs.' + this.type, this)\n\n          this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element)\n          this.$element.trigger('inserted.bs.' + this.type)\n\n          var pos          = this.getPosition()\n          var actualWidth  = $tip[0].offsetWidth\n          var actualHeight = $tip[0].offsetHeight\n\n          if (autoPlace) {\n            var orgPlacement = placement\n            var viewportDim = this.getPosition(this.$viewport)\n\n            placement = placement == 'bottom' && pos.bottom + actualHeight > viewportDim.bottom ? 'top'    :\n                        placement == 'top'    && pos.top    - actualHeight < viewportDim.top    ? 'bottom' :\n                        placement == 'right'  && pos.right  + actualWidth  > viewportDim.width  ? 'left'   :\n                        placement == 'left'   && pos.left   - actualWidth  < viewportDim.left   ? 'right'  :\n                        placement\n\n            $tip\n              .removeClass(orgPlacement)\n              .addClass(placement)\n          }\n\n          var calculatedOffset = this.getCalculatedOffset(placement, pos, actualWidth, actualHeight)\n\n          this.applyPlacement(calculatedOffset, placement)\n\n          var complete = function () {\n            var prevHoverState = that.hoverState\n            that.$element.trigger('shown.bs.' + that.type)\n            that.hoverState = null\n\n            if (prevHoverState == 'out') that.leave(that)\n          }\n\n          $.support.transition && this.$tip.hasClass('fade') ?\n            $tip\n              .one('bsTransitionEnd', complete)\n              .emulateTransitionEnd(Tooltip.TRANSITION_DURATION) :\n            complete()\n        }\n      }\n\n      Tooltip.prototype.applyPlacement = function (offset, placement) {\n        var $tip   = this.tip()\n        var width  = $tip[0].offsetWidth\n        var height = $tip[0].offsetHeight\n\n        // manually read margins because getBoundingClientRect includes difference\n        var marginTop = parseInt($tip.css('margin-top'), 10)\n        var marginLeft = parseInt($tip.css('margin-left'), 10)\n\n        // we must check for NaN for ie 8/9\n        if (isNaN(marginTop))  marginTop  = 0\n        if (isNaN(marginLeft)) marginLeft = 0\n\n        offset.top  += marginTop\n        offset.left += marginLeft\n\n        // $.fn.offset doesn't round pixel values\n        // so we use setOffset directly with our own function B-0\n        $.offset.setOffset($tip[0], $.extend({\n          using: function (props) {\n            $tip.css({\n              top: Math.round(props.top),\n              left: Math.round(props.left)\n            })\n          }\n        }, offset), 0)\n\n        $tip.addClass('in')\n\n        // check to see if placing tip in new offset caused the tip to resize itself\n        var actualWidth  = $tip[0].offsetWidth\n        var actualHeight = $tip[0].offsetHeight\n\n        if (placement == 'top' && actualHeight != height) {\n          offset.top = offset.top + height - actualHeight\n        }\n\n        var delta = this.getViewportAdjustedDelta(placement, offset, actualWidth, actualHeight)\n\n        if (delta.left) offset.left += delta.left\n        else offset.top += delta.top\n\n        var isVertical          = /top|bottom/.test(placement)\n        var arrowDelta          = isVertical ? delta.left * 2 - width + actualWidth : delta.top * 2 - height + actualHeight\n        var arrowOffsetPosition = isVertical ? 'offsetWidth' : 'offsetHeight'\n\n        $tip.offset(offset)\n        this.replaceArrow(arrowDelta, $tip[0][arrowOffsetPosition], isVertical)\n      }\n\n      Tooltip.prototype.replaceArrow = function (delta, dimension, isVertical) {\n        this.arrow()\n          .css(isVertical ? 'left' : 'top', 50 * (1 - delta / dimension) + '%')\n          .css(isVertical ? 'top' : 'left', '')\n      }\n\n      Tooltip.prototype.setContent = function () {\n        var $tip  = this.tip()\n        var title = this.getTitle()\n\n        $tip.find('.tooltip-inner')[this.options.html ? 'html' : 'text'](title)\n        $tip.removeClass('fade in top bottom left right')\n      }\n\n      Tooltip.prototype.hide = function (callback) {\n        var that = this\n        var $tip = $(this.$tip)\n        var e    = $.Event('hide.bs.' + this.type)\n\n        function complete() {\n          if (that.hoverState != 'in') $tip.detach()\n          that.$element\n            .removeAttr('aria-describedby')\n            .trigger('hidden.bs.' + that.type)\n          callback && callback()\n        }\n\n        this.$element.trigger(e)\n\n        if (e.isDefaultPrevented()) return\n\n        $tip.removeClass('in')\n\n        $.support.transition && $tip.hasClass('fade') ?\n          $tip\n            .one('bsTransitionEnd', complete)\n            .emulateTransitionEnd(Tooltip.TRANSITION_DURATION) :\n          complete()\n\n        this.hoverState = null\n\n        return this\n      }\n\n      Tooltip.prototype.fixTitle = function () {\n        var $e = this.$element\n        if ($e.attr('title') || typeof $e.attr('data-original-title') != 'string') {\n          $e.attr('data-original-title', $e.attr('title') || '').attr('title', '')\n        }\n      }\n\n      Tooltip.prototype.hasContent = function () {\n        return this.getTitle()\n      }\n\n      Tooltip.prototype.getPosition = function ($element) {\n        $element   = $element || this.$element\n\n        var el     = $element[0]\n        var isBody = el.tagName == 'BODY'\n\n        var elRect    = el.getBoundingClientRect()\n        if (elRect.width == null) {\n          // width and height are missing in IE8, so compute them manually; see https://github.com/twbs/bootstrap/issues/14093\n          elRect = $.extend({}, elRect, { width: elRect.right - elRect.left, height: elRect.bottom - elRect.top })\n        }\n        var elOffset  = isBody ? { top: 0, left: 0 } : $element.offset()\n        var scroll    = { scroll: isBody ? document.documentElement.scrollTop || document.body.scrollTop : $element.scrollTop() }\n        var outerDims = isBody ? { width: $(window).width(), height: $(window).height() } : null\n\n        return $.extend({}, elRect, scroll, outerDims, elOffset)\n      }\n\n      Tooltip.prototype.getCalculatedOffset = function (placement, pos, actualWidth, actualHeight) {\n        return placement == 'bottom' ? { top: pos.top + pos.height,   left: pos.left + pos.width / 2 - actualWidth / 2 } :\n               placement == 'top'    ? { top: pos.top - actualHeight, left: pos.left + pos.width / 2 - actualWidth / 2 } :\n               placement == 'left'   ? { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left - actualWidth } :\n            /* placement == 'right' */ { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left + pos.width }\n\n      }\n\n      Tooltip.prototype.getViewportAdjustedDelta = function (placement, pos, actualWidth, actualHeight) {\n        var delta = { top: 0, left: 0 }\n        if (!this.$viewport) return delta\n\n        var viewportPadding = this.options.viewport && this.options.viewport.padding || 0\n        var viewportDimensions = this.getPosition(this.$viewport)\n\n        if (/right|left/.test(placement)) {\n          var topEdgeOffset    = pos.top - viewportPadding - viewportDimensions.scroll\n          var bottomEdgeOffset = pos.top + viewportPadding - viewportDimensions.scroll + actualHeight\n          if (topEdgeOffset < viewportDimensions.top) { // top overflow\n            delta.top = viewportDimensions.top - topEdgeOffset\n          } else if (bottomEdgeOffset > viewportDimensions.top + viewportDimensions.height) { // bottom overflow\n            delta.top = viewportDimensions.top + viewportDimensions.height - bottomEdgeOffset\n          }\n        } else {\n          var leftEdgeOffset  = pos.left - viewportPadding\n          var rightEdgeOffset = pos.left + viewportPadding + actualWidth\n          if (leftEdgeOffset < viewportDimensions.left) { // left overflow\n            delta.left = viewportDimensions.left - leftEdgeOffset\n          } else if (rightEdgeOffset > viewportDimensions.right) { // right overflow\n            delta.left = viewportDimensions.left + viewportDimensions.width - rightEdgeOffset\n          }\n        }\n\n        return delta\n      }\n\n      Tooltip.prototype.getTitle = function () {\n        var title\n        var $e = this.$element\n        var o  = this.options\n\n        title = $e.attr('data-original-title')\n          || (typeof o.title == 'function' ? o.title.call($e[0]) :  o.title)\n\n        return title\n      }\n\n      Tooltip.prototype.getUID = function (prefix) {\n        do prefix += ~~(Math.random() * 1000000)\n        while (document.getElementById(prefix))\n        return prefix\n      }\n\n      Tooltip.prototype.tip = function () {\n        if (!this.$tip) {\n          this.$tip = $(this.options.template)\n          if (this.$tip.length != 1) {\n            throw new Error(this.type + ' `template` option must consist of exactly 1 top-level element!')\n          }\n        }\n        return this.$tip\n      }\n\n      Tooltip.prototype.arrow = function () {\n        return (this.$arrow = this.$arrow || this.tip().find('.tooltip-arrow'))\n      }\n\n      Tooltip.prototype.enable = function () {\n        this.enabled = true\n      }\n\n      Tooltip.prototype.disable = function () {\n        this.enabled = false\n      }\n\n      Tooltip.prototype.toggleEnabled = function () {\n        this.enabled = !this.enabled\n      }\n\n      Tooltip.prototype.toggle = function (e) {\n        var self = this\n        if (e) {\n          self = $(e.currentTarget).data('bs.' + this.type)\n          if (!self) {\n            self = new this.constructor(e.currentTarget, this.getDelegateOptions())\n            $(e.currentTarget).data('bs.' + this.type, self)\n          }\n        }\n\n        if (e) {\n          self.inState.click = !self.inState.click\n          if (self.isInStateTrue()) self.enter(self)\n          else self.leave(self)\n        } else {\n          self.tip().hasClass('in') ? self.leave(self) : self.enter(self)\n        }\n      }\n\n      Tooltip.prototype.destroy = function () {\n        var that = this\n        clearTimeout(this.timeout)\n        this.hide(function () {\n          that.$element.off('.' + that.type).removeData('bs.' + that.type)\n          if (that.$tip) {\n            that.$tip.detach()\n          }\n          that.$tip = null\n          that.$arrow = null\n          that.$viewport = null\n        })\n      }\n\n\n      // TOOLTIP PLUGIN DEFINITION\n      // =========================\n\n      function Plugin(option) {\n        return this.each(function () {\n          var $this   = $(this)\n          var data    = $this.data('bs.tooltip')\n          var options = typeof option == 'object' && option\n\n          if (!data && /destroy|hide/.test(option)) return\n          if (!data) $this.data('bs.tooltip', (data = new Tooltip(this, options)))\n          if (typeof option == 'string') data[option]()\n        })\n      }\n\n      var old = $.fn.tooltip\n\n      $.fn.tooltip             = Plugin\n      $.fn.tooltip.Constructor = Tooltip\n\n\n      // TOOLTIP NO CONFLICT\n      // ===================\n\n      $.fn.tooltip.noConflict = function () {\n        $.fn.tooltip = old\n        return this\n      }\n\n    }(jQuery);\n\n\n    /* ========================================================================\n     * Bootstrap: popover.js v3.3.5\n     * http://getbootstrap.com/javascript/#popovers\n     * ========================================================================\n     * Copyright 2011-2015 Twitter, Inc.\n     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n     * ======================================================================== */\n\n\n    +function ($) {\n      'use strict';\n\n      // POPOVER PUBLIC CLASS DEFINITION\n      // ===============================\n\n      var Popover = function (element, options) {\n        this.init('popover', element, options)\n      }\n\n      if (!$.fn.tooltip) throw new Error('Popover requires tooltip.js')\n\n      Popover.VERSION  = '3.3.5'\n\n      Popover.DEFAULTS = $.extend({}, $.fn.tooltip.Constructor.DEFAULTS, {\n        placement: 'right',\n        trigger: 'click',\n        content: '',\n        template: '<div class=\"popover\" role=\"tooltip\"><div class=\"arrow\"></div><h3 class=\"popover-title\"></h3><div class=\"popover-content\"></div></div>'\n      })\n\n\n      // NOTE: POPOVER EXTENDS tooltip.js\n      // ================================\n\n      Popover.prototype = $.extend({}, $.fn.tooltip.Constructor.prototype)\n\n      Popover.prototype.constructor = Popover\n\n      Popover.prototype.getDefaults = function () {\n        return Popover.DEFAULTS\n      }\n\n      Popover.prototype.setContent = function () {\n        var $tip    = this.tip()\n        var title   = this.getTitle()\n        var content = this.getContent()\n\n        $tip.find('.popover-title')[this.options.html ? 'html' : 'text'](title)\n        $tip.find('.popover-content').children().detach().end()[ // we use append for html objects to maintain js events\n          this.options.html ? (typeof content == 'string' ? 'html' : 'append') : 'text'\n        ](content)\n\n        $tip.removeClass('fade top bottom left right in')\n\n        // IE8 doesn't accept hiding via the `:empty` pseudo selector, we have to do\n        // this manually by checking the contents.\n        if (!$tip.find('.popover-title').html()) $tip.find('.popover-title').hide()\n      }\n\n      Popover.prototype.hasContent = function () {\n        return this.getTitle() || this.getContent()\n      }\n\n      Popover.prototype.getContent = function () {\n        var $e = this.$element\n        var o  = this.options\n\n        return $e.attr('data-content')\n          || (typeof o.content == 'function' ?\n                o.content.call($e[0]) :\n                o.content)\n      }\n\n      Popover.prototype.arrow = function () {\n        return (this.$arrow = this.$arrow || this.tip().find('.arrow'))\n      }\n\n\n      // POPOVER PLUGIN DEFINITION\n      // =========================\n\n      function Plugin(option) {\n        return this.each(function () {\n          var $this   = $(this)\n          var data    = $this.data('bs.popover')\n          var options = typeof option == 'object' && option\n\n          if (!data && /destroy|hide/.test(option)) return\n          if (!data) $this.data('bs.popover', (data = new Popover(this, options)))\n          if (typeof option == 'string') data[option]()\n        })\n      }\n\n      var old = $.fn.popover\n\n      $.fn.popover             = Plugin\n      $.fn.popover.Constructor = Popover\n\n\n      // POPOVER NO CONFLICT\n      // ===================\n\n      $.fn.popover.noConflict = function () {\n        $.fn.popover = old\n        return this\n      }\n\n    }(jQuery);\n}\n\nfunction chart_title(args) {\n  'use strict';\n\n  var svg = mg_get_svg_child_of(args.target);\n\n  //remove the current title if it exists\n  svg.select('.mg-header').remove();\n\n  if (args.target && args.title) {\n    var chartTitle = svg.insert('text')\n      .attr('class', 'mg-header')\n      .attr('x', args.center_title_full_width ? args.width /2 : (args.width + args.left - args.right) / 2)\n      .attr('y', args.title_y_position)\n      .attr('text-anchor', 'middle')\n      .attr('dy', '0.55em');\n\n    //show the title\n    chartTitle.append('tspan')\n      .attr('class', 'mg-chart-title')\n      .text(args.title);\n\n    //show and activate the description icon if we have a description\n    if (args.show_tooltips && args.description && mg_jquery_exists()) {\n      chartTitle.append('tspan')\n        .attr('class', 'mg-chart-description')\n        .attr('dx', '0.3em')\n        .text('\\uf059');\n\n      //now that the title is an svg text element, we'll have to trigger\n      //mouseenter, mouseleave events manually for the popover to work properly\n      var $chartTitle = $(chartTitle.node());\n      $chartTitle.popover({\n        html: true,\n        animation: false,\n        placement: 'top',\n        content: args.description,\n        container: args.target,\n        trigger: 'manual',\n        template: '<div class=\"popover mg-popover\"><div class=\"arrow\"></div><div class=\"popover-inner\"><h3 class=\"popover-title\"></h3><div class=\"popover-content\"><p></p></div></div></div>'\n      }).on('mouseenter', function() {\n        d3.selectAll(args.target)\n          .selectAll('.mg-popover')\n          .remove();\n\n        $(this).popover('show');\n        $(d3.select(args.target).select('.popover').node())\n          .on('mouseleave', function () {\n            $chartTitle.popover('hide');\n          });\n      }).on('mouseleave', function () {\n        setTimeout(function () {\n          if (!$('.popover:hover').length) {\n            $chartTitle.popover('hide');\n          }\n        }, 120);\n      });\n    } else if (args.show_tooltips && args.description && typeof $ === 'undefined') {\n      args.error = 'In order to enable tooltips, please make sure you include jQuery.';\n    }\n  }\n\n  if (args.error) {\n    error(args);\n  }\n}\n\nMG.chart_title = chart_title;\n\nfunction mg_add_scale_function(args, scalefcn_name, scale, accessor, inflation) {\n  args.scalefns[scalefcn_name] = function(di) {\n    if (inflation === undefined) return args.scales[scale](di[accessor]);\n    else return args.scales[scale](di[accessor]) + inflation;\n  };\n}\n\nfunction mg_position(str, args) {\n  if (str === 'bottom' || str === 'top') {\n    return [mg_get_plot_left(args), mg_get_plot_right(args)];\n  }\n\n  if (str === 'left' || str === 'right') {\n    return [mg_get_plot_bottom(args), args.top];\n  }\n}\n\nfunction mg_cat_position(str, args) {\n  if (str === 'bottom' || str === 'top') {\n    return [mg_get_plot_left(args), mg_get_plot_right(args)]\n  }\n\n  if (str === 'left' || str === 'right') {\n    return [mg_get_plot_bottom(args), mg_get_plot_top(args)];\n  }\n}\n\nfunction MGScale(args) {\n  // big wrapper around d3 scale that automatically formats & calculates scale bounds\n  // according to the data, and handles other niceties.\n  var scaleArgs = {}\n  scaleArgs.use_inflator = false;\n  scaleArgs.zero_bottom = false;\n  scaleArgs.scaleType = 'numerical';\n\n  this.namespace = function(_namespace) {\n    scaleArgs.namespace = _namespace;\n    scaleArgs.namespace_accessor_name = scaleArgs.namespace + '_accessor';\n    scaleArgs.scale_name = scaleArgs.namespace.toUpperCase();\n    scaleArgs.scalefn_name = scaleArgs.namespace + 'f';\n    return this;\n  }\n\n  this.scaleName = function(scaleName) {\n    scaleArgs.scale_name = scaleName.toUpperCase();\n    scaleArgs.scalefn_name = scaleName +'f';\n    return this;\n  }\n\n  this.inflateDomain = function(tf) {\n    scaleArgs.use_inflator = tf;\n    return this;\n  }\n\n  this.zeroBottom = function(tf) {\n    scaleArgs.zero_bottom = tf;\n    return this;\n  }\n\n  /////////////////////////////////////////////////////////////////////////////////////////////////////////\n  /// all scale domains are either numerical (number, date, etc.) or categorical (factor, label, etc) /////\n  /////////////////////////////////////////////////////////////////////////////////////////////////////////\n  // these functions automatically create the d3 scale function and place the domain.\n\n  this.numericalDomainFromData = function() {\n    var other_flat_data_arrays = [];\n\n    if (arguments.length > 0) {\n      other_flat_data_arrays = arguments;\n    }\n\n    // pull out a non-empty array in args.data.\n    var illustrative_data;\n    for (var i = 0; i < args.data.length; i++) {\n      if (args.data[i].length > 0) {\n        illustrative_data = args.data[i];\n      }\n    }\n    scaleArgs.is_time_series = mg_is_date(illustrative_data[0][args[scaleArgs.namespace_accessor_name]])\n      ? true\n      : false;\n\n    mg_add_scale_function(args, scaleArgs.scalefn_name, scaleArgs.scale_name, args[scaleArgs.namespace_accessor_name]);\n\n    mg_min_max_numerical(args, scaleArgs, other_flat_data_arrays, scaleArgs.use_inflator);\n\n    var time_scale = (args.utc_time)\n      ? d3.scaleUtc()\n      : d3.scaleTime();\n\n    args.scales[scaleArgs.scale_name] = (scaleArgs.is_time_series)\n      ? time_scale\n      : (args[scaleArgs.namespace + '_scale_type'] === 'log')\n        ? d3.scaleLog()\n        : d3.scaleLinear();\n\n    args.scales[scaleArgs.scale_name].domain([args.processed['min_' + scaleArgs.namespace], args.processed['max_' + scaleArgs.namespace]]);\n    scaleArgs.scaleType = 'numerical';\n\n    return this;\n  }\n\n  this.categoricalDomain = function(domain) {\n    args.scales[scaleArgs.scale_name] = d3.scaleOrdinal().domain(domain);\n    mg_add_scale_function(args, scaleArgs.scalefn_name, scaleArgs.scale_name, args[scaleArgs.namespace_accessor_name]);\n    return this;\n  }\n\n  this.categoricalDomainFromData = function() {\n    // make args.categorical_variables.\n    // lets make the categorical variables.\n    var all_data = mg_flatten_array(args.data)\n    //d3.set(data.map(function(d){return d[args.group_accessor]})).values()\n    scaleArgs.categoricalVariables = d3.set(all_data.map(function(d) {\n      return d[args[scaleArgs.namespace_accessor_name]] })).values();\n    args.scales[scaleArgs.scale_name] = d3.scaleBand()\n      .domain(scaleArgs.categoricalVariables);\n\n    scaleArgs.scaleType = 'categorical';\n    return this;\n  }\n\n  /////////////////////////////////////////////////////////////////////////////////////////////////////////////\n  ////////// all scale ranges are either positional (for axes, etc) or arbitrary (colors, size, etc) //////////\n  /////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n  this.numericalRange = function(range) {\n    if (typeof range === 'string') {\n      args\n        .scales[scaleArgs.scale_name]\n        .range(mg_position(range, args));\n    } else {\n      args\n        .scales[scaleArgs.scale_name]\n        .range(range);\n    }\n\n    return this;\n  }\n\n  this.categoricalRangeBands = function(range, halfway) {\n    if (halfway === undefined) halfway = false;\n\n    var namespace = scaleArgs.namespace;\n    var paddingPercentage = args[namespace + '_padding_percentage'];\n    var outerPaddingPercentage = args[namespace + '_outer_padding_percentage'];\n    if (typeof range === 'string') {\n      // if string, it's a location. Place it accordingly.\n      args.scales[scaleArgs.scale_name]\n        .range(mg_position(range, args))\n        .paddingInner(paddingPercentage)\n        .paddingOuter(outerPaddingPercentage);\n    } else {\n      args.scales[scaleArgs.scale_name]\n        .range(range)\n        .paddingInner(paddingPercentage)\n        .paddingOuter(outerPaddingPercentage);\n    }\n\n    mg_add_scale_function(\n      args,\n      scaleArgs.scalefn_name,\n      scaleArgs.scale_name,\n      args[scaleArgs.namespace_accessor_name],\n      halfway\n        ? args.scales[scaleArgs.scale_name].bandwidth() / 2\n        : 0\n    );\n\n    return this;\n  }\n\n  this.categoricalRange = function(range) {\n    args.scales[scaleArgs.scale_name].range(range);\n    mg_add_scale_function(args, scaleArgs.scalefn_name, scaleArgs.scale_name, args[scaleArgs.namespace_accessor_name]);\n    return this;\n  }\n\n  this.categoricalColorRange = function() {\n    args.scales[scaleArgs.scale_name] = args.scales[scaleArgs.scale_name].domain().length > 10\n      ? d3.scaleOrdinal(d3.schemeCategory20)\n      : d3.scaleOrdinal(d3.schemeCategory10);\n\n    args\n      .scales[scaleArgs.scale_name]\n      .domain(scaleArgs.categoricalVariables);\n\n    mg_add_scale_function(args, scaleArgs.scalefn_name, scaleArgs.scale_name, args[scaleArgs.namespace_accessor_name]);\n    return this;\n  }\n\n  this.clamp = function(yn) {\n    args.scales[scaleArgs.scale_name].clamp(yn);\n    return this;\n  }\n\n  return this;\n}\n\nMG.scale_factory = MGScale;\n\n/////////////////////////////// x, x_accessor, markers, baselines, etc.\nfunction mg_min_max_numerical(args, scaleArgs, additional_data_arrays) {\n  // A BIT OF EXPLANATION ABOUT THIS FUNCTION\n  // This function pulls out all the accessor values in all the arrays in args.data.\n  // We also have this additional argument, additional_data_arrays, which is an array of arrays of raw data values.\n  // These values also get concatenated to the data pulled from args.data, and the extents are calculate from that.\n  // They are optional.\n  //\n  // This may seem arbitrary, but it gives us a lot of flexibility. For instance, if we're calculating\n  // the min and max for the y axis of a line chart, we're going to want to also factor in baselines (horizontal lines\n  // that might potentially be outside of the y value bounds). The easiest way to do this is in the line.js code\n  // & scale creation to just flatten the args.baselines array, pull out hte values, and feed it in\n  // so it appears in additional_data_arrays.\n  var namespace = scaleArgs.namespace;\n  var namespace_accessor_name = scaleArgs.namespace_accessor_name;\n  var use_inflator = scaleArgs.use_inflator;\n  var zero_bottom = scaleArgs.zero_bottom;\n\n  var accessor = args[namespace_accessor_name];\n\n  // add together all relevant data arrays.\n  var all_data = mg_flatten_array(args.data)\n    .map(function(dp) {\n      return dp[accessor] })\n    .concat(mg_flatten_array(additional_data_arrays));\n\n  // do processing for log\n  if (args[namespace + '_scale_type'] === 'log') {\n    all_data = all_data.filter(function(d) {\n      return d > 0;\n    });\n  }\n\n  // use inflator?\n  var extents = d3.extent(all_data);\n  var min_val = extents[0];\n  var max_val = extents[1];\n\n  // bolt scale domain to zero when the right conditions are met:\n  // not pulling the bottom of the range from data\n  // not zero-bottomed\n  // not a time series\n  if (zero_bottom && !args['min_' + namespace + '_from_data'] && min_val > 0 && !scaleArgs.is_time_series) {\n    min_val = args[namespace + '_scale_type'] === 'log' ? 1 : 0;\n  }\n\n  if (args[namespace + '_scale_type'] !== 'log' && min_val < 0 && !scaleArgs.is_time_series) {\n    min_val = min_val - (min_val - min_val * args.inflator) * use_inflator;\n  }\n\n  if (!scaleArgs.is_time_series) {\n    max_val = (max_val < 0) ? max_val + (max_val - max_val * args.inflator) * use_inflator : max_val * (use_inflator ? args.inflator : 1);\n  }\n\n  min_val = args['min_' + namespace] || min_val;\n  max_val = args['max_' + namespace] || max_val;\n  // if there's a single data point, we should custom-set the min and max values.\n\n  if (min_val === max_val && !(args['min_' + namespace] && args['max_' + namespace])) {\n\n    if (mg_is_date(min_val)) {\n      max_val = new Date(MG.clone(min_val).setDate(min_val.getDate() + 1));\n      min_val = new Date(MG.clone(min_val).setDate(min_val.getDate() - 1));\n    } else if (typeof min_val === 'number') {\n      min_val = min_val - 1;\n      max_val = min_val + 1;\n      mg_force_xax_count_to_be_two(args);\n    }\n  }\n\n  args.processed['min_' + namespace] = min_val;\n  args.processed['max_' + namespace] = max_val;\n\n  MG.call_hook('x_axis.process_min_max', args, args.processed.min_x, args.processed.max_x);\n  MG.call_hook('y_axis.process_min_max', args, args.processed.min_y, args.processed.max_y);\n}\n\nfunction mg_categorical_group_color_scale(args) {\n  if (args.color_accessor !== false) {\n    if (args.ygroup_accessor) {\n      // add a custom accessor element.\n      if (args.color_accessor === null) {\n        args.color_accessor = args.y_accessor;\n      } else {}\n    }\n    if (args.color_accessor !== null) {\n      new MG.scale_factory(args)\n        .namespace('color')\n        .categoricalDomainFromData()\n        .categoricalColorRange();\n    }\n  }\n}\n\nfunction mg_add_color_categorical_scale(args, domain, accessor) {\n  args.scales.color = d3.scaleOrdinal(d3.schemeCategory20).domain(domain);\n  args.scalefns.color = function(d) {\n    return args.scales.color(d[accessor]);\n  };\n}\n\nfunction mg_get_categorical_domain(data, accessor) {\n  return d3.set(data.map(function(d) {\n      return d[accessor]; }))\n    .values();\n}\n\nfunction mg_get_color_domain(args) {\n  var color_domain;\n  if (args.color_domain === null) {\n    if (args.color_type === 'number') {\n      color_domain = d3.extent(args.data[0], function(d) {\n        return d[args.color_accessor]; });\n    } else if (args.color_type === 'category') {\n      color_domain = mg_get_categorical_domain(args.data[0], args.color_accessor);\n\n    }\n  } else {\n    color_domain = args.color_domain;\n  }\n  return color_domain;\n}\n\nfunction mg_get_color_range(args) {\n  var color_range;\n  if (args.color_range === null) {\n    if (args.color_type === 'number') {\n      color_range = ['blue', 'red'];\n    } else {\n      color_range = null;\n    }\n  } else {\n    color_range = args.color_range;\n  }\n  return color_range;\n}\n\nfunction processScaleTicks (args, axis) {\n  var accessor = args[axis + '_accessor'];\n  var scale_ticks = args.scales[axis.toUpperCase()].ticks(args[axis + 'ax_count']);\n  var max = args.processed['max_' + axis];\n\n  function log10 (val) {\n    if (val === 1000) {\n      return 3;\n    }\n    if (val === 1000000) {\n      return 7;\n    }\n    return Math.log(val) / Math.LN10;\n  }\n\n  if (args[axis + '_scale_type'] === 'log') {\n    // get out only whole logs\n    scale_ticks = scale_ticks.filter(function (d) {\n      return Math.abs(log10(d)) % 1 < 1e-6 || Math.abs(log10(d)) % 1 > 1 - 1e-6;\n    });\n  }\n\n  // filter out fraction ticks if our data is ints and if xmax > number of generated ticks\n  var number_of_ticks = scale_ticks.length;\n\n  // is our data object all ints?\n  var data_is_int = true;\n  args.data.forEach(function (d, i) {\n    d.forEach(function (d, i) {\n      if (d[accessor] % 1 !== 0) {\n        data_is_int = false;\n        return false;\n      }\n    });\n  });\n\n  if (data_is_int && number_of_ticks > max && args.format === 'count') {\n    // remove non-integer ticks\n    scale_ticks = scale_ticks.filter(function (d) {\n      return d % 1 === 0;\n    });\n  }\n  args.processed[axis + '_ticks'] = scale_ticks;\n}\n\nfunction rugPlacement (args, axisArgs) {\n  var position = axisArgs.position;\n  var ns = axisArgs.namespace;\n  var coordinates = {};\n  if (position === 'left') {\n    coordinates.x1 = mg_get_left(args) + 1;\n    coordinates.x2 = mg_get_left(args) + args.rug_buffer_size;\n    coordinates.y1 = args.scalefns[ns + 'f'];\n    coordinates.y2 = args.scalefns[ns + 'f'];\n  }\n  if (position === 'right') {\n    coordinates.x1 = mg_get_right(args) - 1,\n    coordinates.x2 = mg_get_right(args) - args.rug_buffer_size,\n    coordinates.y1 = args.scalefns[ns + 'f'];\n    coordinates.y2 = args.scalefns[ns + 'f'];\n  }\n  if (position === 'top') {\n    coordinates.x1 = args.scalefns[ns + 'f'];\n    coordinates.x2 = args.scalefns[ns + 'f'];\n    coordinates.y1 = mg_get_top(args) + 1;\n    coordinates.y2 = mg_get_top(args) + args.rug_buffer_size;\n  }\n  if (position === 'bottom') {\n    coordinates.x1 = args.scalefns[ns + 'f'];\n    coordinates.x2 = args.scalefns[ns + 'f'];\n    coordinates.y1 = mg_get_bottom(args) - 1;\n    coordinates.y2 = mg_get_bottom(args) - args.rug_buffer_size;\n  }\n  return coordinates;\n}\n\nfunction rimPlacement (args, axisArgs) {\n  var ns = axisArgs.namespace;\n  var position = axisArgs.position;\n  var tick_length = args.processed[ns + '_ticks'].length;\n  var ticks = args.processed[ns + '_ticks'];\n  var scale = args.scales[ns.toUpperCase()];\n  var coordinates = {};\n\n  if (position === 'left') {\n    coordinates.x1 = mg_get_left(args);\n    coordinates.x2 = mg_get_left(args);\n    coordinates.y1 = scale(ticks[0]).toFixed(2);\n    coordinates.y2 = scale(ticks[tick_length - 1]).toFixed(2);\n  }\n  if (position === 'right') {\n    coordinates.x1 = mg_get_right(args);\n    coordinates.x2 = mg_get_right(args);\n    coordinates.y1 = scale(ticks[0]).toFixed(2);\n    coordinates.y2 = scale(ticks[tick_length - 1]).toFixed(2);\n  }\n  if (position === 'top') {\n    coordinates.x1 = mg_get_left(args);\n    coordinates.x2 = mg_get_right(args);\n    coordinates.y1 = mg_get_top(args);\n    coordinates.y2 = mg_get_top(args);\n  }\n  if (position === 'bottom') {\n    coordinates.x1 = mg_get_left(args);\n    coordinates.x2 = mg_get_right(args);\n    coordinates.y1 = mg_get_bottom(args);\n    coordinates.y2 = mg_get_bottom(args);\n  }\n\n  if (position === 'left' || position === 'right') {\n    if (args.axes_not_compact) {\n      coordinates.y1 = mg_get_bottom(args);\n      coordinates.y2 = mg_get_top(args);\n    } else if (tick_length) {\n      coordinates.y1 = scale(ticks[0]).toFixed(2);\n      coordinates.y2 = scale(ticks[tick_length - 1]).toFixed(2);\n    }\n  }\n\n  return coordinates;\n}\n\nfunction labelPlacement (args, axisArgs) {\n  var position = axisArgs.position;\n  var ns = axisArgs.namespace;\n  var tickLength = args[ns + 'ax_tick_length'];\n  var scale = args.scales[ns.toUpperCase()];\n  var coordinates = {};\n\n  if (position === 'left') {\n    coordinates.x = mg_get_left(args) - tickLength * 3 / 2;\n    coordinates.y = function (d) {\n      return scale(d).toFixed(2);\n    };\n    coordinates.dx = -3;\n    coordinates.dy = '.35em';\n    coordinates.textAnchor = 'end';\n    coordinates.text = function (d) {\n      return mg_compute_yax_format(args)(d);\n    };\n  }\n  if (position === 'right') {\n    coordinates.x = mg_get_right(args) + tickLength * 3 / 2;\n    coordinates.y = function (d) {\n      return scale(d).toFixed(2);\n    };\n    coordinates.dx = 3;\n    coordinates.dy = '.35em';\n    coordinates.textAnchor = 'start';\n    coordinates.text = function (d) {\n      return mg_compute_yax_format(args)(d); };\n  }\n  if (position === 'top') {\n    coordinates.x = function (d) {\n      return scale(d).toFixed(2);\n    };\n    coordinates.y = (mg_get_top(args) - tickLength * 7 / 3).toFixed(2);\n    coordinates.dx = 0;\n    coordinates.dy = '0em';\n    coordinates.textAnchor = 'middle';\n    coordinates.text = function (d) {\n      return mg_default_xax_format(args)(d);\n    };\n  }\n  if (position === 'bottom') {\n    coordinates.x = function (d) {\n      return scale(d).toFixed(2);\n    };\n    coordinates.y = (mg_get_bottom(args) + tickLength * 7 / 3).toFixed(2);\n    coordinates.dx = 0;\n    coordinates.dy = '.50em';\n    coordinates.textAnchor = 'middle';\n    coordinates.text = function (d) {\n      return mg_default_xax_format(args)(d);\n    };\n  }\n\n  return coordinates;\n}\n\nfunction selectXaxFormat (args) {\n  var c = args.chart_type;\n  if (!args.processed.xax_format) {\n    if (args.xax_format) {\n      args.processed.xax_format = args.xax_format;\n    } else {\n      if (c === 'line' || c === 'point' || c === 'histogram') {\n        args.processed.xax_format = mg_default_xax_format(args);\n      } else if (c === 'bar') {\n        args.processed.xax_format = mg_default_bar_xax_format(args);\n      }\n    }\n  }\n}\n\nfunction secondaryLabels (g, args, axisArgs) {\n  if (args.time_series && (args.show_years || args.show_secondary_x_label)) {\n    var tf = mg_get_yformat_and_secondary_time_function(args);\n    addSecondaryLabelElements(args, axisArgs, g, tf.timeframe, tf.yformat, tf.secondary);\n  }\n}\n\nfunction addSecondaryLabelElements (args, axisArgs, g, time_frame, yformat, secondary_function) {\n  var years = secondary_function(args.processed.min_x, args.processed.max_x);\n  if (years.length === 0) {\n    var first_tick = args.scales.X.ticks(args.xax_count)[0];\n    years = [first_tick];\n  }\n\n  var yg = mg_add_g(g, 'mg-year-marker');\n  if (time_frame === 'default' && args.show_year_markers) {\n    yearMarkerLine(args, axisArgs, yg, years, yformat);\n  }\n  if (time_frame != 'years') yearMarkerText(args, axisArgs, yg, years, yformat);\n}\n\nfunction yearMarkerLine (args, axisArgs, g, years, yformat) {\n  g.selectAll('.mg-year-marker')\n    .data(years).enter()\n    .append('line')\n    .attr('x1', function (d) {\n      return args.scales.X(d).toFixed(2); })\n    .attr('x2', function (d) {\n      return args.scales.X(d).toFixed(2); })\n    .attr('y1', mg_get_top(args))\n    .attr('y2', mg_get_bottom(args));\n}\n\nfunction yearMarkerText (args, axisArgs, g, years, yformat) {\n  var position = axisArgs.position;\n  var ns = axisArgs.namespace;\n  var scale = args.scales[ns.toUpperCase()];\n  var x, y, dy, textAnchor, textFcn;\n  var xAxisTextElement = d3.select(args.target)\n    .select('.mg-x-axis text').node().getBoundingClientRect();\n\n  if (position === 'top') {\n    x = function (d, i) {\n      return scale(d).toFixed(2); };\n    y = (mg_get_top(args) - args.xax_tick_length * 7 / 3) - (xAxisTextElement.height);\n    dy = '.50em';\n    textAnchor = 'middle';\n    textFcn = function (d) {\n      return yformat(new Date(d)); };\n  }\n  if (position === 'bottom') {\n    x = function (d, i) {\n      return scale(d).toFixed(2); };\n    y = (mg_get_bottom(args) + args.xax_tick_length * 7 / 3) + (xAxisTextElement.height * 0.8);\n    dy = '.50em';\n    textAnchor = 'middle';\n    textFcn = function (d) {\n      return yformat(new Date(d)); };\n  }\n\n  g.selectAll('.mg-year-marker')\n    .data(years).enter()\n    .append('text')\n    .attr('x', x)\n    .attr('y', y)\n    .attr('dy', dy)\n    .attr('text-anchor', textAnchor)\n    .text(textFcn);\n}\n\nfunction addNumericalLabels (g, args, axisArgs) {\n  var ns = axisArgs.namespace;\n  var coords = labelPlacement(args, axisArgs);\n  var ticks = args.processed[ns + '_ticks'];\n\n  var labels = g.selectAll('.mg-yax-labels')\n    .data(ticks).enter()\n    .append('text')\n    .attr('x', coords.x)\n    .attr('dx', coords.dx)\n    .attr('y', coords.y)\n    .attr('dy', coords.dy)\n    .attr('text-anchor', coords.textAnchor)\n    .text(coords.text);\n\n  // move the labels if they overlap\n  if (ns == 'x') {\n    selectXaxFormat(args);\n    if (args.time_series && args.european_clock) {\n      labels.append('tspan').classed('mg-european-hours', true).text(function (_d, i) {\n        var d = new Date(_d);\n        if (i === 0) return d3.timeFormat('%H')(d);\n        else return '';\n      });\n      labels.append('tspan').classed('mg-european-minutes-seconds', true).text(function (_d, i) {\n        var d = new Date(_d);\n        return ':' + args.processed.xax_format(d);\n      });\n    } else {\n      labels.text(function (d) {\n        return args.xax_units + args.processed.xax_format(d);\n      });\n    }\n    secondaryLabels(g, args, axisArgs);\n  }\n\n  if (mg_elements_are_overlapping(labels)) {\n    labels.filter(function (d, i) {\n      return (i + 1) % 2 === 0;\n    }).remove();\n\n    var svg = mg_get_svg_child_of(args.target);\n    svg.selectAll('.mg-' + ns + 'ax-ticks').filter(function (d, i) {\n      return (i + 1) % 2 === 0; })\n      .remove();\n  }\n}\n\nfunction addTickLines (g, args, axisArgs) {\n  // name\n  var ns = axisArgs.namespace;\n  var position = axisArgs.position;\n  var scale = args.scales[ns.toUpperCase()];\n\n  var ticks = args.processed[ns + '_ticks'];\n  var ticksClass = 'mg-' + ns + 'ax-ticks';\n  var extendedTicksClass = 'mg-extended-' + ns + 'ax-ticks';\n  var extendedTicks = args[ns + '_extended_ticks'];\n  var tickLength = args[ns + 'ax_tick_length'];\n\n  var x1, x2, y1, y2;\n\n  if (position === 'left') {\n    x1 = mg_get_left(args);\n    x2 = extendedTicks ? mg_get_right(args) : mg_get_left(args) - tickLength;\n    y1 = function (d) {\n      return scale(d).toFixed(2);\n    };\n    y2 = function (d) {\n      return scale(d).toFixed(2);\n    };\n  }\n  if (position === 'right') {\n    x1 = mg_get_right(args);\n    x2 = extendedTicks ? mg_get_left(args) : mg_get_right(args) + tickLength;\n    y1 = function (d) {\n      return scale(d).toFixed(2);\n    };\n    y2 = function (d) {\n      return scale(d).toFixed(2);\n    };\n  }\n  if (position === 'top') {\n    x1 = function (d) {\n      return scale(d).toFixed(2);\n    };\n    x2 = function (d) {\n      return scale(d).toFixed(2);\n    };\n    y1 = mg_get_top(args);\n    y2 = extendedTicks ? mg_get_bottom(args) : mg_get_top(args) - tickLength;\n  }\n  if (position === 'bottom') {\n    x1 = function (d) {\n      return scale(d).toFixed(2);\n    };\n    x2 = function (d) {\n      return scale(d).toFixed(2);\n    };\n    y1 = mg_get_bottom(args);\n    y2 = extendedTicks ? mg_get_top(args) : mg_get_bottom(args) + tickLength;\n  }\n\n  g.selectAll('.' + ticksClass)\n    .data(ticks).enter()\n    .append('line')\n    .classed(extendedTicksClass, extendedTicks)\n    .attr('x1', x1)\n    .attr('x2', x2)\n    .attr('y1', y1)\n    .attr('y2', y2);\n}\n\nfunction initializeAxisRim (g, args, axisArgs) {\n  var namespace = axisArgs.namespace;\n  var tick_length = args.processed[namespace + '_ticks'].length;\n\n  var rim = rimPlacement(args, axisArgs);\n\n  if (!args[namespace + '_extended_ticks'] && !args[namespace + '_extended_ticks'] && tick_length) {\n    g.append('line')\n      .attr('x1', rim.x1)\n      .attr('x2', rim.x2)\n      .attr('y1', rim.y1)\n      .attr('y2', rim.y2);\n  }\n}\n\nfunction initializeRug (args, rug_class) {\n  var svg = mg_get_svg_child_of(args.target);\n  var all_data = mg_flatten_array(args.data);\n  var rug = svg.selectAll('line.' + rug_class).data(all_data);\n\n  // set the attributes that do not change after initialization, per\n  rug.enter().append('svg:line').attr('class', rug_class).attr('opacity', 0.3);\n\n  // remove rug elements that are no longer in use\n  mg_exit_and_remove(rug);\n\n  // set coordinates of new rug elements\n  mg_exit_and_remove(rug);\n  return rug;\n}\n\nfunction rug (args, axisArgs) {\n  'use strict';\n  args.rug_buffer_size = args.chart_type === 'point' ? args.buffer / 2 : args.buffer * 2 / 3;\n\n  var rug = initializeRug(args, 'mg-' + axisArgs.namespace + '-rug');\n  var rug_positions = rugPlacement(args, axisArgs);\n  rug.attr('x1', rug_positions.x1)\n    .attr('x2', rug_positions.x2)\n    .attr('y1', rug_positions.y1)\n    .attr('y2', rug_positions.y2);\n\n  mg_add_color_accessor_to_rug(rug, args, 'mg-' + axisArgs.namespace + '-rug-mono');\n}\n\nfunction categoricalLabelPlacement (args, axisArgs, group) {\n  var ns = axisArgs.namespace;\n  var position = axisArgs.position;\n  var scale = args.scales[ns.toUpperCase()];\n  var groupScale = args.scales[(ns + 'group').toUpperCase()];\n  var coords = {};\n  coords.cat = {};\n  coords.group = {};\n  // x, y, dy, text-anchor\n\n  if (position === 'left') {\n    coords.cat.x = mg_get_plot_left(args) - args.buffer;\n    coords.cat.y = function (d) {\n      return groupScale(group) + scale(d) + scale.bandwidth() / 2;\n    };\n    coords.cat.dy = '.35em';\n    coords.cat.textAnchor = 'end';\n    coords.group.x = mg_get_plot_left(args) - args.buffer;\n    coords.group.y = groupScale(group) + (groupScale.bandwidth ? groupScale.bandwidth() / 2 : 0);\n    coords.group.dy = '.35em';\n    coords.group.textAnchor = args['rotate_' + ns + '_labels'] ? 'end' : 'end';\n  }\n\n  if (position === 'right') {\n    coords.cat.x = mg_get_plot_right(args) - args.buffer;\n    coords.cat.y = function (d) {\n      return groupScale(group) + scale(d) + scale.bandwidth() / 2;\n    };\n    coords.cat.dy = '.35em';\n    coords.cat.textAnchor = 'start';\n    coords.group.x = mg_get_plot_right(args) - args.buffer;\n    coords.group.y = groupScale(group) + (groupScale.bandwidth ? groupScale.bandwidth() / 2 : 0);\n    coords.group.dy = '.35em';\n    coords.group.textAnchor = 'start';\n  }\n\n  if (position === 'top') {\n    coords.cat.x = function (d) {\n      return groupScale(group) + scale(d) + scale.bandwidth() / 2;\n    };\n    coords.cat.y = mg_get_plot_top(args) + args.buffer;\n    coords.cat.dy = '.35em';\n    coords.cat.textAnchor = args['rotate_' + ns + '_labels'] ? 'start' : 'middle';\n    coords.group.x = groupScale(group) + (groupScale.bandwidth ? groupScale.bandwidth() / 2 : 0);\n    coords.group.y = mg_get_plot_top(args) + args.buffer;\n    coords.group.dy = '.35em';\n    coords.group.textAnchor = args['rotate_' + ns + '_labels'] ? 'start' : 'middle';\n  }\n\n  if (position === 'bottom') {\n    coords.cat.x = function (d) {\n      return groupScale(group) + scale(d) + scale.bandwidth() / 2;\n    };\n    coords.cat.y = mg_get_plot_bottom(args) + args.buffer;\n    coords.cat.dy = '.35em';\n    coords.cat.textAnchor = args['rotate_' + ns + '_labels'] ? 'start' : 'middle';\n    coords.group.x = groupScale(group) + (groupScale.bandwidth ? groupScale.bandwidth() / 2 - scale.bandwidth() / 2 : 0);\n    coords.group.y = mg_get_plot_bottom(args) + args.buffer;\n    coords.group.dy = '.35em';\n    coords.group.textAnchor = args['rotate_' + ns + '_labels'] ? 'start' : 'middle';\n  }\n\n  return coords;\n}\n\nfunction categoricalLabels (args, axisArgs) {\n  var ns = axisArgs.namespace;\n  var nsClass = 'mg-' + ns + '-axis';\n  var scale = args.scales[ns.toUpperCase()];\n  var groupScale = args.scales[(ns + 'group').toUpperCase()];\n  var groupAccessor = ns + 'group_accessor';\n\n  var svg = mg_get_svg_child_of(args.target);\n  mg_selectAll_and_remove(svg, '.' + nsClass);\n  var g = mg_add_g(svg, nsClass);\n  var group_g;\n  var groups = groupScale.domain && groupScale.domain()\n    ? groupScale.domain()\n    : ['1'];\n\n  groups.forEach(function (group) {\n    // grab group placement stuff.\n    var coords = categoricalLabelPlacement(args, axisArgs, group);\n\n    group_g = mg_add_g(g, 'mg-group-' + mg_normalize(group));\n    if (args[groupAccessor] !== null) {\n      var labels = group_g.append('text')\n        .classed('mg-barplot-group-label', true)\n        .attr('x', coords.group.x)\n        .attr('y', coords.group.y)\n        .attr('dy', coords.group.dy)\n        .attr('text-anchor', coords.group.textAnchor)\n        .text(group);\n\n    } else {\n      var labels = group_g.selectAll('text')\n        .data(scale.domain())\n        .enter()\n        .append('text')\n        .attr('x', coords.cat.x)\n        .attr('y', coords.cat.y)\n        .attr('dy', coords.cat.dy)\n        .attr('text-anchor', coords.cat.textAnchor)\n        .text(String);\n    }\n    if (args['rotate_' + ns + '_labels']) {\n      rotateLabels(labels, args['rotate_' + ns + '_labels']);\n    }\n  });\n}\n\nfunction categoricalGuides (args, axisArgs) {\n  // for each group\n  // for each data point\n\n  var ns = axisArgs.namespace;\n  var scalef = args.scalefns[ns + 'f'];\n  var groupf = args.scalefns[ns + 'groupf'];\n  var groupScale = args.scales[(ns + 'group').toUpperCase()];\n  var scale = args.scales[ns.toUpperCase()];\n  var position = axisArgs.position;\n\n  var svg = mg_get_svg_child_of(args.target);\n  var alreadyPlotted = [];\n\n  var x1, x2, y1, y2;\n  var grs = (groupScale.domain && groupScale.domain()) ? groupScale.domain() : [null];\n\n  mg_selectAll_and_remove(svg, '.mg-category-guides');\n  var g = mg_add_g(svg, 'mg-category-guides');\n\n  grs.forEach(function (group) {\n    scale.domain().forEach(function (cat) {\n      if (position === 'left' || position === 'right') {\n        x1 = mg_get_plot_left(args);\n        x2 = mg_get_plot_right(args);\n        y1 = scale(cat) + groupScale(group) + scale.bandwidth() / 2;\n        y2 = scale(cat) + groupScale(group) + scale.bandwidth() / 2;\n      }\n\n      if (position === 'top' || position === 'bottom') {\n        x1 = scale(cat) + groupScale(group) + scale.bandwidth() / 2 * (group === null);\n        x2 = scale(cat) + groupScale(group) + scale.bandwidth() / 2 * (group === null);\n        y1 = mg_get_plot_bottom(args);\n        y2 = mg_get_plot_top(args);\n      }\n\n      g.append('line')\n        .attr('x1', x1)\n        .attr('x2', x2)\n        .attr('y1', y1)\n        .attr('y2', y2)\n        .attr('stroke-dasharray', '2,1');\n    });\n\n    var first = groupScale(group) + scale(scale.domain()[0]) + scale.bandwidth() / 2 * (group === null || (position !== 'top' && position != 'bottom'));\n    var last = groupScale(group) + scale(scale.domain()[scale.domain().length - 1]) + scale.bandwidth() / 2 * (group === null || (position !== 'top' && position != 'bottom'));\n\n    if (position === 'left' || position === 'right') {\n      x11 = mg_get_plot_left(args);\n      x21 = mg_get_plot_left(args);\n      y11 = first;\n      y21 = last;\n\n      x12 = mg_get_plot_right(args);\n      x22 = mg_get_plot_right(args);\n      y12 = first;\n      y22 = last;\n    }\n\n    if (position === 'bottom' || position === 'top') {\n      x11 = first;\n      x21 = last;\n      y11 = mg_get_plot_bottom(args);\n      y21 = mg_get_plot_bottom(args);\n\n      x12 = first;\n      x22 = last;\n      y12 = mg_get_plot_top(args);\n      y22 = mg_get_plot_top(args);\n    }\n\n    g.append('line')\n      .attr('x1', x11)\n      .attr('x2', x21)\n      .attr('y1', y11)\n      .attr('y2', y21)\n      .attr('stroke-dasharray', '2,1');\n\n    g.append('line')\n      .attr('x1', x12)\n      .attr('x2', x22)\n      .attr('y1', y12)\n      .attr('y2', y22)\n      .attr('stroke-dasharray', '2,1');\n  });\n}\n\nfunction rotateLabels (labels, rotation_degree) {\n  if (rotation_degree) {\n    labels.attr('transform', function () {\n      var elem = d3.select(this);\n      return 'rotate(' + rotation_degree + ' ' + elem.attr('x') + ',' + elem.attr('y') + ')';\n    });\n\n  }\n}\n\nfunction zeroLine (args, axisArgs) {\n  var svg = mg_get_svg_child_of(args.target);\n  var ns = axisArgs.namespace;\n  var position = axisArgs.position;\n  var scale = args.scales[ns.toUpperCase()];\n  var x1, x2, y1, y2;\n  if (position === 'left' || position === 'right') {\n    x1 = mg_get_plot_left(args);\n    x2 = mg_get_plot_right(args);\n    y1 = scale(0) + 1;\n    y2 = scale(0) + 1;\n  }\n  if (position === 'bottom' || position === 'top') {\n    y1 = mg_get_plot_top(args);\n    y2 = mg_get_plot_bottom(args);\n    x1 = scale(0) - 1;\n    x2 = scale(0) - 1;\n  }\n\n  svg.append('line')\n    .attr('x1', x1)\n    .attr('x2', x2)\n    .attr('y1', y1)\n    .attr('y2', y2)\n    .attr('stroke', 'black');\n}\n\nvar mgDrawAxis = {};\n\nmgDrawAxis.categorical = function (args, axisArgs) {\n  var ns = axisArgs.namespace;\n\n  categoricalLabels(args, axisArgs);\n  categoricalGuides(args, axisArgs);\n};\n\nmgDrawAxis.numerical = function (args, axisArgs) {\n  var namespace = axisArgs.namespace;\n  var axisName = namespace + '_axis';\n  var axisClass = 'mg-' + namespace + '-axis';\n  var svg = mg_get_svg_child_of(args.target);\n\n  mg_selectAll_and_remove(svg, '.' + axisClass);\n\n  if (!args[axisName]) {\n    return this;\n  }\n\n  var g = mg_add_g(svg, axisClass);\n\n  processScaleTicks(args, namespace);\n  initializeAxisRim(g, args, axisArgs);\n  addTickLines(g, args, axisArgs);\n  addNumericalLabels(g, args, axisArgs);\n\n  // add label\n  if (args[namespace + '_label']) {\n    axisArgs.label(svg.select('.mg-' + namespace + '-axis'), args);\n  }\n\n  // add rugs\n  if (args[namespace + '_rug']) {\n    rug(args, axisArgs);\n  }\n\n  if (args.show_bar_zero) {\n    mg_bar_add_zero_line(args);\n  }\n\n  return this;\n};\n\nfunction axisFactory (args) {\n  var axisArgs = {};\n  axisArgs.type = 'numerical';\n\n  this.namespace = function (ns) {\n    // take the ns in the scale, and use it to\n    axisArgs.namespace = ns;\n    return this;\n  };\n\n  this.rug = function (tf) {\n    axisArgs.rug = tf;\n    return this;\n  };\n\n  this.label = function (tf) {\n    axisArgs.label = tf;\n    return this;\n  };\n\n  this.type = function (t) {\n    axisArgs.type = t;\n    return this;\n  };\n\n  this.position = function (pos) {\n    axisArgs.position = pos;\n    return this;\n  };\n\n  this.zeroLine = function (tf) {\n    axisArgs.zeroLine = tf;\n    return this;\n  };\n\n  this.draw = function () {\n    mgDrawAxis[axisArgs.type](args, axisArgs);\n    return this;\n  };\n\n  return this;\n\n}\n\nMG.axis_factory = axisFactory;\n\n/* ================================================================================ */\n/* ================================================================================ */\n/* ================================================================================ */\n\nfunction y_rug (args) {\n  'use strict';\n\n  if (!args.y_rug) {\n    return;\n  }\n\n  args.rug_buffer_size = args.chart_type === 'point'\n    ? args.buffer / 2\n    : args.buffer * 2 / 3;\n\n  var rug = mg_make_rug(args, 'mg-y-rug');\n\n  rug.attr('x1', args.left + 1)\n    .attr('x2', args.left + args.rug_buffer_size)\n    .attr('y1', args.scalefns.yf)\n    .attr('y2', args.scalefns.yf);\n\n  mg_add_color_accessor_to_rug(rug, args, 'mg-y-rug-mono');\n}\n\nMG.y_rug = y_rug;\n\nfunction mg_change_y_extents_for_bars (args, my) {\n  if (args.chart_type === 'bar') {\n    my.min = 0;\n    my.max = d3.max(args.data[0], function (d) {\n      var trio = [];\n      trio.push(d[args.y_accessor]);\n\n      if (args.baseline_accessor !== null) {\n        trio.push(d[args.baseline_accessor]);\n      }\n\n      if (args.predictor_accessor !== null) {\n        trio.push(d[args.predictor_accessor]);\n      }\n\n      return Math.max.apply(null, trio);\n    });\n  }\n  return my;\n}\n\nfunction mg_compute_yax_format (args) {\n  var yax_format = args.yax_format;\n  if (!yax_format) {\n    if (args.format === 'count') {\n      // increase decimals if we have small values, useful for realtime data\n      if (args.processed.max_y < 0.0001) {\n        args.decimals = 6;\n      } else if (args.processed.max_y < 0.1) {\n        args.decimals = 4;\n      }\n\n      yax_format = function (d) {\n        var pf;\n\n        if (d < 1.0 && d > -1.0 && d !== 0) {\n          // don't scale tiny values\n          pf = d3.format(',.' + args.decimals + 'f');\n        } else if (d < 1000) {\n          pf = d3.format(',.0f');\n        } else {\n          pf = d3.format(',.2s');\n        }\n\n        // are we adding units after the value or before?\n        if (args.yax_units_append) {\n          return pf(d) + args.yax_units;\n        } else {\n          return args.yax_units + pf(d);\n        }\n      };\n    } else { // percentage\n      yax_format = function (d_) {\n        var n = d3.format('.0%');\n        return n(d_);\n      };\n    }\n  }\n  return yax_format;\n}\n\nfunction mg_bar_add_zero_line (args) {\n  var svg = mg_get_svg_child_of(args.target);\n  var extents = args.scales.X.domain();\n  if (0 >= extents[0] && extents[1] >= 0) {\n    var r = args.scales.Y.range();\n    var g = args.categorical_groups.length\n      ? args.scales.YGROUP(args.categorical_groups[args.categorical_groups.length - 1])\n      : args.scales.YGROUP();\n\n    svg.append('svg:line')\n      .attr('x1', args.scales.X(0))\n      .attr('x2', args.scales.X(0))\n      .attr('y1', r[0] + mg_get_plot_top(args))\n      .attr('y2', r[r.length - 1] + g)\n      .attr('stroke', 'black')\n      .attr('opacity', .2);\n  }\n}\n\nfunction set_min_max_y (args) {\n  // flatten data\n  // remove weird data, if log.\n  var data = mg_flatten_array(args.data);\n\n  if (args.y_scale_type === 'log') {\n    data = data.filter(function (d) {\n      return d[args.y_accessor] > 0;\n    });\n  }\n\n  if (args.baselines) {\n    data = data.concat(args.baselines);\n  }\n\n  var extents = d3.extent(data, function (d) {\n    return d[args.y_accessor];\n  });\n\n  var my = {};\n  my.min = extents[0];\n  my.max = extents[1];\n  // the default case is for the y-axis to start at 0, unless we explicitly want it\n  // to start at an arbitrary number or from the data's minimum value\n  if (my.min >= 0 && !args.min_y && !args.min_y_from_data) {\n    my.min = 0;\n  }\n\n  mg_change_y_extents_for_bars(args, my);\n  my.min = (args.min_y !== null) ? args.min_y : my.min;\n\n  my.max = (args.max_y !== null) ? args.max_y : (my.max < 0) ? my.max + (my.max - my.max * args.inflator) : my.max * args.inflator;\n\n  if (args.y_scale_type !== 'log' && my.min < 0) {\n    my.min = my.min - (my.min - my.min * args.inflator);\n  }\n\n  if (!args.min_y && args.min_y_from_data) {\n    var buff = (my.max - my.min) * .01;\n    my.min = extents[0] - buff;\n    my.max = extents[1] + buff;\n  }\n  args.processed.min_y = my.min;\n  args.processed.max_y = my.max;\n}\n\nfunction mg_y_domain_range (args, scale) {\n  scale.domain([args.processed.min_y, args.processed.max_y])\n    .range([mg_get_plot_bottom(args), args.top]);\n  return scale;\n}\n\nfunction mg_define_y_scales (args) {\n  var scale = args.y_scale_type === 'log' ? d3.scaleLog() : d3.scaleLinear();\n  if (args.y_scale_type === 'log') {\n    if (args.chart_type === 'histogram') {\n      // log histogram plots should start just below 1\n      // so that bins with single counts are visible\n      args.processed.min_y = 0.2;\n    } else {\n      if (args.processed.min_y <= 0) {\n        args.processed.min_y = 1;\n      }\n    }\n  }\n  args.scales.Y = mg_y_domain_range(args, scale);\n  args.scales.Y.clamp(args.y_scale_type === 'log');\n\n  // used for ticks and such, and designed to be paired with log or linear\n  args.scales.Y_axis = mg_y_domain_range(args, d3.scaleLinear());\n}\n\nfunction mg_add_y_label (g, args) {\n  if (args.y_label) {\n    g.append('text')\n      .attr('class', 'label')\n      .attr('x', function () {\n        return -1 * (mg_get_plot_top(args) +\n        ((mg_get_plot_bottom(args)) - (mg_get_plot_top(args))) / 2);\n      })\n      .attr('y', function () {\n        return args.left / 2;\n      })\n      .attr('dy', '0.4em')\n      .attr('text-anchor', 'middle')\n      .text(function (d) {\n        return args.y_label;\n      })\n      .attr('transform', function (d) {\n        return 'rotate(-90)';\n      });\n  }\n}\n\nfunction mg_add_y_axis_rim (g, args) {\n  var tick_length = args.processed.y_ticks.length;\n  if (!args.x_extended_ticks && !args.y_extended_ticks && tick_length) {\n    var y1scale, y2scale;\n\n    if (args.axes_not_compact && args.chart_type !== 'bar') {\n      y1scale = args.height - args.bottom;\n      y2scale = args.top;\n    } else if (tick_length) {\n      y1scale = args.scales.Y(args.processed.y_ticks[0]).toFixed(2);\n      y2scale = args.scales.Y(args.processed.y_ticks[tick_length - 1]).toFixed(2);\n    } else {\n      y1scale = 0;\n      y2scale = 0;\n    }\n\n    g.append('line')\n      .attr('x1', args.left)\n      .attr('x2', args.left)\n      .attr('y1', y1scale)\n      .attr('y2', y2scale);\n  }\n}\n\nfunction mg_add_y_axis_tick_lines (g, args) {\n  g.selectAll('.mg-yax-ticks')\n    .data(args.processed.y_ticks).enter()\n    .append('line')\n    .classed('mg-extended-yax-ticks', args.y_extended_ticks)\n    .attr('x1', args.left)\n    .attr('x2', function () {\n      return (args.y_extended_ticks) ? args.width - args.right : args.left - args.yax_tick_length;\n    })\n    .attr('y1', function (d) {\n      return args.scales.Y(d).toFixed(2);\n    })\n    .attr('y2', function (d) {\n      return args.scales.Y(d).toFixed(2);\n    });\n}\n\nfunction mg_add_y_axis_tick_labels (g, args) {\n  var yax_format = mg_compute_yax_format(args);\n  g.selectAll('.mg-yax-labels')\n    .data(args.processed.y_ticks).enter()\n    .append('text')\n    .attr('x', args.left - args.yax_tick_length * 3 / 2)\n    .attr('dx', -3)\n    .attr('y', function (d) {\n      return args.scales.Y(d).toFixed(2);\n    })\n    .attr('dy', '.35em')\n    .attr('text-anchor', 'end')\n    .text(function (d) {\n      var o = yax_format(d);\n      return o;\n    });\n}\n\n// TODO ought to be deprecated, only used by histogram\nfunction y_axis (args) {\n  if (!args.processed) {\n    args.processed = {};\n  }\n\n  var svg = mg_get_svg_child_of(args.target);\n  MG.call_hook('y_axis.process_min_max', args, args.processed.min_y, args.processed.max_y);\n  mg_selectAll_and_remove(svg, '.mg-y-axis');\n\n  if (!args.y_axis) {\n    return this;\n  }\n\n  var g = mg_add_g(svg, 'mg-y-axis');\n  mg_add_y_label(g, args);\n  mg_process_scale_ticks(args, 'y');\n  mg_add_y_axis_rim(g, args);\n  mg_add_y_axis_tick_lines(g, args);\n  mg_add_y_axis_tick_labels(g, args);\n\n  if (args.y_rug) {\n    y_rug(args);\n  }\n\n  return this;\n}\n\nMG.y_axis = y_axis;\n\nfunction mg_add_categorical_labels (args) {\n  var svg = mg_get_svg_child_of(args.target);\n  mg_selectAll_and_remove(svg, '.mg-y-axis');\n  var g = mg_add_g(svg, 'mg-y-axis');\n  var group_g;(args.categorical_groups.length ? args.categorical_groups : ['1']).forEach(function (group) {\n    group_g = mg_add_g(g, 'mg-group-' + mg_normalize(group));\n\n    if (args.ygroup_accessor !== null) {\n      mg_add_group_label(group_g, group, args);\n    } else {\n      var labels = mg_add_graphic_labels(group_g, group, args);\n      mg_rotate_labels(labels, args.rotate_y_labels);\n    }\n  });\n}\n\nfunction mg_add_graphic_labels (g, group, args) {\n  return g.selectAll('text').data(args.scales.Y.domain()).enter().append('svg:text')\n    .attr('x', args.left - args.buffer)\n    .attr('y', function (d) {\n      return args.scales.YGROUP(group) + args.scales.Y(d) + args.scales.Y.bandwidth() / 2;\n    })\n    .attr('dy', '.35em')\n    .attr('text-anchor', 'end')\n    .text(String);\n}\n\nfunction mg_add_group_label (g, group, args) {\n  g.append('svg:text')\n    .classed('mg-barplot-group-label', true)\n    .attr('x', args.left - args.buffer)\n    .attr('y', args.scales.YGROUP(group) + args.scales.YGROUP.bandwidth() / 2)\n    .attr('dy', '.35em')\n    .attr('text-anchor', 'end')\n    .text(group);\n}\n\nfunction mg_draw_group_lines (args) {\n  var svg = mg_get_svg_child_of(args.target);\n  var groups = args.scales.YGROUP.domain();\n  var first = groups[0];\n  var last = groups[groups.length - 1];\n\n  svg.select('.mg-category-guides').selectAll('mg-group-lines')\n    .data(groups)\n    .enter().append('line')\n      .attr('x1', mg_get_plot_left(args))\n      .attr('x2', mg_get_plot_left(args))\n      .attr('y1', function (d) {\n        return args.scales.YGROUP(d);\n      })\n      .attr('y2', function (d) {\n        return args.scales.YGROUP(d) + args.ygroup_height;\n      })\n      .attr('stroke-width', 1);\n}\n\nfunction mg_y_categorical_show_guides (args) {\n  // for each group\n  // for each data point\n  var svg = mg_get_svg_child_of(args.target);\n  var alreadyPlotted = [];\n  args.data[0].forEach(function (d) {\n    if (alreadyPlotted.indexOf(d[args.y_accessor]) === -1) {\n      svg.select('.mg-category-guides').append('line')\n        .attr('x1', mg_get_plot_left(args))\n        .attr('x2', mg_get_plot_right(args))\n        .attr('y1', args.scalefns.yf(d) + args.scalefns.ygroupf(d))\n        .attr('y2', args.scalefns.yf(d) + args.scalefns.ygroupf(d))\n        .attr('stroke-dasharray', '2,1');\n    }\n  });\n}\n\nfunction y_axis_categorical (args) {\n  if (!args.y_axis) {\n    return this;\n  }\n\n  mg_add_categorical_labels(args);\n  // mg_draw_group_scaffold(args);\n  if (args.show_bar_zero) mg_bar_add_zero_line(args);\n  if (args.ygroup_accessor) mg_draw_group_lines(args);\n  if (args.y_categorical_show_guides) mg_y_categorical_show_guides(args);\n  return this;\n}\n\nMG.y_axis_categorical = y_axis_categorical;\n\nfunction x_rug(args) {\n  'use strict';\n\n  if(!args.x_rug) {\n    return;\n  }\n\n  args.rug_buffer_size = args.chart_type === 'point'\n    ? args.buffer / 2\n    : args.buffer;\n\n  var rug = mg_make_rug(args, 'mg-x-rug');\n\n  rug.attr('x1', args.scalefns.xf)\n    .attr('x2', args.scalefns.xf)\n    .attr('y1', args.height - args.bottom - args.rug_buffer_size)\n    .attr('y2', args.height - args.bottom);\n\n  mg_add_color_accessor_to_rug(rug, args, 'mg-x-rug-mono');\n}\n\nMG.x_rug = x_rug;\n\nfunction mg_add_processed_object(args) {\n  if (!args.processed) {\n    args.processed = {};\n  }\n}\n\n// TODO ought to be deprecated, only used by histogram\nfunction x_axis(args) {\n  'use strict';\n\n  var svg = mg_get_svg_child_of(args.target);\n  mg_add_processed_object(args);\n\n  mg_select_xax_format(args);\n  mg_selectAll_and_remove(svg, '.mg-x-axis');\n\n  if (!args.x_axis) {\n    return this;\n  }\n\n  var g = mg_add_g(svg, 'mg-x-axis');\n\n  mg_add_x_ticks(g, args);\n  mg_add_x_tick_labels(g, args);\n  if (args.x_label) { mg_add_x_label(g, args); }\n  if (args.x_rug) { x_rug(args); }\n\n  return this;\n}\n\nMG.x_axis = x_axis;\n\nfunction x_axis_categorical(args) {\n  var svg = mg_get_svg_child_of(args.target);\n  var additional_buffer = 0;\n  if (args.chart_type === 'bar') {\n    additional_buffer = args.buffer + 5;\n  }\n\n  mg_add_categorical_scale(args, 'X', args.categorical_variables.reverse(), args.left, mg_get_plot_right(args) - additional_buffer);\n  mg_add_scale_function(args, 'xf', 'X', 'value');\n  mg_selectAll_and_remove(svg, '.mg-x-axis');\n\n  var g = mg_add_g(svg, 'mg-x-axis');\n\n  if (!args.x_axis) {\n    return this;\n  }\n\n  mg_add_x_axis_categorical_labels(g, args, additional_buffer);\n  return this;\n}\n\nfunction mg_add_x_axis_categorical_labels(g, args, additional_buffer) {\n  var labels = g.selectAll('text')\n    .data(args.categorical_variables)\n    .enter()\n    .append('text');\n\n  labels\n    .attr('x', function(d) {\n      return args.scales.X(d) + args.scales.X.bandwidth() / 2 + (args.buffer) * args.bar_outer_padding_percentage + (additional_buffer / 2);\n    })\n    .attr('y', mg_get_plot_bottom(args))\n    .attr('dy', '.35em')\n    .attr('text-anchor', 'middle')\n    .text(String);\n\n  if (args.truncate_x_labels) {\n    labels.each(function(d, idx) {\n      var elem = this, width = args.scales.X.bandwidth();\n      truncate_text(elem, d, width);\n    });\n  }\n  mg_rotate_labels(labels, args.rotate_x_labels);\n}\n\nMG.x_axis_categorical = x_axis_categorical;\n\nfunction mg_point_add_color_scale(args) {\n  var color_domain, color_range;\n\n  if (args.color_accessor !== null) {\n    color_domain = mg_get_color_domain(args);\n    color_range = mg_get_color_range(args);\n\n    if (args.color_type === 'number') {\n      args.scales.color = d3.scaleLinear()\n        .domain(color_domain)\n        .range(color_range)\n        .clamp(true);\n    } else {\n      args.scales.color = args.color_range !== null\n        ? d3.scaleOrdinal().range(color_range)\n        : (color_domain.length > 10\n          ? d3.scaleOrdinal(d3.schemeCategory20)\n          : d3.scaleOrdinal(d3.schemeCategory10));\n\n      args.scales.color.domain(color_domain);\n    }\n    mg_add_scale_function(args, 'color', 'color', args.color_accessor);\n  }\n}\n\nfunction mg_get_color_domain(args) {\n  var color_domain;\n  if (args.color_domain === null) {\n    if (args.color_type === 'number') {\n      color_domain = d3.extent(args.data[0], function(d) {\n        return d[args.color_accessor];\n      });\n    } else if (args.color_type === 'category') {\n      color_domain = d3.set(args.data[0]\n          .map(function(d) {\n            return d[args.color_accessor];\n        }))\n        .values();\n\n      color_domain.sort();\n    }\n  } else {\n    color_domain = args.color_domain;\n  }\n  return color_domain;\n}\n\nfunction mg_get_color_range(args) {\n  var color_range;\n  if (args.color_range === null) {\n    if (args.color_type === 'number') {\n      color_range = ['blue', 'red'];\n    } else {\n      color_range = null;\n    }\n  } else {\n    color_range = args.color_range;\n  }\n  return color_range;\n}\n\nfunction mg_point_add_size_scale(args) {\n  var min_size, max_size, size_domain, size_range;\n  if (args.size_accessor !== null) {\n    size_domain = mg_get_size_domain(args);\n    size_range = mg_get_size_range(args);\n\n    args.scales.size = d3.scaleLinear()\n      .domain(size_domain)\n      .range(size_range)\n      .clamp(true);\n\n    mg_add_scale_function(args, 'size', 'size', args.size_accessor);\n  }\n}\n\nfunction mg_get_size_domain(args) {\n  return (args.size_domain === null)\n    ? d3.extent(args.data[0], function(d) { return d[args.size_accessor]; })\n    : args.size_domain;\n}\n\nfunction mg_get_size_range(args) {\n  var size_range;\n  if (args.size_range === null) {\n    size_range = [1, 5];\n  } else {\n    size_range = args.size_range;\n  }\n  return size_range;\n}\n\nfunction mg_add_x_label(g, args) {\n  if (args.x_label) {\n    g.append('text')\n      .attr('class', 'label')\n      .attr('x', function() {\n        return mg_get_plot_left(args) + (mg_get_plot_right(args) - mg_get_plot_left(args)) / 2;\n      })\n      .attr('dx', args.x_label_nudge_x != null ? args.x_label_nudge_x : 0)\n      .attr('y', function() {\n        var xAxisTextElement = d3.select(args.target)\n          .select('.mg-x-axis text').node().getBoundingClientRect();\n        return mg_get_bottom(args) + args.xax_tick_length * (7 / 3) + xAxisTextElement.height * 0.8 + 10;\n      })\n      .attr('dy', '.5em')\n      .attr('text-anchor', 'middle')\n      .text(function(d) {\n        return args.x_label;\n      });\n  }\n}\n\nfunction mg_default_bar_xax_format(args) {\n  return function(d) {\n    if (d < 1.0 && d > -1.0 && d !== 0) {\n      // don't scale tiny values\n      return args.xax_units + d.toFixed(args.decimals);\n    } else {\n      var pf = d3.format(',.0f');\n      return args.xax_units + pf(d);\n    }\n  };\n}\n\nfunction mg_get_time_frame(diff) {\n  // diff should be (max_x - min_x) / 1000, in other words, the difference in seconds.\n  var time_frame;\n  if (mg_milisec_diff(diff)) {\n    time_frame = 'millis';\n  } else if (mg_sec_diff(diff)) {\n    time_frame = 'seconds';\n  } else if (mg_day_diff(diff)) {\n    time_frame = 'less-than-a-day';\n  } else if (mg_four_days(diff)) {\n    time_frame = 'four-days';\n  } else if (mg_many_days(diff)) { // a handful of months?\n    time_frame = 'many-days';\n  } else if (mg_many_months(diff)) {\n    time_frame = 'many-months';\n  } else if (mg_years(diff)) {\n    time_frame = 'years';\n  } else {\n    time_frame = 'default';\n  }\n  return time_frame;\n}\n\nfunction mg_milisec_diff(diff) {\n  return diff < 10;\n}\n\nfunction mg_sec_diff(diff) {\n  return diff < 60;\n}\n\nfunction mg_day_diff(diff) {\n  return diff / (60 * 60) <= 24;\n}\n\nfunction mg_four_days(diff) {\n  return diff / (60 * 60) <= 24 * 4;\n}\n\nfunction mg_many_days(diff) {\n  return diff / (60 * 60 * 24) <= 93;\n}\n\nfunction mg_many_months(diff) {\n  return diff / (60 * 60 * 24) < 365 * 2;\n}\n\nfunction mg_years(diff) {\n  return diff / (60 * 60 * 24) >= 365 * 2;\n}\n\nfunction mg_get_time_format(utc, diff) {\n  var main_time_format;\n  if (mg_milisec_diff(diff)) {\n    main_time_format = MG.time_format(utc, '%M:%S.%L');\n  } else if (mg_sec_diff(diff)) {\n    main_time_format = MG.time_format(utc, '%M:%S');\n  } else if (mg_day_diff(diff)) {\n    main_time_format = MG.time_format(utc, '%H:%M');\n  } else if (mg_four_days(diff)) {\n    main_time_format = MG.time_format(utc, '%H:%M');\n  } else if (mg_many_days(diff)) {\n    main_time_format = MG.time_format(utc, '%b %d');\n  } else if (mg_many_months(diff)) {\n    main_time_format = MG.time_format(utc, '%b');\n  } else {\n    main_time_format = MG.time_format(utc, '%Y');\n  }\n  return main_time_format;\n}\n\nfunction mg_process_time_format(args) {\n  var diff;\n  var main_time_format;\n  var time_frame;\n\n  if (args.time_series) {\n    diff = (args.processed.max_x - args.processed.min_x) / 1000;\n    time_frame = mg_get_time_frame(diff);\n    main_time_format = mg_get_time_format(args.utc_time, diff);\n  }\n\n  args.processed.main_x_time_format = main_time_format;\n  args.processed.x_time_frame = time_frame;\n}\n\nfunction mg_default_xax_format(args) {\n  if (args.xax_format) {\n    return args.xax_format;\n  }\n\n  var data = args.processed.original_data || args.data;\n  var flattened = mg_flatten_array(data)[0];\n  var test_point_x = flattened[args.processed.original_x_accessor || args.x_accessor];\n  if (test_point_x === undefined) {\n    test_point_x = flattened;\n  }\n\n  return function(d) {\n    mg_process_time_format(args);\n\n    if (mg_is_date(test_point_x)) {\n      return args.processed.main_x_time_format(new Date(d));\n    } else if (typeof test_point_x === 'number') {\n      var is_float = d % 1 !== 0;\n      var pf;\n\n      if (is_float) {\n        pf = d3.format(',.' + args.decimals + 'f');\n      } else if (d < 1000) {\n        pf = d3.format(',.0f');\n      } else {\n        pf = d3.format(',.2s');\n      }\n      return args.xax_units + pf(d);\n    } else {\n      return args.xax_units + d;\n    }\n  };\n}\n\nfunction mg_add_x_ticks(g, args) {\n  mg_process_scale_ticks(args, 'x');\n  mg_add_x_axis_rim(args, g);\n  mg_add_x_axis_tick_lines(args, g);\n}\n\nfunction mg_add_x_axis_rim(args, g) {\n  var tick_length = args.processed.x_ticks.length;\n  var last_i = args.scales.X.ticks(args.xax_count).length - 1;\n\n  if (!args.x_extended_ticks) {\n    g.append('line')\n      .attr('x1', function() {\n        if (args.xax_count === 0) {\n          return mg_get_plot_left(args);\n        } else if (args.axes_not_compact && args.chart_type !== 'bar') {\n          return args.left;\n        } else {\n          return (args.scales.X(args.scales.X.ticks(args.xax_count)[0])).toFixed(2);\n        }\n      })\n      .attr('x2', function() {\n        if (args.xax_count === 0 || (args.axes_not_compact && args.chart_type !== 'bar')) {\n          return mg_get_right(args);\n        } else {\n          return args.scales.X(args.scales.X.ticks(args.xax_count)[last_i]).toFixed(2);\n        }\n      })\n      .attr('y1', args.height - args.bottom)\n      .attr('y2', args.height - args.bottom);\n  }\n}\n\nfunction mg_add_x_axis_tick_lines(args, g) {\n  g.selectAll('.mg-xax-ticks')\n    .data(args.processed.x_ticks).enter()\n    .append('line')\n    .attr('x1', function(d) {\n      return args.scales.X(d).toFixed(2); })\n    .attr('x2', function(d) {\n      return args.scales.X(d).toFixed(2); })\n    .attr('y1', args.height - args.bottom)\n    .attr('y2', function() {\n      return (args.x_extended_ticks) ? args.top : args.height - args.bottom + args.xax_tick_length;\n    })\n    .attr('class', function() {\n      if (args.x_extended_ticks) {\n        return 'mg-extended-xax-ticks';\n      }\n    })\n    .classed('mg-xax-ticks', true);\n}\n\nfunction mg_add_x_tick_labels(g, args) {\n  mg_add_primary_x_axis_label(args, g);\n  mg_add_secondary_x_axis_label(args, g);\n}\n\nfunction mg_add_primary_x_axis_label(args, g) {\n  var labels = g.selectAll('.mg-xax-labels')\n    .data(args.processed.x_ticks).enter()\n    .append('text')\n    .attr('x', function(d) {\n      return args.scales.X(d).toFixed(2);\n    })\n    .attr('y', (args.height - args.bottom + args.xax_tick_length * 7 / 3).toFixed(2))\n    .attr('dy', '.50em')\n    .attr('text-anchor', 'middle');\n\n  if (args.time_series && args.european_clock) {\n    labels.append('tspan').classed('mg-european-hours', true).text(function(_d, i) {\n      var d = new Date(_d);\n      if (i === 0) return d3.timeFormat('%H')(d);\n      else return '';\n    });\n    labels.append('tspan').classed('mg-european-minutes-seconds', true).text(function(_d, i) {\n      var d = new Date(_d);\n      return ':' + args.processed.xax_format(d);\n    });\n  } else {\n    labels.text(function(d) {\n      return args.xax_units + args.processed.xax_format(d);\n    });\n  }\n\n  // CHECK TO SEE IF OVERLAP for labels. If so,\n  // remove half of them. This is a dirty hack.\n  // We will need to figure out a more principled way of doing this.\n  if (mg_elements_are_overlapping(labels)) {\n    labels.filter(function(d, i) {\n      return (i + 1) % 2 === 0;\n    }).remove();\n\n    var svg = mg_get_svg_child_of(args.target);\n    svg.selectAll('.mg-xax-ticks')\n      .filter(function(d, i) {\n        return (i + 1) % 2 === 0;\n      })\n      .remove();\n  }\n}\n\nfunction mg_add_secondary_x_axis_label(args, g) {\n  if (args.time_series && (args.show_years || args.show_secondary_x_label)) {\n    var tf = mg_get_yformat_and_secondary_time_function(args);\n    mg_add_secondary_x_axis_elements(args, g, tf.timeframe, tf.yformat, tf.secondary);\n  }\n}\n\nfunction mg_get_yformat_and_secondary_time_function(args) {\n  var tf = {};\n  tf.timeframe = args.processed.x_time_frame;\n  switch (tf.timeframe) {\n    case 'millis':\n    case 'seconds':\n      tf.secondary = d3.timeDays;\n      if (args.european_clock) tf.yformat = MG.time_format(args.utc_time, '%b %d');\n      else tf.yformat = MG.time_format(args.utc_time, '%I %p');\n      break;\n    case 'less-than-a-day':\n      tf.secondary = d3.timeDays;\n      tf.yformat = MG.time_format(args.utc_time, '%b %d');\n      break;\n    case 'four-days':\n      tf.secondary = d3.timeDays;\n      tf.yformat = MG.time_format(args.utc_time, '%b %d');\n      break;\n    case 'many-days':\n      tf.secondary = d3.timeYears;\n      tf.yformat = MG.time_format(args.utc_time, '%Y');\n      break;\n    case 'many-months':\n      tf.secondary = d3.timeYears;\n      tf.yformat = MG.time_format(args.utc_time, '%Y');\n      break;\n    default:\n      tf.secondary = d3.timeYears;\n      tf.yformat = MG.time_format(args.utc_time, '%Y');\n  }\n  return tf;\n}\n\nfunction mg_add_secondary_x_axis_elements(args, g, time_frame, yformat, secondary_function) {\n  var years = secondary_function(args.processed.min_x, args.processed.max_x);\n  if (years.length === 0) {\n    var first_tick = args.scales.X.ticks(args.xax_count)[0];\n    years = [first_tick];\n  }\n\n  var yg = mg_add_g(g, 'mg-year-marker');\n  if (time_frame === 'default' && args.show_year_markers) {\n    mg_add_year_marker_line(args, yg, years, yformat);\n  }\n  if (time_frame != 'years') mg_add_year_marker_text(args, yg, years, yformat);\n}\n\nfunction mg_add_year_marker_line(args, g, years, yformat) {\n  g.selectAll('.mg-year-marker')\n    .data(years).enter()\n    .append('line')\n    .attr('x1', function(d) {\n      return args.scales.X(d).toFixed(2);\n    })\n    .attr('x2', function(d) {\n      return args.scales.X(d).toFixed(2);\n    })\n    .attr('y1', mg_get_top(args))\n    .attr('y2', mg_get_bottom(args));\n}\n\nfunction mg_add_year_marker_text(args, g, years, yformat) {\n  g.selectAll('.mg-year-marker')\n    .data(years).enter()\n    .append('text')\n    .attr('x', function(d, i) {\n      return args.scales.X(d).toFixed(2);\n    })\n    .attr('y', function() {\n      var xAxisTextElement = d3.select(args.target)\n        .select('.mg-x-axis text').node().getBoundingClientRect();\n      return (mg_get_bottom(args) + args.xax_tick_length * 7 / 3) + (xAxisTextElement.height * 0.8);\n    })\n    .attr('dy', '.50em')\n    .attr('text-anchor', 'middle')\n    .text(function(d) {\n      return yformat(new Date(d));\n    });\n}\n\nfunction mg_min_max_x_for_nonbars(mx, args, data) {\n  var extent_x = d3.extent(data, function(d) {\n    return d[args.x_accessor];\n  });\n  mx.min = extent_x[0];\n  mx.max = extent_x[1];\n}\n\nfunction mg_min_max_x_for_bars(mx, args, data) {\n  mx.min = d3.min(data, function(d) {\n    var trio = [\n      d[args.x_accessor],\n      (d[args.baseline_accessor]) ? d[args.baseline_accessor] : 0,\n      (d[args.predictor_accessor]) ? d[args.predictor_accessor] : 0\n    ];\n    return Math.min.apply(null, trio);\n  });\n\n  if (mx.min > 0) mx.min = 0;\n\n  mx.max = d3.max(data, function(d) {\n    var trio = [\n      d[args.x_accessor],\n      (d[args.baseline_accessor]) ? d[args.baseline_accessor] : 0,\n      (d[args.predictor_accessor]) ? d[args.predictor_accessor] : 0\n    ];\n    return Math.max.apply(null, trio);\n  });\n  return mx;\n}\n\nfunction mg_min_max_x_for_dates(mx) {\n  var yesterday = MG.clone(mx.min).setDate(mx.min.getDate() - 1);\n  var tomorrow = MG.clone(mx.min).setDate(mx.min.getDate() + 1);\n  mx.min = yesterday;\n  mx.max = tomorrow;\n}\n\nfunction mg_min_max_x_for_numbers(mx) {\n  // TODO do we want to rewrite this?\n  mx.min = mx.min - 1;\n  mx.max = mx.max + 1;\n}\n\nfunction mg_min_max_x_for_strings(mx) {\n  // TODO shouldn't be allowing strings here to be coerced into numbers\n  mx.min = Number(mx.min) - 1;\n  mx.max = Number(mx.max) + 1;\n}\n\nfunction mg_force_xax_count_to_be_two(args) {\n  args.xax_count = 2;\n}\n\nfunction mg_sort_through_data_type_and_set_x_min_max_accordingly(mx, args, data) {\n  if (args.chart_type === 'line' || args.chart_type === 'point' || args.chart_type === 'histogram') {\n    mg_min_max_x_for_nonbars(mx, args, data);\n\n  } else if (args.chart_type === 'bar') {\n    mg_min_max_x_for_bars(mx, args, data);\n  }\n  // if data set is of length 1, expand the range so that we can build the x-axis\n  if (mx.min === mx.max && !(args.min_x && args.max_x)) {\n    if (mg_is_date(mx.min)) {\n      mg_min_max_x_for_dates(mx);\n    } else if (typeof min_x === 'number') {\n      mg_min_max_x_for_numbers(mx);\n    } else if (typeof min_x === 'string') {\n      mg_min_max_x_for_strings(mx);\n    }\n    // force xax_count to be 2\n    mg_force_xax_count_to_be_two(args);\n  }\n}\n\nfunction mg_select_xax_format(args) {\n  var c = args.chart_type;\n  if (!args.processed.xax_format) {\n    if (args.xax_format) {\n      args.processed.xax_format = args.xax_format;\n    } else {\n      if (c === 'line' || c === 'point' || c === 'histogram') {\n        args.processed.xax_format = mg_default_xax_format(args);\n      } else if (c === 'bar') {\n        args.processed.xax_format = mg_default_bar_xax_format(args);\n      }\n    }\n  }\n}\n\nfunction mg_merge_args_with_defaults(args) {\n  var defaults = {\n    target: null,\n    title: null,\n    description: null\n  };\n\n  if (!args) {\n    args = {};\n  }\n\n  if (!args.processed) {\n    args.processed = {};\n  }\n\n  args = merge_with_defaults(args, defaults);\n  return args;\n}\n\nfunction mg_is_time_series(args) {\n  var first_elem = mg_flatten_array(args.processed.original_data || args.data)[0];\n  args.time_series = mg_is_date(first_elem[args.processed.original_x_accessor || args.x_accessor]);\n}\n\nfunction mg_init_compute_width(args) {\n  var svg_width = args.width;\n  if (args.full_width) {\n    svg_width = get_width(args.target);\n  }\n  if (args.x_axis_type === 'categorical' && svg_width === null) {\n    svg_width = mg_categorical_calculate_height(args, 'x');\n  }\n\n  args.width = svg_width;\n}\n\nfunction mg_init_compute_height(args) {\n  var svg_height = args.height;\n  if (args.full_height) {\n    svg_height = get_height(args.target);\n  }\n  if (args.y_axis_type === 'categorical' && svg_height === null) {\n    svg_height = mg_categorical_calculate_height(args, 'y');\n  }\n\n  args.height = svg_height;\n}\n\nfunction mg_remove_svg_if_chart_type_has_changed(svg, args) {\n  if ((!svg.selectAll('.mg-main-line').empty() && args.chart_type !== 'line') ||\n    (!svg.selectAll('.mg-points').empty() && args.chart_type !== 'point') ||\n    (!svg.selectAll('.mg-histogram').empty() && args.chart_type !== 'histogram') ||\n    (!svg.selectAll('.mg-barplot').empty() && args.chart_type !== 'bar')\n  ) {\n    svg.remove();\n  }\n}\n\nfunction mg_add_svg_if_it_doesnt_exist(svg, args) {\n  if (mg_get_svg_child_of(args.target).empty()) {\n    svg = d3.select(args.target)\n      .append('svg')\n      .classed('linked', args.linked)\n      .attr('width', args.width)\n      .attr('height', args.height);\n  }\n  return svg;\n}\n\nfunction mg_add_clip_path_for_plot_area(svg, args) {\n  svg.selectAll('.mg-clip-path').remove();\n  svg.append('defs')\n    .attr('class', 'mg-clip-path')\n    .append('clipPath')\n    .attr('id', 'mg-plot-window-' + mg_target_ref(args.target))\n    .append('svg:rect')\n    .attr('x', mg_get_left(args))\n    .attr('y', mg_get_top(args))\n    .attr('width', args.width - args.left - args.right - args.buffer)\n    .attr('height', args.height - args.top - args.bottom - args.buffer + 1);\n}\n\nfunction mg_adjust_width_and_height_if_changed(svg, args) {\n  if (args.width !== Number(svg.attr('width'))) {\n    svg.attr('width', args.width);\n  }\n  if (args.height !== Number(svg.attr('height'))) {\n    svg.attr('height', args.height);\n  }\n}\n\nfunction mg_set_viewbox_for_scaling(svg, args) {\n  // we need to reconsider how we handle automatic scaling\n  svg.attr('viewBox', '0 0 ' + args.width + ' ' + args.height);\n  if (args.full_width || args.full_height) {\n    svg.attr('preserveAspectRatio', 'xMinYMin meet');\n  }\n}\n\nfunction mg_remove_missing_classes_and_text(svg) {\n  // remove missing class\n  svg.classed('mg-missing', false);\n\n  // remove missing text\n  svg.selectAll('.mg-missing-text').remove();\n  svg.selectAll('.mg-missing-pane').remove();\n}\n\nfunction mg_remove_outdated_lines(svg, args) {\n  // if we're updating an existing chart and we have fewer lines than\n  // before, remove the outdated lines, e.g. if we had 3 lines, and we're calling\n  // data_graphic() on the same target with 2 lines, remove the 3rd line\n\n  var i = 0;\n\n  if (svg.selectAll('.mg-main-line').nodes().length >= args.data.length) {\n    // now, the thing is we can't just remove, say, line3 if we have a custom\n    // line-color map, instead, see which are the lines to be removed, and delete those\n    if (args.custom_line_color_map.length > 0) {\n      var array_full_series = function(len) {\n        var arr = new Array(len);\n        for (var i = 0; i < arr.length; i++) { arr[i] = i + 1; }\n        return arr;\n      };\n\n      // get an array of lines ids to remove\n      var lines_to_remove = arr_diff(\n        array_full_series(args.max_data_size),\n        args.custom_line_color_map);\n\n      for (i = 0; i < lines_to_remove.length; i++) {\n        svg.selectAll('.mg-main-line.mg-line' + lines_to_remove[i] + '-color')\n          .remove();\n      }\n    } else {\n      // if we don't have a custom line-color map, just remove the lines from the end\n      var num_of_new = args.data.length;\n      var num_of_existing = (svg.selectAll('.mg-main-line').nodes()) ? svg.selectAll('.mg-main-line').nodes().length : 0;\n\n      for (i = num_of_existing; i > num_of_new; i--) {\n        svg.selectAll('.mg-main-line.mg-line' + i + '-color')\n          .remove();\n      }\n    }\n  }\n}\n\nfunction mg_raise_container_error(container, args) {\n  if (container.empty()) {\n    console.warn('The specified target element \"' + args.target + '\" could not be found in the page. The chart will not be rendered.');\n    return;\n  }\n}\n\nfunction categoricalInitialization(args, ns) {\n  var which = ns === 'x' ? args.width : args.height;\n  mg_categorical_count_number_of_groups(args, ns);\n  mg_categorical_count_number_of_lanes(args, ns);\n  mg_categorical_calculate_group_length(args, ns, which);\n  if (which) mg_categorical_calculate_bar_thickness(args, ns);\n}\n\n\nfunction mg_categorical_count_number_of_groups(args, ns) {\n  var accessor_string = ns + 'group_accessor';\n  var accessor = args[accessor_string];\n  args.categorical_groups = [];\n  if (accessor) {\n    var data = args.data[0];\n    args.categorical_groups = d3.set(data.map(function(d) {\n      return d[accessor] })).values();\n  }\n}\n\nfunction mg_categorical_count_number_of_lanes(args, ns) {\n  var accessor_string = ns + 'group_accessor';\n  var groupAccessor = args[accessor_string];\n\n  args.total_bars = args.data[0].length;\n  if (groupAccessor) {\n    var group_bars = count_array_elements(pluck(args.data[0], groupAccessor));\n    group_bars = d3.max(Object.keys(group_bars).map(function(d) {\n      return group_bars[d] }));\n    args.bars_per_group = group_bars;\n  } else {\n    args.bars_per_group = args.data[0].length;\n  }\n}\n\nfunction mg_categorical_calculate_group_length(args, ns, which) {\n  var groupHeight = ns + 'group_height';\n  if (which) {\n    var gh = ns === 'y' ?\n      (args.height - args.top - args.bottom - args.buffer * 2) / (args.categorical_groups.length || 1) :\n      (args.width - args.left - args.right - args.buffer * 2) / (args.categorical_groups.length || 1);\n\n    args[groupHeight] = gh;\n  } else {\n    var step = (1 + args[ns + '_padding_percentage']) * args.bar_thickness;\n    args[groupHeight] = args.bars_per_group * step + args[ns + '_outer_padding_percentage'] * 2 * step; //args.bar_thickness + (((args.bars_per_group-1) * args.bar_thickness) * (args.bar_padding_percentage + args.bar_outer_padding_percentage*2));\n  }\n}\n\nfunction mg_categorical_calculate_bar_thickness(args, ns) {\n  // take one group height.\n  var step = (args[ns + 'group_height']) / (args.bars_per_group + args[ns + '_outer_padding_percentage']);\n  args.bar_thickness = step - (step * args[ns + '_padding_percentage']);\n}\n\nfunction mg_categorical_calculate_height(args, ns) {\n  var groupContribution = (args[ns + 'group_height']) * (args.categorical_groups.length || 1);\n\n  var marginContribution = ns === 'y'\n    ? args.top + args.bottom + args.buffer * 2\n    : args.left + args.right + args.buffer * 2;\n\n  return groupContribution + marginContribution +\n    (args.categorical_groups.length * args[ns + 'group_height'] * (args[ns + 'group_padding_percentage'] + args[ns + 'group_outer_padding_percentage']));\n}\n\nfunction mg_barchart_extrapolate_group_and_thickness_from_height(args) {\n  // we need to set args.bar_thickness, group_height\n}\n\nfunction init(args) {\n  'use strict';\n  args = arguments[0];\n  args = mg_merge_args_with_defaults(args);\n  // If you pass in a dom element for args.target, the expectation\n  // of a string elsewhere will break.\n  var container = d3.select(args.target);\n  mg_raise_container_error(container, args);\n\n  var svg = container.selectAll('svg');\n\n  // some things that will need to be calculated if we have a categorical axis.\n  if (args.y_axis_type === 'categorical') { categoricalInitialization(args, 'y'); }\n  if (args.x_axis_type === 'categorical') { categoricalInitialization(args, 'x'); }\n\n  mg_is_time_series(args);\n  mg_init_compute_width(args);\n  mg_init_compute_height(args);\n\n  mg_remove_svg_if_chart_type_has_changed(svg, args);\n  svg = mg_add_svg_if_it_doesnt_exist(svg, args);\n\n  mg_add_clip_path_for_plot_area(svg, args);\n  mg_adjust_width_and_height_if_changed(svg, args);\n  mg_set_viewbox_for_scaling(svg, args);\n  mg_remove_missing_classes_and_text(svg);\n  chart_title(args);\n  mg_remove_outdated_lines(svg, args);\n\n  return this;\n}\n\nMG.init = init;\n\nfunction mg_return_label(d) {\n  return d.label;\n}\n\nfunction mg_remove_existing_markers(svg) {\n  svg.selectAll('.mg-markers').remove();\n  svg.selectAll('.mg-baselines').remove();\n}\n\nfunction mg_in_range(args) {\n  return function(d) {\n    return (args.scales.X(d[args.x_accessor]) >= mg_get_plot_left(args)) && (args.scales.X(d[args.x_accessor]) <= mg_get_plot_right(args));\n  };\n}\n\nfunction mg_x_position(args) {\n  return function(d) {\n    return args.scales.X(d[args.x_accessor]);\n  };\n}\n\nfunction mg_x_position_fixed(args) {\n  var _mg_x_pos = mg_x_position(args);\n  return function(d) {\n    return _mg_x_pos(d).toFixed(2);\n  };\n}\n\nfunction mg_y_position_fixed(args) {\n  var _mg_y_pos = args.scales.Y;\n  return function(d) {\n    return _mg_y_pos(d.value).toFixed(2);\n  };\n}\n\nfunction mg_place_annotations(checker, class_name, args, svg, line_fcn, text_fcn) {\n  var g;\n  if (checker) {\n    g = svg.append('g').attr('class', class_name);\n    line_fcn(g, args);\n    text_fcn(g, args);\n  }\n}\n\nfunction mg_place_markers(args, svg) {\n  mg_place_annotations(args.markers, 'mg-markers', args, svg, mg_place_marker_lines, mg_place_marker_text);\n}\n\nfunction mg_place_baselines(args, svg) {\n  mg_place_annotations(args.baselines, 'mg-baselines', args, svg, mg_place_baseline_lines, mg_place_baseline_text);\n}\n\nfunction mg_place_marker_lines(gm, args) {\n  var x_pos_fixed = mg_x_position_fixed(args);\n  gm.selectAll('.mg-markers')\n    .data(args.markers.filter(mg_in_range(args)))\n    .enter()\n    .append('line')\n    .attr('x1', x_pos_fixed)\n    .attr('x2', x_pos_fixed)\n    .attr('y1', args.top)\n    .attr('y2', mg_get_plot_bottom(args))\n    .attr('class', function(d) {\n      return d.lineclass;\n    })\n    .attr('stroke-dasharray', '3,1');\n}\n\nfunction mg_place_marker_text(gm, args) {\n  gm.selectAll('.mg-markers')\n    .data(args.markers.filter(mg_in_range(args)))\n    .enter()\n    .append('text')\n      .attr('class', function(d) {\n        return d.textclass || ''; })\n      .classed('mg-marker-text', true)\n      .attr('x', mg_x_position(args))\n      .attr('y', args.x_axis_position === 'bottom' ? mg_get_top(args) * 0.95 : mg_get_bottom(args) + args.buffer)\n      .attr('text-anchor', 'middle')\n      .text(mg_return_label)\n      .each(function(d) {\n        if (d.click) {\n          d3.select(this).style('cursor', 'pointer')\n            .on('click', d.click);\n        }\n      });\n\n  mg_prevent_horizontal_overlap(gm.selectAll('.mg-marker-text').nodes(), args);\n}\n\nfunction mg_place_baseline_lines(gb, args) {\n  var y_pos = mg_y_position_fixed(args);\n  gb.selectAll('.mg-baselines')\n    .data(args.baselines)\n    .enter().append('line')\n    .attr('x1', mg_get_plot_left(args))\n    .attr('x2', mg_get_plot_right(args))\n    .attr('y1', y_pos)\n    .attr('y2', y_pos);\n}\n\nfunction mg_place_baseline_text(gb, args) {\n  var y_pos = mg_y_position_fixed(args);\n  gb.selectAll('.mg-baselines')\n    .data(args.baselines)\n    .enter().append('text')\n    .attr('x', mg_get_plot_right(args))\n    .attr('y', y_pos)\n    .attr('dy', -3)\n    .attr('text-anchor', 'end')\n    .text(mg_return_label);\n}\n\nfunction markers(args) {\n  'use strict';\n\n  var svg = mg_get_svg_child_of(args.target);\n  mg_remove_existing_markers(svg);\n  mg_place_markers(args, svg);\n  mg_place_baselines(args, svg);\n  return this;\n}\n\nMG.markers = markers;\n\nfunction mg_clear_mouseover_container(svg) {\n  svg.selectAll('.mg-active-datapoint-container').selectAll('*').remove();\n}\n\nfunction mg_setup_mouseover_container(svg, args) {\n  svg.select('.mg-active-datapoint').remove();\n  var text_anchor = args.mouseover_align === 'right'\n    ? 'end'\n    : (args.mouseover_align === 'left'\n      ? 'start'\n      : 'middle');\n\n  var mouseover_x = (args.mouseover_align === 'right')\n    ? mg_get_plot_right(args)\n    : (args.mouseover_align === 'left'\n      ? mg_get_plot_left(args)\n      : (args.width - args.left - args.right) / 2 + args.left);\n\n  var active_datapoint = svg.select('.mg-active-datapoint-container')\n    .append('text')\n    .attr('class', 'mg-active-datapoint')\n    .attr('xml:space', 'preserve')\n    .attr('text-anchor', text_anchor);\n\n  // set the rollover text's position; if we have markers on two lines,\n  // nudge up the rollover text a bit\n  var active_datapoint_y_nudge = 0.75;\n\n  var y_position = (args.x_axis_position === 'bottom')\n    ? mg_get_top(args) * active_datapoint_y_nudge\n    : mg_get_bottom(args) + args.buffer * 3;\n\n  if (args.markers) {\n    var yPos;\n    svg.selectAll('.mg-marker-text')\n      .each(function() {\n        if (!yPos) {\n          yPos = d3.select(this).attr('y');\n        } else if (yPos !== d3.select(this).attr('y')) {\n          active_datapoint_y_nudge = 0.56;\n        }\n      });\n  }\n\n  active_datapoint\n    .attr('transform', 'translate(' + mouseover_x + ',' + (y_position) + ')');\n}\n\nfunction mg_mouseover_tspan(svg, text) {\n  var tspan = '';\n  var cl = null;\n  if (arguments.length === 3) cl = arguments[2];\n  tspan = svg.append('tspan').text(text);\n  if (cl !== null) tspan.classed(cl, true);\n  this.tspan = tspan;\n\n  this.bold = function() {\n    this.tspan.attr('font-weight', 'bold');\n    return this;\n  };\n\n  this.font_size = function(pts) {\n    this.tspan.attr('font-size', pts);\n    return this;\n  }\n\n  this.x = function(x) {\n    this.tspan.attr('x', x);\n    return this;\n  };\n  this.y = function(y) {\n    this.tspan.attr('y', y);\n    return this;\n  };\n  this.elem = function() {\n    return this.tspan;\n  };\n  return this;\n}\n\nfunction mg_reset_text_container(svg) {\n  var textContainer = svg.select('.mg-active-datapoint');\n  textContainer\n    .selectAll('*')\n    .remove();\n  return textContainer;\n}\n\nfunction mg_mouseover_row(row_number, container, rargs) {\n  var lineHeight = 1.1;\n  this.rargs = rargs;\n\n  var rrr = container.append('tspan')\n    .attr('x', 0)\n    .attr('y', (row_number * lineHeight) + 'em');\n\n  this.text = function(text) {\n    return mg_mouseover_tspan(rrr, text);\n  }\n  return this;\n}\n\nfunction mg_mouseover_text(args, rargs) {\n  var lineHeight = 1.1;\n  this.row_number = 0;\n  this.rargs = rargs;\n  mg_setup_mouseover_container(rargs.svg, args);\n\n  this.text_container = mg_reset_text_container(rargs.svg);\n\n  this.mouseover_row = function(rargs) {\n    var that = this;\n    var rrr = mg_mouseover_row(that.row_number, that.text_container, rargs);\n    that.row_number += 1;\n    return rrr;\n  }\n\n  return this;\n}\n\nfunction MG_WindowResizeTracker() {\n  var targets = [];\n\n  var Observer;\n  if (typeof MutationObserver !== \"undefined\") {\n    Observer = MutationObserver;\n  } else if (typeof WebKitMutationObserver !== \"undefined\") {\n    Observer = WebKitMutationObserver;\n  }\n\n  function window_listener() {\n    targets.forEach(function(target) {\n      var svg = d3.select(target).select('svg');\n\n      // skip if svg is not visible\n      if (!svg.empty() && (svg.node().parentNode.offsetWidth > 0 || svg.node().parentNode.offsetHeight > 0)) {\n        var aspect = svg.attr('width') !== 0 ? (svg.attr('height') / svg.attr('width')) : 0;\n\n        var newWidth = get_width(target);\n\n        svg.attr('width', newWidth);\n        svg.attr('height', aspect * newWidth);\n      }\n    });\n  }\n\n  function remove_target(target) {\n    var index = targets.indexOf(target);\n    if (index !== -1) {\n      targets.splice(index, 1);\n    }\n\n    if (targets.length === 0) {\n      window.removeEventListener('resize', window_listener, true);\n    }\n  }\n\n  return {\n    add_target: function(target) {\n      if (targets.length === 0) {\n        window.addEventListener('resize', window_listener, true);\n      }\n\n      if (targets.indexOf(target) === -1) {\n        targets.push(target);\n\n        if (Observer) {\n          var observer = new Observer(function(mutations) {\n            var targetNode = d3.select(target).node();\n\n            if (!targetNode || mutations.some(\n                function(mutation) {\n                  for (var i = 0; i < mutation.removedNodes.length; i++) {\n                    if (mutation.removedNodes[i] === targetNode) {\n                      return true;\n                    }\n                  }\n                })) {\n              observer.disconnect();\n              remove_target(target);\n            }\n          });\n\n          observer.observe(d3.select(target).node().parentNode, { childList: true });\n        }\n      }\n    }\n  };\n}\n\nvar mg_window_resize_tracker = new MG_WindowResizeTracker();\n\nfunction mg_window_listeners(args) {\n  mg_if_aspect_ratio_resize_svg(args);\n}\n\nfunction mg_if_aspect_ratio_resize_svg(args) {\n  // have we asked the svg to fill a div, if so resize with div\n  if (args.full_width || args.full_height) {\n    mg_window_resize_tracker.add_target(args.target);\n  }\n}\n\nif (mg_jquery_exists()) {\n    /*!\n     * Bootstrap v3.3.1 (http://getbootstrap.com)\n     * Copyright 2011-2014 Twitter, Inc.\n     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n     */\n\n    /*!\n     * Generated using the Bootstrap Customizer (http://getbootstrap.com/customize/?id=c3834cc5b59ef727da53)\n     * Config saved to config.json and https://gist.github.com/c3834cc5b59ef727da53\n     */\n\n    /* ========================================================================\n     * Bootstrap: dropdown.js v3.3.1\n     * http://getbootstrap.com/javascript/#dropdowns\n     * ========================================================================\n     * Copyright 2011-2014 Twitter, Inc.\n     * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\n     * ======================================================================== */\n\n\n    +function ($) {\n      'use strict';\n\n      if(typeof $().dropdown == 'function')\n        return true;\n\n      // DROPDOWN CLASS DEFINITION\n      // =========================\n\n      var backdrop = '.dropdown-backdrop';\n      var toggle   = '[data-toggle=\"dropdown\"]';\n      var Dropdown = function (element) {\n        $(element).on('click.bs.dropdown', this.toggle);\n      };\n\n      Dropdown.VERSION = '3.3.1';\n\n      Dropdown.prototype.toggle = function (e) {\n        var $this = $(this);\n\n        if ($this.is('.disabled, :disabled')) return;\n\n        var $parent  = getParent($this);\n        var isActive = $parent.hasClass('open');\n\n        clearMenus();\n\n        if (!isActive) {\n          if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {\n            // if mobile we use a backdrop because click events don't delegate\n            $('<div class=\"dropdown-backdrop\"/>').insertAfter($(this)).on('click', clearMenus);\n          }\n\n          var relatedTarget = { relatedTarget: this };\n          $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget));\n\n          if (e.isDefaultPrevented()) return;\n\n          $this\n            .trigger('focus')\n            .attr('aria-expanded', 'true');\n\n          $parent\n            .toggleClass('open')\n            .trigger('shown.bs.dropdown', relatedTarget);\n        }\n\n        return false;\n      };\n\n      Dropdown.prototype.keydown = function (e) {\n        if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return;\n\n        var $this = $(this);\n\n        e.preventDefault();\n        e.stopPropagation();\n\n        if ($this.is('.disabled, :disabled')) return;\n\n        var $parent  = getParent($this);\n        var isActive = $parent.hasClass('open');\n\n        if ((!isActive && e.which != 27) || (isActive && e.which == 27)) {\n          if (e.which == 27) $parent.find(toggle).trigger('focus');\n          return $this.trigger('click');\n        }\n\n        var desc = ' li:not(.divider):visible a';\n        var $items = $parent.find('[role=\"menu\"]' + desc + ', [role=\"listbox\"]' + desc);\n\n        if (!$items.length) return;\n\n        var index = $items.index(e.target);\n\n        if (e.which == 38 && index > 0)                 index--;                        // up\n        if (e.which == 40 && index < $items.length - 1) index++;                        // down\n        if (!~index)                                      index = 0;\n\n        $items.eq(index).trigger('focus');\n      };\n\n      function clearMenus(e) {\n        if (e && e.which === 3) return;\n        $(backdrop).remove();\n        $(toggle).each(function () {\n          var $this         = $(this);\n          var $parent       = getParent($this);\n          var relatedTarget = { relatedTarget: this };\n\n          if (!$parent.hasClass('open')) return;\n\n          $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget));\n\n          if (e.isDefaultPrevented()) return;\n\n          $this.attr('aria-expanded', 'false');\n          $parent.removeClass('open').trigger('hidden.bs.dropdown', relatedTarget);\n        });\n      }\n\n      function getParent($this) {\n        var selector = $this.attr('data-target');\n\n        if (!selector) {\n          selector = $this.attr('href');\n          selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\\s]*$)/, ''); // strip for ie7\n        }\n\n        var $parent = selector && $(selector);\n\n        return $parent && $parent.length ? $parent : $this.parent();\n      }\n\n\n      // DROPDOWN PLUGIN DEFINITION\n      // ==========================\n\n      function Plugin(option) {\n        return this.each(function () {\n          var $this = $(this);\n          var data  = $this.data('bs.dropdown');\n\n          if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)));\n          if (typeof option == 'string') data[option].call($this);\n        });\n      }\n\n      var old = $.fn.dropdown;\n\n      $.fn.dropdown             = Plugin;\n      $.fn.dropdown.Constructor = Dropdown;\n\n\n      // DROPDOWN NO CONFLICT\n      // ====================\n\n      $.fn.dropdown.noConflict = function () {\n        $.fn.dropdown = old;\n        return this;\n      };\n\n\n      // APPLY TO STANDARD DROPDOWN ELEMENTS\n      // ===================================\n\n      $(document)\n        .on('click.bs.dropdown.data-api', clearMenus)\n        .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation(); })\n        .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)\n        .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)\n        .on('keydown.bs.dropdown.data-api', '[role=\"menu\"]', Dropdown.prototype.keydown)\n        .on('keydown.bs.dropdown.data-api', '[role=\"listbox\"]', Dropdown.prototype.keydown);\n\n    }(jQuery);\n}\n\nMG.button_layout = function(target) {\n  'use strict';\n  this.target = target;\n  this.feature_set = {};\n  this.public_name = {};\n  this.sorters = {};\n  this.manual = [];\n  this.manual_map = {};\n  this.manual_callback = {};\n\n  this._strip_punctuation = function(s) {\n    var punctuationless = s.replace(/[^a-zA-Z0-9 _]+/g, '');\n    var finalString = punctuationless.replace(/ +?/g, '');\n    return finalString;\n  };\n\n  this.data = function(data) {\n    this._data = data;\n    return this;\n  };\n\n  this.manual_button = function(feature, feature_set, callback) {\n    this.feature_set[feature] = feature_set;\n    this.manual_map[this._strip_punctuation(feature)] = feature;\n    this.manual_callback[feature] = callback; // the default is going to be the first feature.\n    return this;\n  };\n\n  this.button = function(feature) {\n    if (arguments.length > 1) {\n      this.public_name[feature] = arguments[1];\n    }\n\n    if (arguments.length > 2) {\n      this.sorters[feature] = arguments[2];\n    }\n\n    this.feature_set[feature] = [];\n    return this;\n  };\n\n  this.callback = function(callback) {\n    this._callback = callback;\n    return this;\n  };\n\n  this.display = function() {\n    var callback = this._callback;\n    var manual_callback = this.manual_callback;\n    var manual_map = this.manual_map;\n\n    var d, f, features, feat;\n    features = Object.keys(this.feature_set);\n\n    var mapDtoF = function(f) {\n      return d[f]; };\n\n    var i;\n\n    // build out this.feature_set with this.data\n    for (i = 0; i < this._data.length; i++) {\n      d = this._data[i];\n      f = features.map(mapDtoF);\n      for (var j = 0; j < features.length; j++) {\n        feat = features[j];\n        if (this.feature_set[feat].indexOf(f[j]) === -1) {\n          this.feature_set[feat].push(f[j]);\n        }\n      }\n    }\n\n    for (feat in this.feature_set) {\n      if (this.sorters.hasOwnProperty(feat)) {\n        this.feature_set[feat].sort(this.sorters[feat]);\n      }\n    }\n\n    $(this.target).empty();\n\n    $(this.target).append(\"<div class='col-lg-12 segments text-center'></div>\");\n\n    var dropdownLiAClick = function() {\n      var k = $(this).data('key');\n      var feature = $(this).data('feature');\n      var manual_feature;\n      $('.' + feature + '-btns button.btn span.title').html(k);\n      if (!manual_map.hasOwnProperty(feature)) {\n        callback(feature, k);\n      } else {\n        manual_feature = manual_map[feature];\n        manual_callback[manual_feature](k);\n      }\n\n      return false;\n    };\n\n    for (var feature in this.feature_set) {\n      features = this.feature_set[feature];\n      $(this.target + ' div.segments').append(\n        '<div class=\"btn-group ' + this._strip_punctuation(feature) + '-btns text-left\">' + // This never changes.\n        '<button type=\"button\" class=\"btn btn-default btn-lg dropdown-toggle\" data-toggle=\"dropdown\">' +\n        \"<span class='which-button'>\" + (this.public_name.hasOwnProperty(feature) ? this.public_name[feature] : feature) + \"</span>\" +\n        \"<span class='title'>\" + (this.manual_callback.hasOwnProperty(feature) ? this.feature_set[feature][0] : 'all') + \"</span>\" + // if a manual button, don't default to all in label.\n        '<span class=\"caret\"></span>' +\n        '</button>' +\n        '<ul class=\"dropdown-menu\" role=\"menu\">' +\n        (!this.manual_callback.hasOwnProperty(feature) ? '<li><a href=\"#\" data-feature=\"' + feature + '\" data-key=\"all\">All</a></li>' : \"\") +\n        (!this.manual_callback.hasOwnProperty(feature) ? '<li class=\"divider\"></li>' : \"\") +\n        '</ul>' + '</div>');\n\n      for (i = 0; i < features.length; i++) {\n        if (features[i] !== 'all' && features[i] !== undefined) { // strange bug with undefined being added to manual buttons.\n          $(this.target + ' div.' + this._strip_punctuation(feature) + '-btns ul.dropdown-menu').append(\n            '<li><a href=\"#\" data-feature=\"' + this._strip_punctuation(feature) + '\" data-key=\"' + features[i] + '\">' + features[i] + '</a></li>'\n          );\n        }\n      }\n\n      $('.' + this._strip_punctuation(feature) + '-btns .dropdown-menu li a').on('click', dropdownLiAClick);\n    }\n\n    return this;\n  };\n\n  return this;\n};\n\n(function() {\n  'use strict';\n\n  function mg_line_color_text(elem, d, args) {\n    elem.classed('mg-hover-line' + d.line_id + '-color', args.colors === null)\n      .attr('fill', args.colors === null ? '' : args.colors[d.line_id - 1]);\n  }\n\n  function mg_line_graph_generators(args, plot, svg) {\n    mg_add_line_generator(args, plot);\n    mg_add_area_generator(args, plot);\n    mg_add_flat_line_generator(args, plot);\n    mg_add_confidence_band_generator(args, plot, svg);\n  }\n\n  function mg_add_confidence_band_generator(args, plot, svg) {\n    plot.existing_band = svg.selectAll('.mg-confidence-band').nodes();\n    if (args.show_confidence_band) {\n      plot.confidence_area = d3.area()\n        .defined(plot.line.defined())\n        .x(args.scalefns.xf)\n        .y0(function(d) {\n          var l = args.show_confidence_band[0];\n          if (d[l] != undefined) {\n            return args.scales.Y(d[l]);\n          } else {\n            return args.scales.Y(d[args.y_accessor]);\n          }\n        })\n        .y1(function(d) {\n          var u = args.show_confidence_band[1];\n          if (d[u] != undefined) {\n            return args.scales.Y(d[u]);\n          } else {\n            return args.scales.Y(d[args.y_accessor]);\n          }\n        })\n        .curve(args.interpolate);\n    }\n  }\n\n  function mg_add_area_generator(args, plot) {\n    plot.area = d3.area()\n      .defined(plot.line.defined())\n      .x(args.scalefns.xf)\n      .y0(args.scales.Y.range()[0])\n      .y1(args.scalefns.yf)\n      .curve(args.interpolate);\n  }\n\n  function mg_add_flat_line_generator(args, plot) {\n    plot.flat_line = d3.line()\n      .defined(function(d) {\n        return (d['_missing'] === undefined || d['_missing'] !== true) && d[args.y_accessor] !== null;\n      })\n      .x(args.scalefns.xf)\n      .y(function() {\n        return args.scales.Y(plot.data_median); })\n      .curve(args.interpolate);\n  }\n\n  function mg_add_line_generator(args, plot) {\n    plot.line = d3.line()\n      .x(args.scalefns.xf)\n      .y(args.scalefns.yf)\n      .curve(args.interpolate);\n\n    // if missing_is_zero is not set, then hide data points that fall in missing\n    // data ranges or that have been explicitly identified as missing in the\n    // data source.\n    if (!args.missing_is_zero) {\n      // a line is defined if the _missing attrib is not set to true\n      // and the y-accessor is not null\n      plot.line = plot.line.defined(function(d) {\n        return (d['_missing'] === undefined || d['_missing'] !== true) && d[args.y_accessor] !== null;\n      });\n    }\n  }\n\n  function mg_add_confidence_band(args, plot, svg, which_line) {\n    if (args.show_confidence_band) {\n      var confidenceBand;\n      if (svg.select('.mg-confidence-band-' + which_line).empty()) {\n        svg.append('path')\n          .attr('class', 'mg-confidence-band mg-confidence-band-' + which_line)\n      }\n\n      // transition this line's confidence band\n      confidenceBand = svg.select('.mg-confidence-band-' + which_line);\n\n      confidenceBand\n        .transition()\n        .duration(function() {\n          return (args.transition_on_update) ? 1000 : 0;\n        })\n        .attr('d', plot.confidence_area(args.data[which_line - 1]))\n        .attr('clip-path', 'url(#mg-plot-window-' + mg_target_ref(args.target) + ')')\n    }\n  }\n\n  function mg_add_area(args, plot, svg, which_line, line_id) {\n    var areas = svg.selectAll('.mg-main-area.mg-area' + line_id);\n    if (plot.display_area) {\n      // if area already exists, transition it\n      if (!areas.empty()) {\n        svg.node().appendChild(areas.node());\n\n        areas.transition()\n          .duration(plot.update_transition_duration)\n          .attr('d', plot.area(args.data[which_line]))\n          .attr('clip-path', 'url(#mg-plot-window-' + mg_target_ref(args.target) + ')');\n      } else { // otherwise, add the area\n        svg.append('path')\n          .classed('mg-main-area', true)\n          .classed('mg-area' + line_id, true)\n          .classed('mg-area' + line_id + '-color', args.colors === null)\n          .attr('d', plot.area(args.data[which_line]))\n          .attr('fill', args.colors === null ? '' : args.colors[line_id - 1])\n          .attr('clip-path', 'url(#mg-plot-window-' + mg_target_ref(args.target) + ')');\n      }\n    } else if (!areas.empty()) {\n      areas.remove();\n    }\n  }\n\n  function mg_default_color_for_path(this_path, line_id) {\n    this_path.classed('mg-line' + (line_id) + '-color', true);\n  }\n\n  function mg_color_line(args, this_path, which_line, line_id) {\n    if (args.colors) {\n      // for now, if args.colors is not an array, then keep moving as if nothing happened.\n      // if args.colors is not long enough, default to the usual line_id color.\n      if (args.colors.constructor === Array) {\n        this_path.attr('stroke', args.colors[which_line]);\n        if (args.colors.length < which_line + 1) {\n          // Go with default coloring.\n          // this_path.classed('mg-line' + (line_id) + '-color', true);\n          mg_default_color_for_path(this_path, line_id);\n        }\n      } else {\n        // this_path.classed('mg-line' + (line_id) + '-color', true);\n        mg_default_color_for_path(this_path, line_id);\n      }\n    } else {\n      // this is the typical workflow\n      // this_path.classed('mg-line' + (line_id) + '-color', true);\n      mg_default_color_for_path(this_path, line_id);\n    }\n  }\n\n  function mg_add_line_element(args, plot, this_path, which_line) {\n    if (args.animate_on_load) {\n      plot.data_median = d3.median(args.data[which_line], function(d) {\n        return d[args.y_accessor]; });\n      this_path.attr('d', plot.flat_line(args.data[which_line]))\n        .transition()\n        .duration(1000)\n        .attr('d', plot.line(args.data[which_line]))\n        .attr('clip-path', 'url(#mg-plot-window-' + mg_target_ref(args.target) + ')');\n    } else { // or just add the line\n      this_path.attr('d', plot.line(args.data[which_line]))\n        .attr('clip-path', 'url(#mg-plot-window-' + mg_target_ref(args.target) + ')');\n    }\n  }\n\n  function mg_add_line(args, plot, svg, existing_line, which_line, line_id) {\n    if (!existing_line.empty()) {\n      svg.node().appendChild(existing_line.node());\n\n      var lineTransition = existing_line.transition()\n        .duration(plot.update_transition_duration);\n\n      if (!plot.display_area && args.transition_on_update && !args.missing_is_hidden) {\n        lineTransition.attrTween('d', path_tween(plot.line(args.data[which_line]), 4));\n      } else {\n        lineTransition.attr('d', plot.line(args.data[which_line]));\n      }\n    } else { // otherwise...\n      // if we're animating on load, animate the line from its median value\n      var this_path = svg.append('path')\n        .attr('class', 'mg-main-line mg-line' + line_id);\n\n      mg_color_line(args, this_path, which_line, line_id);\n      mg_add_line_element(args, plot, this_path, which_line);\n    }\n  }\n\n  function mg_add_legend_element(args, plot, which_line, line_id) {\n    var this_legend;\n    if (args.legend) {\n      if (is_array(args.legend)) {\n        this_legend = args.legend[which_line];\n      } else if (is_function(args.legend)) {\n        this_legend = args.legend(args.data[which_line]);\n      }\n\n      if (args.legend_target) {\n        if (args.colors && args.colors.constructor === Array) {\n          plot.legend_text = \"<span style='color:\" + args.colors[which_line] + \"'>&mdash; \" +\n            this_legend + '&nbsp; </span>' + plot.legend_text;\n        } else {\n          plot.legend_text = \"<span class='mg-line\" + line_id + \"-legend-color'>&mdash; \" +\n            this_legend + '&nbsp; </span>' + plot.legend_text;\n        }\n      } else {\n        var anchor_point, anchor_orientation, dx;\n        if (args.y_axis_position === 'left') {\n          anchor_point = args.data[which_line][args.data[which_line].length - 1];\n          anchor_orientation = 'start';\n          dx = args.buffer;\n        } else {\n          anchor_point = args.data[which_line][0];\n          anchor_orientation = 'end';\n          dx = -args.buffer;\n        }\n        var legend_text = plot.legend_group.append('svg:text')\n          .attr('x', args.scalefns.xf(anchor_point))\n          .attr('dx', dx)\n          .attr('y', args.scalefns.yf(anchor_point))\n          .attr('dy', '.35em')\n          .attr('font-size', 10)\n          .attr('text-anchor', anchor_orientation)\n          .attr('font-weight', '300')\n          .text(this_legend);\n\n        if (args.colors && args.colors.constructor === Array) {\n          if (args.colors.length < which_line + 1) {\n            legend_text.classed('mg-line' + (line_id) + '-legend-color', true);\n          } else {\n            legend_text.attr('fill', args.colors[which_line]);\n          }\n        } else {\n          legend_text.classed('mg-line' + (line_id) + '-legend-color', true);\n        }\n\n        mg_prevent_vertical_overlap(plot.legend_group.selectAll('.mg-line-legend text').nodes(), args);\n      }\n    }\n  }\n\n  function mg_plot_legend_if_legend_target(target, legend) {\n    if (target) {\n      d3.select(target).html(legend);\n    }\n  }\n\n  function mg_add_legend_group(args, plot, svg) {\n    if (args.legend) plot.legend_group = mg_add_g(svg, 'mg-line-legend');\n  }\n\n  function mg_remove_existing_line_rollover_elements(svg) {\n    // remove the old rollovers if they already exist\n    mg_selectAll_and_remove(svg, '.mg-rollover-rect');\n    mg_selectAll_and_remove(svg, '.mg-voronoi');\n\n    // remove the old rollover text and circle if they already exist\n    mg_selectAll_and_remove(svg, '.mg-active-datapoint');\n    mg_selectAll_and_remove(svg, '.mg-line-rollover-circle');\n    //mg_selectAll_and_remove(svg, '.mg-active-datapoint-container');\n  }\n\n  function mg_add_rollover_circle(args, svg) {\n    // append circle\n    var circle = svg.selectAll('.mg-line-rollover-circle')\n      .data(args.data)\n      .enter().append('circle')\n      .attr('cx', 0)\n      .attr('cy', 0)\n      .attr('r', 0);\n\n    if (args.colors && args.colors.constructor === Array) {\n      circle\n        .attr('class', function(d) {\n          return 'mg-line' + d.line_id;\n        })\n        .attr('fill', function(d, i) {\n          return args.colors[i];\n        })\n        .attr('stroke', function(d, i) {\n          return args.colors[i];\n        });\n    } else {\n      circle.attr('class', function(d, i) {\n        return [\n          'mg-line' + d.line_id,\n          'mg-line' + d.line_id + '-color',\n          'mg-area' + d.line_id + '-color'\n        ].join(' ');\n      });\n    }\n    circle.classed('mg-line-rollover-circle', true);\n  }\n\n  function mg_set_unique_line_id_for_each_series(args) {\n    // update our data by setting a unique line id for each series\n    // increment from 1... unless we have a custom increment series\n    var line_id = 1;\n    for (var i = 0; i < args.data.length; i++) {\n      for (var j = 0; j < args.data[i].length; j++) {\n        // if custom line-color map is set, use that instead of line_id\n        if (args.custom_line_color_map.length > 0) {\n          args.data[i][j].line_id = args.custom_line_color_map[i];\n        } else {\n          args.data[i][j].line_id = line_id;\n        }\n      }\n      line_id++;\n    }\n  }\n\n  function mg_nest_data_for_voronoi(args) {\n    return d3.merge(args.data);\n  }\n\n  function mg_line_class_string(args) {\n    return function(d) {\n      var class_string;\n\n      if (args.linked) {\n        var v = d[args.x_accessor];\n        var formatter = MG.time_format(args.utc_time, args.linked_format);\n\n        // only format when x-axis is date\n        var id = (typeof v === 'number') ? (d.line_id - 1) : formatter(v);\n        class_string = 'roll_' + id + ' mg-line' + d.line_id;\n\n        if (args.color === null) {\n          class_string += ' mg-line' + d.line_id + '-color';\n        }\n        return class_string;\n\n      } else {\n        class_string = 'mg-line' + d.line_id;\n        if (args.color === null) class_string += ' mg-line' + d.line_id + '-color';\n        return class_string;\n      }\n    };\n  }\n\n  function mg_add_voronoi_rollover(args, svg, rollover_on, rollover_off, rollover_move) {\n    var voronoi = d3.voronoi()\n      .x(function(d) {\n        return args.scales.X(d[args.x_accessor]).toFixed(2); })\n      .y(function(d) {\n        return args.scales.Y(d[args.y_accessor]).toFixed(2); })\n      .extent([\n        [args.buffer, args.buffer + args.title_y_position],\n        [args.width - args.buffer, args.height - args.buffer]\n      ]);\n\n    var g = mg_add_g(svg, 'mg-voronoi');\n    g.selectAll('path')\n      .data(voronoi.polygons(mg_nest_data_for_voronoi(args)))\n      .enter()\n      .append('path')\n      .filter(function(d) {\n        return d !== undefined && d.length > 0; })\n      .attr('d', function(d) {\n        return d == null ? null : 'M' + d.join('L') + 'Z'; })\n      .datum(function(d) {\n        return d == null ? null : d.data; }) // because of d3.voronoi, reassign d\n      .attr('class', mg_line_class_string(args))\n      .on('mouseover', rollover_on)\n      .on('mouseout', rollover_off)\n      .on('mousemove', rollover_move);\n\n    mg_configure_voronoi_rollover(args, svg);\n  }\n\n  function nest_data_for_aggregate_rollover(args) {\n    var data_nested = d3.nest()\n      .key(function(d) {\n        return d[args.x_accessor]; })\n      .entries(d3.merge(args.data));\n    data_nested.forEach(function(entry) {\n      var datum = entry.values[0];\n      entry.key = datum[args.x_accessor];\n    });\n\n    if (args.x_sort) {\n      return data_nested.sort(function(a, b) {\n        return new Date(a.key) - new Date(b.key); });\n    } else {\n      return data_nested;\n    }\n  }\n\n  function mg_add_aggregate_rollover(args, svg, rollover_on, rollover_off, rollover_move) {\n    // Undo the keys getting coerced to strings, by setting the keys from the values\n    // This is necessary for when we have X axis keys that are things like\n    var data_nested = nest_data_for_aggregate_rollover(args);\n\n    var xf = data_nested.map(function(di) {\n      return args.scales.X(di.key);\n    });\n\n    var g = svg.append('g')\n      .attr('class', 'mg-rollover-rect');\n\n    g.selectAll('.mg-rollover-rects')\n      .data(data_nested).enter()\n      .append('rect')\n      .attr('x', function(d, i) {\n        if (xf.length === 1) return mg_get_plot_left(args);\n        else if (i === 0) return xf[i].toFixed(2);\n        else return ((xf[i - 1] + xf[i]) / 2).toFixed(2);\n      })\n      .attr('y', args.top)\n      .attr('width', function(d, i) {\n        if (xf.length === 1) return mg_get_plot_right(args);\n        else if (i === 0) return ((xf[i + 1] - xf[i]) / 2).toFixed(2);\n        else if (i === xf.length - 1) return ((xf[i] - xf[i - 1]) / 2).toFixed(2);\n        else return ((xf[i + 1] - xf[i - 1]) / 2).toFixed(2);\n      })\n      .attr('class', function(d) {\n        var line_classes = d.values.map(function(datum) {\n          var lc = mg_line_class(datum.line_id);\n          if (args.colors === null) lc += ' ' + mg_line_color_class(datum.line_id);\n          return lc;\n        }).join(' ');\n        if (args.linked && d.values.length > 0) {\n          line_classes += ' ' + mg_rollover_id_class(mg_rollover_format_id(d.values[0], 0, args));\n        }\n\n        return line_classes;\n      })\n      .attr('height', args.height - args.bottom - args.top - args.buffer)\n      .attr('opacity', 0)\n      .on('mouseover', rollover_on)\n      .on('mouseout', rollover_off)\n      .on('mousemove', rollover_move);\n\n    mg_configure_aggregate_rollover(args, svg);\n  }\n\n  function mg_configure_singleton_rollover(args, svg) {\n    svg.select('.mg-rollover-rect rect')\n      .on('mouseover')(args.data[0][0], 0);\n  }\n\n  function mg_configure_voronoi_rollover(args, svg) {\n    for (var i = 0; i < args.data.length; i++) {\n      var j = i + 1;\n\n      if (args.custom_line_color_map.length > 0 &&\n        args.custom_line_color_map[i] !== undefined) {\n        j = args.custom_line_color_map[i];\n      }\n\n      if (args.data[i].length === 1 && !svg.selectAll('.mg-voronoi .mg-line' + j).empty()) {\n        svg.selectAll('.mg-voronoi .mg-line' + j)\n          .on('mouseover')(args.data[i][0], 0);\n\n        svg.selectAll('.mg-voronoi .mg-line' + j)\n          .on('mouseout')(args.data[i][0], 0);\n      }\n    }\n  }\n\n  function mg_line_class(line_id) {\n    return 'mg-line' + line_id;\n  }\n\n  function mg_line_color_class(line_id) {\n    return 'mg-line' + line_id + '-color';\n  }\n\n  function mg_rollover_id_class(id) {\n    return 'roll_' + id;\n  }\n\n  function mg_rollover_format_id(d, i, args) {\n    var v = d[args.x_accessor];\n    var formatter = MG.time_format(args.utc_time, args.linked_format);\n    // only format when x-axis is date\n    var id = (typeof v === 'number') ? i : formatter(v);\n    return id;\n  }\n\n  function mg_add_single_line_rollover(args, svg, rollover_on, rollover_off, rollover_move) {\n    // set to 1 unless we have a custom increment series\n    var line_id = 1;\n    if (args.custom_line_color_map.length > 0) {\n      line_id = args.custom_line_color_map[0];\n    }\n\n    var g = svg.append('g')\n      .attr('class', 'mg-rollover-rect');\n\n    var xf = args.data[0].map(args.scalefns.xf);\n\n    g.selectAll('.mg-rollover-rects')\n      .data(args.data[0]).enter()\n      .append('rect')\n      .attr('class', function(d, i) {\n        var cl = mg_line_color_class(line_id) + ' ' + mg_line_class(d.line_id);\n        if (args.linked) cl += cl + ' ' + mg_rollover_id_class(mg_rollover_format_id(d, i, args));\n        return cl;\n      })\n      .attr('x', function(d, i) {\n        // if data set is of length 1\n        if (xf.length === 1) return mg_get_plot_left(args);\n        else if (i === 0) return xf[i].toFixed(2);\n        else return ((xf[i - 1] + xf[i]) / 2).toFixed(2);\n      })\n      .attr('y', function(d, i) {\n        return (args.data.length > 1) ? args.scalefns.yf(d) - 6 // multi-line chart sensitivity\n          : args.top;\n      })\n      .attr('width', function(d, i) {\n        // if data set is of length 1\n        if (xf.length === 1) return mg_get_plot_right(args);\n        else if (i === 0) return ((xf[i + 1] - xf[i]) / 2).toFixed(2);\n        else if (i === xf.length - 1) return ((xf[i] - xf[i - 1]) / 2).toFixed(2);\n        else return ((xf[i + 1] - xf[i - 1]) / 2).toFixed(2);\n      })\n      .attr('height', function(d, i) {\n        return (args.data.length > 1) ? 12 // multi-line chart sensitivity\n          : args.height - args.bottom - args.top - args.buffer;\n      })\n      .attr('opacity', 0)\n      .on('mouseover', rollover_on)\n      .on('mouseout', rollover_off)\n      .on('mousemove', rollover_move);\n\n    if (mg_is_singleton(args)) {\n      mg_configure_singleton_rollover(args, svg);\n    }\n  }\n\n  function mg_configure_aggregate_rollover(args, svg) {\n    var rect = svg.selectAll('.mg-rollover-rect rect');\n    var rect_first = rect.nodes()[0][0] || rect.nodes()[0];\n    if (args.data.filter(function(d) { return d.length === 1; }).length > 0) {\n      rect.on('mouseover')(rect_first.__data__, 0);\n    }\n  }\n\n  function mg_is_standard_multiline(args) {\n    return args.data.length > 1 && !args.aggregate_rollover;\n  }\n\n  function mg_is_aggregated_rollover(args) {\n    return args.data.length > 1 && args.aggregate_rollover;\n  }\n\n  function mg_is_singleton(args) {\n    return args.data.length === 1 && args.data[0].length === 1;\n  }\n\n  function mg_draw_all_line_elements(args, plot, svg) {\n    mg_remove_dangling_bands(plot, svg);\n\n    for (var i = args.data.length - 1; i >= 0; i--) {\n      var this_data = args.data[i];\n\n      // passing the data for the current line\n      MG.call_hook('line.before_each_series', [this_data, args]);\n\n      // override increment if we have a custom increment series\n      var line_id = i + 1;\n      if (args.custom_line_color_map.length > 0) {\n        line_id = args.custom_line_color_map[i];\n      }\n\n      args.data[i].line_id = line_id;\n\n      if (this_data.length === 0) {\n        continue;\n      }\n      var existing_line = svg.select('path.mg-main-line.mg-line' + (line_id));\n\n      mg_add_confidence_band(args, plot, svg, line_id);\n      mg_add_area(args, plot, svg, i, line_id);\n      mg_add_line(args, plot, svg, existing_line, i, line_id);\n      mg_add_legend_element(args, plot, i, line_id);\n\n      // passing the data for the current line\n      MG.call_hook('line.after_each_series', [this_data, existing_line, args]);\n    }\n  }\n\n  function mg_remove_dangling_bands(plot, svg) {\n    if (plot.existing_band[0] && plot.existing_band[0].length > svg.selectAll('.mg-main-line').node().length) {\n      svg.selectAll('.mg-confidence-band').remove();\n    }\n  }\n\n  function mg_line_main_plot(args) {\n    var plot = {};\n    var svg = mg_get_svg_child_of(args.target);\n\n    // remove any old legends if they exist\n    mg_selectAll_and_remove(svg, '.mg-line-legend');\n    mg_add_legend_group(args, plot, svg);\n\n    plot.data_median = 0;\n    plot.update_transition_duration = (args.transition_on_update) ? 1000 : 0;\n    plot.display_area = args.area && !args.use_data_y_min && args.data.length <= 1 && args.aggregate_rollover === false;\n    plot.legend_text = '';\n    mg_line_graph_generators(args, plot, svg);\n    plot.existing_band = svg.selectAll('.mg-confidence-band').nodes();\n\n    // should we continue with the default line render? A `line.all_series` hook should return false to prevent the default.\n    var continueWithDefault = MG.call_hook('line.before_all_series', [args]);\n    if (continueWithDefault !== false) {\n      mg_draw_all_line_elements(args, plot, svg);\n    }\n\n    mg_plot_legend_if_legend_target(args.legend_target, plot.legend_text);\n  }\n\n  function mg_line_rollover_setup(args, graph) {\n    var svg = mg_get_svg_child_of(args.target);\n\n    if (svg.selectAll('.mg-active-datapoint-container').nodes().length === 0) {\n      mg_add_g(svg, 'mg-active-datapoint-container');\n    }\n\n    mg_remove_existing_line_rollover_elements(svg);\n    mg_add_rollover_circle(args, svg);\n    mg_set_unique_line_id_for_each_series(args);\n\n    if (mg_is_standard_multiline(args)) {\n      mg_add_voronoi_rollover(args, svg, graph.rolloverOn(args), graph.rolloverOff(args), graph.rolloverMove(args));\n    } else if (mg_is_aggregated_rollover(args)) {\n      mg_add_aggregate_rollover(args, svg, graph.rolloverOn(args), graph.rolloverOff(args), graph.rolloverMove(args));\n    } else {\n      mg_add_single_line_rollover(args, svg, graph.rolloverOn(args), graph.rolloverOff(args), graph.rolloverMove(args));\n    }\n  }\n\n  function mg_update_rollover_circle(args, svg, d) {\n    if (args.aggregate_rollover && args.data.length > 1) {\n      // hide the circles in case a non-contiguous series is present\n      svg.selectAll('circle.mg-line-rollover-circle')\n        .style('opacity', 0);\n\n      d.values.forEach(function(datum) {\n        if (mg_data_in_plot_bounds(datum, args)) mg_update_aggregate_rollover_circle(args, svg, datum);\n      });\n    } else if ((args.missing_is_hidden && d['_missing']) || d[args.y_accessor] === null) {\n      // disable rollovers for hidden parts of the line\n      // recall that hidden parts are missing data ranges and possibly also\n      // data points that have been explicitly identified as missing\n      return;\n    } else {\n      // show circle on mouse-overed rect\n      if (mg_data_in_plot_bounds(d, args)) {\n        mg_update_generic_rollover_circle(args, svg, d);\n      }\n    }\n  }\n\n  function mg_update_aggregate_rollover_circle(args, svg, datum) {\n    svg.select('circle.mg-line-rollover-circle.mg-line' + datum.line_id)\n      .attr('cx', args.scales.X(datum[args.x_accessor]).toFixed(2))\n      .attr('cy', args.scales.Y(datum[args.y_accessor]).toFixed(2))\n      .attr('r', args.point_size)\n      .style('opacity', 1);\n  }\n\n  function mg_update_generic_rollover_circle(args, svg, d) {\n    svg.selectAll('circle.mg-line-rollover-circle.mg-line' + d.line_id)\n      .classed('mg-line-rollover-circle', true)\n      .attr('cx', function() {\n        return args.scales.X(d[args.x_accessor]).toFixed(2);\n      })\n      .attr('cy', function() {\n        return args.scales.Y(d[args.y_accessor]).toFixed(2);\n      })\n      .attr('r', args.point_size)\n      .style('opacity', 1);\n  }\n\n  function mg_trigger_linked_mouseovers(args, d, i) {\n    if (args.linked && !MG.globals.link) {\n      MG.globals.link = true;\n      if (!args.aggregate_rollover || d.value !== undefined || d.values.length > 0) {\n        var datum = d.values ? d.values[0] : d;\n        var id = mg_rollover_format_id(datum, i, args);\n        // trigger mouseover on matching line in .linked charts\n        d3.selectAll('.' + mg_line_class(datum.line_id) + '.' + mg_rollover_id_class(id))\n          .each(function(d) {\n            d3.select(this)\n              .on('mouseover')(d, i);\n          });\n      }\n    }\n  }\n\n  function mg_trigger_linked_mouseouts(args, d, i) {\n    if (args.linked && MG.globals.link) {\n      MG.globals.link = false;\n\n      var formatter = MG.time_format(args.utc_time, args.linked_format);\n      var datums = d.values ? d.values : [d];\n      datums.forEach(function(datum) {\n        var v = datum[args.x_accessor];\n        var id = (typeof v === 'number') ? i : formatter(v);\n\n        // trigger mouseout on matching line in .linked charts\n        d3.selectAll('.roll_' + id)\n          .each(function(d) {\n            d3.select(this)\n              .on('mouseout')(d);\n          });\n      });\n    }\n  }\n\n  function mg_remove_active_data_points_for_aggregate_rollover(args, svg) {\n    svg.selectAll('circle.mg-line-rollover-circle').filter(function(circle) {\n        return circle.length > 1;\n      })\n      .style('opacity', 0);\n  }\n\n  function mg_remove_active_data_points_for_generic_rollover(args, svg, d) {\n    svg.selectAll('circle.mg-line-rollover-circle.mg-line' + d.line_id)\n      .style('opacity', function() {\n        var id = d.line_id - 1;\n\n        if (args.custom_line_color_map.length > 0 &&\n          args.custom_line_color_map.indexOf(d.line_id) !== undefined\n        ) {\n          id = args.custom_line_color_map.indexOf(d.line_id);\n        }\n\n        if (args.data[id].length === 1) {\n          return 1;\n        } else {\n          return 0;\n        }\n      });\n  }\n\n  function mg_remove_active_text(svg) {\n    svg.select('.mg-active-datapoint').text('');\n  }\n\n  function lineChart(args) {\n    this.init = function(args) {\n      this.args = args;\n\n      if (!args.data || args.data.length === 0) {\n        args.internal_error = 'No data was supplied';\n        internal_error(args);\n        return this;\n      } else {\n        args.internal_error = undefined;\n      }\n\n      raw_data_transformation(args);\n      process_line(args);\n\n      MG.call_hook('line.before_destroy', this);\n\n      init(args);\n\n      // TODO incorporate markers into calculation of x scales\n      new MG.scale_factory(args)\n        .namespace('x')\n        .numericalDomainFromData()\n        .numericalRange('bottom')\n\n      var baselines = (args.baselines || []).map(function(d) {\n        return d[args.y_accessor];\n      });\n\n      new MG.scale_factory(args)\n        .namespace('y')\n        .zeroBottom(true)\n        .inflateDomain(true)\n        .numericalDomainFromData(baselines)\n        .numericalRange('left');\n\n      var svg = mg_get_svg_child_of(args.target);\n\n      if (args.x_axis) {\n        new MG.axis_factory(args)\n          .namespace('x')\n          .type('numerical')\n          .position(args.x_axis_position)\n          .rug(x_rug(args))\n          .label(mg_add_x_label)\n          .draw();\n      }\n\n      if (args.y_axis) {\n        new MG.axis_factory(args)\n          .namespace('y')\n          .type('numerical')\n          .position(args.y_axis_position)\n          .rug(y_rug(args))\n          .label(mg_add_y_label)\n          .draw();\n      }\n\n      this.markers();\n      this.mainPlot();\n      this.rollover();\n      this.windowListeners();\n\n      MG.call_hook('line.after_init', this);\n\n      return this;\n    };\n\n    this.mainPlot = function() {\n      mg_line_main_plot(args);\n      return this;\n    };\n\n    this.markers = function() {\n      markers(args);\n      return this;\n    };\n\n    this.rollover = function() {\n      var that = this;\n      mg_line_rollover_setup(args, that);\n      MG.call_hook('line.after_rollover', args);\n\n      return this;\n    };\n\n    this.rolloverOn = function(args) {\n      var svg = mg_get_svg_child_of(args.target);\n      var fmt = mg_get_rollover_time_format(args);\n\n      return function(d, i) {\n        mg_update_rollover_circle(args, svg, d);\n        mg_trigger_linked_mouseovers(args, d, i);\n\n        svg.selectAll('text')\n          .filter(function(g, j) {\n            return d === g;\n          })\n          .attr('opacity', 0.3);\n\n        // update rollover text except for missing data points\n        if (args.show_rollover_text &&\n            !((args.missing_is_hidden && d['_missing']) || d[args.y_accessor] === null)\n          ) {\n          var mouseover = mg_mouseover_text(args, { svg: svg });\n          var row = mouseover.mouseover_row();\n          if (args.aggregate_rollover) {\n            row.text((args.aggregate_rollover && args.data.length > 1\n              ? mg_format_x_aggregate_mouseover\n              : mg_format_x_mouseover)(args, d));\n          }\n\n          var pts = args.aggregate_rollover && args.data.length > 1\n            ? d.values\n            : [d];\n\n          pts.forEach(function(di) {\n            if (args.aggregate_rollover) {\n              row = mouseover.mouseover_row();\n            }\n\n            if (args.legend) {\n              mg_line_color_text(row.text(args.legend[di.line_id - 1] + '  ').bold().elem(), di, args);\n            }\n\n            mg_line_color_text(row.text('\\u2014  ').elem(), di, args);\n            if (!args.aggregate_rollover) {\n              row.text(mg_format_x_mouseover(args, di));\n            }\n\n            row.text(mg_format_y_mouseover(args, di, args.time_series === false));\n          })\n        }\n\n        if (args.mouseover) {\n          args.mouseover(d, i);\n        }\n      };\n    };\n\n    this.rolloverOff = function(args) {\n      var svg = mg_get_svg_child_of(args.target);\n\n      return function(d, i) {\n        mg_trigger_linked_mouseouts(args, d, i);\n        if (args.aggregate_rollover) {\n          mg_remove_active_data_points_for_aggregate_rollover(args, svg);\n        } else {\n          mg_remove_active_data_points_for_generic_rollover(args, svg, d);\n        }\n\n        if (args.data[0].length > 1) {\n          mg_clear_mouseover_container(svg);\n        }\n\n        if (args.mouseout) {\n          args.mouseout(d, i);\n        }\n      };\n    };\n\n    this.rolloverMove = function(args) {\n      return function(d, i) {\n        if (args.mousemove) {\n          args.mousemove(d, i);\n        }\n      };\n    };\n\n    this.windowListeners = function() {\n      mg_window_listeners(this.args);\n      return this;\n    };\n\n    this.init(args);\n  }\n\n  MG.register('line', lineChart);\n}).call(this);\n\n(function() {\n  'use strict';\n\n  function histogram(args) {\n    this.init = function(args) {\n      this.args = args;\n\n      raw_data_transformation(args);\n      process_histogram(args);\n      init(args);\n\n      new MG.scale_factory(args)\n        .namespace('x')\n        .numericalDomainFromData()\n        .numericalRange('bottom');\n\n      var baselines = (args.baselines || []).map(function(d) {\n        return d[args.y_accessor]\n      });\n\n      new MG.scale_factory(args)\n        .namespace('y')\n        .zeroBottom(true)\n        .inflateDomain(true)\n        .numericalDomainFromData(baselines)\n        .numericalRange('left');\n\n      x_axis(args);\n      y_axis(args);\n\n      this.mainPlot();\n      this.markers();\n      this.rollover();\n      this.windowListeners();\n\n      return this;\n    };\n\n    this.mainPlot = function() {\n      var svg = mg_get_svg_child_of(args.target);\n\n      //remove the old histogram, add new one\n      svg.selectAll('.mg-histogram').remove();\n\n      var g = svg.append('g')\n        .attr('class', 'mg-histogram');\n\n      var bar = g.selectAll('.mg-bar')\n        .data(args.data[0])\n        .enter().append('g')\n        .attr('class', 'mg-bar')\n        .attr('transform', function(d) {\n          return \"translate(\" + args.scales.X(d[args.x_accessor]).toFixed(2) + \",\" + args.scales.Y(d[args.y_accessor]).toFixed(2) + \")\";\n        });\n\n      //draw bars\n      bar.append('rect')\n        .attr('x', 1)\n        .attr('width', function(d, i) {\n          if (args.data[0].length === 1) {\n            return (args.scalefns.xf(args.data[0][0]) - args.bar_margin).toFixed(0);\n          } else if (i !== args.data[0].length - 1) {\n            return (args.scalefns.xf(args.data[0][i + 1]) - args.scalefns.xf(d)).toFixed(0);\n          } else {\n            return (args.scalefns.xf(args.data[0][1]) - args.scalefns.xf(args.data[0][0])).toFixed(0);\n          }\n        })\n        .attr('height', function(d) {\n          if (d[args.y_accessor] === 0) {\n            return 0;\n          }\n\n          return (args.height - args.bottom - args.buffer - args.scales.Y(d[args.y_accessor])).toFixed(2);\n        });\n\n      return this;\n    };\n\n    this.markers = function() {\n      markers(args);\n      return this;\n    };\n\n    this.rollover = function() {\n      var svg = mg_get_svg_child_of(args.target);\n\n      if (svg.selectAll('.mg-active-datapoint-container').nodes().length === 0) {\n        mg_add_g(svg, 'mg-active-datapoint-container');\n      }\n\n      //remove the old rollovers if they already exist\n      svg.selectAll('.mg-rollover-rect').remove();\n      svg.selectAll('.mg-active-datapoint').remove();\n\n      var g = svg.append('g')\n        .attr('class', 'mg-rollover-rect');\n\n      //draw rollover bars\n      var bar = g.selectAll('.mg-bar')\n        .data(args.data[0])\n        .enter().append('g')\n        .attr('class', function(d, i) {\n          if (args.linked) {\n            return 'mg-rollover-rects roll_' + i;\n          } else {\n            return 'mg-rollover-rects';\n          }\n        })\n        .attr('transform', function(d) {\n          return \"translate(\" + (args.scales.X(d[args.x_accessor])) + \",\" + 0 + \")\";\n        });\n\n      bar.append('rect')\n        .attr('x', 1)\n        .attr('y', args.buffer + args.title_y_position)\n        .attr('width', function(d, i) {\n          //if data set is of length 1\n          if (args.data[0].length === 1) {\n            return (args.scalefns.xf(args.data[0][0]) - args.bar_margin).toFixed(0);\n          } else if (i !== args.data[0].length - 1) {\n            return (args.scalefns.xf(args.data[0][i + 1]) - args.scalefns.xf(d)).toFixed(0);\n          } else {\n            return (args.scalefns.xf(args.data[0][1]) - args.scalefns.xf(args.data[0][0])).toFixed(0);\n          }\n        })\n        .attr('height', function(d) {\n          return args.height;\n        })\n        .attr('opacity', 0)\n        .on('mouseover', this.rolloverOn(args))\n        .on('mouseout', this.rolloverOff(args))\n        .on('mousemove', this.rolloverMove(args));\n\n      return this;\n    };\n\n    this.rolloverOn = function(args) {\n      var svg = mg_get_svg_child_of(args.target);\n\n      return function(d, i) {\n        svg.selectAll('text')\n          .filter(function(g, j) {\n            return d === g;\n          })\n          .attr('opacity', 0.3);\n\n        var fmt = args.processed.xax_format || MG.time_format(args.utc_time, '%b %e, %Y');\n        var num = format_rollover_number(args);\n\n        svg.selectAll('.mg-bar rect')\n          .filter(function(d, j) {\n            return j === i;\n          })\n          .classed('active', true);\n\n        //trigger mouseover on all matching bars\n        if (args.linked && !MG.globals.link) {\n          MG.globals.link = true;\n\n          //trigger mouseover on matching bars in .linked charts\n          d3.selectAll('.mg-rollover-rects.roll_' + i + ' rect')\n            .each(function(d) { //use existing i\n              d3.select(this).on('mouseover')(d, i);\n            });\n        }\n\n        //update rollover text\n        if (args.show_rollover_text) {\n          var mo = mg_mouseover_text(args, { svg: svg });\n          var row = mo.mouseover_row();\n          row.text('\\u259F  ').elem()\n            .classed('hist-symbol', true);\n\n          row.text(mg_format_x_mouseover(args, d)); // x\n          row.text(mg_format_y_mouseover(args, d, args.time_series === false));\n        }\n\n        if (args.mouseover) {\n          mg_setup_mouseover_container(svg, args);\n          args.mouseover(d, i);\n        }\n      };\n    };\n\n    this.rolloverOff = function(args) {\n      var svg = mg_get_svg_child_of(args.target);\n\n      return function(d, i) {\n        if (args.linked && MG.globals.link) {\n          MG.globals.link = false;\n\n          //trigger mouseout on matching bars in .linked charts\n          d3.selectAll('.mg-rollover-rects.roll_' + i + ' rect')\n            .each(function(d) { //use existing i\n              d3.select(this).on('mouseout')(d, i);\n            });\n        }\n\n        //reset active bar\n        svg.selectAll('.mg-bar rect')\n          .classed('active', false);\n\n        //reset active data point text\n        mg_clear_mouseover_container(svg);\n\n        if (args.mouseout) {\n          args.mouseout(d, i);\n        }\n      };\n    };\n\n    this.rolloverMove = function(args) {\n      return function(d, i) {\n        if (args.mousemove) {\n          args.mousemove(d, i);\n        }\n      };\n    };\n\n    this.windowListeners = function() {\n      mg_window_listeners(this.args);\n      return this;\n    };\n\n    this.init(args);\n  }\n\n  var defaults = {\n    binned: false,\n    bins: null,\n    processed_x_accessor: 'x',\n    processed_y_accessor: 'y',\n    processed_dx_accessor: 'dx',\n    bar_margin: 1\n  };\n\n  MG.register('histogram', histogram, defaults);\n}).call(this);\n\nfunction point_mouseover(args, svg, d) {\n  var mouseover = mg_mouseover_text(args, { svg: svg });\n  var row = mouseover.mouseover_row();\n\n  if (args.color_accessor !== null && args.color_type === 'category') {\n    var label = d[args.color_accessor];\n    row.text(label + '  ').bold().elem().attr('fill', args.scalefns.colorf(d));\n  }\n\n  mg_color_point_mouseover(args, row.text('\\u25CF   ').elem(), d); // point shape\n\n  row.text(mg_format_x_mouseover(args, d)); // x\n  row.text(mg_format_y_mouseover(args, d, args.time_series === false));\n}\n\nfunction mg_color_point_mouseover(args, elem, d) {\n  if (args.color_accessor !== null) {\n    elem.attr('fill', args.scalefns.colorf(d));\n    elem.attr('stroke', args.scalefns.colorf(d));\n  } else {\n    elem.classed('mg-points-mono', true);\n  }\n}\n\n\n(function() {\n  'use strict';\n\n  function mg_filter_out_plot_bounds(data, args) {\n    // max_x, min_x, max_y, min_y;\n    var x = args.x_accessor;\n    var y = args.y_accessor;\n    var new_data = data.filter(function(d) {\n      return (args.min_x === null || d[x] >= args.min_x) &&\n        (args.max_x === null || d[x] <= args.max_x) &&\n        (args.min_y === null || d[y] >= args.min_y) &&\n        (args.max_y === null || d[y] <= args.max_y);\n    })\n    return new_data;\n  }\n\n  function pointChart(args) {\n    this.init = function(args) {\n      this.args = args;\n\n      // infer y_axis and x_axis type;\n      args.x_axis_type = mg_infer_type(args, 'x');\n      args.y_axis_type = mg_infer_type(args, 'y');\n\n      raw_data_transformation(args);\n\n      process_point(args);\n      init(args);\n\n      var xMaker, yMaker;\n\n      if (args.x_axis_type === 'categorical') {\n        xMaker = MG.scale_factory(args)\n          .namespace('x')\n          .categoricalDomainFromData()\n          .categoricalRangeBands([0, args.xgroup_height], args.xgroup_accessor === null);\n\n        if (args.xgroup_accessor) {\n          new MG.scale_factory(args)\n            .namespace('xgroup')\n            .categoricalDomainFromData()\n            .categoricalRangeBands('bottom');\n\n        } else {\n          args.scales.XGROUP = function(d) {\n            return mg_get_plot_left(args) };\n          args.scalefns.xgroupf = function(d) {\n            return mg_get_plot_left(args) };\n        }\n\n        args.scalefns.xoutf = function(d) {\n          return args.scalefns.xf(d) + args.scalefns.xgroupf(d)\n        };\n      } else {\n        xMaker = MG.scale_factory(args)\n          .namespace('x')\n          .inflateDomain(true)\n          .zeroBottom(args.y_axis_type === 'categorical')\n          .numericalDomainFromData((args.baselines || []).map(function(d) {\n            return d[args.x_accessor] }))\n          .numericalRange('bottom');\n\n        args.scalefns.xoutf = args.scalefns.xf;\n      }\n\n      // y-scale generation. This needs to get simplified.\n      if (args.y_axis_type === 'categorical') {\n        yMaker = MG.scale_factory(args)\n          .namespace('y')\n          .zeroBottom(true)\n          .categoricalDomainFromData()\n          .categoricalRangeBands([0, args.ygroup_height], true);\n\n        if (args.ygroup_accessor) {\n\n          new MG.scale_factory(args)\n            .namespace('ygroup')\n            .categoricalDomainFromData()\n            .categoricalRangeBands('left');\n\n        } else {\n          args.scales.YGROUP = function() {\n            return mg_get_plot_top(args) };\n          args.scalefns.ygroupf = function(d) {\n            return mg_get_plot_top(args) };\n\n        }\n        args.scalefns.youtf = function(d) {\n          return args.scalefns.yf(d) + args.scalefns.ygroupf(d) };\n\n      } else {\n        var baselines = (args.baselines || []).map(function(d) {\n          return d[args.y_accessor] });\n        yMaker = MG.scale_factory(args)\n          .namespace('y')\n          .inflateDomain(true)\n          .zeroBottom(args.x_axis_type === 'categorical')\n          .numericalDomainFromData(baselines)\n          .numericalRange('left');\n\n        args.scalefns.youtf = function(d) {\n          return args.scalefns.yf(d) };\n      }\n\n      /////// COLOR accessor\n      if (args.color_accessor !== null) {\n        var colorScale = MG.scale_factory(args).namespace('color');\n        if (args.color_type === 'number') {\n          // do the color scale.\n          // etiher get color range, or what.\n          colorScale\n            .numericalDomainFromData(mg_get_color_domain(args))\n            .numericalRange(mg_get_color_range(args))\n            .clamp(true);\n        } else {\n          if (args.color_domain) {\n            colorScale\n              .categoricalDomain(args.color_domain)\n              .categoricalRange(args.color_range);\n          } else {\n            colorScale\n              .categoricalDomainFromData()\n              .categoricalColorRange();\n          }\n        }\n      }\n\n      if (args.size_accessor) {\n        new MG.scale_factory(args).namespace('size')\n          .numericalDomainFromData()\n          .numericalRange(mg_get_size_range(args))\n          .clamp(true);\n      }\n\n      new MG.axis_factory(args)\n        .namespace('x')\n        .type(args.x_axis_type)\n        .zeroLine(args.y_axis_type === 'categorical')\n        .position(args.x_axis_position)\n        .rug(x_rug(args))\n        .label(mg_add_x_label)\n        .draw();\n\n      new MG.axis_factory(args)\n        .namespace('y')\n        .type(args.y_axis_type)\n        .zeroLine(args.x_axis_type === 'categorical')\n        .position(args.y_axis_position)\n        .rug(y_rug(args))\n        .label(mg_add_y_label)\n        .draw();\n\n      this.mainPlot();\n      this.markers();\n      this.rollover();\n      this.windowListeners();\n\n      return this;\n    };\n\n    this.markers = function() {\n      markers(args);\n      if (args.least_squares) {\n        add_ls(args);\n      }\n\n      return this;\n    };\n\n    this.mainPlot = function() {\n      var svg = mg_get_svg_child_of(args.target);\n      var g;\n\n      var data = mg_filter_out_plot_bounds(args.data[0], args);\n      //remove the old points, add new one\n      svg.selectAll('.mg-points').remove();\n\n      g = svg.append('g')\n        .classed('mg-points', true);\n\n\n      var pts = g.selectAll('circle')\n        .data(data)\n        .enter().append('circle')\n        .attr('class', function(d, i) {\n          return 'path-' + i;\n        })\n        .attr('cx', args.scalefns.xoutf)\n        .attr('cy', function(d) {\n          return args.scalefns.youtf(d);\n        });\n\n      //are we coloring our points, or just using the default color?\n      if (args.color_accessor !== null) {\n        pts.attr('fill', args.scalefns.colorf);\n        pts.attr('stroke', args.scalefns.colorf);\n      } else {\n        pts.classed('mg-points-mono', true);\n      }\n\n      if (args.size_accessor !== null) {\n        pts.attr('r', args.scalefns.sizef);\n      } else {\n        pts.attr('r', args.point_size);\n      }\n\n      return this;\n    };\n\n    this.rollover = function() {\n      var svg = mg_get_svg_child_of(args.target);\n\n      if (svg.selectAll('.mg-active-datapoint-container').nodes().length === 0) {\n        mg_add_g(svg, 'mg-active-datapoint-container');\n      }\n\n      //remove the old rollovers if they already exist\n      svg.selectAll('.mg-voronoi').remove();\n\n      //add rollover paths\n      var voronoi = d3.voronoi()\n        .x(args.scalefns.xoutf)\n        .y(args.scalefns.youtf)\n        .extent([\n          [args.buffer, args.buffer + args.title_y_position],\n          [args.width - args.buffer, args.height - args.buffer]\n        ]);\n\n      var paths = svg.append('g')\n        .attr('class', 'mg-voronoi');\n\n      paths.selectAll('path')\n        .data(voronoi.polygons(mg_filter_out_plot_bounds(args.data[0], args)))\n        .enter().append('path')\n        .attr('d', function(d) {\n          return d == null ? null : 'M' + d.join(',') + 'Z'; })\n        .attr('class', function(d, i) {\n          return 'path-' + i;\n        })\n        .style('fill-opacity', 0)\n        .on('mouseover', this.rolloverOn(args))\n        .on('mouseout', this.rolloverOff(args))\n        .on('mousemove', this.rolloverMove(args));\n\n      if (args.data[0].length === 1) {\n        point_mouseover(args, svg, args.data[0][0]);\n      }\n\n      return this;\n    };\n\n    this.rolloverOn = function(args) {\n      var svg = mg_get_svg_child_of(args.target);\n\n      return function(d, i) {\n        svg.selectAll('.mg-points circle')\n          .classed('selected', false);\n\n        //highlight active point\n        var pts = svg.selectAll('.mg-points circle.path-' + i)\n          .classed('selected', true);\n\n        if (args.size_accessor) {\n          pts.attr('r', function(di) {\n            return args.scalefns.sizef(di) + args.active_point_size_increase;\n          });\n        } else {\n          pts.attr('r', args.point_size + args.active_point_size_increase);\n        }\n\n        //trigger mouseover on all points for this class name in .linked charts\n        if (args.linked && !MG.globals.link) {\n          MG.globals.link = true;\n\n          //trigger mouseover on matching point in .linked charts\n          d3.selectAll('.mg-voronoi .path-' + i)\n            .each(function() {\n              d3.select(this).on('mouseover')(d, i);\n            });\n        }\n\n        if (args.show_rollover_text) {\n          point_mouseover(args, svg, d.data);\n        }\n\n        if (args.mouseover) {\n          args.mouseover(d, i);\n        }\n      };\n    };\n\n    this.rolloverOff = function(args) {\n      var svg = mg_get_svg_child_of(args.target);\n\n      return function(d, i) {\n        if (args.linked && MG.globals.link) {\n          MG.globals.link = false;\n\n          d3.selectAll('.mg-voronoi .path-' + i)\n            .each(function() {\n              d3.select(this).on('mouseout')(d, i);\n            });\n        }\n\n        //reset active point\n        var pts = svg.selectAll('.mg-points circle')\n          .classed('unselected', false)\n          .classed('selected', false);\n\n        if (args.size_accessor) {\n          pts.attr('r', args.scalefns.sizef);\n        } else {\n          pts.attr('r', args.point_size);\n        }\n\n        //reset active data point text\n        if (args.data[0].length > 1) mg_clear_mouseover_container(svg);\n\n        if (args.mouseout) {\n          args.mouseout(d, i);\n        }\n      };\n    };\n\n    this.rolloverMove = function(args) {\n      return function(d, i) {\n        if (args.mousemove) {\n          args.mousemove(d, i);\n        }\n      };\n    };\n\n    this.update = function(args) {\n      return this;\n    };\n\n    this.windowListeners = function() {\n      mg_window_listeners(this.args);\n      return this;\n    };\n\n    this.init(args);\n  }\n\n  var defaults = {\n    y_padding_percentage: 0.05, // for categorical scales\n    y_outer_padding_percentage: .2, // for categorical scales\n    ygroup_padding_percentage: 0, // for categorical scales\n    ygroup_outer_padding_percentage: 0, // for categorical scales\n    x_padding_percentage: 0.05, // for categorical scales\n    x_outer_padding_percentage: .2, // for categorical scales\n    xgroup_padding_percentage: 0, // for categorical scales\n    xgroup_outer_padding_percentage: 0, // for categorical scales\n    y_categorical_show_guides: true,\n    x_categorical_show_guides: true,\n    buffer: 16,\n    ls: false,\n    lowess: false,\n    point_size: 2.5,\n    label_accessor: null,\n    size_accessor: null,\n    color_accessor: null,\n    size_range: null, // when we set a size_accessor option, this array determines the size range, e.g. [1,5]\n    color_range: null, // e.g. ['blue', 'red'] to color different groups of points\n    size_domain: null,\n    color_domain: null,\n    active_point_size_increase: 1,\n    color_type: 'number' // can be either 'number' - the color scale is quantitative - or 'category' - the color scale is qualitative.\n  };\n\n  MG.register('point', pointChart, defaults);\n}).call(this);\n\n(function() {\n  'use strict';\n\n  // TODO add styles to stylesheet instead\n  function scaffold(args) {\n    var svg = mg_get_svg_child_of(args.target);\n    // main margins\n    svg.append('line')\n      .attr('x1', 0)\n      .attr('x2', args.width)\n      .attr('y1', args.top)\n      .attr('y2', args.top)\n      .attr('stroke', 'black');\n    svg.append('line')\n      .attr('x1', 0)\n      .attr('x2', args.width)\n      .attr('y1', args.height-args.bottom)\n      .attr('y2', args.height-args.bottom)\n      .attr('stroke', 'black');\n\n    svg.append('line')\n      .attr('x1', args.left)\n      .attr('x2', args.left)\n      .attr('y1', 0)\n      .attr('y2', args.height)\n      .attr('stroke', 'black');\n\n    svg.append('line')\n      .attr('x1', args.width-args.right)\n      .attr('x2', args.width-args.right)\n      .attr('y1', 0)\n      .attr('y2', args.height)\n      .attr('stroke', 'black');\n\n    // plot area margins\n    svg.append('line')\n      .attr('x1', 0)\n      .attr('x2', args.width)\n      .attr('y1', args.height-args.bottom-args.buffer)\n      .attr('y2', args.height-args.bottom-args.buffer)\n      .attr('stroke', 'gray');\n\n    svg.append('line')\n      .attr('x1', 0)\n      .attr('x2', args.width)\n      .attr('y1', args.top+args.buffer)\n      .attr('y2', args.top+args.buffer)\n      .attr('stroke', 'gray');\n\n    svg.append('line')\n      .attr('x1', args.left + args.buffer)\n      .attr('x2', args.left + args.buffer)\n      .attr('y1', 0)\n      .attr('y2', args.height)\n      .attr('stroke', 'gray');\n    svg.append('line')\n      .attr('x1', args.width -args.right - args.buffer)\n      .attr('x2', args.width -args.right - args.buffer)\n      .attr('y1', 0)\n      .attr('y2', args.height)\n      .attr('stroke', 'gray');\n  }\n\n  // barchart re-write.\n  function mg_targeted_legend(args) {\n    var labels;\n    var plot = '';\n    if (args.legend_target) {\n\n      var div = d3.select(args.legend_target).append('div').classed('mg-bar-target-legend', true);\n      \n      if (args.orientation == 'horizontal') labels = args.scales.Y.domain()\n      else labels = args.scales.X.domain();\n\n      labels.forEach(function(label) {\n        var outer_span = div.append('span').classed('mg-bar-target-element', true);\n        outer_span.append('span')\n          .classed('mg-bar-target-legend-shape', true)\n          .style('color', args.scales.COLOR(label))\n          .text('\\u25FC ');\n        outer_span.append('span')\n          .classed('mg-bar-target-legend-text', true)\n          .text(label);\n\n      });\n    }\n  }\n\n  function legend_on_graph(svg, args) {\n    // draw each element at the top right\n    // get labels\n\n    var labels;\n    if (args.orientation=='horizontal') labels = args.scales.Y.domain()\n    else labels = args.scales.X.domain();\n\n    var lineCount = 0;\n    var lineHeight = 1.1;\n    var g = svg.append('g').classed(\"mg-bar-legend\", true);\n    var textContainer = g.append('text');\n\n    //\n\n    textContainer\n      .selectAll('*')\n      .remove();\n    textContainer\n      .attr('width', args.right)\n      .attr('height', 100)\n      .attr('text-anchor', 'start');\n\n    labels.forEach(function(label) {\n      var sub_container = textContainer.append('tspan')\n        .attr('x', mg_get_plot_right(args))\n        .attr('y', args.height / 2)\n        .attr('dy', (lineCount * lineHeight) + 'em');\n      sub_container.append('tspan')\n        .text('\\u25a0 ')\n        .attr('fill', args.scales.COLOR(label))\n        .attr('font-size', 20)\n      sub_container.append('tspan')\n        .text(label)\n        .attr('font-weight', 300)\n        .attr('font-size', 10);\n      lineCount++;\n    })\n\n    // d.values.forEach(function (datum) {\n    //   formatted_y = mg_format_y_rollover(args, num, datum);\n\n    //   if (args.y_rollover_format !== null) {\n    //     formatted_y = number_rollover_format(args.y_rollover_format, datum, args.y_accessor);\n    //   } else {\n    //     formatted_y = args.yax_units + num(datum[args.y_accessor]);\n    //   }\n\n    //   sub_container = textContainer.append('tspan').attr('x', 0).attr('y', (lineCount * lineHeight) + 'em');\n    //   formatted_y = mg_format_y_rollover(args, num, datum);\n    //   mouseover_tspan(sub_container, '\\u2014  ')\n    //     .color(args, datum);\n    //   mouseover_tspan(sub_container, formatted_x + ' ' + formatted_y);\n\n    //   lineCount++;\n    // });\n  }\n\n  function barChart(args) {\n    this.args = args;\n\n    this.init = function(args) {\n      this.args = args;\n      args.x_axis_type = mg_infer_type(args, 'x');\n      args.y_axis_type = mg_infer_type(args, 'y');\n\n      // this is specific to how rects work in svg, let's keep track of the bar orientation to\n      // plot appropriately.\n      if (args.x_axis_type == 'categorical') {\n        args.orientation = 'vertical';\n      } else if (args.y_axis_type == 'categorical') {\n        args.orientation = 'horizontal';\n      } else if (args.x_axis_type != 'categorical' && args.y_axis_type != 'categorical') {\n        // histogram.\n        args.orientation = 'vertical';\n      }\n\n      raw_data_transformation(args);\n\n      process_point(args);\n      init(args);\n\n      var xMaker, yMaker;\n\n      if (args.x_axis_type === 'categorical') {\n        xMaker = MG.scale_factory(args)\n          .namespace('x')\n          .categoricalDomainFromData()\n          .categoricalRangeBands([0, args.xgroup_height], args.xgroup_accessor === null);\n\n        if (args.xgroup_accessor) {\n          new MG.scale_factory(args)\n            .namespace('xgroup')\n            .categoricalDomainFromData()\n            .categoricalRangeBands('bottom');\n\n        } else {\n          args.scales.XGROUP = function(d) {\n            return mg_get_plot_left(args) };\n          args.scalefns.xgroupf = function(d) {\n            return mg_get_plot_left(args) };\n        }\n\n        args.scalefns.xoutf = function(d) {\n          return args.scalefns.xf(d) + args.scalefns.xgroupf(d)\n        };\n      } else {\n        xMaker = MG.scale_factory(args)\n          .namespace('x')\n          .inflateDomain(true)\n          .zeroBottom(args.y_axis_type === 'categorical')\n          .numericalDomainFromData((args.baselines || []).map(function(d) {\n            return d[args.x_accessor] }))\n          .numericalRange('bottom');\n\n        args.scalefns.xoutf = args.scalefns.xf;\n      }\n\n      // y-scale generation. This needs to get simplified.\n      if (args.y_axis_type === 'categorical') {\n        yMaker = MG.scale_factory(args)\n          .namespace('y')\n          .zeroBottom(true)\n          .categoricalDomainFromData()\n          .categoricalRangeBands([0, args.ygroup_height], true);\n\n        if (args.ygroup_accessor) {\n\n          new MG.scale_factory(args)\n            .namespace('ygroup')\n            .categoricalDomainFromData()\n            .categoricalRangeBands('left');\n\n        } else {\n          args.scales.YGROUP = function() {\n            return mg_get_plot_top(args) };\n          args.scalefns.ygroupf = function(d) {\n            return mg_get_plot_top(args) };\n\n        }\n        args.scalefns.youtf = function(d) {\n          return args.scalefns.yf(d) + args.scalefns.ygroupf(d) };\n\n      } else {\n        var baselines = (args.baselines || []).map(function(d) {\n          return d[args.y_accessor] });\n\n        yMaker = MG.scale_factory(args)\n          .namespace('y')\n          .inflateDomain(true)\n          .zeroBottom(args.x_axis_type === 'categorical')\n          .numericalDomainFromData(baselines)\n          .numericalRange('left');\n\n        args.scalefns.youtf = function(d) {\n          return args.scalefns.yf(d) };\n      }\n\n      if (args.ygroup_accessor !== null) {\n        args.ycolor_accessor = args.y_accessor;\n        MG.scale_factory(args)\n          .namespace('ycolor')\n          .scaleName('color')\n          .categoricalDomainFromData()\n          .categoricalColorRange();\n      }\n\n      if (args.xgroup_accessor !== null) {\n        args.xcolor_accessor = args.x_accessor;\n        MG.scale_factory(args)\n          .namespace('xcolor')\n          .scaleName('color')\n          .categoricalDomainFromData()\n          .categoricalColorRange();\n      }\n\n      // if (args.ygroup_accessor !== null) {\n      //   MG.scale_factory(args)\n      //     .namespace('ygroup')\n      //     .categoricalDomainFromData()\n      //     .categoricalColorRange();\n      // }\n\n      new MG.axis_factory(args)\n        .namespace('x')\n        .type(args.x_axis_type)\n        .zeroLine(args.y_axis_type === 'categorical')\n        .position(args.x_axis_position)\n        .draw();\n\n      new MG.axis_factory(args)\n        .namespace('y')\n        .type(args.y_axis_type)\n        .zeroLine(args.x_axis_type === 'categorical')\n        .position(args.y_axis_position)\n        .draw();\n\n      //mg_categorical_group_color_scale(args);\n\n      this.mainPlot();\n      this.markers();\n      this.rollover();\n      this.windowListeners();\n      //scaffold(args)\n\n      return this;\n    };\n\n    this.mainPlot = function() {\n      var svg = mg_get_svg_child_of(args.target);\n      var data = args.data[0];\n      var barplot = svg.select('g.mg-barplot');\n      var fresh_render = barplot.empty();\n\n      var bars;\n      var predictor_bars;\n      var pp, pp0;\n      var baseline_marks;\n\n      var perform_load_animation = fresh_render && args.animate_on_load;\n      var should_transition = perform_load_animation || args.transition_on_update;\n      var transition_duration = args.transition_duration || 1000;\n\n      // draw the plot on first render\n      if (fresh_render) {\n        barplot = svg.append('g')\n          .classed('mg-barplot', true);\n      }\n\n      bars = barplot.selectAll('.mg-bar')\n        .data(data)\n        .enter()\n        .append('rect')\n          .classed('mg-bar', true)\n          .classed('default-bar', args.scales.hasOwnProperty('COLOR') ? false : true);\n\n      // TODO - reimplement\n\n      // reference_accessor {}\n\n      // if (args.predictor_accessor) {\n      //   predictor_bars = barplot.selectAll('.mg-bar-prediction')\n      //     .data(data.filter(function(d) {\n      //       return d.hasOwnProperty(args.predictor_accessor) }));\n\n      //   predictor_bars.exit().remove();\n\n      //   predictor_bars.enter().append('rect')\n      //     .classed('mg-bar-prediction', true);\n      // }\n\n      // if (args.baseline_accessor) {\n      //   baseline_marks = barplot.selectAll('.mg-bar-baseline')\n      //     .data(data.filter(function(d) {\n      //       return d.hasOwnProperty(args.baseline_accessor) }));\n\n      //   baseline_marks.exit().remove();\n\n      //   baseline_marks.enter().append('line')\n      //     .classed('mg-bar-baseline', true);\n      // }\n\n      var appropriate_size;\n\n      // setup transitions\n      // if (should_transition) {\n      //   bars = bars.transition()\n      //     .duration(transition_duration);\n\n      //   if (predictor_bars) {\n      //     predictor_bars = predictor_bars.transition()\n      //       .duration(transition_duration);\n      //   }\n\n      //   if (baseline_marks) {\n      //     baseline_marks = baseline_marks.transition()\n      //       .duration(transition_duration);\n      //   }\n      // }\n\n      //appropriate_size = args.scales.Y_ingroup.rangeBand()/1.5;\n      var length, width, length_type, width_type, length_coord, width_coord,\n          length_scalefn, width_scalefn, length_scale, width_scale,\n          length_accessor, width_accessor, length_coord_map, width_coord_map,\n          length_map, width_map;\n\n      var reference_length_map, reference_length_coord_fn;\n\n      if (args.orientation == 'vertical') {\n        length = 'height';\n        width = 'width';\n        length_type = args.y_axis_type;\n        width_type = args.x_axis_type;\n        length_coord = 'y';\n        width_coord = 'x';\n        length_scalefn = length_type == 'categorical' ? args.scalefns.youtf : args.scalefns.yf;\n        width_scalefn  = width_type == 'categorical' ? args.scalefns.xoutf : args.scalefns.xf;\n        length_scale   = args.scales.Y;\n        width_scale     = args.scales.X;\n        length_accessor = args.y_accessor;\n        width_accessor = args.x_accessor;\n\n        length_coord_map = function(d) {\n          var l;\n          l = length_scalefn(d);\n          if (d[length_accessor] < 0) {\n            l = length_scale(0);\n          }\n          return l;\n        }\n\n        length_map = function(d) {\n          return Math.abs(length_scalefn(d) - length_scale(0));\n        }\n\n        reference_length_map = function(d) {\n          return Math.abs(length_scale(d[args.reference_accessor]) - length_scale(0));\n        }\n\n        reference_length_coord_fn = function(d){\n          return length_scale(d[args.reference_accessor]);\n        }\n      }\n\n      if (args.orientation == 'horizontal') {\n        length = 'width';\n        width = 'height';\n        length_type = args.x_axis_type;\n        width_type = args.y_axis_type;\n        length_coord = 'x';\n        width_coord = 'y';\n        length_scalefn = length_type == 'categorical' ? args.scalefns.xoutf : args.scalefns.xf;\n        width_scalefn = width_type == 'categorical' ? args.scalefns.youtf : args.scalefns.yf;\n        length_scale = args.scales.X;\n        width_scale = args.scales.Y;\n        length_accessor = args.x_accessor;\n        width_accessor = args.y_accessor;\n\n        length_coord_map = function(d) {\n          var l;\n          l = length_scale(0);\n          return l;\n        }\n\n        length_map = function(d) {\n          return Math.abs(length_scalefn(d) - length_scale(0));\n        }\n\n        reference_length_map = function(d) {\n          return Math.abs(length_scale(d[args.reference_accessor]) - length_scale(0));\n        }\n\n        reference_length_coord_fn = function(d){\n          return length_scale(0);\n        }\n      }\n\n      // if (perform_load_animation) {\n      //   bars.attr(length, 0);\n\n      //   if (predictor_bars) {\n      //     predictor_bars.attr(length, 0);\n      //   }\n\n      //   // if (baseline_marks) {\n      //   //   baseline_marks.attr({\n      //   //     x1: args.scales.X(0),\n      //   //     x2: args.scales.X(0)\n      //   //   });\n      //   // }\n      // }\n\n      bars.attr(length_coord, length_coord_map);\n\n      // bars.attr(length_coord, 40)\n      //bars.attr(width_coord, 70)\n\n\n\n      bars.attr(width_coord, function(d) {\n        var w;\n        if (width_type == 'categorical') {\n          w = width_scalefn(d);\n        } else {\n          w = width_scale(0);\n          if (d[width_accessor] < 0) {\n            w = width_scalefn(d);\n          }\n        }\n        w = w - args.bar_thickness/2;\n        return w;\n      });\n\n      if (args.scales.COLOR) {\n        bars.attr('fill', args.scalefns.colorf)\n      }\n\n      bars\n        .attr(length, length_map)\n        .attr(width, function(d) {\n          return args.bar_thickness;\n      });\n\n\n\n\n      if (args.reference_accessor !== null) {\n        var reference_data = data.filter(function(d){\n          return d.hasOwnProperty(args.reference_accessor);\n        })\n        var reference_bars = barplot.selectAll('.mg-categorical-reference')\n          .data(reference_data)\n          .enter()\n          .append('rect');\n\n        reference_bars\n          .attr(length_coord, reference_length_coord_fn)\n          .attr(width_coord, function(d) {\n            return width_scalefn(d) - args.reference_thickness/2\n          })\n          .attr(length, reference_length_map)\n          .attr(width, args.reference_thickness);\n      }\n\n      if (args.comparison_accessor !== null) {\n        var comparison_thickness = null;\n        if (args.comparison_thickness === null) {\n          comparison_thickness = args.bar_thickness/2;\n        } else {\n          comparison_thickness = args.comparison_thickness;\n        }\n\n\n        var comparison_data = data.filter(function(d) {\n          return d.hasOwnProperty(args.comparison_accessor);\n        })\n        var comparison_marks = barplot.selectAll('.mg-categorical-comparison')\n          .data(comparison_data)\n          .enter()\n          .append('line');\n\n        comparison_marks\n          .attr(length_coord + '1', function(d){return length_scale(d[args.comparison_accessor])})\n          .attr(length_coord + '2', function(d){return length_scale(d[args.comparison_accessor])})\n          .attr(width_coord + '1',  function(d){\n            return width_scalefn(d) - comparison_thickness/2;\n          })\n          .attr(width_coord + '2', function(d) {\n            return width_scalefn(d) + comparison_thickness/2;\n          })\n          .attr('stroke', 'black')\n          .attr('stroke-width', args.comparison_width);\n      }\n\n        //bars.attr(width_coord, );\n        // bars.attr('width', 50);\n        // bars.attr('height', 50);\n        // bars.attr('y', function(d){\n        //   var y = args.scales.Y(0);\n        //   if (d[args.y_accessor] < 0) {\n        //     y = args.scalefns.yf(d);\n        //   }\n        //   return y;\n        // });\n\n        // bars.attr('x', function(d){\n        //   return 40;\n        // })\n\n        // bars.attr('width', function(d){\n        //   return 100;\n        // });\n\n        // bars.attr('height', 100);\n\n        // bars.attr('fill', 'black');\n        // bars.attr('x', function(d) {\n        //   var x = args.scales.X(0);\n        //   if (d[args.x_accessor] < 0) {\n        //     x = args.scalefns.xf(d);\n        //   }\n        //   return x;\n        // })\n        // TODO - reimplement.\n        // if (args.predictor_accessor) {\n        //   predictor_bars\n        //     .attr('x', args.scales.X(0))\n        //     .attr('y', function(d) {\n        //       return args.scalefns.ygroupf(d) + args.scalefns.yf(d) + args.scales.Y.rangeBand() * (7 / 16) // + pp0 * appropriate_size/(pp*2) + appropriate_size / 2;\n        //     })\n        //     .attr('height', args.scales.Y.rangeBand() / 8) //appropriate_size / pp)\n        //     .attr('width', function(d) {\n        //       return args.scales.X(d[args.predictor_accessor]) - args.scales.X(0);\n        //     });\n        // }\n\n      // TODO - reimplement.\n      //   if (args.baseline_accessor) {\n\n      //     baseline_marks\n      //       .attr('x1', function(d) {\n      //         return args.scales.X(d[args.baseline_accessor]); })\n      //       .attr('x2', function(d) {\n      //         return args.scales.X(d[args.baseline_accessor]); })\n      //       .attr('y1', function(d) {\n      //         return args.scalefns.ygroupf(d) + args.scalefns.yf(d) + args.scales.Y.rangeBand() / 4\n      //       })\n      //       .attr('y2', function(d) {\n      //         return args.scalefns.ygroupf(d) + args.scalefns.yf(d) + args.scales.Y.rangeBand() * 3 / 4\n      //       });\n      //   }\n        if (args.legend || (args.color_accessor !== null && args.ygroup_accessor !== args.color_accessor)) {\n        if (!args.legend_target) legend_on_graph(svg, args);\n        else mg_targeted_legend(args);\n      }\n      return this;\n    };\n\n    this.markers = function() {\n      markers(args);\n      return this;\n    };\n\n    this.rollover = function() {\n      var svg = mg_get_svg_child_of(args.target);\n      var g;\n\n      if (svg.selectAll('.mg-active-datapoint-container').nodes().length === 0) {\n        mg_add_g(svg, 'mg-active-datapoint-container');\n      }\n\n      //remove the old rollovers if they already exist\n      svg.selectAll('.mg-rollover-rect').remove();\n      svg.selectAll('.mg-active-datapoint').remove();\n\n      // get orientation\n      var length, width, length_type, width_type, length_coord, width_coord,\n        length_scalefn, width_scalefn, length_scale, width_scale,\n        length_accessor, width_accessor;\n\n      var length_coord_map, width_coord_map, length_map, width_map;\n\n      if (args.orientation == 'vertical') {\n        length = 'height';\n        width = 'width';\n        length_type = args.y_axis_type;\n        width_type = args.x_axis_type;\n        length_coord = 'y';\n        width_coord = 'x';\n        length_scalefn = length_type == 'categorical' ? args.scalefns.youtf : args.scalefns.yf;\n        width_scalefn  = width_type == 'categorical' ? args.scalefns.xoutf : args.scalefns.xf;\n        length_scale   = args.scales.Y;\n        width_scale     = args.scales.X;\n        length_accessor = args.y_accessor;\n        width_accessor = args.x_accessor;\n\n        length_coord_map = function(d){\n          return mg_get_plot_top(args);\n        }\n\n        length_map = function(d) {\n          return args.height -args.top-args.bottom-args.buffer*2\n        }\n      }\n\n      if (args.orientation == 'horizontal') {\n        length = 'width';\n        width = 'height';\n        length_type = args.x_axis_type;\n        width_type = args.y_axis_type;\n        length_coord = 'x';\n        width_coord = 'y';\n        length_scalefn = length_type == 'categorical' ? args.scalefns.xoutf : args.scalefns.xf;\n        width_scalefn = width_type == 'categorical' ? args.scalefns.youtf : args.scalefns.yf;\n        length_scale = args.scales.X;\n        width_scale = args.scales.Y;\n        length_accessor = args.x_accessor;\n        width_accessor = args.y_accessor;\n\n        length_coord_map = function(d){\n          var l;\n          l = length_scale(0);\n          return l;\n        }\n\n        length_map = function(d) {\n          return args.width -args.left-args.right-args.buffer*2\n        }\n      }\n\n      //rollover text\n      var rollover_x, rollover_anchor;\n      if (args.rollover_align === 'right') {\n        rollover_x = args.width - args.right;\n        rollover_anchor = 'end';\n      } else if (args.rollover_align === 'left') {\n        rollover_x = args.left;\n        rollover_anchor = 'start';\n      } else {\n        rollover_x = (args.width - args.left - args.right) / 2 + args.left;\n        rollover_anchor = 'middle';\n      }\n\n      svg.append('text')\n        .attr('class', 'mg-active-datapoint')\n        .attr('xml:space', 'preserve')\n        .attr('x', rollover_x)\n        .attr('y', args.top * 0.75)\n        .attr('dy', '.35em')\n        .attr('text-anchor', rollover_anchor);\n\n      g = svg.append('g')\n        .attr('class', 'mg-rollover-rect');\n\n      //draw rollover bars\n      var bars = g.selectAll(\".mg-bar-rollover\")\n        .data(args.data[0]).enter()\n        .append(\"rect\")\n        .attr('class', 'mg-bar-rollover');\n\n      bars.attr('opacity', 0)\n        .attr(length_coord, length_coord_map)\n        .attr(width_coord, function(d) {\n          var w;\n          if (width_type == 'categorical') {\n            w = width_scalefn(d);\n          } else {\n            w = width_scale(0);\n            if (d[width_accessor] < 0) {\n              w = width_scalefn(d);\n            }\n          }\n          w = w - args.bar_thickness/2;\n          return w;\n        });\n\n      bars.attr(length, length_map)\n      bars.attr(width, function(d) {\n        return args.bar_thickness;\n      });\n\n      bars\n        .on('mouseover', this.rolloverOn(args))\n        .on('mouseout', this.rolloverOff(args))\n        .on('mousemove', this.rolloverMove(args));\n\n      return this;\n    };\n\n    this.rolloverOn = function(args) {\n      var svg = mg_get_svg_child_of(args.target);\n      var label_accessor = this.is_vertical ? args.x_accessor : args.y_accessor;\n      var data_accessor = this.is_vertical ? args.y_accessor : args.x_accessor;\n      var label_units = this.is_vertical ? args.yax_units : args.xax_units;\n\n      return function(d, i) {\n\n        var fmt = MG.time_format(args.utc_time, '%b %e, %Y');\n        var num = format_rollover_number(args);\n\n        //highlight active bar\n        var bar = svg.selectAll('g.mg-barplot .mg-bar')\n          .filter(function(d, j) {\n            return j === i;\n          }).classed('active', true);\n\n        if (args.scales.hasOwnProperty('COLOR')) {\n          bar.attr('fill', d3.rgb(args.scalefns.colorf(d)).darker());\n        } else {\n          bar.classed('default-active', true);\n        }\n\n        //update rollover text\n        if (args.show_rollover_text) {\n          var mouseover = mg_mouseover_text(args, { svg: svg });\n          var row = mouseover.mouseover_row();\n\n          if (args.ygroup_accessor) row.text(d[args.ygroup_accessor] + '   ').bold();\n\n          row.text(mg_format_x_mouseover(args, d));\n          row.text(args.y_accessor + ': ' + d[args.y_accessor]);\n          if (args.predictor_accessor || args.baseline_accessor) {\n            row = mouseover.mouseover_row();\n\n            if (args.predictor_accessor) row.text(mg_format_data_for_mouseover(args, d, null, args.predictor_accessor, false))\n            if (args.baseline_accessor) row.text(mg_format_data_for_mouseover(args, d, null, args.baseline_accessor, false))\n          }\n        }\n        if (args.mouseover) {\n          args.mouseover(d, i);\n        }\n      };\n    };\n\n    this.rolloverOff = function(args) {\n      var svg = mg_get_svg_child_of(args.target);\n\n      return function(d, i) {\n        //reset active bar\n        var bar = svg.selectAll('g.mg-barplot .mg-bar.active').classed('active', false);\n\n        if (args.scales.hasOwnProperty('COLOR')) {\n          bar.attr('fill', args.scalefns.colorf(d));\n        } else {\n          bar.classed('default-active', false);\n        }\n\n        //reset active data point text\n        svg.select('.mg-active-datapoint')\n          .text('');\n\n        mg_clear_mouseover_container(svg);\n\n        if (args.mouseout) {\n          args.mouseout(d, i);\n        }\n      };\n    };\n\n    this.rolloverMove = function(args) {\n      return function(d, i) {\n        if (args.mousemove) {\n          args.mousemove(d, i);\n        }\n      };\n    };\n\n    this.windowListeners = function() {\n      mg_window_listeners(this.args);\n      return this;\n    };\n\n    this.init(args);\n  }\n\n  var defaults = {\n    y_padding_percentage: 0.05, // for categorical scales\n    y_outer_padding_percentage: .2, // for categorical scales\n    ygroup_padding_percentage: 0, // for categorical scales\n    ygroup_outer_padding_percentage: 0, // for categorical scales\n    x_padding_percentage: 0.05, // for categorical scales\n    x_outer_padding_percentage: .2, // for categorical scales\n    xgroup_padding_percentage: 0, // for categorical scales\n    xgroup_outer_padding_percentage: 0, // for categorical scales\n    buffer: 16,\n    y_accessor: 'factor',\n    x_accessor: 'value',\n    reference_accessor: null,\n    comparison_accessor: null,\n    secondary_label_accessor: null,\n    color_accessor: null,\n    color_type: 'category',\n    color_domain: null,\n    reference_thickness: 1,\n    comparison_width: 3,\n    comparison_thickness: null,\n    legend: false,\n    legend_target: null,\n    mouseover_align: 'right',\n    baseline_accessor: null,\n    predictor_accessor: null,\n    predictor_proportion: 5,\n    show_bar_zero: true,\n    binned: true,\n    truncate_x_labels: true,\n    truncate_y_labels: true\n  };\n\n  MG.register('bar', barChart, defaults);\n\n}).call(this);\n\n/*\nData Tables\n\nAlong with histograms, bars, lines, and scatters, a simple data table can take you far.\nWe often just want to look at numbers, organized as a table, where columns are variables,\nand rows are data points. Sometimes we want a cell to have a small graphic as the main\ncolumn element, in which case we want small multiples. sometimes we want to\n\nvar table = New data_table(data)\n        .target('div#data-table')\n        .title({accessor: 'point_name', align: 'left'})\n        .description({accessor: 'description'})\n        .number({accessor: ''})\n\n*/\n\nMG.data_table = function(args) {\n  'use strict';\n  this.args = args;\n  this.args.standard_col = { width: 150, font_size: 12, font_weight: 'normal' };\n  this.args.columns = [];\n  this.formatting_options = [\n    ['color', 'color'],\n    ['font-weight', 'font_weight'],\n    ['font-style', 'font_style'],\n    ['font-size', 'font_size']\n  ];\n\n  this._strip_punctuation = function(s) {\n    var punctuationless = s.replace(/[^a-zA-Z0-9 _]+/g, '');\n    var finalString = punctuationless.replace(/ +?/g, '');\n    return finalString;\n  };\n\n  this._format_element = function(element, value, args) {\n    this.formatting_options.forEach(function(fo) {\n      var attr = fo[0];\n      var key = fo[1];\n      if (args[key]) element.style(attr,\n        typeof args[key] === 'string' ||\n        typeof args[key] === 'number' ?\n        args[key] : args[key](value));\n    });\n  };\n\n  this._add_column = function(_args, arg_type) {\n    var standard_column = this.args.standard_col;\n    var args = merge_with_defaults(MG.clone(_args), MG.clone(standard_column));\n    args.type = arg_type;\n    this.args.columns.push(args);\n  };\n\n  this.target = function() {\n    var target = arguments[0];\n    this.args.target = target;\n    return this;\n  };\n\n  this.title = function() {\n    this._add_column(arguments[0], 'title');\n    return this;\n  };\n\n  this.text = function() {\n    this._add_column(arguments[0], 'text');\n    return this;\n  };\n\n  this.bullet = function() {\n    /*\n    text label\n    main value\n    comparative measure\n    any number of ranges\n\n    additional args:\n    no title\n    xmin, xmax\n    format: percentage\n    xax_formatter\n    */\n    return this;\n  };\n\n  this.sparkline = function() {\n    return this;\n  };\n\n  this.number = function() {\n    this._add_column(arguments[0], 'number');\n    return this;\n  };\n\n  this.display = function() {\n    var args = this.args;\n\n    chart_title(args);\n\n    var target = args.target;\n    var table = d3.select(target).append('table').classed('mg-data-table', true);\n    var colgroup = table.append('colgroup');\n    var thead = table.append('thead');\n    var tbody = table.append('tbody');\n    var this_column;\n    var this_title;\n\n    var tr, th, td_accessor, td_type, td_value, th_text, td_text, td;\n    var col;\n    var h;\n\n    tr = thead.append('tr');\n\n    for (h = 0; h < args.columns.length; h++) {\n      var this_col = args.columns[h];\n      td_type = this_col.type;\n      th_text = this_col.label;\n      th_text = th_text === undefined ? '' : th_text;\n      th = tr.append('th')\n        .style('width', this_col.width)\n        .style('text-align', td_type === 'title' ? 'left' : 'right')\n        .text(th_text);\n\n      if (args.show_tooltips && this_col.description && mg_jquery_exists()) {\n        th.append('i')\n          .classed('fa', true)\n          .classed('fa-question-circle', true)\n          .classed('fa-inverse', true);\n\n        $(th.node()).popover({\n          html: true,\n          animation: false,\n          content: this_col.description,\n          trigger: 'hover',\n          placement: 'top',\n          container: $(th.node())\n        });\n      }\n    }\n\n    for (h = 0; h < args.columns.length; h++) {\n      col = colgroup.append('col');\n      if (args.columns[h].type === 'number') {\n        col.attr('align', 'char').attr('char', '.');\n      }\n    }\n\n    for (var i = 0; i < args.data.length; i++) {\n      tr = tbody.append('tr');\n      for (var j = 0; j < args.columns.length; j++) {\n        this_column = args.columns[j];\n        td_accessor = this_column.accessor;\n        td_value = td_text = args.data[i][td_accessor];\n        td_type = this_column.type;\n\n        if (td_type === 'number') {\n          //td_text may need to be rounded\n          if (this_column.hasOwnProperty('round') && !this_column.hasOwnProperty('format')) {\n            // round according to the number value in this_column.round\n            td_text = d3.format('0,.' + this_column.round + 'f')(td_text);\n          }\n\n          if (this_column.hasOwnProperty('value_formatter')) {\n            // provide a function that formats the text according to the function this_column.format.\n            td_text = this_column.value_formatter(td_text);\n          }\n\n          if (this_column.hasOwnProperty('format')) {\n            // this is a shorthand for percentage formatting, and others if need be.\n            // supported: 'percentage', 'count', 'temperature'\n\n            if (this_column.round) {\n              td_text = Math.round(td_text, this_column.round);\n            }\n\n            var this_format = this_column.format;\n            var formatter;\n\n            if (this_format === 'percentage') formatter = d3.format('.0%');\n            if (this_format === 'count') formatter = d3.format(',.0f');\n            if (this_format === 'temperature') formatter = function(t) {\n              return t + '°'; };\n\n            td_text = formatter(td_text);\n          }\n\n          if (this_column.hasOwnProperty('currency')) {\n            // this is another shorthand for formatting according to a currency amount, which gets appended to front of number\n            td_text = this_column.currency + td_text;\n          }\n        }\n\n        td = tr.append('td')\n          .classed('table-' + td_type, true)\n          .classed('table-' + td_type + '-' + this._strip_punctuation(td_accessor), true)\n          .attr('data-value', td_value)\n          .style('width', this_column.width)\n          .style('text-align', td_type === 'title' || td_type === 'text' ? 'left' : 'right');\n\n        this._format_element(td, td_value, this_column);\n\n        if (td_type === 'title') {\n          this_title = td.append('div').text(td_text);\n          this._format_element(this_title, td_text, this_column);\n\n          if (args.columns[j].hasOwnProperty('secondary_accessor')) {\n            td.append('div')\n              .text(args.data[i][args.columns[j].secondary_accessor])\n              .classed(\"secondary-title\", true);\n          }\n        } else {\n          td.text(td_text);\n        }\n      }\n    }\n\n    return this;\n  };\n\n  return this;\n};\n\n(function() {\n  'use strict';\n\n  function mg_missing_add_text(svg, args) {\n    svg.selectAll('.mg-missing-text').data([args.missing_text])\n      .enter().append('text')\n      .attr('class', 'mg-missing-text')\n      .attr('x', args.width / 2)\n      .attr('y', args.height / 2)\n      .attr('dy', '.50em')\n      .attr('text-anchor', 'middle')\n      .text(args.missing_text);\n  }\n\n  function mg_missing_x_scale(args) {\n    args.scales.X = d3.scaleLinear()\n      .domain([0, args.data.length])\n      .range([mg_get_plot_left(args), mg_get_plot_right(args)]);\n    args.scalefns.yf = function(di) {\n      return args.scales.Y(di.y); };\n  }\n\n  function mg_missing_y_scale(args) {\n    args.scales.Y = d3.scaleLinear()\n      .domain([-2, 2])\n      .range([args.height - args.bottom - args.buffer * 2, args.top]);\n    args.scalefns.xf = function(di) {\n      return args.scales.X(di.x); };\n  }\n\n  function mg_make_fake_data(args) {\n    var data = [];\n    for (var x = 1; x <= 50; x++) {\n      data.push({ 'x': x, 'y': Math.random() - (x * 0.03) });\n    }\n    args.data = data;\n  }\n\n  function mg_add_missing_background_rect(g, args) {\n    g.append('svg:rect')\n      .classed('mg-missing-background', true)\n      .attr('x', args.buffer)\n      .attr('y', args.buffer + args.title_y_position * 2)\n      .attr('width', args.width - args.buffer * 2)\n      .attr('height', args.height - args.buffer * 2 - args.title_y_position * 2)\n      .attr('rx', 15)\n      .attr('ry', 15);\n  }\n\n  function mg_missing_add_line(g, args) {\n    var line = d3.line()\n      .x(args.scalefns.xf)\n      .y(args.scalefns.yf)\n      .curve(args.interpolate);\n\n    g.append('path')\n      .attr('class', 'mg-main-line mg-line1-color')\n      .attr('d', line(args.data));\n  }\n\n  function mg_missing_add_area(g, args) {\n    var area = d3.area()\n      .x(args.scalefns.xf)\n      .y0(args.scales.Y.range()[0])\n      .y1(args.scalefns.yf)\n      .curve(args.interpolate);\n\n    g.append('path')\n      .attr('class', 'mg-main-area mg-area1-color')\n      .attr('d', area(args.data));\n  }\n\n  function mg_remove_all_children(args) {\n    d3.select(args.target).selectAll('svg *').remove();\n  }\n\n  function mg_missing_remove_legend(args) {\n    if (args.legend_target) {\n      d3.select(args.legend_target).html('');\n    }\n  }\n\n  function missingData(args) {\n    this.init = function(args) {\n      this.args = args;\n\n      mg_init_compute_width(args);\n      mg_init_compute_height(args);\n\n      // create svg if one doesn't exist\n\n      var container = d3.select(args.target);\n      mg_raise_container_error(container, args);\n      var svg = container.selectAll('svg');\n      mg_remove_svg_if_chart_type_has_changed(svg, args);\n      svg = mg_add_svg_if_it_doesnt_exist(svg, args);\n      mg_adjust_width_and_height_if_changed(svg, args);\n      mg_set_viewbox_for_scaling(svg, args);\n      mg_remove_all_children(args);\n\n      svg.classed('mg-missing', true);\n      mg_missing_remove_legend(args);\n\n      chart_title(args);\n\n      // are we adding a background placeholder\n      if (args.show_missing_background) {\n        mg_make_fake_data(args);\n        mg_missing_x_scale(args);\n        mg_missing_y_scale(args);\n        var g = mg_add_g(svg, 'mg-missing-pane');\n\n        mg_add_missing_background_rect(g, args);\n        mg_missing_add_line(g, args);\n        mg_missing_add_area(g, args);\n      }\n\n      mg_missing_add_text(svg, args);\n\n      this.windowListeners();\n\n      return this;\n    };\n\n    this.windowListeners = function() {\n      mg_window_listeners(this.args);\n      return this;\n    };\n\n    this.init(args);\n  }\n\n  var defaults = {\n    top: 40, // the size of the top margin\n    bottom: 30, // the size of the bottom margin\n    right: 10, // size of the right margin\n    left: 0, // size of the left margin\n    buffer: 8, // the buffer between the actual chart area and the margins\n    legend_target: '',\n    width: 350,\n    height: 220,\n    missing_text: 'Data currently missing or unavailable',\n    scalefns: {},\n    scales: {},\n    show_tooltips: true,\n    show_missing_background: true\n  };\n\n  MG.register('missing-data', missingData, defaults);\n}).call(this);\n\nfunction mg_process_scale_ticks(args, axis) {\n  var accessor;\n  var scale_ticks;\n  var max;\n\n  if (axis === 'x') {\n    accessor = args.x_accessor;\n    scale_ticks = args.scales.X.ticks(args.xax_count);\n    max = args.processed.max_x;\n  } else if (axis === 'y') {\n    accessor = args.y_accessor;\n    scale_ticks = args.scales.Y.ticks(args.yax_count)\n    max = args.processed.max_y;\n  }\n\n  function log10(val) {\n    if (val === 1000) {\n      return 3;\n    }\n    if (val === 1000000) {\n      return 7;\n    }\n    return Math.log(val) / Math.LN10;\n  }\n\n  if ((axis === 'x' && args.x_scale_type === 'log') || (axis === 'y' && args.y_scale_type === 'log')) {\n    // get out only whole logs\n    scale_ticks = scale_ticks.filter(function(d) {\n      return Math.abs(log10(d)) % 1 < 1e-6 || Math.abs(log10(d)) % 1 > 1 - 1e-6;\n    });\n  }\n\n  // filter out fraction ticks if our data is ints and if xmax > number of generated ticks\n  var number_of_ticks = scale_ticks.length;\n\n  // is our data object all ints?\n  var data_is_int = true;\n  args.data.forEach(function(d, i) {\n    d.forEach(function(d, i) {\n      if (d[accessor] % 1 !== 0) {\n        data_is_int = false;\n        return false;\n      }\n    });\n  });\n\n  if (data_is_int && number_of_ticks > max && args.format === 'count') {\n    // remove non-integer ticks\n    scale_ticks = scale_ticks.filter(function(d) {\n      return d % 1 === 0;\n    });\n  }\n\n  if (axis === 'x') {\n    args.processed.x_ticks = scale_ticks;\n  } else if (axis === 'y') {\n    args.processed.y_ticks = scale_ticks;\n  }\n}\n\nfunction raw_data_transformation(args) {\n  'use strict';\n\n  // dupe our data so we can modify it without adverse effect\n  args.data = MG.clone(args.data);\n\n  // we need to account for a few data format cases:\n  // #0 {bar1:___, bar2:___}                                    // single object (for, say, bar charts)\n  // #1 [{key:__, value:__}, ...]                               // unnested obj-arrays\n  // #2 [[{key:__, value:__}, ...], [{key:__, value:__}, ...]]  // nested obj-arrays\n  // #3 [[4323, 2343],..]                                       // unnested 2d array\n  // #4 [[[4323, 2343],..] , [[4323, 2343],..]]                 // nested 2d array\n  args.single_object = false; // for bar charts.\n  args.array_of_objects = false;\n  args.array_of_arrays = false;\n  args.nested_array_of_arrays = false;\n  args.nested_array_of_objects = false;\n\n  // is the data object a nested array?\n\n  if (is_array_of_arrays(args.data)) {\n    args.nested_array_of_objects = args.data.map(function(d) {\n      return is_array_of_objects_or_empty(d);\n    }); // Case #2\n    args.nested_array_of_arrays = args.data.map(function(d) {\n      return is_array_of_arrays(d);\n    }); // Case #4\n  } else {\n    args.array_of_objects = is_array_of_objects(args.data); // Case #1\n    args.array_of_arrays = is_array_of_arrays(args.data); // Case #3\n  }\n\n  if (args.chart_type === 'line') {\n    if (args.array_of_objects || args.array_of_arrays) {\n      args.data = [args.data];\n    }\n  } else {\n    if (!(mg_is_array(args.data[0]))) {\n      args.data = [args.data];\n    }\n  }\n  // if the y_accessor is an array, break it up and store the result in args.data\n  mg_process_multiple_x_accessors(args);\n  mg_process_multiple_y_accessors(args);\n\n  // if user supplies keyword in args.color, change to arg.colors.\n  // this is so that the API remains fairly sensible and legible.\n  if (args.color !== undefined) {\n    args.colors = args.color;\n  }\n\n  // if user has supplied args.colors, and that value is a string, turn it into an array.\n  if (args.colors !== null && typeof args.colors === 'string') {\n    args.colors = [args.colors];\n  }\n\n  // sort x-axis data\n  if (args.chart_type === 'line' && args.x_sort === true) {\n    for (var i = 0; i < args.data.length; i++) {\n      args.data[i].sort(function(a, b) {\n        return a[args.x_accessor] - b[args.x_accessor];\n      });\n    }\n  }\n\n  return this;\n}\n\nfunction mg_process_multiple_accessors(args, which_accessor) {\n  // turns an array of accessors into ...\n  if (mg_is_array(args[which_accessor])) {\n    args.data = args.data.map(function(_d) {\n      return args[which_accessor].map(function(ya) {\n        return _d.map(function(di) {\n          di = MG.clone(di);\n\n          if (di[ya] === undefined) {\n            return undefined;\n          }\n\n          di['multiline_' + which_accessor] = di[ya];\n          return di;\n        }).filter(function(di) {\n          return di !== undefined;\n        });\n      });\n    })[0];\n    args[which_accessor] = 'multiline_' + which_accessor;\n  }\n}\n\nfunction mg_process_multiple_x_accessors(args) {\n  mg_process_multiple_accessors(args, 'x_accessor');\n}\n\nfunction mg_process_multiple_y_accessors(args) {\n  mg_process_multiple_accessors(args, 'y_accessor');\n}\n\nMG.raw_data_transformation = raw_data_transformation;\n\nfunction process_line(args) {\n  'use strict';\n\n  var time_frame;\n\n  // do we have a time-series?\n  var is_time_series = d3.sum(args.data.map(function(series) {\n    return series.length > 0 && mg_is_date(series[0][args.x_accessor]);\n  })) > 0;\n\n  // are we replacing missing y values with zeros?\n  if ((args.missing_is_zero || args.missing_is_hidden) && args.chart_type === 'line' && is_time_series) {\n    for (var i = 0; i < args.data.length; i++) {\n      // we need to have a dataset of length > 2, so if it's less than that, skip\n      if (args.data[i].length <= 1) {\n        continue;\n      }\n\n      var first = args.data[i][0];\n      var last = args.data[i][args.data[i].length - 1];\n\n      // initialize our new array for storing the processed data\n      var processed_data = [];\n\n      // we'll be starting from the day after our first date\n      var start_date = MG.clone(first[args.x_accessor]).setDate(first[args.x_accessor].getDate() + 1);\n\n      // if we've set a max_x, add data points up to there\n      var from = (args.min_x) ? args.min_x : start_date;\n      var upto = (args.max_x) ? args.max_x : last[args.x_accessor];\n\n      time_frame = mg_get_time_frame((upto - from) / 1000);\n\n      if (['four-days', 'many-days', 'many-months', 'years', 'default'].indexOf(time_frame) !== -1 && args.missing_is_hidden_accessor === null) {\n        for (var d = new Date(from); d <= upto; d.setDate(d.getDate() + 1)) {\n          var o = {};\n          d.setHours(0, 0, 0, 0);\n\n          // add the first date item, we'll be starting from the day after our first date\n          if (Date.parse(d) === Date.parse(new Date(start_date))) {\n            processed_data.push(MG.clone(args.data[i][0]));\n          }\n\n          // check to see if we already have this date in our data object\n          var existing_o = null;\n          args.data[i].forEach(function(val, i) {\n            if (Date.parse(val[args.x_accessor]) === Date.parse(new Date(d))) {\n              existing_o = val;\n\n              return false;\n            }\n          });\n\n          // if we don't have this date in our data object, add it and set it to zero\n          if (!existing_o) {\n            o[args.x_accessor] = new Date(d);\n            o[args.y_accessor] = 0;\n            o['_missing'] = true; //we want to distinguish between zero-value and missing observations\n            processed_data.push(o);\n          }\n\n          // if the data point has, say, a 'missing' attribute set or if its\n          // y-value is null identify it internally as missing\n          else if (existing_o[args.missing_is_hidden_accessor] || existing_o[args.y_accessor] === null) {\n            existing_o['_missing'] = true;\n            processed_data.push(existing_o);\n          }\n\n          //otherwise, use the existing object for that date\n          else {\n            processed_data.push(existing_o);\n          }\n        }\n      } else {\n        for (var j = 0; j < args.data[i].length; j += 1) {\n          var obj = MG.clone(args.data[i][j]);\n          obj['_missing'] = args.data[i][j][args.missing_is_hidden_accessor];\n          processed_data.push(obj);\n        }\n      }\n\n      // update our date object\n      args.data[i] = processed_data;\n    }\n  }\n\n  return this;\n}\n\nMG.process_line = process_line;\n\nfunction process_histogram(args) {\n  'use strict';\n\n  // if args.binned == false, then we need to bin the data appropriately.\n  // if args.binned == true, then we need to make sure to compute the relevant computed data.\n  // the outcome of either of these should be something in args.computed_data.\n  // the histogram plotting function will be looking there for the data to plot.\n\n  // we need to compute an array of objects.\n  // each object has an x, y, and dx.\n\n  // histogram data is always single dimension\n  var our_data = args.data[0];\n\n  var extracted_data;\n  if (args.binned === false) {\n    // use d3's built-in layout.histogram functionality to compute what you need.\n\n    if (typeof(our_data[0]) === 'object') {\n      // we are dealing with an array of objects. Extract the data value of interest.\n      extracted_data = our_data\n        .map(function(d) {\n          return d[args.x_accessor];\n        });\n    } else if (typeof(our_data[0]) === 'number') {\n      // we are dealing with a simple array of numbers. No extraction needed.\n      extracted_data = our_data;\n    } else {\n      console.log('TypeError: expected an array of numbers, found ' + typeof(our_data[0]));\n      return;\n    }\n\n    var hist = d3.histogram();\n    if (args.bins) {\n      hist.thresholds(args.bins);\n    }\n\n    var bins = hist(extracted_data);\n    args.processed_data = bins.map(function(d) {\n      return { 'x': d.x0, 'y': d.length };\n    });\n  } else {\n    // here, we just need to reconstruct the array of objects\n    // take the x accessor and y accessor.\n    // pull the data as x and y. y is count.\n\n    args.processed_data = our_data.map(function(d) {\n      return { 'x': d[args.x_accessor], 'y': d[args.y_accessor] };\n    });\n\n    var this_pt;\n    var next_pt;\n\n    // we still need to compute the dx component for each data point\n    for (var i = 0; i < args.processed_data.length; i++) {\n      this_pt = args.processed_data[i];\n      if (i === args.processed_data.length - 1) {\n        this_pt.dx = args.processed_data[i - 1].dx;\n      } else {\n        next_pt = args.processed_data[i + 1];\n        this_pt.dx = next_pt.x - this_pt.x;\n      }\n    }\n  }\n\n  // capture the original data and accessors before replacing args.data\n  if (!args.processed) {\n    args.processed = {};\n  }\n  args.processed.original_data = args.data;\n  args.processed.original_x_accessor = args.x_accessor;\n  args.processed.original_y_accessor = args.y_accessor;\n\n  args.data = [args.processed_data];\n  args.x_accessor = args.processed_x_accessor;\n  args.y_accessor = args.processed_y_accessor;\n\n  return this;\n}\n\nMG.process_histogram = process_histogram;\n\n// for use with bar charts, etc.\nfunction process_categorical_variables(args) {\n  'use strict';\n\n  var extracted_data, processed_data = {},\n    pd = [];\n  //var our_data = args.data[0];\n  var label_accessor = args.bar_orientation === 'vertical' ? args.x_accessor : args.y_accessor;\n  var data_accessor = args.bar_orientation === 'vertical' ? args.y_accessor : args.x_accessor;\n\n  return this;\n}\n\nMG.process_categorical_variables = process_categorical_variables;\n\nfunction process_point(args) {\n  'use strict';\n\n  var data = args.data[0];\n  var x = data.map(function(d) {\n    return d[args.x_accessor];\n  });\n  var y = data.map(function(d) {\n    return d[args.y_accessor];\n  });\n\n  if (args.least_squares) {\n    args.ls_line = least_squares(x, y);\n  }\n\n  return this;\n}\n\nMG.process_point = process_point;\n\nfunction add_ls(args) {\n  var svg = mg_get_svg_child_of(args.target);\n  var data = args.data[0];\n  var min_x = d3.min(data, function(d) {\n    return d[args.x_accessor]; });\n  var max_x = d3.max(data, function(d) {\n    return d[args.x_accessor]; });\n\n  d3.select(args.target).selectAll('.mg-least-squares-line').remove();\n\n  svg.append('svg:line')\n    .attr('x1', args.scales.X(min_x))\n    .attr('x2', args.scales.X(max_x))\n    .attr('y1', args.scales.Y(args.ls_line.fit(min_x)))\n    .attr('y2', args.scales.Y(args.ls_line.fit(max_x)))\n    .attr('class', 'mg-least-squares-line');\n}\n\nMG.add_ls = add_ls;\n\nfunction add_lowess(args) {\n  var svg = mg_get_svg_child_of(args.target);\n  var lowess = args.lowess_line;\n\n  var line = d3.svg.line()\n    .x(function(d) {\n      return args.scales.X(d.x); })\n    .y(function(d) {\n      return args.scales.Y(d.y); })\n    .interpolate(args.interpolate);\n\n  svg.append('path')\n    .attr('d', line(lowess))\n    .attr('class', 'mg-lowess-line');\n}\n\nMG.add_lowess = add_lowess;\n\nfunction lowess_robust(x, y, alpha, inc) {\n  // Used http://www.unc.edu/courses/2007spring/biol/145/001/docs/lectures/Oct27.html\n  // for the clear explanation of robust lowess.\n\n  // calculate the the first pass.\n  var _l;\n  var r = [];\n  var yhat = d3.mean(y);\n  var i;\n  for (i = 0; i < x.length; i += 1) { r.push(1); }\n  _l = _calculate_lowess_fit(x, y, alpha, inc, r);\n  var x_proto = _l.x;\n  var y_proto = _l.y;\n\n  // Now, take the fit, recalculate the weights, and re-run LOWESS using r*w instead of w.\n\n  for (i = 0; i < 100; i += 1) {\n    r = d3.zip(y_proto, y).map(function(yi) {\n      return Math.abs(yi[1] - yi[0]);\n    });\n\n    var q = d3.quantile(r.sort(), 0.5);\n\n    r = r.map(function(ri) {\n      return _bisquare_weight(ri / (6 * q));\n    });\n\n    _l = _calculate_lowess_fit(x, y, alpha, inc, r);\n    x_proto = _l.x;\n    y_proto = _l.y;\n  }\n\n  return d3.zip(x_proto, y_proto).map(function(d) {\n    var p = {};\n    p.x = d[0];\n    p.y = d[1];\n    return p;\n  });\n}\n\nMG.lowess_robust = lowess_robust;\n\nfunction lowess(x, y, alpha, inc) {\n  var r = [];\n  for (var i = 0; i < x.length; i += 1) { r.push(1); }\n  var _l = _calculate_lowess_fit(x, y, alpha, inc, r);\n}\n\nMG.lowess = lowess;\n\nfunction least_squares(x_, y_) {\n  var x, y, xi, yi,\n    _x = 0,\n    _y = 0,\n    _xy = 0,\n    _xx = 0;\n\n  var n = x_.length;\n  if (mg_is_date(x_[0])) {\n    x = x_.map(function(d) {\n      return d.getTime();\n    });\n  } else {\n    x = x_;\n  }\n\n  if (mg_is_date(y_[0])) {\n    y = y_.map(function(d) {\n      return d.getTime();\n    });\n  } else {\n    y = y_;\n  }\n\n  var xhat = d3.mean(x);\n  var yhat = d3.mean(y);\n  var numerator = 0,\n    denominator = 0;\n\n  for (var i = 0; i < x.length; i++) {\n    xi = x[i];\n    yi = y[i];\n    numerator += (xi - xhat) * (yi - yhat);\n    denominator += (xi - xhat) * (xi - xhat);\n  }\n\n  var beta = numerator / denominator;\n  var x0 = yhat - beta * xhat;\n\n  return {\n    x0: x0,\n    beta: beta,\n    fit: function(x) {\n      return x0 + x * beta;\n    }\n  };\n}\n\nMG.least_squares = least_squares;\n\nfunction _pow_weight(u, w) {\n  if (u >= 0 && u <= 1) {\n    return Math.pow(1 - Math.pow(u, w), w);\n  } else {\n    return 0;\n  }\n}\n\nfunction _bisquare_weight(u) {\n  return _pow_weight(u, 2);\n}\n\nfunction _tricube_weight(u) {\n  return _pow_weight(u, 3);\n}\n\nfunction _neighborhood_width(x0, xis) {\n  return Array.max(xis.map(function(xi) {\n    return Math.abs(x0 - xi);\n  }));\n}\n\nfunction _manhattan(x1, x2) {\n  return Math.abs(x1 - x2);\n}\n\nfunction _weighted_means(wxy) {\n  var wsum = d3.sum(wxy.map(function(wxyi) {\n    return wxyi.w; }));\n\n  return {\n    xbar: d3.sum(wxy.map(function(wxyi) {\n      return wxyi.w * wxyi.x;\n    })) / wsum,\n    ybar: d3.sum(wxy.map(function(wxyi) {\n      return wxyi.w * wxyi.y;\n    })) / wsum\n  };\n}\n\nfunction _weighted_beta(wxy, xbar, ybar) {\n  var num = d3.sum(wxy.map(function(wxyi) {\n    return Math.pow(wxyi.w, 2) * (wxyi.x - xbar) * (wxyi.y - ybar);\n  }));\n\n  var denom = d3.sum(wxy.map(function(wxyi) {\n    return Math.pow(wxyi.w, 2) * Math.pow(wxyi.x - xbar, 2);\n  }));\n\n  return num / denom;\n}\n\nfunction _weighted_least_squares(wxy) {\n  var ybar, xbar, beta_i, x0;\n\n  var _wm = _weighted_means(wxy);\n\n  xbar = _wm.xbar;\n  ybar = _wm.ybar;\n\n  var beta = _weighted_beta(wxy, xbar, ybar);\n\n  return {\n    beta: beta,\n    xbar: xbar,\n    ybar: ybar,\n    x0: ybar - beta * xbar\n\n  };\n}\n\nfunction _calculate_lowess_fit(x, y, alpha, inc, residuals) {\n  // alpha - smoothing factor. 0 < alpha < 1/\n  //\n  //\n  var k = Math.floor(x.length * alpha);\n\n  var sorted_x = x.slice();\n\n  sorted_x.sort(function(a, b) {\n    if (a < b) {\n      return -1; } else if (a > b) {\n      return 1; }\n\n    return 0;\n  });\n\n  var x_max = d3.quantile(sorted_x, 0.98);\n  var x_min = d3.quantile(sorted_x, 0.02);\n\n  var xy = d3.zip(x, y, residuals).sort();\n\n  var size = Math.abs(x_max - x_min) / inc;\n\n  var smallest = x_min;\n  var largest = x_max;\n  var x_proto = d3.range(smallest, largest, size);\n\n  var xi_neighbors;\n  var x_i, beta_i, x0_i, delta_i, xbar, ybar;\n\n  // for each prototype, find its fit.\n  var y_proto = [];\n\n  for (var i = 0; i < x_proto.length; i += 1) {\n    x_i = x_proto[i];\n\n    // get k closest neighbors.\n    xi_neighbors = xy.map(function(xyi) {\n      return [\n        Math.abs(xyi[0] - x_i),\n        xyi[0],\n        xyi[1],\n        xyi[2]\n      ];\n    }).sort().slice(0, k);\n\n    // Get the largest distance in the neighbor set.\n    delta_i = d3.max(xi_neighbors)[0];\n\n    // Prepare the weights for mean calculation and WLS.\n\n    xi_neighbors = xi_neighbors.map(function(wxy) {\n      return {\n        w: _tricube_weight(wxy[0] / delta_i) * wxy[3],\n        x: wxy[1],\n        y: wxy[2]\n      };\n    });\n\n    // Find the weighted least squares, obviously.\n    var _output = _weighted_least_squares(xi_neighbors);\n\n    x0_i = _output.x0;\n    beta_i = _output.beta;\n\n    //\n    y_proto.push(x0_i + beta_i * x_i);\n  }\n\n  return { x: x_proto, y: y_proto };\n}\n\nfunction format_rollover_number(args) {\n  var num;\n  if (args.format === 'count') {\n    num = function(d) {\n      var is_float = d % 1 !== 0;\n      var pf;\n\n      if (is_float) {\n        pf = d3.format(',.' + args.decimals + 'f');\n      } else {\n        pf = d3.format(',.0f');\n      }\n\n      // are we adding units after the value or before?\n      if (args.yax_units_append) {\n        return pf(d) + args.yax_units;\n      } else {\n        return args.yax_units + pf(d);\n      }\n    };\n  } else {\n    num = function(d_) {\n      var fmt_string = (args.decimals ? '.' + args.decimals : '') + '%';\n      var pf = d3.format(fmt_string);\n      return pf(d_);\n    };\n  }\n  return num;\n}\n\nvar time_rollover_format = function(f, d, accessor, utc) {\n  var fd;\n  if (typeof f === 'string') {\n    fd = MG.time_format(utc, f)(d[accessor]);\n  } else if (typeof f === 'function') {\n    fd = f(d);\n  } else {\n    fd = d[accessor];\n  }\n  return fd;\n}\n\n// define our rollover format for numbers\nvar number_rollover_format = function(f, d, accessor) {\n  var fd;\n  if (typeof f === 'string') {\n    fd = d3.format('s')(d[accessor]);\n  } else if (typeof f === 'function') {\n    fd = f(d);\n  } else {\n    fd = d[accessor];\n  }\n  return fd;\n}\n\nfunction mg_format_y_rollover(args, num, d) {\n  var formatted_y;\n  if (args.y_mouseover !== null) {\n    if (args.aggregate_rollover) {\n      formatted_y = number_rollover_format(args.y_mouseover, d, args.y_accessor);\n    } else {\n      formatted_y = number_rollover_format(args.y_mouseover, d, args.y_accessor);\n    }\n  } else {\n    if (args.time_series) {\n      if (args.aggregate_rollover) {\n        formatted_y = num(d[args.y_accessor]);\n      } else {\n        formatted_y = args.yax_units + num(d[args.y_accessor]);\n      }\n    } else {\n      formatted_y = args.y_accessor + ': ' + args.yax_units + num(d[args.y_accessor]);\n    }\n  }\n  return formatted_y;\n}\n\nfunction mg_format_x_rollover(args, fmt, d) {\n  var formatted_x;\n  if (args.x_mouseover !== null) {\n    if (args.time_series) {\n      if (args.aggregate_rollover) {\n        formatted_x = time_rollover_format(args.x_mouseover, d, 'key', args.utc);\n      } else {\n        formatted_x = time_rollover_format(args.x_mouseover, d, args.x_accessor, args.utc);\n      }\n    } else {\n      formatted_x = number_rollover_format(args.x_mouseover, d, args.x_accessor);\n    }\n  } else {\n    if (args.time_series) {\n      var date;\n\n      if (args.aggregate_rollover && args.data.length > 1) {\n        date = new Date(d.key);\n      } else {\n        date = new Date(+d[args.x_accessor]);\n        date.setDate(date.getDate());\n      }\n\n      formatted_x = fmt(date) + '  ';\n    } else {\n      formatted_x = args.x_accessor + ': ' + d[args.x_accessor] + '   ';\n    }\n  }\n  return formatted_x;\n}\n\nfunction mg_format_data_for_mouseover(args, d, mouseover_fcn, accessor, check_time) {\n  var formatted_data, formatter;\n  var time_fmt = mg_get_rollover_time_format(args);\n  if (typeof d[accessor] === 'string') {\n    formatter = function(d) {\n      return d;\n    }\n  } else {\n    formatter = format_rollover_number(args);\n  }\n\n  if (mouseover_fcn !== null) {\n    if (check_time) formatted_data = time_rollover_format(mouseover_fcn, d, accessor, args.utc);\n    else formatted_data = number_rollover_format(mouseover_fcn, d, accessor);\n\n  } else {\n    if (check_time) formatted_data = time_fmt(new Date(+d[accessor])) + '  ';\n    else formatted_data = (args.time_series ? '' : accessor + ': ') + formatter(d[accessor]) + '   ';\n  }\n  return formatted_data;\n}\n\nfunction mg_format_number_mouseover(args, d) {\n  return mg_format_data_for_mouseover(args, d, args.x_mouseover, args.x_accessor, false);\n}\n\nfunction mg_format_x_mouseover(args, d) {\n  return mg_format_data_for_mouseover(args, d, args.x_mouseover, args.x_accessor, args.time_series);\n}\n\nfunction mg_format_y_mouseover(args, d) {\n  return mg_format_data_for_mouseover(args, d, args.y_mouseover, args.y_accessor, false);\n}\n\nfunction mg_format_x_aggregate_mouseover(args, d) {\n  return mg_format_data_for_mouseover(args, d, args.x_mouseover, 'key', args.time_series)\n}\n\nMG.format_rollover_number = format_rollover_number;\n\n// http://bl.ocks.org/mbostock/3916621\nfunction path_tween(d1, precision) {\n  return function() {\n    var path0 = this,\n      path1 = path0.cloneNode(),\n      n0 = path0.getTotalLength() || 0,\n      n1 = (path1.setAttribute(\"d\", d1), path1).getTotalLength() || 0;\n\n    // Uniform sampling of distance based on specified precision.\n    var distances = [0],\n      i = 0,\n      dt = precision / Math.max(n0, n1);\n    while ((i += dt) < 1) distances.push(i);\n    distances.push(1);\n\n    // Compute point-interpolators at each distance.\n    var points = distances.map(function(t) {\n      var p0 = path0.getPointAtLength(t * n0),\n        p1 = path1.getPointAtLength(t * n1);\n      return d3.interpolate([p0.x, p0.y], [p1.x, p1.y]);\n    });\n\n    return function(t) {\n      return t < 1 ? \"M\" + points.map(function(p) {\n        return p(t);\n      }).join(\"L\") : d1;\n    };\n  };\n}\n\nMG.path_tween = path_tween;\n\n// influenced by https://bl.ocks.org/tomgp/c99a699587b5c5465228\n\nfunction render_markup_for_server(callback) {\n  var virtual_window = MG.virtual_window;\n  var virtual_d3 = d3.select(virtual_window.document);\n  var target = virtual_window.document.createElement('div');\n\n  var original_d3 = global.d3;\n  var original_window = global.window;\n  var original_document = global.document;\n  global.d3 = virtual_d3;\n  global.window = virtual_window;\n  global.document = virtual_window.document;\n\n  var error;\n  try {\n    callback(target);\n  } catch(e) {\n    error = e;\n  }\n\n  global.d3 = original_d3;\n  global.window = original_window;\n  global.document = original_document;\n\n  if (error) {\n    throw error;\n  }\n\n  /* for some reason d3.select parses jsdom elements incorrectly\n   * but it works if we wrap the element in a function.\n   */\n  return virtual_d3.select(function targetFn() {\n    return target;\n  }).html();\n}\n\nfunction render_markup_for_client(callback) {\n  var target = document.createElement('div');\n  callback(target);\n  return d3.select(target).html();\n}\n\nfunction render_markup(callback) {\n  switch(typeof window) {\n    case 'undefined':\n      return render_markup_for_server(callback);\n    default:\n      return render_markup_for_client(callback);\n  }\n}\n\nfunction init_virtual_window(jsdom, force) {\n  if (MG.virtual_window && !force) {\n    return;\n  }\n\n  var doc = jsdom.jsdom({\n    html: '',\n    features: { QuerySelector: true }\n  });\n  MG.virtual_window = doc.defaultView;\n}\n\nMG.render_markup = render_markup;\nMG.init_virtual_window = init_virtual_window;\n\n// call this to add a warning icon to a graph and log an error to the console\nfunction error(args) {\n  console.error('ERROR : ', args.target, ' : ', args.error);\n\n  d3.select(args.target).select('.mg-chart-title')\n    .append('tspan')\n      .attr('class', 'fa fa-x fa-exclamation-circle mg-warning')\n      .attr('dx', '0.3em')\n      .text('\\uf06a');\n}\n\nfunction internal_error(args) {\n  console.error('INTERNAL ERROR : ', args.target, ' : ', args.internal_error);\n}\n\nMG.error = error;\n\nreturn MG;\n}));\n"]},"metadata":{},"sourceType":"module"}